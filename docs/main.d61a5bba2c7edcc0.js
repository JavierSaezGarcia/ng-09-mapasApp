(self.webpackChunkng_09_mapasApp=self.webpackChunkng_09_mapasApp||[]).push([[179],{339:(Xn,Bt,Ae)=>{"use strict";var G=Ae(481),Ee=Ae(256),Rt=Ae(322);const u=[{path:"mapas",loadChildren:()=>Ae.e(180).then(Ae.bind(Ae,180)).then(xn=>xn.MapasModule)},{path:"**",redirectTo:"mapas"}];class Te{static#e=this.\u0275fac=function(Ht){return new(Ht||Te)};static#t=this.\u0275mod=Ee.oAB({type:Te});static#n=this.\u0275inj=Ee.cJS({imports:[Rt.Bz.forRoot(u),Rt.Bz]})}var Nt=Ae(898),At=Ae(895);function vt(xn,wt){if(1&xn&&(Ee.TgZ(0,"li",9)(1,"a",10),Ee._uU(2),Ee.qZA()()),2&xn){const Ht=wt.$implicit;Ee.xp6(1),Ee.s9C("routerLink",Ht.ruta),Ee.xp6(1),Ee.hij(" ",Ht.nombre," ")}}class mt{constructor(){this.menuItems=[{ruta:"./mapas/fullscreen",nombre:"FullScreen"},{ruta:"./mapas/zoom-range",nombre:"Zoom Range"},{ruta:"./mapas/marcadores",nombre:"Marcadores"},{ruta:"./mapas/propiedades",nombre:"Propiedades"}]}static#e=this.\u0275fac=function(Ht){return new(Ht||mt)};static#t=this.\u0275cmp=Ee.Xpm({type:mt,selectors:[["app-menu"]],decls:9,vars:1,consts:[[1,"navbar","navbar-expand-md","navbar-light","bg-light","fixed-top"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["src","./assets/images/mapa.png","alt","","width","24","height","24",1,"d-inline-block","align-text-top"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse"],[1,"navbar-nav"],["class","nav-item",4,"ngFor","ngForOf"],[1,"nav-item"],["routerLinkActive","active",1,"nav-link",3,"routerLink"]],template:function(Ht,Xt){1&Ht&&(Ee.TgZ(0,"nav",0)(1,"div",1)(2,"a",2),Ee._UZ(3,"img",3),Ee.qZA(),Ee.TgZ(4,"button",4),Ee._UZ(5,"span",5),Ee.qZA(),Ee.TgZ(6,"div",6)(7,"ul",7),Ee.YNc(8,vt,3,2,"li",8),Ee.qZA()()()()),2&Ht&&(Ee.xp6(8),Ee.Q6J("ngForOf",Xt.menuItems))},dependencies:[At.sg,Rt.rH,Rt.Od],styles:["@keyframes _ngcontent-%COMP%_AnimateBG{0%{background-color:#fff}to{background-color:#ff6961}}li[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{background-color:#ff6961;color:#fff;animation:_ngcontent-%COMP%_AnimateBG .5s ease-in alternate}li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{padding-left:10px;color:#000000e6}"]})}class Qe{constructor(){this.title="ng-09-mapasApp"}ngOnInit(){Nt.accessToken="pk.eyJ1IjoiYmFuYmxlYWMiLCJhIjoiY2xhbDZ2eHBkMDJqcTNvdGEwazR0bmVqMyJ9.BJOQLtJ_YDi6kAbFcSBWYQ"}static#e=this.\u0275fac=function(Ht){return new(Ht||Qe)};static#t=this.\u0275cmp=Ee.Xpm({type:Qe,selectors:[["app-root"]],decls:2,vars:0,template:function(Ht,Xt){1&Ht&&Ee._UZ(0,"app-menu")(1,"router-outlet")},dependencies:[Rt.lC,mt]})}class It{static#e=this.\u0275fac=function(Ht){return new(Ht||It)};static#t=this.\u0275mod=Ee.oAB({type:It,bootstrap:[Qe]});static#n=this.\u0275inj=Ee.cJS({imports:[G.b2,Te]})}(0,Ee.G48)(),G.q6().bootstrapModule(It).catch(xn=>console.error(xn))},898:function(Xn){Xn.exports=function(){"use strict";var Bt,Ae,G;function Ee(u,Te){if(Bt)if(Ae){var Gt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Bt+")(sharedChunk); ("+Ae+")(sharedChunk); self.onerror = null;",Nt={};Bt(Nt),G=Te(Nt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(G.workerUrl=window.URL.createObjectURL(new Blob([Gt],{type:"text/javascript"})))}else Ae=Te;else Bt=Te}return Ee(0,function(u){var Te=typeof self<"u"?self:{},Gt="2.11.0";let Nt;const At={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Nt){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Nt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):n}catch{Nt=n}}return Nt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},vt={supported:!1,testSupport:function(n){!It&&Qe&&(xn?wt(n):mt=n)}};let mt,Qe,It=!1,xn=!1;function wt(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Qe),n.isContextLost())return;vt.supported=!0}catch{}n.deleteTexture(e),It=!0}Te.document&&(Qe=Te.document.createElement("img"),Qe.onload=function(){mt&&wt(mt),mt=null,xn=!0},Qe.onerror=function(){It=!0,mt=null},Qe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ht="01";var Xt=Lt;function Lt(n,e,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=a}Lt.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(void 0===e&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=h/m}var _=0,x=1;for(r=n,a=0;a<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<e));a++)n>h?_=r:x=r,r=.5*(x-_)+_;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var et=Yn;function Yn(n,e){this.x=n,this.y=e}Yn.prototype={clone:function(){return new Yn(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(n,e){var r=Math.cos(n),a=Math.sin(n),h=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Yn.convert=function(n){return n instanceof Yn?n:Array.isArray(n)?new Yn(n[0],n[1]):n};const Ut=Math.PI/180,Zt=180/Math.PI;function qe(n){return n*Ut}function Yt(n){return n*Zt}const Pt=[[0,0],[1,0],[1,1],[0,1]];function tn(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function st(n,e,r,a){const h=new Xt(n,e,r,a);return function(m){return h.solve(m)}}const kt=st(.25,.1,.25,1);function Ie(n,e,r){return Math.min(r,Math.max(e,n))}function Ne(n,e,r){return(r=Ie((r-n)/(e-n),0,1))*r*(3-2*r)}function Ye(n,e,r){const a=r-e,h=((n-e)%a+a)%a+e;return h===e?r:h}function Ve(n,e,r){if(!n.length)return r(null,[]);let a=n.length;const h=new Array(n.length);let m=null;n.forEach((_,x)=>{e(_,(w,D)=>{w&&(m=w),h[x]=D,0==--a&&r(m,h)})})}function Dt(n){const e=[];for(const r in n)e.push(n[r]);return e}function gt(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}let fn=1;function Gn(){return fn++}function lr(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function en(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Mr(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function gi(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function kn(n,e){return-1!==n.indexOf(e,n.length-e.length)}function hr(n,e,r){const a={};for(const h in n)a[h]=e.call(r||this,n[h],h,n);return a}function ui(n,e,r){const a={};for(const h in n)e.call(r||this,n[h],h,n)&&(a[h]=n[h]);return a}function cr(n){return Array.isArray(n)?n.map(cr):"object"==typeof n&&n?hr(n,cr):n}const ji={};function mn(n){ji[n]||(typeof console<"u"&&console.warn(n),ji[n]=!0)}function Sn(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function jn(n){let e=0;for(let r,a,h=0,m=n.length,_=m-1;h<m;_=h++)r=n[h],a=n[_],e+=(a.x-r.x)*(r.y+a.y);return e}function Ki(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Vi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,h,m)=>{const _=h||m;return e[a]=!_||_.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Jn=null;function Ar(n){if(null==Jn){const e=n.navigator?n.navigator.userAgent:null;Jn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Jn}function hi(n){try{const e=Te[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function $i(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Jr="mapbox-tiles";let Pr,uo,Is=500,ss=50;function Ji(){try{return Te.caches}catch{}}function _i(){Ji()&&!Pr&&(Pr=Te.caches.open(Jr))}function bn(n){const e=n.indexOf("?");if(e<0)return n;const a=function(h){const m=h.indexOf("?");return m>0?h.slice(m+1).split("&"):[]}(n).filter(h=>{const m=h.split("=");return"language"===m[0]||"worldview"===m[0]});return a.length?`${n.slice(0,e)}?${a.join("&")}`:n.slice(0,e)}let ur=1/0;const ut={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ut);class un extends Error{constructor(e,r,a){401===r&&Ri(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ss=Ki()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Te.location.protocol?Te.parent:Te).location.href,xr=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(Ss())&&!/^\w+:/.test(r))){if(Te.fetch&&Te.Request&&Te.AbortController&&Te.Request.prototype.hasOwnProperty("signal"))return function(a,h){const m=new Te.AbortController,_=new Te.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Ss(),signal:m.signal});let x=!1,w=!1;const D=(I=_.url).indexOf("sku=")>0&&Ri(I);var I;"json"===a.type&&_.headers.set("Accept","application/json");const A=(F,z,H)=>{if(w)return;if(F&&"SecurityError"!==F.message&&mn(F),z&&H)return P(z);const Y=Date.now();Te.fetch(_).then(le=>{if(le.ok){const me=D?le.clone():null;return P(le,me,Y)}return h(new un(le.statusText,le.status,a.url))}).catch(le=>{20!==le.code&&h(new Error(le.message))})},P=(F,z,H)=>{("arrayBuffer"===a.type?F.arrayBuffer():"json"===a.type?F.json():F.text()).then(Y=>{w||(z&&H&&function(le,me,ae){if(_i(),!Pr)return;const fe={status:me.status,statusText:me.statusText,headers:new Te.Headers};me.headers.forEach((Be,Fe)=>fe.headers.set(Fe,Be));const be=Vi(me.headers.get("Cache-Control")||"");if(be["no-store"])return;be["max-age"]&&fe.headers.set("Expires",new Date(ae+1e3*be["max-age"]).toUTCString());const _e=fe.headers.get("Expires");_e&&(new Date(_e).getTime()-ae<42e4||function(Be,Fe){if(void 0===uo)try{new Response(new ReadableStream),uo=!0}catch{uo=!1}uo?Fe(Be.body):Be.blob().then(Fe)}(me,Be=>{const Fe=new Te.Response(Be,fe);_i(),Pr&&Pr.then(He=>He.put(bn(le.url),Fe)).catch(He=>mn(He.message))}))}(_,z,H),x=!0,h(null,Y,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Y=>{w||h(new Error(Y.message))})};return D?function(F,z){if(_i(),!Pr)return z(null);const H=bn(F.url);Pr.then(Y=>{Y.match(H).then(le=>{const me=function(ae){if(!ae)return!1;const fe=new Date(ae.headers.get("Expires")||0),be=Vi(ae.headers.get("Cache-Control")||"");return fe>Date.now()&&!be["no-cache"]}(le);Y.delete(H),me&&Y.put(H,le.clone()),z(null,le,me)}).catch(z)}).catch(z)}(_,A):A(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(n,e);if(Ki()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(a,h){const m=new Te.XMLHttpRequest;m.open(a.method||"GET",a.url,!0),"arrayBuffer"===a.type&&(m.responseType="arraybuffer");for(const _ in a.headers)m.setRequestHeader(_,a.headers[_]);return"json"===a.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===a.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===a.type)try{_=JSON.parse(m.response)}catch(x){return h(x)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new un(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(n,e)},Zn=function(n,e){return xr(gt(n,{type:"arrayBuffer"}),e)};function Po(n){const e=Te.document.createElement("a");return e.href=n,e.protocol===Te.document.location.protocol&&e.host===Te.document.location.host}const Hn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ro,fr;Ro=[],fr=0;const Vr=function(n,e){if(vt.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),fr>=At.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ro.push(m),m}fr++;let r=!1;const a=()=>{if(!r)for(r=!0,fr--;Ro.length&&fr<At.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Ro.shift(),{requestParameters:_,callback:x,cancelled:w}=m;w||(m.cancel=Vr(_,x).cancel)}},h=Zn(n,(m,_,x,w)=>{a(),m?e(m):_&&(Te.createImageBitmap?function(D,I){const A=new Te.Blob([new Uint8Array(D)],{type:"image/png"});Te.createImageBitmap(A).then(P=>{I(null,P)}).catch(P=>{I(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,I)=>e(D,I,x,w)):function(D,I){const A=new Te.Image,P=Te.URL;A.onload=()=>{I(null,A),P.revokeObjectURL(A.src),A.onload=null,Te.requestAnimationFrame(()=>{A.src=Hn})},A.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Te.Blob([new Uint8Array(D)],{type:"image/png"});A.src=D.byteLength?P.createObjectURL(F):Hn}(_,(D,I)=>e(D,I,x,w)))});return{cancel:()=>{h.cancel(),a()}}},Rn="NO_ACCESS_TOKEN";function di(n){return 0===n.indexOf("mapbox:")}function Ri(n){return At.API_URL_REGEX.test(n)}function Ys(n){return At.API_STYLE_REGEX.test(n)&&!ho(n)}function ho(n){return At.API_SPRITE_REGEX.test(n)}const Ms=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ii(n){const e=n.match(Ms);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ki(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}function yi(n){if(!n)return null;const e=n.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Te.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class fo{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=yi(At.ACCESS_TOKEN);let a="";return a=r&&r.u?Te.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):At.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${a}`:`mapbox.eventData:${a}`}fetchEventData(){const e=hi("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const h=Te.localStorage.getItem(r);h&&(this.eventData=JSON.parse(h));const m=Te.localStorage.getItem(a);m&&(this.anonId=m)}catch{mn("Unable to read from LocalStorage")}}saveEventData(){const e=hi("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{Te.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&Te.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{mn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,h){if(!At.EVENTS_URL)return;const m=ii(At.EVENTS_URL);m.params.push(`access_token=${h||At.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString()},x=r?gt(_,r):_,w={url:ki(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};var I;this.pendingRequest=(I=D=>{this.pendingRequest=null,a(D),this.saveEventData(),this.processRequests(h)},xr(gt(w,{method:"POST"}),I))}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const ie=new class extends fo{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){At.EVENTS_URL&&At.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>di(r)||Ri(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=yi(At.ACCESS_TOKEN),r=e?e.u:At.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;Mr(this.anonId)||(this.anonId=lr(),a=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;a=a||x>=1||x<-1||m.getDate()!==_.getDate()}else a=!0;a?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Gt,skuId:Ht,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=r)},n):this.processRequests()}},U=ie.postTurnstileEvent.bind(ie),V=new class extends fo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,a){this.skuToken=e,this.errorCb=a,At.EVENTS_URL&&(r||At.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Rn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Mr(this.anonId)||(this.anonId=lr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Gt,skuId:Ht,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},oe=V.postMapLoadEvent.bind(V),he=new class extends fo{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){At.EVENTS_URL&&(n||At.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(h){const m=Te.performance.getEntriesByType("resource"),_=Te.performance.getEntriesByType("mark"),x=function(P){const F={};if(P)for(const z in P)if("other"!==z)for(const H of P[z]){const Y=`${z}RequestCount`,le=`${z}ResolveRangeMin`,me=`${z}ResolveRangeMax`;F[le]=Math.min(F[le]||1/0,H.startTime),F[me]=Math.max(F[me]||-1/0,H.responseEnd),void 0===F[Y]&&(F[Y]=0),++F[Y]}return F}(function(P,F){const z={};if(P)for(const H of P){const Y=F(H);void 0===z[Y]&&(z[Y]=[]),z[Y].push(H)}return z}(m,te)),w=Te.devicePixelRatio,D=Te.navigator.connection||Te.navigator.mozConnection||Te.navigator.webkitConnection,I={counters:[],metadata:[],attributes:[]},A=(P,F,z)=>{null!=z&&P.push({name:F,value:z.toString()})};for(const P in x)A(I.counters,P,x[P]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(A(I.counters,"interactionRangeMin",h.interactionRange[0]),A(I.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const P of Object.keys(Q)){const F=Q[P],z=_.find(H=>H.name===F);z&&A(I.counters,F,z.startTime)}return A(I.attributes,"style",function(P){if(P)for(const F of P){const z=F.name.split("?")[0];if(Ys(z)){const H=z.split("/").slice(-2);if(2===H.length)return`mapbox://styles/${H[0]}/${H[1]}`}}}(m)),A(I.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),A(I.attributes,"fogEnabled",h.fogEnabled?"true":"false"),A(I.attributes,"projection",h.projection.name),A(I.attributes,"zoom",h.zoom),A(I.metadata,"devicePixelRatio",w),A(I.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),A(I.metadata,"navigatorUserAgent",Te.navigator.userAgent),A(I.metadata,"screenWidth",Te.screen.width),A(I.metadata,"screenHeight",Te.screen.height),A(I.metadata,"windowWidth",Te.innerWidth),A(I.metadata,"windowHeight",Te.innerHeight),A(I.metadata,"mapWidth",h.width/w),A(I.metadata,"mapHeight",h.height/w),A(I.metadata,"webglRenderer",h.renderer),A(I.metadata,"webglVendor",h.vendor),A(I.metadata,"sdkVersion",Gt),A(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(r);for(const h of a.metadata);for(const h of a.counters);for(const h of a.attributes);this.postEvent(e,a,()=>{},n)}},ye=he.postPerformanceEvent.bind(he),Pe=new class extends fo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,a){if(!At.API_URL||!At.SESSION_PATH)return;const h=ii(At.API_URL+At.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${a||At.ACCESS_TOKEN||""}`);const m={url:ki(h),headers:{"Content-Type":"text/plain"}};var x;this.pendingRequest=(x=_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(a)},xr(gt(m,{method:"GET"}),x))}getSessionAPI(n,e,r,a){this.skuToken=e,this.errorCb=a,At.SESSION_PATH&&At.API_URL&&(r||At.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(Rn)))}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},Me=Pe.getSessionAPI.bind(Pe),we=new Set,Q={create:"create",load:"load",fullLoad:"fullLoad"},ee={mark(n){Te.performance.mark(n)},measure(n,e,r){Te.performance.measure(n,e,r)}};function te(n){const e=n.name.split("?")[0];return e.includes("mapbox-gl.js")?"javascript":e.includes("mapbox-gl.css")?"css":At.API_FONTS_REGEX.test(e)?"fontRange":ho(e)?"sprite":Ys(e)?"style":At.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const de=Te.performance;function Re(n){const e=n?n.url.toString():void 0;return de.getEntriesByName(e)}let rt,We,Ot,nn;const Ln={now:()=>void 0!==Ot?Ot:Te.performance.now(),setNow(n){Ot=n},restoreNow(){Ot=void 0},frame(n){const e=Te.requestAnimationFrame(n);return{cancel:()=>Te.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:a}=n;nn||(nn=Te.document.createElement("canvas"));const h=nn.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(r>nn.width||a>nn.height)&&(nn.width=r,nn.height=a),h.clearRect(-e,-e,r+2*e,a+2*e),h.drawImage(n,0,0,r,a),h.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:n=>(rt||(rt=Te.document.createElement("a")),rt.href=n,rt.href),get devicePixelRatio(){return Te.devicePixelRatio},get prefersReducedMotion(){return!!Te.matchMedia&&(null==We&&(We=Te.matchMedia("(prefers-reduced-motion: reduce)")),We.matches)}};function Jt(n,e,r){r[n]&&-1!==r[n].indexOf(e)||(r[n]=r[n]||[],r[n].push(e))}function On(n,e,r){if(r&&r[n]){const a=r[n].indexOf(e);-1!==a&&r[n].splice(a,1)}}class qn{constructor(e,r={}){gt(this,r),this.type=e}}class po extends qn{constructor(e,r={}){super("error",gt({error:e},r))}}class mo{on(e,r){return this._listeners=this._listeners||{},Jt(e,r,this._listeners),this}off(e,r){return On(e,r,this._listeners),On(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){"string"==typeof e&&(e=new qn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const x of h)x.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const x of m)On(a,x,this._oneTimeListeners),x.call(this,e);const _=this._eventedParent;_&&(gt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof po&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qi(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}function Rr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function ko(n){if(Array.isArray(n))return n.map(ko);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=ko(n[r]);return e}return Rr(n)}class Tl extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Li=Tl;class As{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,h]of r)this.bindings[a]=h}concat(e){return new As(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var qo=As;const Un={kind:"null"},dt={kind:"number"},on={kind:"string"},_n={kind:"boolean"},kr={kind:"color"},Hr={kind:"object"},ot={kind:"value"},pn={kind:"collator"},ir={kind:"formatted"},Zr={kind:"resolvedImage"};function $r(n,e){return{kind:"array",itemType:n,N:e}}function yn(n){if("array"===n.kind){const e=yn(n.itemType);return"number"==typeof n.N?`array<${e}, ${n.N}>`:"value"===n.itemType.kind?"array":`array<${e}>`}return n.kind}const Ps=[Un,dt,on,_n,kr,ir,Hr,$r(ot),Zr];function or(n,e){if("error"===e.kind)return null;if("array"===n.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!or(n.itemType,e.itemType))&&("number"!=typeof n.N||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if("value"===n.kind)for(const r of Ps)if(!or(r,e))return null}return`Expected ${yn(n)} but found ${yn(e)} instead.`}function Lo(n,e){return e.some(r=>r.kind===n.kind)}function oi(n,e){return e.some(r=>"null"===r?null===n:"array"===r?Array.isArray(n):"object"===r?n&&!Array.isArray(n)&&"object"==typeof n:r===typeof n)}var En,go={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function as(n){return(n=Math.round(n))<0?0:n>255?255:n}function Qr(n){return as("%"===n[n.length-1]?parseFloat(n)/100*255:parseInt(n))}function _o(n){return(e="%"===n[n.length-1]?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function Lr(n,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(e-n)*r*6:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n}try{En={}.parseCSSColor=function(n){var e,r=n.replace(/ /g,"").toLowerCase();if(r in go)return go[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),h=r.indexOf(")");if(-1!==a&&h+1===r.length){var m=r.substr(0,a),_=r.substr(a+1,h-(a+1)).split(","),x=1;switch(m){case"rgba":if(4!==_.length)return null;x=_o(_.pop());case"rgb":return 3!==_.length?null:[Qr(_[0]),Qr(_[1]),Qr(_[2]),x];case"hsla":if(4!==_.length)return null;x=_o(_.pop());case"hsl":if(3!==_.length)return null;var w=(parseFloat(_[0])%360+360)%360/360,D=_o(_[1]),I=_o(_[2]),A=I<=.5?I*(D+1):I+D-I*D,P=2*I-A;return[as(255*Lr(P,A,w+1/3)),as(255*Lr(P,A,w)),as(255*Lr(P,A,w-1/3)),x];default:return null}}return null}}catch{}class qr{constructor(e,r,a,h=1){this.r=e,this.g=r,this.b=a,this.a=h}static parse(e){if(!e)return;if(e instanceof qr)return e;if("string"!=typeof e)return;const r=En(e);return r?new qr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${h})`}toArray(){const{r:e,g:r,b:a,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*r/h,255*a/h,h]}toArray01(){const{r:e,g:r,b:a,a:h}=this;return 0===h?[0,0,0,0]:[e/h,r/h,a/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:h}=this;return[e,r,a,h]}}qr.black=new qr(0,0,0,1),qr.white=new qr(1,1,1,1),qr.transparent=new qr(0,0,0,0),qr.red=new qr(1,0,0,1),qr.blue=new qr(0,0,1,1);var Wn=qr;class Mi{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oi{constructor(e,r,a,h,m){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=h,this.textColor=m}}class ei{constructor(e){this.sections=e}static fromString(e){return new ei([new Oi(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ei?e:ei.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class zn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new zn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function rc(n,e,r,a){return"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof a?[n,e,r,a]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rs(n){if(null===n||"string"==typeof n||"boolean"==typeof n||"number"==typeof n||n instanceof Wn||n instanceof Mi||n instanceof ei||n instanceof zn)return!0;if(Array.isArray(n)){for(const e of n)if(!Rs(e))return!1;return!0}if("object"==typeof n){for(const e in n)if(!Rs(n[e]))return!1;return!0}return!1}function Or(n){if(null===n)return Un;if("string"==typeof n)return on;if("boolean"==typeof n)return _n;if("number"==typeof n)return dt;if(n instanceof Wn)return kr;if(n instanceof Mi)return pn;if(n instanceof ei)return ir;if(n instanceof zn)return Zr;if(Array.isArray(n)){const e=n.length;let r;for(const a of n){const h=Or(a);if(r){if(r===h)continue;r=ot;break}r=h}return $r(r||ot,e)}return Hr}function ks(n){const e=typeof n;return null===n?"":"string"===e||"number"===e||"boolean"===e?String(n):n instanceof Wn||n instanceof ei||n instanceof zn?n.toString():JSON.stringify(n)}class Ls{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(2!==e.length)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Rs(e[1]))return r.error("invalid value");const a=e[1];let h=Or(a);const m=r.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Ls(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Wn?["rgba"].concat(this.value.toArray()):this.value instanceof ei?this.value.serialize():this.value}}var ls=Ls,Fr=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const si={string:on,number:dt,boolean:_n,object:Hr};class Cl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,h=1;const m=e[0];if("array"===m){let x,w;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in si)||"object"===D)return r.error('The item type argument of "array" must be one of string, number, boolean',1);x=si[D],h++}else x=ot;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}a=$r(x,w)}else a=si[m];const _=[];for(;h<e.length;h++){const x=r.parse(e[h],h,ot);if(!x)return null;_.push(x)}return new Cl(a,_)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!or(this.type,Or(a)))return a;if(r===this.args.length-1)throw new Fr(`Expected value to be of type ${yn(this.type)}, but found ${yn(Or(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if("array"===e.kind){const a=e.itemType;if("string"===a.kind||"number"===a.kind||"boolean"===a.kind){r.push(a.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&r.push(h)}}return r.concat(this.args.map(a=>a.serialize()))}}var zr=Cl;class ai{constructor(e){this.type=ir,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&"object"==typeof a)return r.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=r.parse(x["font-scale"],1,dt),!w))return null;let D=null;if(x["text-font"]&&(D=r.parse(x["text-font"],1,$r(on)),!D))return null;let I=null;if(x["text-color"]&&(I=r.parse(x["text-color"],1,kr),!I))return null;const A=h[h.length-1];A.scale=w,A.font=D,A.textColor=I}else{const w=r.parse(e[_],1,ot);if(!w)return null;const D=w.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new ai(h)}evaluate(e){return new ei(this.sections.map(r=>{const a=r.content.evaluate(e);return Or(a)===Zr?new Oi("",a,null,null,null):new Oi(ks(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class cs{constructor(e){this.type=Zr,this.input=e}static parse(e,r){if(2!==e.length)return r.error("Expected two arguments.");const a=r.parse(e[1],1,on);return a?new cs(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=zn.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _a={"to-boolean":_n,"to-color":kr,"to-number":dt,"to-string":on};class Os{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(("to-boolean"===a||"to-string"===a)&&2!==e.length)return r.error("Expected one argument.");const h=_a[a],m=[];for(let _=1;_<e.length;_++){const x=r.parse(e[_],_,ot);if(!x)return null;m.push(x)}return new Os(h,m)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let r,a;for(const h of this.args){if(r=h.evaluate(e),a=null,r instanceof Wn)return r;if("string"==typeof r){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:rc(r[0],r[1],r[2],r[3]),!a))return new Wn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Fr(a||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const a of this.args){if(r=a.evaluate(e),null===r)return 0;const h=Number(r);if(!isNaN(h))return h}throw new Fr(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?ei.fromString(ks(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?zn.fromString(ks(this.args[0].evaluate(e))):ks(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ai([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new cs(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var li=Os;const ya=["Unknown","Point","LineString","Polygon"];var yo=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ya[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-n[0])+this.featureDistanceData.bearing[1]*(a*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Wn.parse(n)),e}};class eo{constructor(e,r,a,h){this.name=e,this.type=r,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],h=eo.definitions[a];if(!h)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let w=null;for(const[D,I]of x){w=new Ha(r.registry,r.path,null,r.scope);const A=[];let P=!1;for(let F=1;F<e.length;F++){const z=e[F],H=Array.isArray(D)?D[F-1]:D.type,Y=w.parse(z,1+A.length,H);if(!Y){P=!0;break}A.push(Y)}if(!P)if(Array.isArray(D)&&D.length!==A.length)w.error(`Expected ${D.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const z=Array.isArray(D)?D[F]:D.type,H=A[F];w.concat(F+1).checkSubtype(z,H.type)}if(0===w.errors.length)return new eo(a,m,I,A)}}if(1===x.length)r.errors.push(...w.errors);else{const D=(x.length?x:_).map(([A])=>{return P=A,Array.isArray(P)?`(${P.map(yn).join(", ")})`:`(${yn(P.type)}...)`;var P}).join(" | "),I=[];for(let A=1;A<e.length;A++){const P=r.parse(e[A],1+I.length);if(!P)return null;I.push(yn(P.type))}r.error(`Expected arguments of type ${D}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){eo.definitions=r;for(const a in r)e[a]=eo}}var vo=eo;class Ua{constructor(e,r,a){this.type=pn,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(2!==e.length)return r.error("Expected one argument.");const a=e[1];if("object"!=typeof a||Array.isArray(a))return r.error("Collator options argument must be an object.");const h=r.parse(void 0!==a["case-sensitive"]&&a["case-sensitive"],1,_n);if(!h)return null;const m=r.parse(void 0!==a["diacritic-sensitive"]&&a["diacritic-sensitive"],1,_n);if(!m)return null;let _=null;return a.locale&&(_=r.parse(a.locale,1,on),!_)?null:new Ua(h,m,_)}evaluate(e){return new Mi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const us=8192;function Fs(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ja(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Wo(n,e){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*us),Math.round(a*h*us)]}function Il(n,e,r){const a=n[0]-e[0],h=n[1]-e[1],m=n[0]-r[0],_=n[1]-r[1];return a*_-m*h==0&&a*m<=0&&h*_<=0}function Sl(n,e){let r=!1;for(let _=0,x=e.length;_<x;_++){const w=e[_];for(let D=0,I=w.length;D<I-1;D++){if(Il(n,w[D],w[D+1]))return!1;(h=w[D])[1]>(a=n)[1]!=(m=w[D+1])[1]>a[1]&&a[0]<(m[0]-h[0])*(a[1]-h[1])/(m[1]-h[1])+h[0]&&(r=!r)}}var a,h,m;return r}function ic(n,e){for(let r=0;r<e.length;r++)if(Sl(n,e[r]))return!0;return!1}function oc(n,e,r,a){const h=a[0]-r[0],m=a[1]-r[1],_=(n[0]-r[0])*m-h*(n[1]-r[1]),x=(e[0]-r[0])*m-h*(e[1]-r[1]);return _>0&&x<0||_<0&&x>0}function sc(n,e,r){for(const D of r)for(let I=0;I<D.length-1;++I)if((x=[(_=D[I+1])[0]-(m=D[I])[0],_[1]-m[1]])[0]*(w=[(h=e)[0]-(a=n)[0],h[1]-a[1]])[1]-x[1]*w[0]!=0&&oc(a,h,m,_)&&oc(m,_,a,h))return!0;var a,h,m,_,x,w;return!1}function Va(n,e){for(let r=0;r<n.length;++r)if(!Sl(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(sc(n[r],n[r+1],e))return!1;return!0}function ac(n,e){for(let r=0;r<e.length;r++)if(Va(n,e[r]))return!0;return!1}function xo(n,e,r){const a=[];for(let h=0;h<n.length;h++){const m=[];for(let _=0;_<n[h].length;_++){const x=Wo(n[h][_],r);Fs(e,x),m.push(x)}a.push(m)}return a}function lc(n,e,r){const a=[];for(let h=0;h<n.length;h++){const m=xo(n[h],e,r);a.push(m)}return a}function Ml(n,e,r,a){if(n[0]<r[0]||n[0]>r[2]){const h=.5*a;let m=n[0]-r[0]>h?-a:r[0]-n[0]>h?a:0;0===m&&(m=n[0]-r[2]>h?-a:r[2]-n[0]>h?a:0),n[0]+=m}Fs(e,n)}function hs(n,e,r,a){const h=Math.pow(2,a.z)*us,m=[a.x*us,a.y*us],_=[];if(!n)return _;for(const x of n)for(const w of x){const D=[w.x+m[0],w.y+m[1]];Ml(D,e,r,h),_.push(D)}return _}function cc(n,e,r,a){const h=Math.pow(2,a.z)*us,m=[a.x*us,a.y*us],_=[];if(!n)return _;for(const w of n){const D=[];for(const I of w){const A=[I.x+m[0],I.y+m[1]];Fs(e,A),D.push(A)}_.push(D)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const D of w)Ml(D,e,r,h)}var x;return _}class to{constructor(e,r){this.type=_n,this.geojson=e,this.geometries=r}static parse(e,r){if(2!==e.length)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Rs(e[1])){const a=e[1];if("FeatureCollection"===a.type)for(let h=0;h<a.features.length;++h){const m=a.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new to(a,a.features[h].geometry)}else if("Feature"===a.type){const h=a.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new to(a,a.geometry)}else if("Polygon"===a.type||"MultiPolygon"===a.type)return new to(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(r,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if("Polygon"===a.type){const x=xo(a.coordinates,m,_),w=hs(r.geometry(),h,m,_);if(!ja(h,m))return!1;for(const D of w)if(!Sl(D,x))return!1}if("MultiPolygon"===a.type){const x=lc(a.coordinates,m,_),w=hs(r.geometry(),h,m,_);if(!ja(h,m))return!1;for(const D of w)if(!ic(D,x))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(r,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(!_)return!1;if("Polygon"===a.type){const x=xo(a.coordinates,m,_),w=cc(r.geometry(),h,m,_);if(!ja(h,m))return!1;for(const D of w)if(!Va(D,x))return!1}if("MultiPolygon"===a.type){const x=lc(a.coordinates,m,_),w=cc(r.geometry(),h,m,_);if(!ja(h,m))return!1;for(const D of w)if(!ac(D,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Kn=to;function no(n){if(n instanceof vo&&("get"===n.name&&1===n.args.length||"feature-state"===n.name||"has"===n.name&&1===n.args.length||"properties"===n.name||"geometry-type"===n.name||"id"===n.name||/^filter-/.test(n.name))||n instanceof Kn)return!1;let e=!0;return n.eachChild(r=>{e&&!no(r)&&(e=!1)}),e}function $a(n){if(n instanceof vo&&"feature-state"===n.name)return!1;let e=!0;return n.eachChild(r=>{e&&!$a(r)&&(e=!1)}),e}function Oo(n,e){if(n instanceof vo&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(a=>{r&&!Oo(a,e)&&(r=!1)}),r}class Xo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Xo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ga=Xo;class zs{constructor(e,r=[],a,h=new qo,m=[]){this.registry=e,this.path=r,this.key=r.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=a}parse(e,r,a,h,m={}){return r?this.concat(r,a,h)._parse(e,m):this._parse(e,m)}_parse(e,r){function a(h,m,_){return"assert"===_?new zr(m,[h]):"coerce"===_?new li(m,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(e,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else _=a(_,x,r.typeAnnotation||"coerce");else _=a(_,x,r.typeAnnotation||"assert")}if(!(_ instanceof ls)&&"resolvedImage"!==_.type.kind&&Bs(_)){const x=new yo;try{_=new ls(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const h="number"==typeof e?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new zs(this.registry,h,r||null,m,this.errors)}error(e,...r){const a=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new Li(a,e))}checkSubtype(e,r){const a=or(e,r);return a&&this.error(a),a}}var Ha=zs;function Bs(n){if(n instanceof Ga)return Bs(n.boundExpression);if(n instanceof vo&&"error"===n.name||n instanceof Ua||n instanceof Kn)return!1;const e=n instanceof li||n instanceof zr;let r=!0;return n.eachChild(a=>{r=e?r&&Bs(a):r&&a instanceof ls}),!!r&&no(n)&&Oo(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function va(n,e){const r=n.length-1;let a,h,m=0,_=r,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),a=n[x],h=n[x+1],a<=e){if(x===r||e<h)return x;m=x+1}else{if(!(a>e))throw new Fr("Input is not a number.");_=x-1}return 0}class Yo{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,dt);if(!a)return null;const h=[];let m=null;r.expectedType&&"value"!==r.expectedType.kind&&(m=r.expectedType);for(let _=1;_<e.length;_+=2){const x=1===_?-1/0:e[_],w=e[_+1],D=_,I=_+1;if("number"!=typeof x)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=x)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const A=r.parse(w,I,m);if(!A)return null;m=m||A.type,h.push([x,A])}return new Yo(m,a,h)}evaluate(e){const r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const m=r.length;return h>=r[m-1]?a[m-1].evaluate(e):a[va(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var xa=Yo;function Dn(n,e,r){return n*(1-r)+e*r}var Ns=Object.freeze({__proto__:null,number:Dn,color:function(n,e,r){return new Wn(Dn(n.r,e.r,r),Dn(n.g,e.g,r),Dn(n.b,e.b,r),Dn(n.a,e.a,r))},array:function(n,e,r){return n.map((a,h)=>Dn(a,e[h],r))}});const uc=4/29,Al=6/29,Br=3*Al*Al,ro=Math.PI/180,hc=180/Math.PI;function Fo(n){return n>.008856451679035631?Math.pow(n,1/3):n/Br+uc}function vi(n){return n>Al?n*n*n:Br*(n-uc)}function Pl(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Ks(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function bo(n){const e=Ks(n.r),r=Ks(n.g),a=Ks(n.b),h=Fo((.4124564*e+.3575761*r+.1804375*a)/.95047),m=Fo((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Fo((.0193339*e+.119192*r+.9503041*a)/1.08883)),alpha:n.a}}function er(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*vi(e),r=.95047*vi(r),a=1.08883*vi(a),new Wn(Pl(3.2404542*r-1.5371385*e-.4985314*a),Pl(-.969266*r+1.8760108*e+.041556*a),Pl(.0556434*r-.2040259*e+1.0572252*a),n.alpha)}function Du(n,e,r){const a=e-n;return n+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const io={forward:bo,reverse:er,interpolate:function(n,e,r){return{l:Dn(n.l,e.l,r),a:Dn(n.a,e.a,r),b:Dn(n.b,e.b,r),alpha:Dn(n.alpha,e.alpha,r)}}},ds={forward:function(n){const{l:e,a:r,b:a}=bo(n),h=Math.atan2(a,r)*hc;return{h:h<0?h+360:h,c:Math.sqrt(r*r+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*ro,r=n.c;return er({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:Du(n.h,e.h,r),c:Dn(n.c,e.c,r),l:Dn(n.l,e.l,r),alpha:Dn(n.alpha,e.alpha,r)}}};var fs=Object.freeze({__proto__:null,lab:io,hcl:ds});class Wa{constructor(e,r,a,h,m){this.type=e,this.operator=r,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,r,a,h){let m=0;if("exponential"===e.name)m=Ko(r,e.base,a,h);else if("linear"===e.name)m=Ko(r,1,a,h);else if("cubic-bezier"===e.name){const _=e.controlPoints;m=new Xt(_[0],_[1],_[2],_[3]).solve(Ko(r,1,a,h))}return m}static parse(e,r){let[a,h,m,..._]=e;if(!Array.isArray(h)||0===h.length)return r.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const D=h[1];if("number"!=typeof D)return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if("cubic-bezier"!==h[0])return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(4!==D.length||D.some(I=>"number"!=typeof I||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,dt),!m)return null;const x=[];let w=null;"interpolate-hcl"===a||"interpolate-lab"===a?w=kr:r.expectedType&&"value"!==r.expectedType.kind&&(w=r.expectedType);for(let D=0;D<_.length;D+=2){const I=_[D],A=_[D+1],P=D+3,F=D+4;if("number"!=typeof I)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=r.parse(A,F,w);if(!z)return null;w=w||z.type,x.push([I,z])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Wa(w,a,h,m,x):r.error(`Type ${yn(w)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(1===r.length)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const m=r.length;if(h>=r[m-1])return a[m-1].evaluate(e);const _=va(r,h),x=Wa.interpolationFactor(this.interpolation,h,r[_],r[_+1]),w=a[_].evaluate(e),D=a[_+1].evaluate(e);return"interpolate"===this.operator?Ns[this.type.kind.toLowerCase()](w,D,x):"interpolate-hcl"===this.operator?ds.reverse(ds.interpolate(ds.forward(w),ds.forward(D),x)):io.reverse(io.interpolate(io.forward(w),io.forward(D),x))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Ko(n,e,r,a){const h=a-r,m=n-r;return 0===h?0:1===e?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}var sn=Wa;class Rl{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const h=r.expectedType;h&&"value"!==h.kind&&(a=h);const m=[];for(const x of e.slice(1)){const w=r.parse(x,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!w)return null;a=a||w.type,m.push(w)}const _=h&&m.some(x=>or(h,x.type));return new Rl(_?ot:a,m)}evaluate(e){let r,a=null,h=0;for(const m of this.args){if(h++,a=m.evaluate(e),a&&a instanceof zn&&!a.available&&(r||(r=a),a=null,h===this.args.length))return r;if(null!==a)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Tu=Rl;class dc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if("string"!=typeof _)return r.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=r.parse(e[m+1],m+1);if(!x)return null;a.push([_,x])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return h?new dc(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var Xa=dc;class Ya{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,dt),h=r.parse(e[2],2,$r(r.expectedType||ot));return a&&h?new Ya(h.type.itemType,a,h):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Fr(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Fr(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Fr(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var kl=Ya;class Ka{constructor(e,r){this.type=_n,this.needle=e,this.haystack=r}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ot),h=r.parse(e[2],2,ot);return a&&h?Lo(a.type,[_n,on,dt,Un,ot])?new Ka(a,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(null==a)return!1;if(!oi(r,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${yn(Or(r))} instead.`);if(!oi(a,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${yn(Or(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ba=Ka;class lt{constructor(e,r,a){this.type=dt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ot),h=r.parse(e[2],2,ot);if(!a||!h)return null;if(!Lo(a.type,[_n,on,dt,Un,ot]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${yn(a.type)} instead`);if(4===e.length){const m=r.parse(e[3],3,dt);return m?new lt(a,h,m):null}return new lt(a,h)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!oi(r,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${yn(Or(r))} instead.`);if(!oi(a,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${yn(Or(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(r,h)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Vn=lt;class wo{constructor(e,r,a,h,m,_){this.inputType=e,this.type=r,this.input=a,this.cases=h,this.outputs=m,this.otherwise=_}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,h;r.expectedType&&"value"!==r.expectedType.kind&&(h=r.expectedType);const m={},_=[];for(let D=2;D<e.length-1;D+=2){let I=e[D];const A=e[D+1];Array.isArray(I)||(I=[I]);const P=r.concat(D);if(0===I.length)return P.error("Expected at least one branch label.");for(const z of I){if("number"!=typeof z&&"string"!=typeof z)return P.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,Or(z)))return null}else a=Or(z);if(void 0!==m[String(z)])return P.error("Branch labels must be unique.");m[String(z)]=_.length}const F=r.parse(A,D,h);if(!F)return null;h=h||F.type,_.push(F)}const x=r.parse(e[1],1,ot);if(!x)return null;const w=r.parse(e[e.length-1],e.length-1,h);return w?"value"!==x.type.kind&&r.concat(1).checkSubtype(a,x.type)?null:new wo(a,h,x,m,_,w):null}evaluate(e){const r=this.input.evaluate(e);return(Or(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],h={};for(const _ of r){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[x][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of a)e.push(1===x.length?m(x[0]):x.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var Ll=wo;class ti{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&"value"!==r.expectedType.kind&&(a=r.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const x=r.parse(e[_],_,_n);if(!x)return null;const w=r.parse(e[_+1],_+1,a);if(!w)return null;h.push([x,w]),a=a||w.type}const m=r.parse(e[e.length-1],e.length-1,a);return m?new ti(a,h,m):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Ol=ti;class Us{constructor(e,r,a,h){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ot),h=r.parse(e[2],2,dt);if(!a||!h)return null;if(!Lo(a.type,[$r(ot),on,ot]))return r.error(`Expected first argument to be of type array or string, but found ${yn(a.type)} instead`);if(4===e.length){const m=r.parse(e[3],3,dt);return m?new Us(a.type,a,h,m):null}return new Us(a.type,a,h)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!oi(r,["string","array"]))throw new Fr(`Expected first argument to be of type array or string, but found ${yn(Or(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return r.slice(a,h)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var oo=Us;function Ja(n,e){return"=="===n||"!="===n?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Qa(n,e,r,a){return 0===a.compare(e,r)}function el(n,e,r){const a="=="!==n&&"!="!==n;return class Px{constructor(m,_,x){this.type=_n,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const x=m[0];let w=_.parse(m[1],1,ot);if(!w)return null;if(!Ja(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${yn(w.type)}'.`);let D=_.parse(m[2],2,ot);if(!D)return null;if(!Ja(x,D.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${yn(D.type)}'.`);if(w.type.kind!==D.type.kind&&"value"!==w.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${yn(w.type)}' and '${yn(D.type)}'.`);a&&("value"===w.type.kind&&"value"!==D.type.kind?w=new zr(D.type,[w]):"value"!==w.type.kind&&"value"===D.type.kind&&(D=new zr(w.type,[D])));let I=null;if(4===m.length){if("string"!==w.type.kind&&"string"!==D.type.kind&&"value"!==w.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(m[3],3,pn),!I)return null}return new Px(w,D,I)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const w=Or(_),D=Or(x);if(w.kind!==D.kind||"string"!==w.kind&&"number"!==w.kind)throw new Fr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${D.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const w=Or(_),D=Or(x);if("string"!==w.kind||"string"!==D.kind)return e(m,_,x)}return this.collator?r(m,_,x,this.collator.evaluate(m)):e(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[n];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const Cu=el("==",function(n,e,r){return e===r},Qa),Iu=el("!=",function(n,e,r){return e!==r},function(n,e,r,a){return!Qa(0,e,r,a)}),fc=el("<",function(n,e,r){return e<r},function(n,e,r,a){return a.compare(e,r)<0}),fi=el(">",function(n,e,r){return e>r},function(n,e,r,a){return a.compare(e,r)>0}),zo=el("<=",function(n,e,r){return e<=r},function(n,e,r,a){return a.compare(e,r)<=0}),Js=el(">=",function(n,e,r){return e>=r},function(n,e,r,a){return a.compare(e,r)>=0});class Bo{constructor(e,r,a,h,m,_){this.type=on,this.number=e,this.locale=r,this.currency=a,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(e,r){if(3!==e.length)return r.error("Expected two arguments.");const a=r.parse(e[1],1,dt);if(!a)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=r.parse(h.locale,1,on),!m))return null;let _=null;if(h.currency&&(_=r.parse(h.currency,1,on),!_))return null;let x=null;if(h.unit&&(x=r.parse(h.unit,1,on),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=r.parse(h["min-fraction-digits"],1,dt),!w))return null;let D=null;return h["max-fraction-digits"]&&(D=r.parse(h["max-fraction-digits"],1,dt),!D)?null:new Bo(a,m,_,x,w,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Eo{constructor(e){this.type=dt,this.input=e}static parse(e,r){if(2!==e.length)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?"array"!==a.type.kind&&"string"!==a.type.kind&&"value"!==a.type.kind?r.error(`Expected argument of type string or array, but found ${yn(a.type)} instead.`):new Eo(a):null}evaluate(e){const r=this.input.evaluate(e);if("string"==typeof r||Array.isArray(r))return r.length;throw new Fr(`Expected value to be of type string or array, but found ${yn(Or(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const pc={"==":Cu,"!=":Iu,">":fi,"<":fc,">=":Js,"<=":zo,array:zr,at:kl,boolean:zr,case:Ol,coalesce:Tu,collator:Ua,format:ai,image:cs,in:ba,"index-of":Vn,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:Eo,let:Xa,literal:ls,match:Ll,number:zr,"number-format":Bo,object:zr,slice:oo,step:xa,string:zr,"to-boolean":li,"to-color":li,"to-number":li,"to-string":li,var:Ga,within:Kn};function mc(n,[e,r,a,h]){e=e.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const m=h?h.evaluate(n):1,_=rc(e,r,a,m);if(_)throw new Fr(_);return new Wn(e/255*m,r/255*m,a/255*m,m)}function Hc(n,e){return n in e}function wa(n,e){const r=e[n];return void 0===r?null:r}function Jo(n){return{type:n}}vo.register(pc,{error:[{kind:"error"},[on],(n,[e])=>{throw new Fr(e.evaluate(n))}],typeof:[on,[ot],(n,[e])=>yn(Or(e.evaluate(n)))],"to-rgba":[$r(dt,4),[kr],(n,[e])=>e.evaluate(n).toArray()],rgb:[kr,[dt,dt,dt],mc],rgba:[kr,[dt,dt,dt,dt],mc],has:{type:_n,overloads:[[[on],(n,[e])=>Hc(e.evaluate(n),n.properties())],[[on,Hr],(n,[e,r])=>Hc(e.evaluate(n),r.evaluate(n))]]},get:{type:ot,overloads:[[[on],(n,[e])=>wa(e.evaluate(n),n.properties())],[[on,Hr],(n,[e,r])=>wa(e.evaluate(n),r.evaluate(n))]]},"feature-state":[ot,[on],(n,[e])=>wa(e.evaluate(n),n.featureState||{})],properties:[Hr,[],n=>n.properties()],"geometry-type":[on,[],n=>n.geometryType()],id:[ot,[],n=>n.id()],zoom:[dt,[],n=>n.globals.zoom],pitch:[dt,[],n=>n.globals.pitch||0],"distance-from-center":[dt,[],n=>n.distanceFromCenter()],"heatmap-density":[dt,[],n=>n.globals.heatmapDensity||0],"line-progress":[dt,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[dt,[],n=>n.globals.skyRadialProgress||0],accumulated:[ot,[],n=>void 0===n.globals.accumulated?null:n.globals.accumulated],"+":[dt,Jo(dt),(n,e)=>{let r=0;for(const a of e)r+=a.evaluate(n);return r}],"*":[dt,Jo(dt),(n,e)=>{let r=1;for(const a of e)r*=a.evaluate(n);return r}],"-":{type:dt,overloads:[[[dt,dt],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[dt],(n,[e])=>-e.evaluate(n)]]},"/":[dt,[dt,dt],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[dt,[dt,dt],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[dt,[dt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[dt,[dt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[dt,[dt],(n,[e])=>Math.log(e.evaluate(n))],log2:[dt,[dt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[dt,[dt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[dt,[dt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[dt,[dt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[dt,[dt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[dt,[dt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[dt,[dt],(n,[e])=>Math.atan(e.evaluate(n))],min:[dt,Jo(dt),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[dt,Jo(dt),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[dt,[dt],(n,[e])=>Math.abs(e.evaluate(n))],round:[dt,[dt],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[dt,[dt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[dt,[dt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[_n,[on,ot],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[_n,[ot],(n,[e])=>n.id()===e.value],"filter-type-==":[_n,[on],(n,[e])=>n.geometryType()===e.value],"filter-<":[_n,[on,ot],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a<h}],"filter-id-<":[_n,[ot],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[_n,[on,ot],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a>h}],"filter-id->":[_n,[ot],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[_n,[on,ot],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[_n,[ot],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[_n,[on,ot],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[_n,[ot],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[_n,[ot],(n,[e])=>e.value in n.properties()],"filter-has-id":[_n,[],n=>null!==n.id()&&void 0!==n.id()],"filter-type-in":[_n,[$r(on)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[_n,[$r(ot)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[_n,[on,$r(ot)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[_n,[on,$r(ot)],(n,[e,r])=>function(a,h,m,_){for(;m<=_;){const x=m+_>>1;if(h[x]===a)return!0;h[x]>a?_=x-1:m=x+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[Jo(_n),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[Jo(_n),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[_n,[_n],(n,[e])=>!e.evaluate(n)],"is-supported-script":[_n,[on],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[on,[on],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[on,[on],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[on,Jo(ot),(n,e)=>e.map(r=>ks(r.evaluate(n))).join("")],"resolved-locale":[on,[pn],(n,[e])=>e.evaluate(n).resolvedLocale()]});var ps=pc;function Qs(n){return{result:"success",value:n}}function Gi(n){return{result:"error",value:n}}function ea(n){return"data-driven"===n["property-type"]||"cross-faded-data-driven"===n["property-type"]}function k(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function j(n){return!!n.expression&&n.expression.interpolated}function L(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n}function Z(n){return"object"==typeof n&&null!==n&&!Array.isArray(n)}function ve(n){return n}function Ge(n,e){const r="color"===e.type,a=n.stops&&"object"==typeof n.stops[0][0],h=a||!(a||void 0!==n.property),m=n.type||(j(e)?"exponential":"interval");if(r&&((n=Qi({},n)).stops&&(n.stops=n.stops.map(D=>[D[0],Wn.parse(D[1])])),n.default=Wn.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!fs[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let _,x,w;if("exponential"===m)_=Tn;else if("interval"===m)_=tr;else if("categorical"===m){_=Kt,x=Object.create(null);for(const D of n.stops)x[D[0]]=D[1];w=typeof n.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=$n}if(a){const D={},I=[];for(let F=0;F<n.stops.length;F++){const z=n.stops[F],H=z[0].zoom;void 0===D[H]&&(D[H]={zoom:H,type:n.type,property:n.property,default:n.default,stops:[]},I.push(H)),D[H].stops.push([z[0].value,z[1]])}const A=[];for(const F of I)A.push([D[F].zoom,Ge(D[F],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:sn.interpolationFactor.bind(void 0,P),zoomStops:A.map(F=>F[0]),evaluate:({zoom:F},z)=>Tn({stops:A,base:n.base},e,F).evaluate(F,z)}}if(h){const D="exponential"===m?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:sn.interpolationFactor.bind(void 0,D),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(n,e,I,x,w)}}return{kind:"source",evaluate(D,I){const A=I&&I.properties?I.properties[n.property]:void 0;return void 0===A?tt(n.default,e.default):_(n,e,A,x,w)}}}function tt(n,e,r){return void 0!==n?n:void 0!==e?e:void 0!==r?r:void 0}function Kt(n,e,r,a,h){return tt(typeof r===h?a[r]:void 0,n.default,e.default)}function tr(n,e,r){if("number"!==L(r))return tt(n.default,e.default);const a=n.stops.length;if(1===a||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const h=va(n.stops.map(m=>m[0]),r);return n.stops[h][1]}function Tn(n,e,r){const a=void 0!==n.base?n.base:1;if("number"!==L(r))return tt(n.default,e.default);const h=n.stops.length;if(1===h||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const m=va(n.stops.map(I=>I[0]),r),_=function(I,A,P,F){const z=F-P,H=I-P;return 0===z?0:1===A?H/z:(Math.pow(A,H)-1)/(Math.pow(A,z)-1)}(r,a,n.stops[m][0],n.stops[m+1][0]),x=n.stops[m][1],w=n.stops[m+1][1];let D=Ns[e.type]||ve;if(n.colorSpace&&"rgb"!==n.colorSpace){const I=fs[n.colorSpace];D=(A,P)=>I.reverse(I.interpolate(I.forward(A),I.forward(P),_))}return"function"==typeof x.evaluate?{evaluate(...I){const A=x.evaluate.apply(void 0,I),P=w.evaluate.apply(void 0,I);if(void 0!==A&&void 0!==P)return D(A,P,_)}}:D(x,w,_)}function $n(n,e,r){return"color"===e.type?r=Wn.parse(r):"formatted"===e.type?r=ei.fromString(r.toString()):"resolvedImage"===e.type?r=zn.fromString(r.toString()):L(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),tt(r,n.default,e.default)}class rn{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new yo,this._defaultValue=r?"color"===(a=r).type&&(Z(a.default)||Array.isArray(a.default))?new Wn(0,0,0,0):"color"===a.type?Wn.parse(a.default)||null:void 0===a.default?null:a.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(e,r,a,h,m,_,x,w){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,h,m,_,x,w){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Fr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function Nr(n){return Array.isArray(n)&&n.length>0&&"string"==typeof n[0]&&n[0]in ps}function nr(n,e){const r=new Ha(ps,[],e?function(h){const m={color:kr,string:on,number:dt,enum:on,boolean:_n,formatted:ir,resolvedImage:Zr};return"array"===h.type?$r(m[h.value]||ot,h.length):m[h.type]}(e):void 0),a=r.parse(n,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return a?Qs(new rn(a,e)):Gi(r.errors)}class Yr{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent="constant"!==e&&!$a(r.expression)}evaluateWithoutErrorHandling(e,r,a,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,m,_)}evaluate(e,r,a,h,m,_){return this._styleExpression.evaluate(e,r,a,h,m,_)}}class Do{constructor(e,r,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent="camera"!==e&&!$a(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,a,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,m,_)}evaluate(e,r,a,h,m,_){return this._styleExpression.evaluate(e,r,a,h,m,_)}interpolationFactor(e,r,a){return this.interpolationType?sn.interpolationFactor(this.interpolationType,e,r,a):0}}function Fi(n,e){if("error"===(n=nr(n,e)).result)return n;const r=n.value.expression,a=no(r);if(!a&&!ea(e))return Gi([new Li("","data expressions not supported")]);const h=Oo(r,["zoom","pitch","distance-from-center"]);if(!h&&!k(e))return Gi([new Li("","zoom expressions not supported")]);const m=bi(r);return m||h?m instanceof Li?Gi([m]):m instanceof sn&&!j(e)?Gi([new Li("",'"interpolate" expressions cannot be used with this property')]):Qs(m?new Do(a?"camera":"composite",n.value,m.labels,m instanceof sn?m.interpolation:void 0):new Yr(a?"constant":"source",n.value)):Gi([new Li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xi{constructor(e,r){this._parameters=e,this._specification=r,Qi(this,Ge(this._parameters,this._specification))}static deserialize(e){return new xi(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bi(n){let e=null;if(n instanceof Xa)e=bi(n.result);else if(n instanceof Tu){for(const r of n.args)if(e=bi(r),e)break}else(n instanceof xa||n instanceof sn)&&n.input instanceof vo&&"zoom"===n.input.name&&(e=n);return e instanceof Li||n.eachChild(r=>{const a=bi(r);a instanceof Li?e=a:!e&&a?e=new Li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Tt{constructor(e,r,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),null!=r&&r.__line__&&(this.line=r.__line__)}}function ni(n){const e=n.key,r=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},m=n.style,_=n.styleSpec;let x=[];const w=L(r);if("object"!==w)return[new Tt(e,r,`object expected, ${w} found`)];for(const D in r){const I=D.split(".")[0],A=a[I]||a["*"];let P;h[I]?P=h[I]:a[I]?P=wi:h["*"]?P=h["*"]:a["*"]&&(P=wi),P?x=x.concat(P({key:(e&&`${e}.`)+D,value:r[D],valueSpec:A,style:m,styleSpec:_,object:r,objectKey:D},r)):x.push(new Tt(e,r[D],`unknown property "${D}"`))}for(const D in a)h[D]||a[D].required&&void 0===a[D].default&&void 0===r[D]&&x.push(new Tt(e,r,`missing required property "${D}"`));return x}function js(n){const e=n.value,r=n.valueSpec,a=n.style,h=n.styleSpec,m=n.key,_=n.arrayElementValidator||wi;if("array"!==L(e))return[new Tt(m,e,`array expected, ${L(e)} found`)];if(r.length&&e.length!==r.length)return[new Tt(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let x={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};h.$version<7&&(x.function=r.function),"object"===L(r.value)&&(x=r.value);let w=[];for(let D=0;D<e.length;D++)w=w.concat(_({array:e,arrayIndex:D,value:e[D],valueSpec:x,style:a,styleSpec:h,key:`${m}[${D}]`}));return w}function Zc(n){const e=n.key,r=n.value,a=n.valueSpec;let h=L(r);if("number"===h&&r!=r&&(h="NaN"),"number"!==h)return[new Tt(e,r,`number expected, ${h} found`)];if("minimum"in a){let m=a.minimum;if("array"===L(a.minimum)&&(m=a.minimum[n.arrayIndex]),r<m)return[new Tt(e,r,`${r} is less than the minimum value ${m}`)]}if("maximum"in a){let m=a.maximum;if("array"===L(a.maximum)&&(m=a.maximum[n.arrayIndex]),r>m)return[new Tt(e,r,`${r} is greater than the maximum value ${m}`)]}return[]}function qc(n){const e=n.valueSpec,r=Rr(n.value.type);let a,h,m,_={};const x="categorical"!==r&&void 0===n.value.property,w=!x,D="array"===L(n.value.stops)&&"array"===L(n.value.stops[0])&&"object"===L(n.value.stops[0][0]),I=ni({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if("identity"===r)return[new Tt(F.key,F.value,'identity function may not have a "stops" property')];let z=[];const H=F.value;return z=z.concat(js({key:F.key,value:H,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),"array"===L(H)&&0===H.length&&z.push(new Tt(F.key,H,"array must have at least one stop")),z},default:function(F){return wi({key:F.key,value:F.value,valueSpec:e,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===r&&x&&I.push(new Tt(n.key,n.value,'missing required property "property"')),"identity"===r||n.value.stops||I.push(new Tt(n.key,n.value,'missing required property "stops"')),"exponential"===r&&n.valueSpec.expression&&!j(n.valueSpec)&&I.push(new Tt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(w&&!ea(n.valueSpec)?I.push(new Tt(n.key,n.value,"property functions not supported")):x&&!k(n.valueSpec)&&I.push(new Tt(n.key,n.value,"zoom functions not supported"))),"categorical"!==r&&!D||void 0!==n.value.property||I.push(new Tt(n.key,n.value,'"property" property is required')),I;function A(F){let z=[];const H=F.value,Y=F.key;if("array"!==L(H))return[new Tt(Y,H,`array expected, ${L(H)} found`)];if(2!==H.length)return[new Tt(Y,H,`array length 2 expected, length ${H.length} found`)];if(D){if("object"!==L(H[0]))return[new Tt(Y,H,`object expected, ${L(H[0])} found`)];if(void 0===H[0].zoom)return[new Tt(Y,H,"object stop key must have zoom")];if(void 0===H[0].value)return[new Tt(Y,H,"object stop key must have value")];const le=Rr(H[0].zoom);if("number"!=typeof le)return[new Tt(Y,H[0].zoom,"stop zoom values must be numbers")];if(m&&m>le)return[new Tt(Y,H[0].zoom,"stop zoom values must appear in ascending order")];le!==m&&(m=le,h=void 0,_={}),z=z.concat(ni({key:`${Y}[0]`,value:H[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Zc,value:P}}))}else z=z.concat(P({key:`${Y}[0]`,value:H[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},H));return Nr(ko(H[1]))?z.concat([new Tt(`${Y}[1]`,H[1],"expressions are not allowed in function stops.")]):z.concat(wi({key:`${Y}[1]`,value:H[1],valueSpec:e,style:F.style,styleSpec:F.styleSpec}))}function P(F,z){const H=L(F.value),Y=Rr(F.value),le=null!==F.value?F.value:z;if(a){if(H!==a)return[new Tt(F.key,le,`${H} stop domain type must match previous stop domain type ${a}`)]}else a=H;if("number"!==H&&"string"!==H&&"boolean"!==H&&"number"!=typeof Y&&"string"!=typeof Y&&"boolean"!=typeof Y)return[new Tt(F.key,le,"stop domain value must be a number, string, or boolean")];if("number"!==H&&"categorical"!==r){let me=`number expected, ${H} found`;return ea(e)&&void 0===r&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(F.key,le,me)]}return"categorical"!==r||"number"!==H||"number"==typeof Y&&isFinite(Y)&&Math.floor(Y)===Y?"categorical"!==r&&"number"===H&&"number"==typeof Y&&"number"==typeof h&&void 0!==h&&Y<h?[new Tt(F.key,le,"stop domain values must appear in ascending order")]:(h=Y,"categorical"===r&&Y in _?[new Tt(F.key,le,"stop domain values must be unique")]:(_[Y]=!0,[])):[new Tt(F.key,le,`integer expected, found ${String(Y)}`)]}}function zi(n){const e=("property"===n.expressionContext?Fi:nr)(ko(n.value),n.valueSpec);if("error"===e.result)return e.value.map(a=>new Tt(`${n.key}${a.key}`,n.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===n.expressionContext&&"text-font"===n.propertyKey&&!r.outputDefined())return[new Tt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===n.expressionContext&&"layout"===n.propertyType&&!$a(r))return[new Tt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===n.expressionContext)return tl(r,n);if(n.expressionContext&&0===n.expressionContext.indexOf("cluster")){if(!Oo(r,["zoom","feature-state"]))return[new Tt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===n.expressionContext&&!no(r))return[new Tt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tl(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)r.delete(h);if(0===r.size)return[];const a=[];return n instanceof vo&&r.has(n.name)?[new Tt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(h=>{a.push(...tl(h,e))}),a)}function gc(n){const e=n.key,r=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?-1===a.values.indexOf(Rr(r))&&h.push(new Tt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(a.values).indexOf(Rr(r))&&h.push(new Tt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Wc(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Wc(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Vs(n,e="fill"){if(null==n)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Wc(n)||(n=Fl(n));const r=n;let a=!0;try{a=function(D){if(!ms(D))return D;let I=ko(D);return rl(I),I=nl(I),I}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const h=$e[`filter_${e}`],m=nr(a,h);let _=null;if("error"===m.result)throw new Error(m.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,I,A)=>m.value.evaluate(D,I,{},A);let x=null,w=null;if(a!==r){const D=nr(r,h);if("error"===D.result)throw new Error(D.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,A,P,F,z)=>D.value.evaluate(I,A,{},P,void 0,void 0,F,z),w=!no(D.value.expression)}return{filter:_,dynamicFilter:x||void 0,needGeometry:_c(a),needFeature:!!w}}function nl(n){if(!Array.isArray(n))return n;const e=function(r){if(No.has(r[0]))for(let a=1;a<r.length;a++)if(ms(r[a]))return!0;return r}(n);return!0===e?e:e.map(r=>nl(r))}function rl(n){let e=!1;const r=[];if("case"===n[0]){for(let a=1;a<n.length-1;a+=2)e=e||ms(n[a]),r.push(n[a+1]);r.push(n[n.length-1])}else if("match"===n[0]){e=e||ms(n[1]);for(let a=2;a<n.length-1;a+=2)r.push(n[a+1]);r.push(n[n.length-1])}else if("step"===n[0]){e=e||ms(n[1]);for(let a=1;a<n.length-1;a+=2)r.push(n[a+1])}e&&(n.length=0,n.push("any",...r));for(let a=1;a<n.length;a++)rl(n[a])}function ms(n){if(!Array.isArray(n))return!1;if("pitch"===(e=n[0])||"distance-from-center"===e)return!0;var e;for(let r=1;r<n.length;r++)if(ms(n[r]))return!0;return!1}const No=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Xc(n,e){return n<e?-1:n>e?1:0}function _c(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(_c(n[e]))return!0;return!1}function Fl(n){if(!n)return!0;const e=n[0];return n.length<=1?"any"!==e:"=="===e?Ea(n[1],n[2],"=="):"!="===e?gs(Ea(n[1],n[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ea(n[1],n[2],e):"any"===e?(r=n.slice(1),["any"].concat(r.map(Fl))):"all"===e?["all"].concat(n.slice(1).map(Fl)):"none"===e?["all"].concat(n.slice(1).map(Fl).map(gs)):"in"===e?il(n[1],n.slice(2)):"!in"===e?gs(il(n[1],n.slice(2))):"has"===e?ol(n[1]):"!has"===e?gs(ol(n[1])):"within"!==e||n;var r}function Ea(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function il(n,e){if(0===e.length)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Xc)]]:["filter-in-small",n,["literal",e]]}}function ol(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function gs(n){return["!",n]}function Uo(n){return Wc(ko(n.value))?zi(Qi({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Su(n)}function Su(n){const e=n.value,r=n.key;if("array"!==L(e))return[new Tt(r,e,`array expected, ${L(e)} found`)];const a=n.styleSpec;let h,m=[];if(e.length<1)return[new Tt(r,e,"filter array must have at least 1 element")];switch(m=m.concat(gc({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),Rr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Rr(e[1])&&m.push(new Tt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&m.push(new Tt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=L(e[1]),"string"!==h&&m.push(new Tt(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=L(e[_]),"$type"===Rr(e[1])?m=m.concat(gc({key:`${r}[${_}]`,value:e[_],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new Tt(`${r}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)m=m.concat(Su({key:`${r}[${_}]`,value:e[_],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=L(e[1]),2!==e.length?m.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new Tt(`${r}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=L(e[1]),2!==e.length?m.push(new Tt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new Tt(`${r}[1]`,e[1],`object expected, ${h} found`))}return m}function ta(n,e){const r=n.key,a=n.style,h=n.styleSpec,m=n.value,_=n.objectKey,x=h[`${e}_${n.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if("paint"===e&&w&&x[w[1]]&&x[w[1]].transition)return wi({key:r,value:m,valueSpec:h.transition,style:a,styleSpec:h});const D=n.valueSpec||x[_];if(!D)return[new Tt(r,m,`unknown property "${_}"`)];let I;if("string"===L(m)&&ea(D)&&!D.tokens&&(I=/^{([^}]+)}$/.exec(m)))return[new Tt(r,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const A=[];return"symbol"===n.layerType&&("text-field"===_&&a&&!a.glyphs&&A.push(new Tt(r,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Z(ko(m))&&"identity"===Rr(m.type)&&A.push(new Tt(r,m,'"text-font" does not support identity functions'))),A.concat(wi({key:n.key,value:m,valueSpec:D,style:a,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:_}))}function sl(n){return ta(n,"paint")}function zl(n){return ta(n,"layout")}function Bl(n){let e=[];const r=n.value,a=n.key,h=n.style,m=n.styleSpec;r.type||r.ref||e.push(new Tt(a,r,'either "type" or "ref" is required'));let _=Rr(r.type);const x=Rr(r.ref);if(r.id){const w=Rr(r.id);for(let D=0;D<n.arrayIndex;D++){const I=h.layers[D];Rr(I.id)===w&&e.push(new Tt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(D=>{D in r&&e.push(new Tt(a,r[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{Rr(D.id)===x&&(w=D)}),w?w.ref?e.push(new Tt(a,r.ref,"ref cannot reference another ref layer")):_=Rr(w.type):"string"==typeof x&&e.push(new Tt(a,r.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(r.source){const w=h.sources&&h.sources[r.source],D=w&&Rr(w.type);w?"vector"===D&&"raster"===_?e.push(new Tt(a,r.source,`layer "${r.id}" requires a raster source`)):"raster"===D&&"raster"!==_?e.push(new Tt(a,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==D||r["source-layer"]?"raster-dem"===D&&"hillshade"!==_?e.push(new Tt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===D&&w.lineMetrics||e.push(new Tt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Tt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Tt(a,r.source,`source "${r.source}" not found`))}else e.push(new Tt(a,r,'missing required property "source"'));return e=e.concat(ni({key:a,value:r,valueSpec:m.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wi({key:`${a}.type`,value:r.type,valueSpec:m.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:w=>Uo(Qi({layerType:_},w)),layout:w=>ni({layer:r,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":D=>zl(Qi({layerType:_},D))}}),paint:w=>ni({layer:r,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":D=>sl(Qi({layerType:_},D))}})}})),e}function na(n){const e=n.value,r=n.key,a=L(e);return"string"!==a?[new Tt(r,e,`string expected, ${a} found`)]:[]}const Yc={promoteId:function({key:n,value:e}){if("string"===L(e))return na({key:n,value:e});{const r=[];for(const a in e)r.push(...na({key:`${n}.${a}`,value:e[a]}));return r}}};function yc(n){const e=n.value,r=n.key,a=n.styleSpec,h=n.style;if(!e.type)return[new Tt(r,e,'"type" is required')];const m=Rr(e.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=ni({key:r,value:e,valueSpec:a[`source_${m.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:Yc}),_;case"geojson":if(_=ni({key:r,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,objectElementValidators:Yc}),e.cluster)for(const x in e.clusterProperties){const[w,D]=e.clusterProperties[x],I="string"==typeof w?[w,["accumulated"],["get",x]]:w;_.push(...zi({key:`${r}.${x}.map`,value:D,expressionContext:"cluster-map"})),_.push(...zi({key:`${r}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return ni({key:r,value:e,valueSpec:a.source_video,style:h,styleSpec:a});case"image":return ni({key:r,value:e,valueSpec:a.source_image,style:h,styleSpec:a});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gc({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:a})}}function so(n){const e=n.value,r=n.styleSpec,a=r.light,h=n.style;let m=[];const _=L(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Tt("light",e,`object expected, ${_} found`)]),m;for(const x in e){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&a[w[1]]&&a[w[1]].transition?wi({key:x,value:e[x],valueSpec:r.transition,style:h,styleSpec:r}):a[x]?wi({key:x,value:e[x],valueSpec:a[x],style:h,styleSpec:r}):[new Tt(x,e[x],`unknown property "${x}"`)])}return m}function Kc(n){const e=n.value,r=n.key,a=n.style,h=n.styleSpec,m=h.terrain;let _=[];const x=L(e);if(void 0===e)return _;if("object"!==x)return _=_.concat([new Tt("terrain",e,`object expected, ${x} found`)]),_;for(const w in e){const D=w.match(/^(.*)-transition$/);_=_.concat(D&&m[D[1]]&&m[D[1]].transition?wi({key:w,value:e[w],valueSpec:h.transition,style:a,styleSpec:h}):m[w]?wi({key:w,value:e[w],valueSpec:m[w],style:a,styleSpec:h}):[new Tt(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=a.sources&&a.sources[e.source],D=w&&Rr(w.type);w?"raster-dem"!==D&&_.push(new Tt(r,e.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):_.push(new Tt(r,e.source,`source "${e.source}" not found`))}else _.push(new Tt(r,e,'terrain is missing required property "source"'));return _}function al(n){const e=n.value,r=n.style,a=n.styleSpec,h=a.fog;let m=[];const _=L(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Tt("fog",e,`object expected, ${_} found`)]),m;for(const x in e){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&h[w[1]]&&h[w[1]].transition?wi({key:x,value:e[x],valueSpec:a.transition,style:r,styleSpec:a}):h[x]?wi({key:x,value:e[x],valueSpec:h[x],style:r,styleSpec:a}):[new Tt(x,e[x],`unknown property "${x}"`)])}return m}const ci={"*":()=>[],array:js,boolean:function(n){const e=n.value,r=n.key,a=L(e);return"boolean"!==a?[new Tt(r,e,`boolean expected, ${a} found`)]:[]},number:Zc,color:function(n){const e=n.key,r=n.value,a=L(r);return"string"!==a?[new Tt(e,r,`color expected, ${a} found`)]:null===En(r)?[new Tt(e,r,`color expected, "${r}" found`)]:[]},enum:gc,filter:Uo,function:qc,layer:Bl,object:ni,source:yc,light:so,terrain:Kc,fog:al,string:na,formatted:function(n){return 0===na(n).length?[]:zi(n)},resolvedImage:function(n){return 0===na(n).length?[]:zi(n)},projection:function(n){const e=n.value,r=n.styleSpec,a=r.projection,h=n.style;let m=[];const _=L(e);if("object"===_)for(const x in e)m=m.concat(wi({key:x,value:e[x],valueSpec:a[x],style:h,styleSpec:r}));else"string"!==_&&(m=m.concat([new Tt("projection",e,`object or string expected, ${_} found`)]));return m}};function wi(n){const e=n.value,r=n.valueSpec,a=n.styleSpec;return r.expression&&Z(Rr(e))?qc(n):r.expression&&Nr(ko(e))?zi(n):r.type&&ci[r.type]?ci[r.type](n):ni(Qi({},n,{valueSpec:r.type?a[r.type]:r}))}function Da(n){const e=n.value,r=n.key,a=na(n);return a.length||(-1===e.indexOf("{fontstack}")&&a.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new Tt(r,e,'"glyphs" url must include a "{range}" token'))),a}function Ta(n,e=$e){return Qo(wi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:Da,"*":()=>[]}}))}const Mu=n=>Qo(sl(n)),Au=n=>Qo(zl(n));function Qo(n){return n.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Jc(n,e){let r=!1;if(e&&e.length)for(const a of e)n.fire(new po(new Error(a.message))),r=!0;return r}var ll=_s;function _s(n,e,r){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var h=new Int32Array(this.arrayBuffer);n=h[0],this.d=(e=h[1])+2*(r=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],x=h[3+m+1];a.push(_===x?null:h.subarray(_,x))}var w=h[3+a.length+1];this.keys=h.subarray(h[3+a.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var D=0;D<this.d*this.d;D++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var I=r/e*n;this.min=-I,this.max=n+I}_s.prototype.insert=function(n,e,r,a,h){this._forEachCell(e,r,a,h,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h)},_s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_s.prototype._insertCell=function(n,e,r,a,h,m){this.cells[h].push(m)},_s.prototype.query=function(n,e,r,a,h){var m=this.min,_=this.max;if(n<=m&&e<=m&&_<=r&&_<=a&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(n,e,r,a,this._queryCell,x,{},h),x},_s.prototype._queryCell=function(n,e,r,a,h,m,_,x){var w=this.cells[h];if(null!==w)for(var D=this.keys,I=this.bboxes,A=0;A<w.length;A++){var P=w[A];if(void 0===_[P]){var F=4*P;(x?x(I[F+0],I[F+1],I[F+2],I[F+3]):n<=I[F+2]&&e<=I[F+3]&&r>=I[F+0]&&a>=I[F+1])?(_[P]=!0,m.push(D[P])):_[P]=!1}}},_s.prototype._forEachCell=function(n,e,r,a,h,m,_,x){for(var w=this._convertToCellCoord(n),D=this._convertToCellCoord(e),I=this._convertToCellCoord(r),A=this._convertToCellCoord(a),P=w;P<=I;P++)for(var F=D;F<=A;F++){var z=this.d*F+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(F),this._convertFromCellCoord(P+1),this._convertFromCellCoord(F+1)))&&h.call(this,n,e,r,a,z,m,_,x))return}},_s.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},_s.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},_s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=3+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var h=new Int32Array(e+r+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=e,_=0;_<n.length;_++){var x=n[_];h[3+_]=m,h.set(x,m),m+=x.length}return h[3+n.length]=m,h.set(this.keys,m),h[3+n.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const $s={};function St(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),$s[e]={klass:n,omit:r.omit||[]}}St(Object,"Object"),ll.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},ll.deserialize=function(n){return new ll(n.buffer)},Object.defineProperty(ll,"name",{value:"Grid"}),St(ll,"Grid"),St(Wn,"Color"),St(Error,"Error"),St(un,"AJAXError"),St(zn,"ResolvedImage"),St(xi,"StylePropertyFunction"),St(rn,"StyleExpression",{omit:["_evaluator"]}),St(Do,"ZoomDependentExpression"),St(Yr,"ZoomConstantExpression"),St(vo,"CompoundExpression",{omit:["_evaluate"]});for(const n in ps)$s[ps[n]._classRegistryKey]||St(ps[n],`Expression${n}`);function Ca(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&"ArrayBuffer"===n.constructor.name)}function Pu(n){return Te.ImageBitmap&&n instanceof Te.ImageBitmap}function Ia(n,e){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Ca(n)||Pu(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof Te.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const a of n)r.push(Ia(a,e));return r}if("object"==typeof n){const r=n.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const h=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const m in n)n.hasOwnProperty(m)&&($s[a].omit.indexOf(m)>=0||(h[m]=Ia(n[m],e)));n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof n)}function Ei(n){if(null==n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Ca(n)||Pu(n)||ArrayBuffer.isView(n)||n instanceof Te.ImageData)return n;if(Array.isArray(n))return n.map(Ei);if("object"==typeof n){const e=n.$name||"Object",{klass:r}=$s[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const h of Object.keys(n))"$name"!==h&&(a[h]=Ei(n[h]));return a}throw new Error("can't deserialize object of type "+typeof n)}class vc{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Ru=n=>n>=1536&&n<=1791,cl=n=>n>=1872&&n<=1919,sh=n=>n>=2208&&n<=2303,Nl=n=>n>=11904&&n<=12031,Ul=n=>n>=12032&&n<=12255,ys=n=>n>=12272&&n<=12287,vs=n=>n>=12288&&n<=12351,Gs=n=>n>=12352&&n<=12447,ul=n=>n>=12448&&n<=12543,Sa=n=>n>=12544&&n<=12591,Hs=n=>n>=12704&&n<=12735,dd=n=>n>=12736&&n<=12783,hl=n=>n>=12784&&n<=12799,_r=n=>n>=12800&&n<=13055,ku=n=>n>=13056&&n<=13311,ah=n=>n>=13312&&n<=19903,Lu=n=>n>=19968&&n<=40959,Qc=n=>n>=40960&&n<=42127,lh=n=>n>=42128&&n<=42191,ch=n=>n>=44032&&n<=55215,uh=n=>n>=63744&&n<=64255,Ma=n=>n>=64336&&n<=65023,hh=n=>n>=65040&&n<=65055,xc=n=>n>=65072&&n<=65103,Wr=n=>n>=65104&&n<=65135,f=n=>n>=65136&&n<=65279,t=n=>n>=65280&&n<=65519;function o(n){for(const e of n)if(g(e.charCodeAt(0)))return!0;return!1}function l(n){for(const e of n)if(!d(e.charCodeAt(0)))return!1;return!0}function d(n){return!(Ru(n)||cl(n)||sh(n)||Ma(n)||f(n))}function g(n){return!(746!==n&&747!==n&&(n<4352||!(Hs(n)||Sa(n)||xc(n)&&!(n>=65097&&n<=65103)||uh(n)||ku(n)||Nl(n)||dd(n)||!(!vs(n)||n>=12296&&n<=12305||n>=12308&&n<=12319||12336===n)||ah(n)||Lu(n)||_r(n)||(e=n,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(n)||(e=>e>=55216&&e<=55295)(n)||(e=>e>=4352&&e<=4607)(n)||ch(n)||Gs(n)||ys(n)||(e=>e>=12688&&e<=12703)(n)||Ul(n)||hl(n)||ul(n)&&12540!==n||!(!t(n)||65288===n||65289===n||65293===n||n>=65306&&n<=65310||65339===n||65341===n||65343===n||n>=65371&&n<=65503||65507===n||n>=65512&&n<=65519)||!(!Wr(n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||(e=>e>=5120&&e<=5759)(n)||(e=>e>=6320&&e<=6399)(n)||hh(n)||(e=>e>=19904&&e<=19967)(n)||Qc(n)||lh(n))));var e}function v(n){return!(g(n)||(e=n,(r=e)>=128&&r<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(r=>r>=8192&&r<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&9251!==e||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vs(e)||ul(e)||(r=>r>=57344&&r<=63743)(e)||xc(e)||Wr(e)||t(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,r}function E(n){return n>=1424&&n<=2303||Ma(n)||f(n)}function T(n,e){return!(!e&&E(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||(r=n,r>=6016&&r<=6143));var r}function S(n){for(const e of n)if(E(e.charCodeAt(0)))return!0;return!1}const R="deferred",B="loading",$="loaded";let K=null,X="unavailable",ne=null;const J=function(n){n&&"string"==typeof n&&n.indexOf("NetworkError")>-1&&(X="error"),K&&K(n)};function W(){se.fire(new qn("pluginStateChange",{pluginStatus:X,pluginURL:ne}))}const se=new mo,re=function(){return X},pe=function(){if(X!==R||!ne)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");X=B,W(),ne&&Zn({url:ne},n=>{n?J(n):(X=$,W())})},ge={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>X===$||null!=ge.applyArabicShaping,isLoading:()=>X===B,setState(n){X=n.pluginStatus,ne=n.pluginURL},isParsed:()=>null!=ge.applyArabicShaping&&null!=ge.processBidirectionalText&&null!=ge.processStyledBidirectionalText,getPluginURL:()=>ne};class ue{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vc,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const h of r)if(!T(h.charCodeAt(0),a))return!1;return!0}(e,ge.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class xe{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,h){if(Z(a))return new xi(a,h);if(Nr(a)){const m=Fi(a,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=a;return"string"==typeof a&&"color"===h.type&&(m=Wn.parse(a)),{kind:"constant",evaluate:()=>m}}}(void 0===r?e.specification.default:r,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Le{constructor(e){this.property=e,this.value=new xe(e,void 0)}transitioned(e,r){return new Oe(this.property,this.value,r,gt({},e.transition,this.transition),e.now)}untransitioned(){return new Oe(this.property,this.value,null,{},0)}}class Ue{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return cr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Le(this._values[e].property)),this._values[e].value=new xe(this._values[e].property,null===r?void 0:cr(r))}getTransition(e){return cr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Le(this._values[e].property)),this._values[e].transition=cr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);void 0!==a&&(e[r]=a);const h=this.getTransition(r);void 0!==h&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const a=new ct(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,r._values[h]);return a}untransitioned(){const e=new ct(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Oe{constructor(e,r,a,h,m){const _=h.delay||0,x=h.duration||0;m=m||0,this.property=e,this.value=r,this.begin=m+_,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const h=e.now||0,m=this.value.possiblyEvaluate(e,r,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(e,r,a);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,r,a),m,tn(x))}}return m}}class ct{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const h=new Ke(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,r,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Se{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return cr(this._values[e].value)}setValue(e,r){this._values[e]=new xe(this._values[e].property,null===r?void 0:cr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);void 0!==a&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const h=new Ke(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,r,a);return h}}class Xe{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,r,a,h){return this.property.evaluate(this.value,this.parameters,e,r,a,h)}}class Ke{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ke{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const h=Ns[this.specification.type];return h?h(e,r,a):e}}class Ce{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,h){return new Xe(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(r,null,{},a,h)}:e.expression,r)}interpolate(e,r,a){if("constant"!==e.value.kind||"constant"!==r.value.kind)return e;if(void 0===e.value.value||void 0===r.value.value)return new Xe(this,{kind:"constant",value:void 0},e.parameters);const h=Ns[this.specification.type];return h?new Xe(this,{kind:"constant",value:h(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,h,m,_){return"constant"===e.kind?e.value:e.evaluate(r,a,h,m,_)}}class Ct extends Ce{possiblyEvaluate(e,r,a,h){if(void 0===e.value)return new Xe(this,{kind:"constant",value:void 0},r);if("constant"===e.expression.kind){const m=e.expression.evaluate(r,null,{},a,h),_="resolvedImage"===e.property.specification.type&&"string"!=typeof m?m.name:m,x=this._calculate(_,_,_,r);return new Xe(this,{kind:"constant",value:x},r)}if("camera"===e.expression.kind){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Xe(this,{kind:"constant",value:m},r)}return new Xe(this,e.expression,r)}evaluate(e,r,a,h,m,_){if("source"===e.kind){const x=e.evaluate(r,a,h,m,_);return this._calculate(x,x,x,r)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,h),e.evaluate({zoom:Math.floor(r.zoom)},a,h),e.evaluate({zoom:Math.floor(r.zoom)+1},a,h),r):e.value}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r,other:a}:{from:a,to:r,other:e}}interpolate(e){return e}}class ft{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){if(void 0!==e.value){if("constant"===e.expression.kind){const m=e.expression.evaluate(r,null,{},a,h);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new ue(Math.floor(r.zoom-1),r)),e.expression.evaluate(new ue(Math.floor(r.zoom),r)),e.expression.evaluate(new ue(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class xt{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){return!!e.expression.evaluate(r,null,{},a,h)}interpolate(){return!1}}class _t{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new ue(0,{});for(const a in e){const h=e[a];h.specification.overridable&&this.overridableProperties.push(a);const m=this.defaultPropertyValues[a]=new xe(h,void 0),_=this.defaultTransitionablePropertyValues[a]=new Le(h);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(r)}}}function Vt(n,e){return 256*(n=Ie(Math.floor(n),0,255))+Ie(Math.floor(e),0,255)}St(Ce,"DataDrivenProperty"),St(ke,"DataConstantProperty"),St(Ct,"CrossFadedDataDrivenProperty"),St(ft,"CrossFadedProperty"),St(xt,"ColorRampProperty");const ln={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qt{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class $t{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function yt(n,e=1){let r=0,a=0;return{members:n.map(h=>{const m=ln[h.type].BYTES_PER_ELEMENT,_=r=vn(r,Math.max(e,m)),x=h.components||1;return a=Math.max(a,m),r+=m*x,{name:h.name,type:h.type,components:x,offset:_}}),size:vn(r,Math.max(a,e)),alignment:e}}function vn(n,e){return Math.ceil(n/e)*e}class Mn extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=a,e}}Mn.prototype.bytesPerElement=4,St(Mn,"StructArrayLayout2i4");class gr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=h,e}}gr.prototype.bytesPerElement=6,St(gr,"StructArrayLayout3i6");class yr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const _=4*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=m,e}}yr.prototype.bytesPerElement=8,St(yr,"StructArrayLayout4i8");class dr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,h,m,_,x)}emplace(e,r,a,h,m,_,x,w){const D=6*e,I=12*e,A=3*e;return this.int16[D+0]=r,this.int16[D+1]=a,this.uint8[I+4]=h,this.uint8[I+5]=m,this.uint8[I+6]=_,this.uint8[I+7]=x,this.float32[A+2]=w,e}}dr.prototype.bytesPerElement=12,St(dr,"StructArrayLayout2i4ub1f12");class Ai extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const _=4*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=m,e}}Ai.prototype.bytesPerElement=16,St(Ai,"StructArrayLayout4f16");class To extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w,D,I){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,h,m,_,x,w,D,I)}emplace(e,r,a,h,m,_,x,w,D,I,A){const P=10*e;return this.uint16[P+0]=r,this.uint16[P+1]=a,this.uint16[P+2]=h,this.uint16[P+3]=m,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=w,this.uint16[P+7]=D,this.uint16[P+8]=I,this.uint16[P+9]=A,e}}To.prototype.bytesPerElement=20,St(To,"StructArrayLayout10ui20");class es extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,a,h,m,_,x,w)}emplace(e,r,a,h,m,_,x,w,D){const I=8*e;return this.uint16[I+0]=r,this.uint16[I+1]=a,this.uint16[I+2]=h,this.uint16[I+3]=m,this.uint16[I+4]=_,this.uint16[I+5]=x,this.uint16[I+6]=w,this.uint16[I+7]=D,e}}es.prototype.bytesPerElement=16,St(es,"StructArrayLayout8ui16");class br extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,h,m,_)}emplace(e,r,a,h,m,_,x){const w=6*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=h,this.int16[w+3]=m,this.int16[w+4]=_,this.int16[w+5]=x,e}}br.prototype.bytesPerElement=12,St(br,"StructArrayLayout6i12");class Xr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w,D,I,A,P){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,a,h,m,_,x,w,D,I,A,P)}emplace(e,r,a,h,m,_,x,w,D,I,A,P,F){const z=12*e;return this.int16[z+0]=r,this.int16[z+1]=a,this.int16[z+2]=h,this.int16[z+3]=m,this.uint16[z+4]=_,this.uint16[z+5]=x,this.uint16[z+6]=w,this.uint16[z+7]=D,this.int16[z+8]=I,this.int16[z+9]=A,this.int16[z+10]=P,this.int16[z+11]=F,e}}Xr.prototype.bytesPerElement=24,St(Xr,"StructArrayLayout4i4ui4i24");class sr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,h,m,_)}emplace(e,r,a,h,m,_,x){const w=10*e,D=5*e;return this.int16[w+0]=r,this.int16[w+1]=a,this.int16[w+2]=h,this.float32[D+2]=m,this.float32[D+3]=_,this.float32[D+4]=x,e}}sr.prototype.bytesPerElement=20,St(sr,"StructArrayLayout3i3f20");class Di extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Di.prototype.bytesPerElement=4,St(Di,"StructArrayLayout1ul4");class Hi extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w,D,I,A,P,F){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,a,h,m,_,x,w,D,I,A,P,F)}emplace(e,r,a,h,m,_,x,w,D,I,A,P,F,z){const H=20*e,Y=10*e;return this.int16[H+0]=r,this.int16[H+1]=a,this.int16[H+2]=h,this.int16[H+3]=m,this.int16[H+4]=_,this.float32[Y+3]=x,this.float32[Y+4]=w,this.float32[Y+5]=D,this.float32[Y+6]=I,this.int16[H+14]=A,this.uint32[Y+8]=P,this.uint16[H+18]=F,this.uint16[H+19]=z,e}}Hi.prototype.bytesPerElement=40,St(Hi,"StructArrayLayout5i4f1i1ul2ui40");class Dr extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,r,a,h,m,_,x)}emplace(e,r,a,h,m,_,x,w){const D=8*e;return this.int16[D+0]=r,this.int16[D+1]=a,this.int16[D+2]=h,this.int16[D+4]=m,this.int16[D+5]=_,this.int16[D+6]=x,this.int16[D+7]=w,e}}Dr.prototype.bytesPerElement=16,St(Dr,"StructArrayLayout3i2i2i16");class jo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,h,m)}emplace(e,r,a,h,m,_){const x=4*e,w=8*e;return this.float32[x+0]=r,this.float32[x+1]=a,this.float32[x+2]=h,this.int16[w+6]=m,this.int16[w+7]=_,e}}jo.prototype.bytesPerElement=16,St(jo,"StructArrayLayout2f1f2i16");class jl extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const _=12*e,x=3*e;return this.uint8[_+0]=r,this.uint8[_+1]=a,this.float32[x+1]=h,this.float32[x+2]=m,e}}jl.prototype.bytesPerElement=12,St(jl,"StructArrayLayout2ub2f12");class ts extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=h,e}}ts.prototype.bytesPerElement=12,St(ts,"StructArrayLayout3f12");class Vo extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=h,e}}Vo.prototype.bytesPerElement=6,St(Vo,"StructArrayLayout3ui6");class eu extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be){const _e=this.length;return this.resize(_e+1),this.emplace(_e,e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be)}emplace(e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be,_e){const Be=30*e,Fe=15*e,He=60*e;return this.int16[Be+0]=r,this.int16[Be+1]=a,this.int16[Be+2]=h,this.float32[Fe+2]=m,this.float32[Fe+3]=_,this.uint16[Be+8]=x,this.uint16[Be+9]=w,this.uint32[Fe+5]=D,this.uint32[Fe+6]=I,this.uint32[Fe+7]=A,this.uint16[Be+16]=P,this.uint16[Be+17]=F,this.uint16[Be+18]=z,this.float32[Fe+10]=H,this.float32[Fe+11]=Y,this.uint8[He+48]=le,this.uint8[He+49]=me,this.uint8[He+50]=ae,this.uint32[Fe+13]=fe,this.int16[Be+28]=be,this.uint8[He+58]=_e,e}}eu.prototype.bytesPerElement=60,St(eu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ra extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be,_e,Be,Fe,He,ht,je,Je,nt,at){const pt=this.length;return this.resize(pt+1),this.emplace(pt,e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be,_e,Be,Fe,He,ht,je,Je,nt,at)}emplace(e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y,le,me,ae,fe,be,_e,Be,Fe,He,ht,je,Je,nt,at,pt){const Ze=38*e,Ft=19*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=a,this.int16[Ze+2]=h,this.float32[Ft+2]=m,this.float32[Ft+3]=_,this.int16[Ze+8]=x,this.int16[Ze+9]=w,this.int16[Ze+10]=D,this.int16[Ze+11]=I,this.int16[Ze+12]=A,this.int16[Ze+13]=P,this.uint16[Ze+14]=F,this.uint16[Ze+15]=z,this.uint16[Ze+16]=H,this.uint16[Ze+17]=Y,this.uint16[Ze+18]=le,this.uint16[Ze+19]=me,this.uint16[Ze+20]=ae,this.uint16[Ze+21]=fe,this.uint16[Ze+22]=be,this.uint16[Ze+23]=_e,this.uint16[Ze+24]=Be,this.uint16[Ze+25]=Fe,this.uint16[Ze+26]=He,this.uint16[Ze+27]=ht,this.uint16[Ze+28]=je,this.uint32[Ft+15]=Je,this.float32[Ft+16]=nt,this.float32[Ft+17]=at,this.float32[Ft+18]=pt,e}}ra.prototype.bytesPerElement=76,St(ra,"StructArrayLayout3i2f6i15ui1ul3f76");class ao extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}ao.prototype.bytesPerElement=4,St(ao,"StructArrayLayout1f4");class Aa extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,h,m)}emplace(e,r,a,h,m,_){const x=5*e;return this.float32[x+0]=r,this.float32[x+1]=a,this.float32[x+2]=h,this.float32[x+3]=m,this.float32[x+4]=_,e}}Aa.prototype.bytesPerElement=20,St(Aa,"StructArrayLayout5f20");class Vl extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const _=6*e;return this.uint32[3*e+0]=r,this.uint16[_+2]=a,this.uint16[_+3]=h,this.uint16[_+4]=m,e}}Vl.prototype.bytesPerElement=12,St(Vl,"StructArrayLayout1ul3ui12");class ia extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,e}}ia.prototype.bytesPerElement=4,St(ia,"StructArrayLayout2ui4");class fd extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}fd.prototype.bytesPerElement=2,St(fd,"StructArrayLayout1ui2");class pd extends $t{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=a,e}}pd.prototype.bytesPerElement=8,St(pd,"StructArrayLayout2f8");class mf extends Qt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}mf.prototype.size=12;class md extends br{get(e){return new mf(this,e)}}St(md,"FillExtrusionExtArray");class gf extends Qt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}gf.prototype.size=40;class gd extends Hi{get(e){return new gf(this,e)}}St(gd,"CollisionBoxArray");class _f extends Qt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}_f.prototype.size=60;class Pa extends eu{get(e){return new _f(this,e)}}St(Pa,"PlacedSymbolArray");class qp extends Qt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}qp.prototype.size=76;class Wp extends ra{get(e){return new qp(this,e)}}St(Wp,"SymbolInstanceArray");class Xp extends ao{getoffsetX(e){return this.float32[1*e+0]}}St(Xp,"GlyphOffsetArray");class yf extends gr{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}St(yf,"SymbolLineVertexArray");class _d extends Qt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}_d.prototype.size=12;class Yp extends Vl{get(e){return new _d(this,e)}}St(Yp,"FeatureIndexArray");class Kp extends Qt{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Kp.prototype.size=4;class Jp extends ia{get(e){return new Kp(this,e)}}St(Jp,"FillExtrusionCentroidArray");class vf extends Qt{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}vf.prototype.size=12;class Qp extends br{get(e){return new vf(this,e)}}St(Qp,"CircleGlobeExtArray");const Rg=yt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ns=yt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var bc={exports:{}},Co=function(n,e){var r,a,h,m,_,x,w,D;for(a=n.length-(r=3&n.length),h=e,_=3432918353,x=461845907,D=0;D<a;)w=255&n.charCodeAt(D)|(255&n.charCodeAt(++D))<<8|(255&n.charCodeAt(++D))<<16|(255&n.charCodeAt(++D))<<24,++D,h=27492+(65535&(m=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,r){case 3:w^=(255&n.charCodeAt(D+2))<<16;case 2:w^=(255&n.charCodeAt(D+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&n.charCodeAt(D)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},dh=function(n,e){for(var r,a=n.length,h=e^a,m=0;a>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(m)|(255&n.charCodeAt(++m))<<8|(255&n.charCodeAt(++m))<<16|(255&n.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:h^=(255&n.charCodeAt(m+2))<<16;case 2:h^=(255&n.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};bc.exports=Co,bc.exports.murmur3=Co,bc.exports.murmur2=dh;class fh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,h){this.ids.push(bf(e)),this.positions.push(r,a,h)}getPositions(e){const r=bf(e);let a=0,h=this.ids.length-1;for(;a<h;){const _=a+h>>1;this.ids[_]>=r?h=_:a=_+1}const m=[];for(;this.ids[a]===r;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(e,r){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return wf(a,h,0,a.length-1),r&&r.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(e){const r=new fh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function bf(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:bc.exports(String(n))}function wf(n,e,r,a){for(;r<a;){const h=n[r+a>>1];let m=r-1,_=a+1;for(;;){do{m++}while(n[m]<h);do{_--}while(n[_]>h);if(m>=_)break;ph(n,m,_),ph(e,3*m,3*_),ph(e,3*m+1,3*_+1),ph(e,3*m+2,3*_+2)}_-r<a-_?(wf(n,e,r,_),r=_+1):(wf(n,e,_+1,a),a=_)}}function ph(n,e,r){const a=n[e];n[e]=n[r],n[r]=a}St(fh,"FeaturePositionMap");class $l{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class mh extends $l{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class em extends $l{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Ef extends $l{constructor(e){super(e),this.current=Wn.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const kg=new Float32Array(16),Lg=new Float32Array(9),Df=new Float32Array(4);function gh(n){return[Vt(255*n.r,255*n.g),Vt(255*n.b,255*n.a)]}class _h{constructor(e,r,a){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=a}setUniform(e,r,a,h,m){r.set(e,m,h.constantOr(this.value))}getBinding(e,r){return"color"===this.type?new Ef(e):new mh(e)}}class tu{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,a,h,m){const _="u_pattern_to"===m||"u_dash_to"===m?this.patternTo:"u_pattern_from"===m||"u_dash_from"===m?this.patternFrom:"u_pixel_ratio_to"===m?this.pixelRatioTo:"u_pixel_ratio_from"===m?this.pixelRatioFrom:null;_&&r.set(e,m,_)}getBinding(e,r){return"u_pattern_from"===r||"u_pattern_to"===r||"u_dash_from"===r||"u_dash_to"===r?new em(e):new mh(e)}}class Gl{constructor(e,r,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===a?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,a,h,m,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new ue(0),r,{},m,h,_);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,r,a,h,m){const _=this.expression.evaluate({zoom:0},a,h,void 0,m);this._setPaintValue(e,r,_)}_setPaintValue(e,r,a){if("color"===this.type){const h=gh(a);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rs{constructor(e,r,a,h,m,_){this.expression=e,this.uniformNames=r.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===a?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,r,a,h,m,_){const x=this.expression.evaluate(new ue(this.zoom),r,{},m,h,_),w=this.expression.evaluate(new ue(this.zoom+1),r,{},m,h,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,x,w)}updatePaintArray(e,r,a,h,m){const _=this.expression.evaluate({zoom:this.zoom},a,h,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},a,h,void 0,m);this._setPaintValue(e,r,_,x)}_setPaintValue(e,r,a,h){if("color"===this.type){const m=gh(a),_=gh(h);for(let x=e;x<r;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,h,m){const _=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,x=Ie(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);r.set(e,m,x)}getBinding(e,r){return new mh(e)}}class wc{constructor(e,r,a,h,m,_,x){this.expression=e,this.type=a,this.useIntegerZoom=h,this.zoom=m,this.layerId=x,this.paintVertexAttributes=("array"===a?ns:Rg).members;for(let w=0;w<r.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,h,m,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,r,a,h){if(!h||!a)return;const{min:m,mid:_,max:x}=a,w=h[m],D=h[_],I=h[x];if(w&&D&&I)for(let A=e;A<r;A++)this._setPaintValue(this.zoomInPaintVertexArray,A,D,w),this._setPaintValue(this.zoomOutPaintVertexArray,A,D,I)}_setPaintValue(e,r,a,h){e.emplace(r,a.tl[0],a.tl[1],a.br[0],a.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],a.pixelRatio,h.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ec{constructor(e,r,a=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!a(m))continue;const _=e.paint.get(m);if(!(_ instanceof Xe&&ea(_.property.specification)))continue;const x=tm(m,e.type),w=_.value,D=_.property.specification.type,I=_.property.useIntegerZoom,A=_.property.specification["property-type"],P="cross-faded"===A||"cross-faded-data-driven"===A,F="line-dasharray"===String(m)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==w.kind||F)if("source"===w.kind||F||P){const z=vd(m,D,"source");this.binders[m]=P?new wc(w,x,D,I,r,z,e.id):new Gl(w,x,D,z),h.push(`/a_${m}`)}else{const z=vd(m,D,"composite");this.binders[m]=new rs(w,x,D,I,r,z),h.push(`/z_${m}`)}else this.binders[m]=P?new tu(w.value,x):new _h(w.value,x,D),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Gl||r instanceof rs?r.maxValue:0}populatePaintArrays(e,r,a,h,m,_){for(const x in this.binders){const w=this.binders[x];(w instanceof Gl||w instanceof rs||w instanceof wc)&&w.populatePaintArray(e,r,a,h,m,_)}}setConstantPatternPositions(e,r){for(const a in this.binders){const h=this.binders[a];h instanceof tu&&h.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,h,m,_){let x=!1;for(const w in e){const D=r.getPositions(w);for(const I of D){const A=a.feature(I.index);for(const P in this.binders){const F=this.binders[P];if((F instanceof Gl||F instanceof rs||F instanceof wc)&&!0===F.expression.isStateDependent){const z=h.paint.get(P);F.expression=z.value,F.updatePaintArray(I.start,I.end,A,e[w],m,_),x=!0}}}}return x}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof _h||a instanceof tu)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Gl||a instanceof rs||a instanceof wc)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof _h||a instanceof tu||a instanceof rs)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof _h||h instanceof tu||h instanceof rs)for(const m of h.uniformNames)r.push({name:m,property:a,binding:h.getBinding(e,m)})}return r}setUniforms(e,r,a,h,m){for(const{name:_,property:x,binding:w}of a)this.binders[x].setUniform(e,w,m,h.get(x),_)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof wc){const h=2===e.fromScale?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Gl||a instanceof rs)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Gl||a instanceof rs||a instanceof wc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Gl||r instanceof rs||r instanceof wc)&&r.destroy()}}}class Hl{constructor(e,r,a=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Ec(h,r,a);this.needsUpload=!1,this._featureMap=new fh,this._bufferOffset=0}populatePaintArrays(e,r,a,h,m,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,r,h,m,_,x);void 0!==r.id&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,h,m){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,h,m)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Tf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function tm(n,e){return Tf[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const Gy={"line-pattern":{source:To,composite:To},"fill-pattern":{source:To,composite:To},"fill-extrusion-pattern":{source:To,composite:To},"line-dasharray":{source:es,composite:es}},Ou={color:{source:pd,composite:Ai},number:{source:ao,composite:pd}};function vd(n,e,r){const a=Gy[n];return a&&a[r]||Ou[e][r]}St(_h,"ConstantBinder"),St(tu,"CrossFadedConstantBinder"),St(Gl,"SourceExpressionBinder"),St(wc,"CrossFadedCompositeBinder"),St(rs,"CompositeExpressionBinder"),St(Ec,"ProgramConfiguration",{omit:["_buffers"]}),St(Hl,"ProgramConfigurationSet");const yh="-transition";class Ra extends mo{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Se(r.layout)),r.paint)){this._transitionablePaint=new Ue(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ke(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){null!=r&&this._validate(Au,`layers.${this.id}.layout.${e}`,e,r,a)||("visibility"!==e?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return kn(e,yh)?this._transitionablePaint.getTransition(e.slice(0,-yh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(null!=r&&this._validate(Mu,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(kn(e,yh))return this._transitionablePaint.setTransition(e.slice(0,-yh.length),r||void 0),!1;{const h=this._transitionablePaint._values[e],m="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(e,x,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),ui(e,(r,a)=>!(void 0===r||"layout"===a&&!Object.keys(r).length||"paint"===a&&!Object.keys(r).length))}_validate(e,r,a,h,m={}){return(!m||!1!==m.validate)&&Jc(this,e.call(Ta,{key:r,layerType:this.type,objectKey:a,value:h,styleSpec:$e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Xe&&ea(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Cf=yt([{name:"a_pos",components:2,type:"Int16"}],4),Og=yt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ti{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,h){let m=this.segments[this.segments.length-1];return e>Ti.MAX_VERTEX_ARRAY_LENGTH&&mn(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Ti.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,h){return new Ti([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,St(Ti,"SegmentVector");var hn=8192;class Dc{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ar?new ar(e.lng,e.lat):ar.convert(e),this}setSouthWest(e){return this._sw=e instanceof ar?new ar(e.lng,e.lat):ar.convert(e),this}extend(e){const r=this._sw,a=this._ne;let h,m;if(e instanceof ar)h=e,m=e;else{if(!(e instanceof Dc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Dc.convert(e)):this.extend(ar.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(ar.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return r||a?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new ar(h.lng,h.lat),this._ne=new ar(m.lng,m.lat)),this}getCenter(){return new ar((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ar(this.getWest(),this.getNorth())}getSouthEast(){return new ar(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=ar.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(e){return!e||e instanceof Dc?e:new Dc(e)}}const xd=6371008.8;class ar{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ar(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,h=e.lat*r,m=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return xd*Math.acos(Math.min(m,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Dc(new ar(this.lng-a,this.lat-r),new ar(this.lng+a,this.lat+r))}static convert(e){if(e instanceof ar)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ar(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ar(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const If=2*Math.PI*xd;function vh(n){return If*Math.cos(n*Math.PI/180)}function ka(n){return(180+n)/360}function oa(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function sa(n,e){return n/vh(e)}function Zs(n){return 360*n-180}function Zi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Sf(n,e){return n*vh(Zi(e))}const $o=85.051129;function Mf(n){return 1/Math.cos(n*Math.PI/180)}class nu{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ar.convert(e);return new nu(ka(a.lng),oa(a.lat),sa(r,a.lat))}toLngLat(){return new ar(Zs(this.x),Zi(this.y))}toAltitude(){return Sf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/If*Mf(Zi(this.y))}}function Af(n,e,r,a,h,m,_,x,w){const D=(e+a)/2,I=(r+h)/2,A=new et(D,I);x(A),function(P,F,z,H,Y,le){const me=z-Y,ae=H-le;return Math.abs((H-F)*me-(z-P)*ae)/Math.hypot(me,ae)}(A.x,A.y,m.x,m.y,_.x,_.y)>=w?(Af(n,e,r,D,I,m,A,x,w),Af(n,D,I,a,h,A,_,x,w)):n.push(_)}function Fg(n,e,r){let a=n[0],h=a.x,m=a.y;e(a);const _=[a];for(let x=1;x<n.length;x++){const w=n[x],{x:D,y:I}=w;e(w),Af(_,h,m,D,I,a,w,e,r),h=D,m=I,a=w}return _}function Fu(n,e,r,a){if(a(e,r)){const h=e.add(r)._mult(.5);Fu(n,e,h,a),Fu(n,h,r,a)}else n.push(r)}function zg(n,e){let r=n[0];const a=[r];for(let h=1;h<n.length;h++){const m=n[h];Fu(a,r,m,e),r=m}return a}const bd=Math.pow(2,14)-1,Pf=-bd-1;function nm(n,e){const r=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Ie(r,Pf,bd),n.y=Ie(a,Pf,bd),(r<n.x||r>n.x+1||a<n.y||a>n.y+1)&&mn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function La(n,e,r){const a=n.loadGeometry(),h=n.extent,m=hn/h;if(e&&r&&r.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:w,y:D,projection:I}=r,A=P=>{const F=Zs((e.x+P.x/h)/_),z=Zi((e.y+P.y/h)/_),H=I.project(F,z);P.x=(H.x*x-w)*h,P.y=(H.y*x-D)*h};for(let P=0;P<a.length;P++)if(1!==n.type)a[P]=Fg(a[P],A,1);else{const F=[];for(const z of a[P])z.x<0||z.x>=h||z.y<0||z.y>=h||(A(z),F.push(z));a[P]=F}}for(const _ of a)for(const x of _)nm(x,m);return a}function Tc(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?La(n):[]}}function ru(n,e,r,a,h){n.emplaceBack(2*e+(a+1)/2,2*r+(h+1)/2)}function iu(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class wd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Mn,this.indexArray=new Vo,this.segments=new Ti,this.programConfigurations=new Hl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,h){const m=this.layers[0],_=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:D,id:I,index:A,sourceLayerIndex:P}of e){const F=this.layers[0]._featureFilter.needGeometry,z=Tc(D,F);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),z,a))continue;const H=x?x.evaluate(z,{},a):void 0,Y={id:I,properties:D.properties,type:D.type,sourceLayerIndex:P,index:A,geometry:F?z.geometry:La(D,a,h),patterns:{},sortKey:H};_.push(Y)}x&&_.sort((D,I)=>D.sortKey-I.sortKey);let w=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Qp,w=h.projection);for(const D of _){const{geometry:I,index:A,sourceLayerIndex:P}=D,F=e[A].feature;this.addFeature(D,I,A,r.availableImages,a,w),r.featureIndex.insert(F,I,A,P,this.index)}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Og.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,h,m,_){for(const x of r)for(const w of x){const D=w.x,I=w.y;if(D<0||D>=hn||I<0||I>=hn)continue;if(_){const F=_.projectTilePoint(D,I,m),z=_.upVector(m,D,I),H=this.globeExtVertexArray;iu(H,F,z),iu(H,F,z),iu(H,F,z),iu(H,F,z)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=A.vertexLength;ru(this.layoutVertexArray,D,I,-1,-1),ru(this.layoutVertexArray,D,I,1,-1),ru(this.layoutVertexArray,D,I,1,1),ru(this.layoutVertexArray,D,I,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h,m)}}function Ed(n,e){for(let r=0;r<n.length;r++)if(Cc(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Cc(n,e[r]))return!0;return!!kf(n,e)}function Rf(n,e,r){return!!Cc(n,e)||!!Lf(e,n,r)}function Dd(n,e){if(1===n.length)return om(e,n[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let h=0;h<a.length;h++)if(Cc(n,a[h]))return!0}for(let r=0;r<n.length;r++)if(om(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(kf(n,e[r]))return!0;return!1}function xh(n,e,r){if(n.length>1){if(kf(n,e))return!0;for(let a=0;a<e.length;a++)if(Lf(e[a],n,r))return!0}for(let a=0;a<n.length;a++)if(Lf(n[a],e,r))return!0;return!1}function kf(n,e){if(0===n.length||0===e.length)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],h=n[r+1];for(let m=0;m<e.length-1;m++)if(rm(a,h,e[m],e[m+1]))return!0}return!1}function rm(n,e,r,a){return Sn(n,r,a)!==Sn(e,r,a)&&Sn(n,e,r)!==Sn(n,e,a)}function Lf(n,e,r){const a=r*r;if(1===e.length)return n.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(im(n,e[h-1],e[h])<a)return!0;return!1}function im(n,e,r){const a=e.distSqr(r);if(0===a)return n.distSqr(e);const h=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/a;return n.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function om(n,e){let r,a,h,m=!1;for(let _=0;_<n.length;_++){r=n[_];for(let x=0,w=r.length-1;x<r.length;w=x++)a=r[x],h=r[w],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(m=!m)}return m}function Cc(n,e){let r=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const m=n[a],_=n[h];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function Of(n,e,r,a,h){for(const _ of n)if(e<=_.x&&r<=_.y&&a>=_.x&&h>=_.y)return!0;const m=[new et(e,r),new et(e,h),new et(a,h),new et(a,r)];if(n.length>2)for(const _ of m)if(Cc(n,_))return!0;for(let _=0;_<n.length-1;_++)if(Td(n[_],n[_+1],m))return!0;return!1}function Td(n,e,r){const a=r[0],h=r[2];if(n.x<a.x&&e.x<a.x||n.x>h.x&&e.x>h.x||n.y<a.y&&e.y<a.y||n.y>h.y&&e.y>h.y)return!1;const m=Sn(n,e,r[0]);return m!==Sn(n,e,r[1])||m!==Sn(n,e,r[2])||m!==Sn(n,e,r[3])}function Ic(n,e,r){const a=e.paint.get(n).value;return"constant"===a.kind?a.value:r.programConfigurations.get(e.id).getMaxValue(n)}function dl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function sm(n,e,r,a,h){if(!e[0]&&!e[1])return n;const m=et.convert(e)._mult(h);"viewport"===r&&m._rotate(-a);const _=[];for(let x=0;x<n.length;x++)_.push(n[x].sub(m));return _}function am(n,e,r,a){const h=et.convert(n)._mult(a);return"viewport"===e&&h._rotate(-r),h}St(wd,"CircleBucket",{omit:["layers"]});const Hy=new _t({"circle-sort-key":new Ce($e.layout_circle["circle-sort-key"])});var Bg={paint:new _t({"circle-radius":new Ce($e.paint_circle["circle-radius"]),"circle-color":new Ce($e.paint_circle["circle-color"]),"circle-blur":new Ce($e.paint_circle["circle-blur"]),"circle-opacity":new Ce($e.paint_circle["circle-opacity"]),"circle-translate":new ke($e.paint_circle["circle-translate"]),"circle-translate-anchor":new ke($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ke($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ke($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ce($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ce($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ce($e.paint_circle["circle-stroke-opacity"])}),layout:Hy},zu=1e-6,xs=typeof Float32Array<"u"?Float32Array:Array;function Ff(){var n=new xs(9);return xs!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function bh(n,e,r){var a=e[0],h=e[1],m=e[2],_=e[3],x=e[4],w=e[5],D=e[6],I=e[7],A=e[8],P=r[0],F=r[1],z=r[2],H=r[3],Y=r[4],le=r[5],me=r[6],ae=r[7],fe=r[8];return n[0]=P*a+F*_+z*D,n[1]=P*h+F*x+z*I,n[2]=P*m+F*w+z*A,n[3]=H*a+Y*_+le*D,n[4]=H*h+Y*x+le*I,n[5]=H*m+Y*w+le*A,n[6]=me*a+ae*_+fe*D,n[7]=me*h+ae*x+fe*I,n[8]=me*m+ae*w+fe*A,n}function aa(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Cd(n,e){var r=e[0],a=e[1],h=e[2],m=e[3],_=e[4],x=e[5],w=e[6],D=e[7],I=e[8],A=e[9],P=e[10],F=e[11],z=e[12],H=e[13],Y=e[14],le=e[15],me=r*x-a*_,ae=r*w-h*_,fe=r*D-m*_,be=a*w-h*x,_e=a*D-m*x,Be=h*D-m*w,Fe=I*H-A*z,He=I*Y-P*z,ht=I*le-F*z,je=A*Y-P*H,Je=A*le-F*H,nt=P*le-F*Y,at=me*nt-ae*Je+fe*je+be*ht-_e*He+Be*Fe;return at?(n[0]=(x*nt-w*Je+D*je)*(at=1/at),n[1]=(h*Je-a*nt-m*je)*at,n[2]=(H*Be-Y*_e+le*be)*at,n[3]=(P*_e-A*Be-F*be)*at,n[4]=(w*ht-_*nt-D*He)*at,n[5]=(r*nt-h*ht+m*He)*at,n[6]=(Y*fe-z*Be-le*ae)*at,n[7]=(I*Be-P*fe+F*ae)*at,n[8]=(_*Je-x*ht+D*Fe)*at,n[9]=(a*ht-r*Je-m*Fe)*at,n[10]=(z*_e-H*fe+le*me)*at,n[11]=(A*fe-I*_e-F*me)*at,n[12]=(x*He-_*je-w*Fe)*at,n[13]=(r*je-a*He+h*Fe)*at,n[14]=(H*ae-z*be-Y*me)*at,n[15]=(I*be-A*ae+P*me)*at,n):null}function ou(n,e,r){var a=e[0],h=e[1],m=e[2],_=e[3],x=e[4],w=e[5],D=e[6],I=e[7],A=e[8],P=e[9],F=e[10],z=e[11],H=e[12],Y=e[13],le=e[14],me=e[15],ae=r[0],fe=r[1],be=r[2],_e=r[3];return n[0]=ae*a+fe*x+be*A+_e*H,n[1]=ae*h+fe*w+be*P+_e*Y,n[2]=ae*m+fe*D+be*F+_e*le,n[3]=ae*_+fe*I+be*z+_e*me,n[4]=(ae=r[4])*a+(fe=r[5])*x+(be=r[6])*A+(_e=r[7])*H,n[5]=ae*h+fe*w+be*P+_e*Y,n[6]=ae*m+fe*D+be*F+_e*le,n[7]=ae*_+fe*I+be*z+_e*me,n[8]=(ae=r[8])*a+(fe=r[9])*x+(be=r[10])*A+(_e=r[11])*H,n[9]=ae*h+fe*w+be*P+_e*Y,n[10]=ae*m+fe*D+be*F+_e*le,n[11]=ae*_+fe*I+be*z+_e*me,n[12]=(ae=r[12])*a+(fe=r[13])*x+(be=r[14])*A+(_e=r[15])*H,n[13]=ae*h+fe*w+be*P+_e*Y,n[14]=ae*m+fe*D+be*F+_e*le,n[15]=ae*_+fe*I+be*z+_e*me,n}function Bu(n,e,r){var a,h,m,_,x,w,D,I,A,P,F,z,H=r[0],Y=r[1],le=r[2];return e===n?(n[12]=e[0]*H+e[4]*Y+e[8]*le+e[12],n[13]=e[1]*H+e[5]*Y+e[9]*le+e[13],n[14]=e[2]*H+e[6]*Y+e[10]*le+e[14],n[15]=e[3]*H+e[7]*Y+e[11]*le+e[15]):(h=e[1],m=e[2],_=e[3],x=e[4],w=e[5],D=e[6],I=e[7],A=e[8],P=e[9],F=e[10],z=e[11],n[0]=a=e[0],n[1]=h,n[2]=m,n[3]=_,n[4]=x,n[5]=w,n[6]=D,n[7]=I,n[8]=A,n[9]=P,n[10]=F,n[11]=z,n[12]=a*H+x*Y+A*le+e[12],n[13]=h*H+w*Y+P*le+e[13],n[14]=m*H+D*Y+F*le+e[14],n[15]=_*H+I*Y+z*le+e[15]),n}function Sc(n,e,r){var a=r[0],h=r[1],m=r[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function zf(n,e,r){var a=Math.sin(r),h=Math.cos(r),m=e[4],_=e[5],x=e[6],w=e[7],D=e[8],I=e[9],A=e[10],P=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*h+D*a,n[5]=_*h+I*a,n[6]=x*h+A*a,n[7]=w*h+P*a,n[8]=D*h-m*a,n[9]=I*h-_*a,n[10]=A*h-x*a,n[11]=P*h-w*a,n}function Id(n,e,r){var a=Math.sin(r),h=Math.cos(r),m=e[0],_=e[1],x=e[2],w=e[3],D=e[8],I=e[9],A=e[10],P=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*h-D*a,n[1]=_*h-I*a,n[2]=x*h-A*a,n[3]=w*h-P*a,n[8]=m*a+D*h,n[9]=_*a+I*h,n[10]=x*a+A*h,n[11]=w*a+P*h,n}function lm(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function cm(n,e,r){var a,h,m,_=r[0],x=r[1],w=r[2],D=Math.hypot(_,x,w);return D<zu?null:(_*=D=1/D,x*=D,w*=D,a=Math.sin(e),h=Math.cos(e),n[0]=_*_*(m=1-h)+h,n[1]=x*_*m+w*a,n[2]=w*_*m-x*a,n[3]=0,n[4]=_*x*m-w*a,n[5]=x*x*m+h,n[6]=w*x*m+_*a,n[7]=0,n[8]=_*w*m+x*a,n[9]=x*w*m-_*a,n[10]=w*w*m+h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Ng=ou;function fl(){var n=new xs(3);return xs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Nu(n){var e=new xs(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function wh(n){return Math.hypot(n[0],n[1],n[2])}function Eh(n,e,r){var a=new xs(3);return a[0]=n,a[1]=e,a[2]=r,a}function Mc(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function um(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function Ug(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function Sd(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function Uu(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function qs(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function Dh(n,e,r,a){return n[0]=e[0]+r[0]*a,n[1]=e[1]+r[1]*a,n[2]=e[2]+r[2]*a,n}function Go(n,e){var r=e[0],a=e[1],h=e[2],m=r*r+a*a+h*h;return m>0&&(m=1/Math.sqrt(m)),n[0]=e[0]*m,n[1]=e[1]*m,n[2]=e[2]*m,n}function la(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Th(n,e,r){var a=e[0],h=e[1],m=e[2],_=r[0],x=r[1],w=r[2];return n[0]=h*w-m*x,n[1]=m*_-a*w,n[2]=a*x-h*_,n}function Tr(n,e,r){var a=e[0],h=e[1],m=e[2],_=r[3]*a+r[7]*h+r[11]*m+r[15];return n[0]=(r[0]*a+r[4]*h+r[8]*m+r[12])/(_=_||1),n[1]=(r[1]*a+r[5]*h+r[9]*m+r[13])/_,n[2]=(r[2]*a+r[6]*h+r[10]*m+r[14])/_,n}function ju(n,e,r){var a=r[0],h=r[1],m=r[2],_=e[0],x=e[1],w=e[2],D=h*w-m*x,I=m*_-a*w,A=a*x-h*_,P=h*A-m*I,F=m*D-a*A,z=a*I-h*D,H=2*r[3];return I*=H,A*=H,F*=2,z*=2,n[0]=_+(D*=H)+(P*=2),n[1]=x+I+F,n[2]=w+A+z,n}var Vu,ca=um,hm=Ug,Zy=wh;function jg(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function Vg(n,e){var r=e[0],a=e[1],h=e[2],m=e[3],_=r*r+a*a+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),n[0]=r*_,n[1]=a*_,n[2]=h*_,n[3]=m*_,n}function Zl(n,e,r){var a=e[0],h=e[1],m=e[2],_=e[3];return n[0]=r[0]*a+r[4]*h+r[8]*m+r[12]*_,n[1]=r[1]*a+r[5]*h+r[9]*m+r[13]*_,n[2]=r[2]*a+r[6]*h+r[10]*m+r[14]*_,n[3]=r[3]*a+r[7]*h+r[11]*m+r[15]*_,n}function Md(){var n=new xs(4);return xs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function $g(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Gg(n,e,r){r*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],x=Math.sin(r),w=Math.cos(r);return n[0]=a*w+_*x,n[1]=h*w+m*x,n[2]=m*w-h*x,n[3]=_*w-a*x,n}function Bf(n,e,r){r*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],x=Math.sin(r),w=Math.cos(r);return n[0]=a*w-m*x,n[1]=h*w+_*x,n[2]=m*w+a*x,n[3]=_*w-h*x,n}fl(),Vu=new xs(4),xs!=Float32Array&&(Vu[0]=0,Vu[1]=0,Vu[2]=0,Vu[3]=0);var Hg=Vg;fl(),Eh(1,0,0),Eh(0,1,0),Md(),Md(),Ff();class Nf{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const h=la(r,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/h;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,r,a){if(H=(F=this.pos)[0],Y=F[1],le=F[2],me=(z=e)[0],ae=z[1],fe=z[2],Math.abs(H-me)<=zu*Math.max(1,Math.abs(H),Math.abs(me))&&Math.abs(Y-ae)<=zu*Math.max(1,Math.abs(Y),Math.abs(ae))&&Math.abs(le-fe)<=zu*Math.max(1,Math.abs(le),Math.abs(fe))||0===r)return a[0]=a[1]=a[2]=0,!1;var F,z,H,Y,le,me,ae,fe;const[h,m,_]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],D=this.pos[2]-e[2],I=h*h+m*m+_*_,A=2*(x*h+w*m+D*_),P=A*A-4*I*(x*x+w*w+D*D-r*r);if(P<0){const F=Math.max(-A/2,0),z=x+h*F,H=w+m*F,Y=D+_*F,le=Math.hypot(z,H,Y);return a[0]=z*r/le,a[1]=H*r/le,a[2]=Y*r/le,!1}{const F=(-A-Math.sqrt(P))/(2*I);if(F<0){const z=Math.hypot(x,w,D);return a[0]=x*r/z,a[1]=w*r/z,a[2]=D*r/z,!1}return a[0]=x+h*F,a[1]=w+m*F,a[2]=D+_*F,!0}}}class Uf{constructor(e,r,a,h,m){this.TL=e,this.TR=r,this.BR=a,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(e,r,a){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],x=[-1,-1,1],w=Tr(h,h,e),D=Tr(m,m,e),I=Tr(_,_,e),A=Tr(x,x,e);return new Uf(w,D,I,A,r/a)}}class jf{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,h){const m=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const D=Zl([],w,e),I=1/D[3]/r*m;return(A=D)[0]=(P=D)[0]*(F=[I,I,h?1/D[3]:I,I])[0],A[1]=P[1]*F[1],A[2]=P[2]*F[2],A[3]=P[3]*F[3],A;var A,P,F}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const D=Go([],Th([],ca([],_[w[0]],_[w[1]]),ca([],_[w[2]],_[w[1]]))),I=-la(D,_[w[1]]);return D.concat(I)});return new jf(_,x)}}class Io{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const h of e)Sd(r,r,h),Uu(a,a,h);return new Io(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let h=0;h<a.length;++h)Tr(a[h],a[h],r);return Io.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=qs([],Mc([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=Nu(this.min),h=Nu(this.max);for(let m=0;m<r.length;m++)a[m]=r[m]?this.min[m]:this.center[m],h[m]=r[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new Io(a,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let h=0;h<e.planes.length;h++){const m=e.planes[h];let _=0;for(let x=0;x<r.length;x++)_+=la(m,r[x])+m[3]>=0;if(0===_)return 0;_!==r.length&&(a=!1)}if(a)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const w=e.points[x][h]-this.min[h];m=Math.min(m,w),_=Math.max(_,w)}if(_<0||m>this.max[h]-this.min[h])return 0}return 1}}function Ch(n,e,r,a,h,m,_,x,w){if(m&&n.queryGeometry.isAboveHorizon)return!1;m&&(w*=n.pixelToTileUnitsFactor);const D=n.tileID.canonical,I=r.projection.upVectorScale(D,r.center.lat,r.worldSize).metersToTile;for(const A of e)for(const P of A){const F=P.add(x),z=h&&r.elevation?r.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,H=r.projection.projectTilePoint(F.x,F.y,D);if(z>0){const ae=r.projection.upVector(D,F.x,F.y);H.x+=ae[0]*I*z,H.y+=ae[1]*I*z,H.z+=ae[2]*I*z}const Y=m?F:Zg(H.x,H.y,H.z,a),le=m?n.tilespaceRays.map(ae=>Bi(ae,z)):n.queryGeometry.screenGeometry,me=Zl([],[H.x,H.y,H.z,1],a);if(!_&&m?w*=me[3]/r.cameraToCenterDistance:_&&!m&&(w*=r.cameraToCenterDistance/me[3]),m){const ae=Zi((P.y/hn+D.y)/(1<<D.z));w/=r.projection.pixelsPerMeter(ae,1)/sa(1,ae)}if(Rf(le,Y,w))return!0}return!1}function Zg(n,e,r,a){const h=Zl([],[n,e,r,1],a);return new et(h[0]/h[3],h[1]/h[3])}const Ad=Eh(0,0,0),qg=Eh(0,0,1);function Bi(n,e){const r=fl();return Ad[2]=e,n.intersectsPlane(Ad,qg,r),new et(r[0],r[1])}class dm extends wd{}function fm(n,{width:e,height:r},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*r*a);return n.width=e,n.height=r,n.data=h,n}function Vf(n,e,r){const{width:a,height:h}=e;a===n.width&&h===n.height||(Pd(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,h)},r),n.width=a,n.height=h,n.data=e.data)}function Pd(n,e,r,a,h,m){if(0===h.width||0===h.height)return e;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=n.data,x=e.data;for(let w=0;w<h.height;w++){const D=((r.y+w)*n.width+r.x)*m,I=((a.y+w)*e.width+a.x)*m;for(let A=0;A<h.width*m;A++)x[I+A]=_[D+A]}return e}St(dm,"HeatmapBucket",{omit:["layers"]});class ql{constructor(e,r){fm(this,e,1,r)}resize(e){Vf(this,new ql(e),1)}clone(){return new ql({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,m){Pd(e,r,a,h,m,1)}}class bs{constructor(e,r){fm(this,e,4,r)}resize(e){Vf(this,new bs(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,m){Pd(e,r,a,h,m,4)}}St(ql,"AlphaImage"),St(bs,"RGBAImage");var Wg={paint:new _t({"heatmap-radius":new Ce($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ce($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ke($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xt($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ke($e.paint_heatmap["heatmap-opacity"])})};function $f(n){const e={},r=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new bs({width:r,height:a}),m=(_,x,w)=>{e[n.evaluationKey]=w;const D=n.expression.evaluate(e);h.data[_+x+0]=Math.floor(255*D.r/D.a),h.data[_+x+1]=Math.floor(255*D.g/D.a),h.data[_+x+2]=Math.floor(255*D.b/D.a),h.data[_+x+3]=Math.floor(255*D.a)};if(n.clips)for(let _=0,x=0;_<a;++_,x+=4*r)for(let w=0,D=0;w<r;w++,D+=4){const I=w/(r-1),{start:A,end:P}=n.clips[_];m(x,D,A*(1-I)+P*I)}else for(let _=0,x=0;_<r;_++,x+=4)m(0,x,_/(r-1));return h}var pm={paint:new _t({"hillshade-illumination-direction":new ke($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ke($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ke($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ke($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ke($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ke($e.paint_hillshade["hillshade-accent-color"])})};const qy=yt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wy}=qy;var Wl={exports:{}};function $u(n,e,r){r=r||2;var a,h,m,_,x,w,D,I=e&&e.length,A=I?e[0]*r:n.length,P=Gf(n,0,A,r,!0),F=[];if(!P||P.next===P.prev)return F;if(I&&(P=function(H,Y,le,me){var ae,fe,be,_e=[];for(ae=0,fe=Y.length;ae<fe;ae++)(be=Gf(H,Y[ae]*me,ae<fe-1?Y[ae+1]*me:H.length,me,!1))===be.next&&(be.steiner=!0),_e.push(Wf(be));for(_e.sort(Hf),ae=0;ae<_e.length;ae++)le=Yy(_e[ae],le);return le}(n,e,P,r)),n.length>80*r){a=m=n[0],h=_=n[1];for(var z=r;z<A;z+=r)(x=n[z])<a&&(a=x),(w=n[z+1])<h&&(h=w),x>m&&(m=x),w>_&&(_=w);D=0!==(D=Math.max(m-a,_-h))?32767/D:0}return Gu(P,F,r,a,h,D,0),F}function Gf(n,e,r,a,h){var m,_;if(h===Xf(n,e,r,a)>0)for(m=e;m<r;m+=a)_=Pc(m,n[m],n[m+1],_);else for(m=r-a;m>=e;m-=a)_=Pc(m,n[m],n[m+1],_);return _&&Rd(_,_.next)&&(Hu(_),_=_.next),_}function Ac(n,e){if(!n)return n;e||(e=n);var r,a=n;do{if(r=!1,a.steiner||!Rd(a,a.next)&&0!==Ur(a.prev,a,a.next))a=a.next;else{if(Hu(a),(a=e=a.prev)===a.next)break;r=!0}}while(r||a!==e);return e}function Gu(n,e,r,a,h,m,_){if(n){!_&&m&&function(I,A,P,F){var z=I;do{0===z.z&&(z.z=qf(z.x,z.y,A,P,F)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next}while(z!==I);z.prevZ.nextZ=null,z.prevZ=null,function(H){var Y,le,me,ae,fe,be,_e,Be,Fe=1;do{for(le=H,H=null,fe=null,be=0;le;){for(be++,me=le,_e=0,Y=0;Y<Fe&&(_e++,me=me.nextZ);Y++);for(Be=Fe;_e>0||Be>0&&me;)0!==_e&&(0===Be||!me||le.z<=me.z)?(ae=le,le=le.nextZ,_e--):(ae=me,me=me.nextZ,Be--),fe?fe.nextZ=ae:H=ae,ae.prevZ=fe,fe=ae;le=me}fe.nextZ=null,Fe*=2}while(be>1)}(z)}(n,a,h,m);for(var x,w,D=n;n.prev!==n.next;)if(x=n.prev,w=n.next,m?Xg(n,a,h,m):Xy(n))e.push(x.i/r|0),e.push(n.i/r|0),e.push(w.i/r|0),Hu(n),n=w.next,D=w.next;else if((n=w)===D){_?1===_?Gu(n=mm(Ac(n),e,r),e,r,a,h,m,2):2===_&&gm(n,e,r,a,h,m):Gu(Ac(n),e,r,a,h,m,1);break}}}function Xy(n){var e=n.prev,r=n,a=n.next;if(Ur(e,r,a)>=0)return!1;for(var h=e.x,m=r.x,_=a.x,x=e.y,w=r.y,D=a.y,I=h<m?h<_?h:_:m<_?m:_,A=x<w?x<D?x:D:w<D?w:D,P=h>m?h>_?h:_:m>_?m:_,F=x>w?x>D?x:D:w>D?w:D,z=a.next;z!==e;){if(z.x>=I&&z.x<=P&&z.y>=A&&z.y<=F&&su(h,x,m,w,_,D,z.x,z.y)&&Ur(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function Xg(n,e,r,a){var h=n.prev,m=n,_=n.next;if(Ur(h,m,_)>=0)return!1;for(var x=h.x,w=m.x,D=_.x,I=h.y,A=m.y,P=_.y,F=x<w?x<D?x:D:w<D?w:D,z=I<A?I<P?I:P:A<P?A:P,H=x>w?x>D?x:D:w>D?w:D,Y=I>A?I>P?I:P:A>P?A:P,le=qf(F,z,e,r,a),me=qf(H,Y,e,r,a),ae=n.prevZ,fe=n.nextZ;ae&&ae.z>=le&&fe&&fe.z<=me;){if(ae.x>=F&&ae.x<=H&&ae.y>=z&&ae.y<=Y&&ae!==h&&ae!==_&&su(x,I,w,A,D,P,ae.x,ae.y)&&Ur(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,fe.x>=F&&fe.x<=H&&fe.y>=z&&fe.y<=Y&&fe!==h&&fe!==_&&su(x,I,w,A,D,P,fe.x,fe.y)&&Ur(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ae&&ae.z>=le;){if(ae.x>=F&&ae.x<=H&&ae.y>=z&&ae.y<=Y&&ae!==h&&ae!==_&&su(x,I,w,A,D,P,ae.x,ae.y)&&Ur(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=F&&fe.x<=H&&fe.y>=z&&fe.y<=Y&&fe!==h&&fe!==_&&su(x,I,w,A,D,P,fe.x,fe.y)&&Ur(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function mm(n,e,r){var a=n;do{var h=a.prev,m=a.next.next;!Rd(h,m)&&kd(h,a,a.next,m)&&lu(h,m)&&lu(m,h)&&(e.push(h.i/r|0),e.push(a.i/r|0),e.push(m.i/r|0),Hu(a),Hu(a.next),a=n=m),a=a.next}while(a!==n);return Ac(a)}function gm(n,e,r,a,h,m){var _=n;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&_m(_,x)){var w=Ih(_,x);return _=Ac(_,_.next),w=Ac(w,w.next),Gu(_,e,r,a,h,m,0),void Gu(w,e,r,a,h,m,0)}x=x.next}_=_.next}while(_!==n)}function Hf(n,e){return n.x-e.x}function Yy(n,e){var r=function(h,m){var _,x=m,w=h.x,D=h.y,I=-1/0;do{if(D<=x.y&&D>=x.next.y&&x.next.y!==x.y){var A=x.x+(D-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(A<=w&&A>I&&(I=A,_=x.x<x.next.x?x:x.next,A===w))return _}x=x.next}while(x!==m);if(!_)return null;var P,F=_,z=_.x,H=_.y,Y=1/0;x=_;do{w>=x.x&&x.x>=z&&w!==x.x&&su(D<H?w:I,D,z,H,D<H?I:w,D,x.x,x.y)&&(P=Math.abs(D-x.y)/(w-x.x),lu(x,h)&&(P<Y||P===Y&&(x.x>_.x||x.x===_.x&&Zf(_,x)))&&(_=x,Y=P)),x=x.next}while(x!==F);return _}(n,e);if(!r)return e;var a=Ih(r,n);return Ac(a,a.next),Ac(r,r.next)}function Zf(n,e){return Ur(n.prev,n,e.prev)<0&&Ur(e.next,n,n.next)<0}function qf(n,e,r,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wf(n){var e=n,r=n;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==n);return r}function su(n,e,r,a,h,m,_,x){return(h-_)*(e-x)>=(n-_)*(m-x)&&(n-_)*(a-x)>=(r-_)*(e-x)&&(r-_)*(m-x)>=(h-_)*(a-x)}function _m(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,a){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==a.i&&h.next.i!==a.i&&kd(h,h.next,r,a))return!0;h=h.next}while(h!==r);return!1}(n,e)&&(lu(n,e)&&lu(e,n)&&function(r,a){var h=r,m=!1,_=(r.x+a.x)/2,x=(r.y+a.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==r);return m}(n,e)&&(Ur(n.prev,n,e.prev)||Ur(n,e.prev,e))||Rd(n,e)&&Ur(n.prev,n,n.next)>0&&Ur(e.prev,e,e.next)>0)}function Ur(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Rd(n,e){return n.x===e.x&&n.y===e.y}function kd(n,e,r,a){var h=Ld(Ur(n,e,r)),m=Ld(Ur(n,e,a)),_=Ld(Ur(r,a,n)),x=Ld(Ur(r,a,e));return h!==m&&_!==x||!(0!==h||!au(n,r,e))||!(0!==m||!au(n,a,e))||!(0!==_||!au(r,n,a))||!(0!==x||!au(r,e,a))}function au(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Ld(n){return n>0?1:n<0?-1:0}function lu(n,e){return Ur(n.prev,n,n.next)<0?Ur(n,e,n.next)>=0&&Ur(n,n.prev,e)>=0:Ur(n,e,n.prev)<0||Ur(n,n.next,e)<0}function Ih(n,e){var r=new Sh(n.i,n.x,n.y),a=new Sh(e.i,e.x,e.y),h=n.next,m=e.prev;return n.next=e,e.prev=n,r.next=h,h.prev=r,a.next=r,r.prev=a,m.next=a,a.prev=m,a}function Pc(n,e,r,a){var h=new Sh(n,e,r);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Hu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Sh(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Xf(n,e,r,a){for(var h=0,m=e,_=r-a;m<r;m+=a)h+=(n[_]-n[m])*(n[m+1]+n[_+1]),_=m;return h}function Yg(n,e,r,a,h){Yf(n,e,r||0,a||n.length-1,h||Kg)}function Yf(n,e,r,a,h){for(;a>r;){if(a-r>600){var m=a-r+1,_=e-r+1,x=Math.log(m),w=.5*Math.exp(2*x/3),D=.5*Math.sqrt(x*w*(m-w)/m)*(_-m/2<0?-1:1);Yf(n,e,Math.max(r,Math.floor(e-_*w/m+D)),Math.min(a,Math.floor(e+(m-_)*w/m+D)),h)}var I=n[e],A=r,P=a;for(pl(n,r,e),h(n[a],I)>0&&pl(n,r,a);A<P;){for(pl(n,A,P),A++,P--;h(n[A],I)<0;)A++;for(;h(n[P],I)>0;)P--}0===h(n[r],I)?pl(n,r,P):pl(n,++P,a),P<=e&&(r=P+1),e<=P&&(a=P-1)}}function pl(n,e,r){var a=n[e];n[e]=n[r],n[r]=a}function Kg(n,e){return n<e?-1:n>e?1:0}function Kf(n,e){const r=n.length;if(r<=1)return[n];const a=[];let h,m;for(let _=0;_<r;_++){const x=jn(n[_]);0!==x&&(n[_].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(h&&a.push(h),h=[n[_]]):h.push(n[_]))}if(h&&a.push(h),e>1)for(let _=0;_<a.length;_++)a[_].length<=e||(Yg(a[_],e,1,a[_].length-1,Jg),a[_]=a[_].slice(0,e));return a}function Jg(n,e){return e.area-n.area}function Mh(n,e,r){const a=r.patternDependencies;let h=!1;for(const m of e){const _=m.paint.get(`${n}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,a[x.to]=!0,a[x.from]=!0)}return h}function Jf(n,e,r,a,h){const m=h.patternDependencies;for(const _ of e){const x=_.paint.get(`${n}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:a-1},r,{},h.availableImages),D=x.evaluate({zoom:a},r,{},h.availableImages),I=x.evaluate({zoom:a+1},r,{},h.availableImages);w=w&&w.name?w.name:w,D=D&&D.name?D.name:D,I=I&&I.name?I.name:I,m[w]=!0,m[D]=!0,m[I]=!0,r.patterns[_.id]={min:w,mid:D,max:I}}}return r}Wl.exports=$u,Wl.exports.default=$u,$u.deviation=function(n,e,r,a){var h=e&&e.length,m=Math.abs(Xf(n,0,h?e[0]*r:n.length,r));if(h)for(var _=0,x=e.length;_<x;_++)m-=Math.abs(Xf(n,e[_]*r,_<x-1?e[_+1]*r:n.length,r));var w=0;for(_=0;_<a.length;_+=3){var D=a[_]*r,I=a[_+1]*r,A=a[_+2]*r;w+=Math.abs((n[D]-n[A])*(n[I+1]-n[D+1])-(n[D]-n[I])*(n[A+1]-n[D+1]))}return 0===m&&0===w?0:Math.abs((w-m)/m)},$u.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,h=0;h<n.length;h++){for(var m=0;m<n[h].length;m++)for(var _=0;_<e;_++)r.vertices.push(n[h][m][_]);h>0&&r.holes.push(a+=n[h-1].length)}return r};class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mn,this.indexArray=new Vo,this.indexArray2=new ia,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,h){this.hasPattern=Mh("fill",this.layers,r);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:w,index:D,sourceLayerIndex:I}of e){const A=this.layers[0]._featureFilter.needGeometry,P=Tc(x,A);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),P,a))continue;const F=m?m.evaluate(P,{},a,r.availableImages):void 0,z={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:D,geometry:A?P.geometry:La(x,a,h),patterns:{},sortKey:F};_.push(z)}m&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:D,sourceLayerIndex:I}=x;if(this.hasPattern){const A=Jf("fill",this.layers,x,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(x,w,D,a,{},r.availableImages);r.featureIndex.insert(e[D].feature,w,D,I,this.index)}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}addFeatures(e,r,a,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,h,m,_=[]){for(const x of Kf(r,500)){let w=0;for(const z of x)w+=z.length;const D=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=D.vertexLength,A=[],P=[];for(const z of x){if(0===z.length)continue;z!==x[0]&&P.push(A.length/2);const H=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),Y=H.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(Y+z.length-1,Y),A.push(z[0].x),A.push(z[0].y);for(let le=1;le<z.length;le++)this.layoutVertexArray.emplaceBack(z[le].x,z[le].y),this.indexArray2.emplaceBack(Y+le-1,Y+le),A.push(z[le].x),A.push(z[le].y);H.vertexLength+=z.length,H.primitiveLength+=z.length}const F=Wl.exports(A,P);for(let z=0;z<F.length;z+=3)this.indexArray.emplaceBack(I+F[z],I+F[z+1],I+F[z+2]);D.vertexLength+=w,D.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,_,h)}}St(Ah,"FillBucket",{omit:["layers","patternFeatures"]});const Qg=new _t({"fill-sort-key":new Ce($e.layout_fill["fill-sort-key"])});var ym={paint:new _t({"fill-antialias":new ke($e.paint_fill["fill-antialias"]),"fill-opacity":new Ce($e.paint_fill["fill-opacity"]),"fill-color":new Ce($e.paint_fill["fill-color"]),"fill-outline-color":new Ce($e.paint_fill["fill-outline-color"]),"fill-translate":new ke($e.paint_fill["fill-translate"]),"fill-translate-anchor":new ke($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ct($e.paint_fill["fill-pattern"])}),layout:Qg};const Ky=yt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),e_=yt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ph=yt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:t_}=Ky;var Xl={},Rh=et,vm=kh;function kh(n,e,r,a,h){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(xm,this,e)}function xm(n,e,r){1==n?e.id=r.readVarint():2==n?function(a,h){for(var m=a.readVarint()+a.pos;a.pos<m;){var _=h._keys[a.readVarint()],x=h._values[a.readVarint()];h.properties[_]=x}}(r,e):3==n?e.type=r.readVarint():4==n&&(e._geometry=r.pos)}function n_(n){for(var e,r,a=0,h=0,m=n.length,_=m-1;h<m;_=h++)a+=((r=n[_]).x-(e=n[h]).x)*(e.y+r.y);return a}kh.types=["Unknown","Point","LineString","Polygon"],kh.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,a=1,h=0,m=0,_=0,x=[];n.pos<r;){if(h<=0){var w=n.readVarint();a=7&w,h=w>>3}if(h--,1===a||2===a)m+=n.readSVarint(),_+=n.readSVarint(),1===a&&(e&&x.push(e),e=[]),e.push(new Rh(m,_));else{if(7!==a)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&x.push(e),x},kh.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,a=0,h=0,m=0,_=1/0,x=-1/0,w=1/0,D=-1/0;n.pos<e;){if(a<=0){var I=n.readVarint();r=7&I,a=I>>3}if(a--,1===r||2===r)(h+=n.readSVarint())<_&&(_=h),h>x&&(x=h),(m+=n.readSVarint())<w&&(w=m),m>D&&(D=m);else if(7!==r)throw new Error("unknown command "+r)}return[_,w,x,D]},kh.prototype.toGeoJSON=function(n,e,r){var a,h,m=this.extent*Math.pow(2,r),_=this.extent*n,x=this.extent*e,w=this.loadGeometry(),D=kh.types[this.type];function I(F){for(var z=0;z<F.length;z++){var H=F[z];F[z]=[360*(H.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<w.length;a++)A[a]=w[a][0];I(w=A);break;case 2:for(a=0;a<w.length;a++)I(w[a]);break;case 3:for(w=function(F){var z=F.length;if(z<=1)return[F];for(var H,Y,le=[],me=0;me<z;me++){var ae=n_(F[me]);0!==ae&&(void 0===Y&&(Y=ae<0),Y===ae<0?(H&&le.push(H),H=[F[me]]):H.push(F[me]))}return H&&le.push(H),le}(w),a=0;a<w.length;a++)for(h=0;h<w[a].length;h++)I(w[a][h])}1===w.length?w=w[0]:D="Multi"+D;var P={type:"Feature",geometry:{type:D,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var r_=vm,bm=Qf;function Qf(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(i_,this,e),this.length=this._features.length}function i_(n,e,r){15===n?e.version=r.readVarint():1===n?e.name=r.readString():5===n?e.extent=r.readVarint():2===n?e._features.push(r.pos):3===n?e._keys.push(r.readString()):4===n&&e._values.push(function(a){for(var h=null,m=a.readVarint()+a.pos;a.pos<m;){var _=a.readVarint()>>3;h=1===_?a.readString():2===_?a.readFloat():3===_?a.readDouble():4===_?a.readVarint64():5===_?a.readVarint():6===_?a.readSVarint():7===_?a.readBoolean():null}return h}(r))}Qf.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new r_(this._pbf,e,this.extent,this._keys,this._values)};var ep=bm;function tp(n,e,r){if(3===n){var a=new ep(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var np=Xl.VectorTile=function(n,e){this.layers=n.readFields(tp,{},e)},Zu=Xl.VectorTileFeature=vm;function Rc(n,e,r,a){const h=[],m=0===a?(_,x,w,D,I,A)=>{_.push(new et(A,w+(A-x)/(D-x)*(I-w)))}:(_,x,w,D,I,A)=>{_.push(new et(x+(A-w)/(I-w)*(D-x),A))};for(const _ of n){const x=[];for(const w of _){if(w.length<=2)continue;const D=[];for(let P=0;P<w.length-1;P++){const F=w[P].x,z=w[P].y,H=w[P+1].x,Y=w[P+1].y,le=0===a?F:z,me=0===a?H:Y;le<e?me>e&&m(D,F,z,H,Y,e):le>r?me<r&&m(D,F,z,H,Y,r):D.push(w[P]),me<e&&le>=e&&m(D,F,z,H,Y,e),me>r&&le<=r&&m(D,F,z,H,Y,r)}let I=w[w.length-1];const A=0===a?I.x:I.y;A>=e&&A<=r&&D.push(I),D.length&&(I=D[D.length-1],D[0].x===I.x&&D[0].y===I.y||D.push(D[0]),x.push(D))}x.length&&h.push(x)}return h}Xl.VectorTileLayer=bm;const o_=Zu.types,s_=Math.pow(2,13);function Lh(n,e,r,a,h,m,_,x){n.emplaceBack((e<<1)+_,(r<<1)+m,(Math.floor(a*s_)<<1)+h,Math.round(x))}function Oh(n,e,r){n.emplaceBack(e.x,e.y,e.z,16384*r[0],16384*r[1],16384*r[2])}class wm{constructor(){this.acc=new et(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new et(e.x,e.y),this.max=new et(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,h=this.max;e.x<a.x?a.x=e.x:e.x>h.x&&(h.x=e.x),e.y<a.y?a.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===hn)&&e.x===r.x)!=((0===e.y||e.y===hn)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Dn(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>hn!=e.x>hn&&this.addBorderIntersection(1,Dn(r.y,e.y,(hn-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Dn(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>hn!=e.y>hn&&this.addBorderIntersection(3,Dn(r.x,e.x,(hn-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=0===e.x?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=0===e.y?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return 0!==e?this.acc.div(e)._round():new et(0,0)}span(){return new et(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Fh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new yr,this.centroidVertexArray=new Jp,this.indexArray=new Vo,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,h){this.features=[],this.hasPattern=Mh("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/hn/(1<<m.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of e){const D=this.layers[0]._featureFilter.needGeometry,I=Tc(m,D);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),I,a))continue;const A={id:_,sourceLayerIndex:w,index:x,geometry:D?I.geometry:La(m,a,h),properties:m.properties,type:m.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Jf("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,x,a,{},r.availableImages,h),r.featureIndex.insert(m,A.geometry,x,w,this.index,P)}this.sortBorders()}addFeatures(e,r,a,h,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,r,a,h,m)}this.sortBorders()}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,t_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Ph.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,e_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,h,m,_,x){const w=[new et(0,0),new et(hn,hn)],D=x.projection,I="globe"===D.name,A=this.enableTerrain&&!I?new wm:null,P="Polygon"===o_[e.type];I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new md);const F=Kf(r,500);for(let le=F.length-1;le>=0;le--){const me=F[le];(0===me.length||(z=me[0]).every(ae=>ae.x<=0)||z.every(ae=>ae.x>=hn)||z.every(ae=>ae.y<=0)||z.every(ae=>ae.y>=hn))&&F.splice(le,1)}var z;let H;if(I)H=rp(F,w,h);else{H=[];for(const le of F)H.push({polygon:le,bounds:w})}const Y=P?this.edgeRadius:0;for(const{polygon:le,bounds:me}of H){let ae=0,fe=0;for(const _e of le)P&&!_e[0].equals(_e[_e.length-1])&&_e.push(_e[0]),fe+=P?_e.length-1:_e.length;const be=this.segments.prepareSegment((P?5:4)*fe,this.layoutVertexArray,this.indexArray);if(P){const _e=[],Be=[];ae=be.vertexLength;for(const He of le){let ht,je;He.length&&He!==le[0]&&Be.push(_e.length/2),ht=He[1].sub(He[0])._perp()._unit();for(let Je=1;Je<He.length;Je++){const nt=He[Je],at=He[Je===He.length-1?1:Je+1];let{x:pt,y:Ze}=nt;if(Y){je=at.sub(nt)._perp()._unit();const Ft=ht.add(je)._unit(),cn=Y*Math.min(4,1/(ht.x*Ft.x+ht.y*Ft.y));pt+=cn*Ft.x,Ze+=cn*Ft.y,ht=je}Lh(this.layoutVertexArray,pt,Ze,0,0,1,1,0),be.vertexLength++,_e.push(nt.x,nt.y),I&&Oh(this.layoutVertexExtArray,D.projectTilePoint(pt,Ze,h),D.upVector(h,pt,Ze))}}const Fe=Wl.exports(_e,Be);for(let He=0;He<Fe.length;He+=3)this.indexArray.emplaceBack(ae+Fe[He],ae+Fe[He+2],ae+Fe[He+1]),be.primitiveLength++}for(const _e of le){A&&_e.length&&A.startRing(_e[0]);let Be,Fe,He,ht=_e.length>4&&Tm(_e[_e.length-2],_e[0],_e[1]),je=Y?qu(_e[_e.length-2],_e[0],_e[1],Y):0;Fe=_e[1].sub(_e[0])._perp()._unit();let Je=!0;for(let nt=1,at=0;nt<_e.length;nt++){let pt=_e[nt-1],Ze=_e[nt];const Ft=_e[nt===_e.length-1?1:nt+1];if(A&&P&&A.currentPolyCount.top++,Dm(Ze,pt,me)){Y&&(Fe=Ft.sub(Ze)._perp()._unit(),Je=!Je);continue}A&&A.append(Ze,pt);const cn=Ze.sub(pt)._perp(),qt=cn.x/(Math.abs(cn.x)+Math.abs(cn.y)),jt=cn.y>0?1:0,Mt=pt.dist(Ze);if(at+Mt>32768&&(at=0),Y){He=Ft.sub(Ze)._perp()._unit();let Qn=ml(pt,Ze,Ft,Em(Fe,He),Y);isNaN(Qn)&&(Qn=0);const gn=Ze.sub(pt)._unit();pt=pt.add(gn.mult(je))._round(),Ze=Ze.add(gn.mult(-Qn))._round(),je=Qn,Fe=He}const an=be.vertexLength,wn=_e.length>4&&Tm(pt,Ze,Ft);let Cn=a_(at,ht,Je);if(Lh(this.layoutVertexArray,pt.x,pt.y,qt,jt,0,0,Cn),Lh(this.layoutVertexArray,pt.x,pt.y,qt,jt,0,1,Cn),at+=Mt,Cn=a_(at,wn,!Je),ht=wn,Lh(this.layoutVertexArray,Ze.x,Ze.y,qt,jt,0,0,Cn),Lh(this.layoutVertexArray,Ze.x,Ze.y,qt,jt,0,1,Cn),be.vertexLength+=4,this.indexArray.emplaceBack(an+0,an+1,an+2),this.indexArray.emplaceBack(an+1,an+3,an+2),be.primitiveLength+=2,Y){const Qn=ae+(1===nt?_e.length-2:nt-2),gn=1===nt?ae:Qn+1;if(this.indexArray.emplaceBack(an+1,Qn,an+3),this.indexArray.emplaceBack(Qn,gn,an+3),be.primitiveLength+=2,void 0===Be&&(Be=an),!Dm(Ft,_e[nt],me)){const Cr=nt===_e.length-1?Be:be.vertexLength;this.indexArray.emplaceBack(an+2,an+3,Cr),this.indexArray.emplaceBack(an+3,Cr+1,Cr),this.indexArray.emplaceBack(an+3,gn,Cr+1),be.primitiveLength+=3}Je=!Je}if(I){const Qn=this.layoutVertexExtArray,gn=D.projectTilePoint(pt.x,pt.y,h),Cr=D.projectTilePoint(Ze.x,Ze.y,h),An=D.upVector(h,pt.x,pt.y),Nn=D.upVector(h,Ze.x,Ze.y);Oh(Qn,gn,An),Oh(Qn,gn,An),Oh(Qn,Cr,Nn),Oh(Qn,Cr,Nn)}}P&&(ae+=_e.length-1)}}if(A&&A.polyCount.length>0){if(A.borders){A.vertexArrayOffset=this.centroidVertexArray.length;const le=A.borders,me=this.featuresOnBorder.push(A)-1;for(let ae=0;ae<4;ae++)le[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(me)}this.encodeCentroid(A.borders?void 0:A.centroid(),A)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,_,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let h,m;if(e)if(0!==e.y){const x=r.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(e.x+450)),m=0;else h=0,m=+a;let _=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const x of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(_++,h,m);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m)}}}function Em(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function qu(n,e,r,a){const h=e.sub(n)._perp()._unit(),m=r.sub(e)._perp()._unit();return ml(n,e,r,Em(h,m),a)}function ml(n,e,r,a,h){const m=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(r)/3,h*m/a)}function Dm(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function Tm(n,e,r){if(n.x<0||n.x>=hn||e.x<0||e.x>=hn||r.x<0||r.x>=hn)return!1;const a=r.sub(e),h=a.perp(),m=n.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function a_(n,e,r){const a=e?2|n:-3&n;return r?1|a:-2&a}function l_(){const n=Math.PI/32,e=Math.tan(n),r=xd;return r*Math.sqrt(1+2*e*e)-r}function rp(n,e,r){const a=1<<r.z,h=Zs(r.x/a),m=Zs((r.x+1)/a),_=Zi(r.y/a),x=Zi((r.y+1)/a);return function(w,D,I,A,P=0,F){const z=[];if(!w.length||!I||!A)return z;const H=(_e,Be)=>{for(const Fe of _e)z.push({polygon:Fe,bounds:Be})},Y=Math.ceil(Math.log2(I)),le=Math.ceil(Math.log2(A)),me=Y-le,ae=[];for(let _e=0;_e<Math.abs(me);_e++)ae.push(me>0?0:1);for(let _e=0;_e<Math.min(Y,le);_e++)ae.push(0),ae.push(1);let fe=w;if(fe=Rc(fe,D[0].y-P,D[1].y+P,1),fe=Rc(fe,D[0].x-P,D[1].x+P,0),!fe.length)return z;const be=[];for(ae.length?be.push({polygons:fe,bounds:D,depth:0}):H(fe,D);be.length;){const _e=be.pop(),Be=_e.depth,Fe=ae[Be],He=_e.bounds[0],ht=_e.bounds[1],je=0===Fe?He.x:He.y,Je=0===Fe?ht.x:ht.y,nt=F?F(Fe,je,Je):.5*(je+Je),at=Rc(_e.polygons,je-P,nt+P,Fe),pt=Rc(_e.polygons,nt-P,Je+P,Fe);if(at.length){const Ze=[He,new et(0===Fe?nt:ht.x,1===Fe?nt:ht.y)];ae.length>Be+1?be.push({polygons:at,bounds:Ze,depth:Be+1}):H(at,Ze)}if(pt.length){const Ze=[new et(0===Fe?nt:He.x,1===Fe?nt:He.y),ht];ae.length>Be+1?be.push({polygons:pt,bounds:Ze,depth:Be+1}):H(pt,Ze)}}return z}(n,e,Math.ceil((m-h)/11.25),Math.ceil((_-x)/11.25),1,(w,D,I)=>{if(0===w)return.5*(D+I);{const A=Zi((r.y+D/hn)/a);return(oa(.5*(Zi((r.y+I/hn)/a)+A))*a-r.y)*hn}})}St(Fh,"FillExtrusionBucket",{omit:["layers","features"]}),St(wm,"PartMetadata");const Jy=new _t({"fill-extrusion-edge-radius":new ke($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Cm={paint:new _t({"fill-extrusion-opacity":new ke($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ce($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ke($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ke($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ct($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ce($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ce($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ke($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ke($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ke($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Jy};function c_(n,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class zh{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Bh(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=(_=this.y,x=this.z,w=c_(256*(m=this.x),256*(_=Math.pow(2,x)-_-1),x),D=c_(256*(m+1),256*(_+1),x),w[0]+","+w[1]+","+D[0]+","+D[1]),h=function(m,_,x){let w,D="";for(let I=m;I>0;I--)w=1<<I-1,D+=(_&w?1:0)+(x&w?2:0);return D}(this.z,this.x,this.y);var m,_,x,w,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Im{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Bh(e,r.z,r.z,r.x,r.y)}}class So{constructor(e,r,a,h,m){this.overscaledZ=e,this.wrap=r,this.canonical=new zh(a,+h,+m),this.key=0===r&&e===a?this.canonical.key:Bh(r,e,a,h,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new So(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new So(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Bh(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Bh(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new So(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new So(r,this.wrap,r,a,h),new So(r,this.wrap,r,a+1,h),new So(r,this.wrap,r,a,h+1),new So(r,this.wrap,r,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new So(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new So(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Im(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bh(n,e,r,a,h){const m=1<<Math.min(r,22);let _=m*(h%m)+a%m;return n&&r<22&&(_+=m*m*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*_+r)+(e-r)}St(zh,"CanonicalTileID"),St(So,"OverscaledTileID",{omit:["projMatrix"]});class Wu extends et{constructor(e,r,a){super(e,r),this.z=a}}function is(n,e){return n.x*e.x+n.y*e.y}function Sm(n,e){if(1===n.length){let r=0;const a=e[r++];let h;for(;!h||a.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const m=e[r],_=n[0],x=h.sub(a),w=m.sub(a),D=_.sub(a),I=is(x,x),A=is(x,w),P=is(w,w),F=is(D,x),z=is(D,w),H=I*P-A*A,Y=(P*F-A*z)/H,le=(I*z-A*F)/H,me=a.z*(1-Y-le)+h.z*Y+m.z*le;if(isFinite(me))return me}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function ip(n,e,r,a,h,m,_,x){const w=_*h.getElevationAt(n,e,!0,!0),D=0!==m[0],I=D?0===m[1]?_*(m[0]/7-450):_*function(A,P,F){const z=Math.floor(P[0]/8),H=Math.floor(P[1]/8),Y=10*(P[0]-8*z),le=10*(P[1]-8*H),me=A.getElevationAt(z,H,!0,!0),ae=A.getMeterToDEM(F),fe=Math.floor(.5*(Y*ae-1)),be=Math.floor(.5*(le*ae-1)),_e=A.tileCoordToPixel(z,H),Be=2*fe+1,Fe=2*be+1,He=(cn=Be,qt=Fe,[(pt=A).getElevationAtPixel(Ze=_e.x-fe,Ft=_e.y-be,!0),pt.getElevationAtPixel(Ze+qt,Ft,!0),pt.getElevationAtPixel(Ze,Ft+qt,!0),pt.getElevationAtPixel(Ze+cn,Ft+qt,!0)]),ht=Math.abs(He[0]-He[1]),je=Math.abs(He[2]-He[3]),Je=Math.abs(He[0]-He[2])+Math.abs(He[1]-He[3]),nt=Math.min(.25,.5*ae*(ht+je)/Be),at=Math.min(.25,.5*ae*Je/Fe);var pt,Ze,Ft,cn,qt;return me+Math.max(nt*Y,at*le)}(h,m,x):w;return{base:w+(0===r)?-1:r,top:D?Math.max(I+a,w+r+2):w+a}}const u_=yt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:h_}=u_,d_=yt([{name:"a_packed",components:4,type:"Float32"}]),{members:f_}=d_,Mm=Zu.types,p_=Math.cos(Math.PI/180*37.5);class Od{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new dr,this.layoutVertexArray2=new Ai,this.indexArray=new Vo,this.programConfigurations=new Hl(e.layers,e.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,h){this.hasPattern=Mh("line",this.layers,r);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:A,index:P,sourceLayerIndex:F}of e){const z=this.layers[0]._featureFilter.needGeometry,H=Tc(I,z);if(!this.layers[0]._featureFilter.filter(new ue(this.zoom),H,a))continue;const Y=m?m.evaluate(H,{},a):void 0,le={id:A,properties:I.properties,type:I.type,sourceLayerIndex:F,index:P,geometry:z?H.geometry:La(I,a,h),patterns:{},sortKey:Y};_.push(le)}m&&_.sort((I,A)=>I.sortKey-A.sortKey);const{lineAtlas:x,featureIndex:w}=r,D=this.addConstantDashes(x);for(const I of _){const{geometry:A,index:P,sourceLayerIndex:F}=I;if(D&&this.addFeatureDashes(I,x),this.hasPattern){const z=Jf("line",this.layers,I,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(I,A,P,a,x.positions,r.availableImages);w.insert(e[P].feature,A,P,F,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)r=!0;else{const _=m.value,x=h.value;if(!x)continue;e.addDash(x.from,_),e.addDash(x.to,_),x.other&&e.addDash(x.other,_)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let x,w,D,I,A,P;if("constant"===m.kind){const Y=m.value;if(!Y)continue;x=Y.other||Y.to,w=Y.to,D=Y.from}else x=m.evaluate({zoom:a-1},e),w=m.evaluate({zoom:a},e),D=m.evaluate({zoom:a+1},e);"constant"===_.kind?I=A=P=_.value:(I=_.evaluate({zoom:a-1},e),A=_.evaluate({zoom:a},e),P=_.evaluate({zoom:a+1},e)),r.addDash(x,I),r.addDash(w,A),r.addDash(D,P);const F=r.getKey(x,I),z=r.getKey(w,A),H=r.getKey(D,P);e.patterns[h.id]={min:F,mid:z,max:H}}}update(e,r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,h)}addFeatures(e,r,a,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,r,a,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,f_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,h,m,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),D=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),A=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of r)this.addLine(P,e,w,D,I,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,_,h)}addLine(e,r,a,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<e.length-1;le++)this.totalDistance+=e[le].dist(e[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Mm[r.type];let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let D=0;for(;D<w-1&&e[D].equals(e[D+1]);)D++;if(w<(x?3:2))return;"bevel"===a&&(m=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,A=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,F,z,H,Y;this.e1=this.e2=-1,x&&(P=e[w-2],Y=e[D].sub(P)._unit()._perp());for(let le=D;le<w;le++){if(z=le===w-1?x?e[D+1]:void 0:e[le+1],z&&e[le].equals(z))continue;Y&&(H=Y),P&&(F=P),P=e[le],Y=z?z.sub(P)._unit()._perp():H,H=H||Y;let me=H.add(Y);0===me.x&&0===me.y||me._unit();const ae=H.x*Y.x+H.y*Y.y,fe=me.x*Y.x+me.y*Y.y,be=0!==fe?1/fe:1/0,_e=2*Math.sqrt(2-2*fe),Be=fe<p_&&F&&z,Fe=H.x*Y.y-H.y*Y.x>0;if(Be&&le>D){const je=P.dist(F);if(je>2*I){const Je=P.sub(P.sub(F)._mult(I/je)._round());this.updateDistance(F,Je),this.addCurrentVertex(Je,H,0,0,A),F=Je}}const He=F&&z;let ht=He?a:x?"butt":h;if(He&&"round"===ht&&(be<_?ht="miter":be<=2&&(ht="fakeround")),"miter"===ht&&be>m&&(ht="bevel"),"bevel"===ht&&(be>2&&(ht="flipbevel"),be<m&&(ht="miter")),F&&this.updateDistance(F,P),"miter"===ht)me._mult(be),this.addCurrentVertex(P,me,0,0,A);else if("flipbevel"===ht){if(be>100)me=Y.mult(-1);else{const je=be*H.add(Y).mag()/H.sub(Y).mag();me._perp()._mult(je*(Fe?-1:1))}this.addCurrentVertex(P,me,0,0,A),this.addCurrentVertex(P,me.mult(-1),0,0,A)}else if("bevel"===ht||"fakeround"===ht){const je=-Math.sqrt(be*be-1),Je=Fe?je:0,nt=Fe?0:je;if(F&&this.addCurrentVertex(P,H,Je,nt,A),"fakeround"===ht){const at=Math.round(180*_e/Math.PI/20);for(let pt=1;pt<at;pt++){let Ze=pt/at;if(.5!==Ze){const cn=Ze-.5;Ze+=Ze*cn*(Ze-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*cn*cn+(.848013+ae*(.215638*ae-1.06021)))}const Ft=Y.sub(H)._mult(Ze)._add(H)._unit()._mult(Fe?-1:1);this.addHalfVertex(P,Ft.x,Ft.y,!1,Fe,0,A)}}z&&this.addCurrentVertex(P,Y,-Je,-nt,A)}else if("butt"===ht)this.addCurrentVertex(P,me,0,0,A);else if("square"===ht){const je=F?1:-1;F||this.addCurrentVertex(P,me,je,je,A),this.addCurrentVertex(P,me,0,0,A),F&&this.addCurrentVertex(P,me,je,je,A)}else"round"===ht&&(F&&(this.addCurrentVertex(P,H,0,0,A),this.addCurrentVertex(P,H,1,1,A,!0)),z&&(this.addCurrentVertex(P,Y,-1,-1,A,!0),this.addCurrentVertex(P,Y,0,0,A)));if(Be&&le<w-1){const je=P.dist(z);if(je>2*I){const Je=P.add(z.sub(P)._mult(I/je)._round());this.updateDistance(P,Je),this.addCurrentVertex(Je,Y,0,0,A),P=Je}}}}addCurrentVertex(e,r,a,h,m,_=!1){const x=r.y*h-r.x,w=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,_,!1,a,m),this.addHalfVertex(e,x,w,_,!0,-h,m)}addHalfVertex({x:e,y:r},a,h,m,_,x,w){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),w.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}St(Od,"LineBucket",{omit:["layers","patternFeatures"]});const m_=new _t({"line-cap":new Ce($e.layout_line["line-cap"]),"line-join":new Ce($e.layout_line["line-join"]),"line-miter-limit":new ke($e.layout_line["line-miter-limit"]),"line-round-limit":new ke($e.layout_line["line-round-limit"]),"line-sort-key":new Ce($e.layout_line["line-sort-key"])});var Bn={paint:new _t({"line-opacity":new Ce($e.paint_line["line-opacity"]),"line-color":new Ce($e.paint_line["line-color"]),"line-translate":new ke($e.paint_line["line-translate"]),"line-translate-anchor":new ke($e.paint_line["line-translate-anchor"]),"line-width":new Ce($e.paint_line["line-width"]),"line-gap-width":new Ce($e.paint_line["line-gap-width"]),"line-offset":new Ce($e.paint_line["line-offset"]),"line-blur":new Ce($e.paint_line["line-blur"]),"line-dasharray":new Ct($e.paint_line["line-dasharray"]),"line-pattern":new Ct($e.paint_line["line-pattern"]),"line-gradient":new xt($e.paint_line["line-gradient"]),"line-trim-offset":new ke($e.paint_line["line-trim-offset"])}),layout:m_};const op=new class extends Ce{possiblyEvaluate(n,e){return e=new ue(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,a){return e=gt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,a)}}(Bn.paint.properties["line-width"].specification);function sp(n,e){return e>0?e+2*n:n}op.useIntegerZoom=!0;const Am=yt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),g_=yt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),__=yt([{name:"a_projected_pos",components:4,type:"Float32"}],4);yt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pm=yt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),y_=yt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ap=yt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),v_=yt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);yt([{name:"triangle",components:3,type:"Uint16"}]),yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),yt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),yt([{type:"Float32",name:"offsetX"}]),yt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Yl=128;function Fd(n,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ue(n+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:a,interpolationType:h}=r;let m=0;for(;m<a.length&&a[m]<=n;)m++;m=Math.max(0,m-1);let _=m;for(;_<a.length&&a[_]<n+1;)_++;_=Math.min(a.length-1,_);const x=a[m],w=a[_];return"composite"===r.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:r.evaluate(new ue(x)),maxSize:r.evaluate(new ue(w)),interpolationType:h}}}function Nh(n,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:h}){return"source"===n.kind?a/Yl:"composite"===n.kind?Dn(a/Yl,h/Yl,r):e}function ua(n,e){let r=0,a=0;if("constant"===n.kind)a=n.layoutSize;else if("source"!==n.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=n,x=h?Ie(sn.interpolationFactor(h,e,m,_),0,1):0;"camera"===n.kind?a=Dn(n.minSize,n.maxSize,x):r=x}return{uSizeT:r,uSize:a}}var x_=Object.freeze({__proto__:null,getSizeData:Fd,evaluateSizeForFeature:Nh,evaluateSizeForZoom:ua,SIZE_PACK_FACTOR:Yl});function lp(n,e,r){return n.sections.forEach(a=>{a.text=function(h,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),ge.applyArabicShaping&&(h=ge.applyArabicShaping(h)),h}(a.text,e,r)}),n}const cu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function b_(n){return"\ufe36"===n||"\ufe48"===n||"\ufe38"===n||"\ufe44"===n||"\ufe42"===n||"\ufe3e"===n||"\ufe3c"===n||"\ufe3a"===n||"\ufe18"===n||"\ufe40"===n||"\ufe10"===n||"\ufe13"===n||"\ufe14"===n||"\uff40"===n||"\uffe3"===n||"\ufe11"===n||"\ufe12"===n}function Qy(n){return"\ufe35"===n||"\ufe47"===n||"\ufe37"===n||"\ufe43"===n||"\ufe41"===n||"\ufe3d"===n||"\ufe3b"===n||"\ufe39"===n||"\ufe17"===n||"\ufe3f"===n}var zd=vr,w_=function(n,e,r,a,h){var m,_,x=8*h-a-1,w=(1<<x)-1,D=w>>1,I=-7,A=r?h-1:0,P=r?-1:1,F=n[e+A];for(A+=P,m=F&(1<<-I)-1,F>>=-I,I+=x;I>0;m=256*m+n[e+A],A+=P,I-=8);for(_=m&(1<<-I)-1,m>>=-I,I+=a;I>0;_=256*_+n[e+A],A+=P,I-=8);if(0===m)m=1-D;else{if(m===w)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,a),m-=D}return(F?-1:1)*_*Math.pow(2,m-a)},Rm=function(n,e,r,a,h,m){var _,x,w,D=8*m-h-1,I=(1<<D)-1,A=I>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,F=a?0:m-1,z=a?1:-1,H=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,_=I):(_=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-_))<1&&(_--,w*=2),(e+=_+A>=1?P/w:P*Math.pow(2,1-A))*w>=2&&(_++,w/=2),_+A>=I?(x=0,_=I):_+A>=1?(x=(e*w-1)*Math.pow(2,h),_+=A):(x=e*Math.pow(2,A-1)*Math.pow(2,h),_=0));h>=8;n[r+F]=255&x,F+=z,x/=256,h-=8);for(_=_<<h|x,D+=h;D>0;n[r+F]=255&_,F+=z,_/=256,D-=8);n[r+F-z]|=128*H};function vr(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}vr.Varint=0,vr.Fixed64=1,vr.Bytes=2,vr.Fixed32=5;var km=4294967296,Lm=1/km,uu=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Kl(n){return n.type===vr.Bytes?n.readVarint()+n.pos:n.pos+1}function Uh(n,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var h=r.pos-1;h>=n;h--)r.buf[h+a]=r.buf[h]}function E_(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function Om(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function D_(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function T_(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function C_(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function I_(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function S_(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function Fm(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function M_(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function jh(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function du(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function Bd(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function ev(n,e,r){e.glyphs=[],1===n&&r.readMessage(cp,e)}function cp(n,e,r){if(3===n){const{id:a,bitmap:h,width:m,height:_,left:x,top:w,advance:D}=r.readMessage(A_,{});e.glyphs.push({id:a,bitmap:new ql({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:x,top:w,advance:D}})}else 4===n?e.ascender=r.readSVarint():5===n&&(e.descender=r.readSVarint())}function A_(n,e,r){1===n?e.id=r.readVarint():2===n?e.bitmap=r.readBytes():3===n?e.width=r.readVarint():4===n?e.height=r.readVarint():5===n?e.left=r.readSVarint():6===n?e.top=r.readSVarint():7===n&&(e.advance=r.readVarint())}function zm(n){let e=0,r=0;for(const _ of n)e+=_.w*_.h,r=Math.max(r,_.w);n.sort((_,x)=>x.h-_.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,m=0;for(const _ of n)for(let x=a.length-1;x>=0;x--){const w=a[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const D=a.pop();x<a.length&&(a[x]=D)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(a.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}vr.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),h=a>>3,m=this.pos;this.type=7&a,n(h,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=jh(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Bd(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=jh(this.buf,this.pos)+jh(this.buf,this.pos+4)*km;return this.pos+=8,n},readSFixed64:function(){var n=jh(this.buf,this.pos)+Bd(this.buf,this.pos+4)*km;return this.pos+=8,n},readFloat:function(){var n=w_(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=w_(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(h,m,_){var x,w,D=_.buf;if(x=(112&(w=D[_.pos++]))>>4,w<128||(x|=(127&(w=D[_.pos++]))<<3,w<128)||(x|=(127&(w=D[_.pos++]))<<10,w<128)||(x|=(127&(w=D[_.pos++]))<<17,w<128)||(x|=(127&(w=D[_.pos++]))<<24,w<128)||(x|=(1&(w=D[_.pos++]))<<31,w<128))return function hu(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}(h,x,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&uu?uu.decode(this.buf.subarray(e,n)):function(r,a,h){for(var m="",_=a;_<h;){var x,w,D,I=r[_],A=null,P=I>239?4:I>223?3:I>191?2:1;if(_+P>h)break;1===P?I<128&&(A=I):2===P?128==(192&(x=r[_+1]))&&(A=(31&I)<<6|63&x)<=127&&(A=null):3===P?(w=r[_+2],128==(192&(x=r[_+1]))&&128==(192&w)&&((A=(15&I)<<12|(63&x)<<6|63&w)<=2047||A>=55296&&A<=57343)&&(A=null)):4===P&&(w=r[_+2],D=r[_+3],128==(192&(x=r[_+1]))&&128==(192&w)&&128==(192&D)&&((A=(15&I)<<18|(63&x)<<12|(63&w)<<6|63&D)<=65535||A>=1114112)&&(A=null)),null===A?(A=65533,P=1):A>65535&&(A-=65536,m+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),m+=String.fromCharCode(A),_+=P}return m}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==vr.Bytes)return n.push(this.readVarint(e));var r=Kl(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==vr.Bytes)return n.push(this.readSVarint());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==vr.Bytes)return n.push(this.readBoolean());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==vr.Bytes)return n.push(this.readFloat());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==vr.Bytes)return n.push(this.readDouble());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==vr.Bytes)return n.push(this.readFixed32());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==vr.Bytes)return n.push(this.readSFixed32());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==vr.Bytes)return n.push(this.readFixed64());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==vr.Bytes)return n.push(this.readSFixed64());var e=Kl(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===vr.Varint)for(;this.buf[this.pos++]>127;);else if(e===vr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===vr.Fixed32)this.pos+=4;else{if(e!==vr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),du(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),du(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),du(this.buf,-1&n,this.pos),du(this.buf,Math.floor(n*Lm),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),du(this.buf,-1&n,this.pos),du(this.buf,Math.floor(n*Lm),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var a,h,m,x;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),m=a,(x=r).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,h,m){for(var _,x,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!x){_>56319||w+1===h.length?(a[m++]=239,a[m++]=191,a[m++]=189):x=_;continue}if(_<56320){a[m++]=239,a[m++]=191,a[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(a[m++]=239,a[m++]=191,a[m++]=189,x=null);_<128?a[m++]=_:(_<2048?a[m++]=_>>6|192:(_<65536?a[m++]=_>>12|224:(a[m++]=_>>18|240,a[m++]=_>>12&63|128),a[m++]=_>>6&63|128),a[m++]=63&_|128)}return m}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&Uh(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Rm(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Rm(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var a=this.pos-r;a>=128&&Uh(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,r){this.writeTag(n,vr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,E_,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Om,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,C_,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,D_,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,T_,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,I_,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,S_,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Fm,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,M_,e)},writeBytesField:function(n,e){this.writeTag(n,vr.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,vr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,vr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,vr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,vr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,vr.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,vr.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,vr.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,vr.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,vr.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,Boolean(e))}};class kc{constructor(e,{pixelRatio:r,version:a,stretchX:h,stretchY:m,content:_}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=m,this.content=_,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class up{constructor(e,r){const a={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,m),this.addImages(r,h,m);const{w:_,h:x}=zm(m),w=new bs({width:_||1,height:x||1});for(const D in e){const I=e[D],A=a[D].paddedRect;bs.copy(I.data,w,{x:0,y:0},{x:A.x+1,y:A.y+1},I.data)}for(const D in r){const I=r[D],A=h[D].paddedRect,P=A.x+1,F=A.y+1,z=I.data.width,H=I.data.height;bs.copy(I.data,w,{x:0,y:0},{x:P,y:F},I.data),bs.copy(I.data,w,{x:0,y:H-1},{x:P,y:F-1},{width:z,height:1}),bs.copy(I.data,w,{x:0,y:0},{x:P,y:F+H},{width:z,height:1}),bs.copy(I.data,w,{x:z-1,y:0},{x:P-1,y:F},{width:1,height:H}),bs.copy(I.data,w,{x:0,y:0},{x:P+z,y:F},{width:1,height:H})}this.image=w,this.iconPositions=a,this.patternPositions=h}addImages(e,r,a){for(const h in e){const m=e[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};a.push(_),r[h]=new kc(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,m]=e.tl;a.update(r.data,void 0,{x:h,y:m})}}St(kc,"ImagePosition"),St(up,"ImageAtlas");const ws={horizontal:1,vertical:2,horizontalOnly:3};class Lc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Lc;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Lc;return r.imageName=e,r}}class Ho{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new Ho;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?a.addImageSection(m):a.addTextSection(m,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let h="";for(let m=0;m<r.length;m++){const _=r.charCodeAt(m+1)||null,x=r.charCodeAt(m-1)||null;h+=!a&&(_&&v(_)&&!cu[r[m+1]]||x&&v(x)&&!cu[r[m-1]])||!cu[r[m]]?r[m]:cu[r[m]]}return h}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Ud[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Ud[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Ho;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Lc.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(0===r.length)return void mn("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Lc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):mn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Nd(n,e,r,a,h,m,_,x,w,D,I,A,P,F,z,H){const Y=Ho.fromFeature(n,h);let le;A===ws.vertical&&Y.verticalizePunctuation(P);const{processBidirectionalText:me,processStyledBidirectionalText:ae}=ge;if(me&&1===Y.sections.length){le=[];const _e=me(Y.toString(),$d(Y,D,m,e,a,F,z));for(const Be of _e){const Fe=new Ho;Fe.text=Be,Fe.sections=Y.sections;for(let He=0;He<Be.length;He++)Fe.sectionIndex.push(0);le.push(Fe)}}else if(ae){le=[];const _e=ae(Y.text,Y.sectionIndex,$d(Y,D,m,e,a,F,z));for(const Be of _e){const Fe=new Ho;Fe.text=Be[0],Fe.sectionIndex=Be[1],Fe.sections=Y.sections,le.push(Fe)}}else le=function(_e,Be){const Fe=[],He=_e.text;let ht=0;for(const je of Be)Fe.push(_e.substring(ht,je)),ht=je;return ht<He.length&&Fe.push(_e.substring(ht,He.length)),Fe}(Y,$d(Y,D,m,e,a,F,z));const fe=[],be={positionedLines:fe,text:Y.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,Be,Fe,He,ht,je,Je,nt,at,pt,Ze,Ft){let cn=0,qt=0,jt=0;const Mt="right"===nt?1:"left"===nt?0:.5;let an=!1;for(const An of ht){const Nn=An.getSections();for(const pr of Nn){if(pr.imageName)continue;const wr=Be[pr.fontStack];if(wr&&(an=void 0!==wr.ascender&&void 0!==wr.descender,!an))break}if(!an)break}let wn=0;for(const An of ht){An.trim();const Nn=An.getMaxScale(),pr=24*(Nn-1),wr={positionedGlyphs:[],lineOffset:0};_e.positionedLines[wn]=wr;const Ir=wr.positionedGlyphs;let Sr=0;if(!An.length()){qt+=je,++wn;continue}let jr=0,Kr=0;for(let In=0;In<An.length();In++){const pi=An.getSection(In),mi=An.getSectionIndex(In),rr=An.getCharCode(In);let Gr=pi.scale,Pi=null,mr=null,ri=null,Ii=24,Wi=0;const Xi=!(at===ws.horizontal||!Ze&&!g(rr)||Ze&&(Ud[rr]||(Cn=rr,Ru(Cn)||cl(Cn)||sh(Cn)||Ma(Cn)||f(Cn))));if(pi.imageName){const Ao=He[pi.imageName];if(!Ao)continue;ri=pi.imageName,_e.iconsInText=_e.iconsInText||!0,mr=Ao.paddedRect;const Yi=Ao.displaySize;Gr=24*Gr/Ft,Pi={width:Yi[0],height:Yi[1],left:1,top:-3,advance:Xi?Yi[1]:Yi[0],localGlyph:!1},Wi=an?-Pi.height*Gr:24*Nn-17-Yi[1]*Gr,Ii=Pi.advance;const El=(Xi?Yi[0]:Yi[1])*Gr-24*Nn;El>0&&El>Sr&&(Sr=El)}else{const Ao=Fe[pi.fontStack];if(!Ao)continue;Ao[rr]&&(mr=Ao[rr]);const Yi=Be[pi.fontStack];if(!Yi)continue;const El=Yi.glyphs[rr];if(!El)continue;if(Pi=El.metrics,Ii=8203!==rr?24:0,an){const ld=void 0!==Yi.ascender?Math.abs(Yi.ascender):0,nh=void 0!==Yi.descender?Math.abs(Yi.descender):0,rh=(ld+nh)*Gr;jr<rh&&(jr=rh,Kr=(ld-nh)/2*Gr),Wi=-ld*Gr}else Wi=24*(Nn-Gr)-17}Xi?(_e.verticalizable=!0,Ir.push({glyph:rr,imageName:ri,x:cn,y:qt+Wi,vertical:Xi,scale:Gr,localGlyph:Pi.localGlyph,fontStack:pi.fontStack,sectionIndex:mi,metrics:Pi,rect:mr}),cn+=Ii*Gr+pt):(Ir.push({glyph:rr,imageName:ri,x:cn,y:qt+Wi,vertical:Xi,scale:Gr,localGlyph:Pi.localGlyph,fontStack:pi.fontStack,sectionIndex:mi,metrics:Pi,rect:mr}),cn+=Pi.advance*Gr+pt)}0!==Ir.length&&(jt=Math.max(cn-pt,jt),an?Vh(Ir,Mt,Sr,Kr,je*Nn/2):Vh(Ir,Mt,Sr,0,je/2)),cn=0;const qi=je*Nn+Sr;wr.lineOffset=Math.max(Sr,pr),qt+=qi,++wn}var Cn;const Qn=qt,{horizontalAlign:gn,verticalAlign:Cr}=Nm(Je);(function(An,Nn,pr,wr,Ir,Sr){const jr=(Nn-pr)*Ir,Kr=-Sr*wr;for(const qi of An)for(const In of qi.positionedGlyphs)In.x+=jr,In.y+=Kr})(_e.positionedLines,Mt,gn,Cr,jt,Qn),_e.top+=-Cr*Qn,_e.bottom=_e.top+Qn,_e.left+=-gn*jt,_e.right=_e.left+jt,_e.hasBaseline=an}(be,e,r,a,le,_,x,w,A,D,P,H),!function(_e){for(const Be of _e)if(0!==Be.positionedGlyphs.length)return!1;return!0}(fe)&&be}const Ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gl(n,e,r,a,h,m){if(e.imageName){const _=a[e.imageName];return _?_.displaySize[0]*e.scale*24/m+h:0}{const _=r[e.fontStack],x=_&&_.glyphs[n];return x?x.metrics.advance*e.scale+h:0}}function jd(n,e,r,a){const h=Math.pow(n-e,2);return a?n<e?h/2:2*h:h+Math.abs(r)*r}function Bm(n,e,r){let a=0;return 10===n&&(a-=1e4),r&&(a+=150),40!==n&&65288!==n||(a+=50),41!==e&&65289!==e||(a+=50),a}function Vd(n,e,r,a,h,m){let _=null,x=jd(e,r,h,m);for(const w of a){const D=jd(e-w.x,r,h,m)+w.badness;D<=x&&(_=w,x=D)}return{index:n,x:e,priorBreak:_,badness:x}}function P_(n){return n?P_(n.priorBreak).concat(n.index):[]}function $d(n,e,r,a,h,m,_){if("point"!==m)return[];if(!n)return[];const x=[],w=function(P,F,z,H,Y,le){let me=0;for(let ae=0;ae<P.length();ae++){const fe=P.getSection(ae);me+=gl(P.getCharCode(ae),fe,H,Y,F,le)}return me/Math.max(1,Math.ceil(me/z))}(n,e,r,a,h,_),D=n.text.indexOf("\u200b")>=0;let I=0;for(let P=0;P<n.length();P++){const F=n.getSection(P),z=n.getCharCode(P);if(Ud[z]||(I+=gl(z,F,a,h,e,_)),P<n.length()-1){const H=!((A=z)<11904||!(Hs(A)||Sa(A)||xc(A)||uh(A)||ku(A)||Nl(A)||dd(A)||vs(A)||ah(A)||Lu(A)||_r(A)||t(A)||Gs(A)||ys(A)||Ul(A)||hl(A)||ul(A)||hh(A)||lh(A)||Qc(A)));(hp[z]||H||F.imageName)&&x.push(Vd(P+1,I,w,x,Bm(z,n.getCharCode(P+1),H&&D),!1))}}var A;return P_(Vd(n.length(),I,w,x,0,!0))}function Nm(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Vh(n,e,r,a,h){if(!(e||r||a||h))return;const m=n.length-1,_=n[m],x=(_.x+_.metrics.advance*_.scale)*e;for(let w=0;w<=m;w++)n[w].x-=x,n[w].y+=r+a+h}function Gd(n,e,r){const{horizontalAlign:a,verticalAlign:h}=Nm(r),m=e[0]-n.displaySize[0]*a,_=e[1]-n.displaySize[1]*h;return{image:n,top:_,bottom:_+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function Hd(n,e,r,a,h,m){const _=n.image;let x;if(_.content){const Y=_.content,le=_.pixelRatio||1;x=[Y[0]/le,Y[1]/le,_.displaySize[0]-Y[2]/le,_.displaySize[1]-Y[3]/le]}const w=e.left*m,D=e.right*m;let I,A,P,F;"width"===r||"both"===r?(F=h[0]+w-a[3],A=h[0]+D+a[1]):(F=h[0]+(w+D-_.displaySize[0])/2,A=F+_.displaySize[0]);const z=e.top*m,H=e.bottom*m;return"height"===r||"both"===r?(I=h[1]+z-a[0],P=h[1]+H+a[2]):(I=h[1]+(z+H-_.displaySize[1])/2,P=I+_.displaySize[1]),{image:_,top:I,right:A,bottom:P,left:F,collisionPadding:x}}class Oa extends et{constructor(e,r,a,h,m){super(e,r),this.angle=h,this.z=a,void 0!==m&&(this.segment=m)}clone(){return new Oa(this.x,this.y,this.z,this.angle,this.segment)}}function Zd(n,e,r,a,h){if(void 0===e.segment)return!0;let m=e,_=e.segment+1,x=0;for(;x>-r/2;){if(_--,_<0)return!1;x-=n[_].dist(m),m=n[_]}x+=n[_].dist(n[_+1]),_++;const w=[];let D=0;for(;x<r/2;){const I=n[_],A=n[_+1];if(!A)return!1;let P=n[_-1].angleTo(I)-I.angleTo(A);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:P}),D+=P;x-w[0].distance>a;)D-=w.shift().angleDelta;if(D>h)return!1;_++,x+=I.dist(A)}return!0}function R_(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Um(n,e,r){return n?.6*e*r:0}function jm(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function k_(n,e,r,a,h,m){const _=Um(r,h,m),x=jm(r,a)*m;let w=0;const D=R_(n)/2;for(let I=0;I<n.length-1;I++){const A=n[I],P=n[I+1],F=A.dist(P);if(w+F>D){const z=(D-w)/F,H=Dn(A.x,P.x,z),Y=Dn(A.y,P.y,z),le=new Oa(H,Y,0,P.angleTo(A),I);return!_||Zd(n,le,x,_,e)?le:void 0}w+=F}}function L_(n,e,r,a,h,m,_,x,w){const D=Um(a,m,_),I=jm(a,h),A=I*_,P=0===n[0].x||n[0].x===w||0===n[0].y||n[0].y===w;return e-A<e/4&&(e=A+e/4),dp(n,P?e/2*x%e:(I/2+2*m)*_*x%e,e,D,r,A,P,!1,w)}function dp(n,e,r,a,h,m,_,x,w){const D=m/2,I=R_(n);let A=0,P=e-r,F=[];for(let z=0;z<n.length-1;z++){const H=n[z],Y=n[z+1],le=H.dist(Y),me=Y.angleTo(H);for(;P+r<A+le;){P+=r;const ae=(P-A)/le,fe=Dn(H.x,Y.x,ae),be=Dn(H.y,Y.y,ae);if(fe>=0&&fe<w&&be>=0&&be<w&&P-D>=0&&P+D<=I){const _e=new Oa(fe,be,0,me,z);_e._round(),a&&!Zd(n,_e,m,a,h)||F.push(_e)}}A+=le}return x||F.length||_||(F=dp(n,A/2,r,a,h,m,_,!0,w)),F}function O_(n,e,r,a,h){const m=[];for(let _=0;_<n.length;_++){const x=n[_];let w;for(let D=0;D<x.length-1;D++){let I=x[D],A=x[D+1];I.x<e&&A.x<e||(I.x<e?I=new et(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x<e&&(A=new et(e,I.y+(e-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y<r&&A.y<r||(I.y<r?I=new et(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round():A.y<r&&(A=new et(I.x+(r-I.y)/(A.y-I.y)*(A.x-I.x),r)._round()),I.x>=a&&A.x>=a||(I.x>=a?I=new et(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round():A.x>=a&&(A=new et(a,I.y+(a-I.x)/(A.x-I.x)*(A.y-I.y))._round()),I.y>=h&&A.y>=h||(I.y>=h?I=new et(I.x+(h-I.y)/(A.y-I.y)*(A.x-I.x),h)._round():A.y>=h&&(A=new et(I.x+(h-I.y)/(A.y-I.y)*(A.x-I.x),h)._round()),w&&I.equals(w[w.length-1])||(w=[I],m.push(w)),w.push(A)))))}}return m}St(Oa,"Anchor");const $h=1e20;function F_(n,e,r,a,h,m,_,x,w){for(let D=e;D<e+a;D++)fp(n,r*m+D,m,h,_,x,w);for(let D=r;D<r+h;D++)fp(n,D*m+e,1,a,_,x,w)}function fp(n,e,r,a,h,m,_){m[0]=0,_[0]=-$h,_[1]=$h,h[0]=n[e];for(let x=1,w=0,D=0;x<a;x++){h[x]=n[e+x*r];const I=x*x;do{const A=m[w];D=(h[x]-h[A]+I-A*A)/(x-A)/2}while(D<=_[w]&&--w>-1);w++,m[w]=x,_[w]=D,_[w+1]=$h}for(let x=0,w=0;x<a;x++){for(;_[w+1]<x;)w++;const D=m[w],I=x-D;n[e+x*r]=h[D]+I*I}}const qd={none:0,ideographs:1,all:2};class Xu{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const h in e)for(const m of e[h])a.push({stack:h,id:m});Ve(a,({stack:h,id:m},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(void 0!==w)return void _(null,{stack:h,id:m,glyph:w});if(w=this._tinySDF(x,h,m),w)return x.glyphs[m]=w,void _(null,{stack:h,id:m,glyph:w});const D=Math.floor(m/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[D])return void _(null,{stack:h,id:m,glyph:w});let I=x.requests[D];I||(I=x.requests[D]=[],Xu.loadGlyphRange(h,D,this.url,this.requestManager,(A,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const F in P.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=P.glyphs[+F]);x.ranges[D]=!0}for(const F of I)F(A,P);delete x.requests[D]})),I.push((A,P)=>{A?_(A):P&&_(null,{stack:h,id:m,glyph:P.glyphs[m]||null})})},(h,m)=>{if(h)r(h);else if(m){const _={};for(const{stack:x,id:w,glyph:D}of m)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[w]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;r(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==qd.none&&(this.localGlyphMode===qd.all?!!this.localFontFamily:!!this.localFontFamily&&(Lu(e)||ch(e)||Gs(e)||ul(e)||vs(e)))}_tinySDF(e,r,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let H="400";/bold/i.test(r)?H="900":/medium/i.test(r)?H="500":/light/i.test(r)&&(H="200"),m=e.tinySDF=new Xu.TinySDF({fontFamily:h,fontWeight:H,fontSize:48,buffer:6,radius:16}),m.fontWeight=H}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];const _=String.fromCharCode(a),{data:x,width:w,height:D,glyphWidth:I,glyphHeight:A,glyphLeft:P,glyphTop:F,glyphAdvance:z}=m.draw(_);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new ql({width:w,height:D},x),metrics:{width:I/2,height:A/2,left:P/2,top:F/2-27,advance:z/2,localGlyph:!0}}}}function Wd(n,e,r,a){const h=[],m=n.image,_=m.pixelRatio,x=m.paddedRect.w-2,w=m.paddedRect.h-2,D=n.right-n.left,I=n.bottom-n.top,A=m.stretchX||[[0,x]],P=m.stretchY||[[0,w]],F=(je,Je)=>je+Je[1]-Je[0],z=A.reduce(F,0),H=P.reduce(F,0),Y=x-z,le=w-H;let me=0,ae=z,fe=0,be=H,_e=0,Be=Y,Fe=0,He=le;if(m.content&&a){const je=m.content;me=pp(A,0,je[0]),fe=pp(P,0,je[1]),ae=pp(A,je[0],je[2]),be=pp(P,je[1],je[3]),_e=je[0]-me,Fe=je[1]-fe,Be=je[2]-je[0]-ae,He=je[3]-je[1]-be}const ht=(je,Je,nt,at)=>{const pt=mp(je.stretch-me,ae,D,n.left),Ze=gp(je.fixed-_e,Be,je.stretch,z),Ft=mp(Je.stretch-fe,be,I,n.top),cn=gp(Je.fixed-Fe,He,Je.stretch,H),qt=mp(nt.stretch-me,ae,D,n.left),jt=gp(nt.fixed-_e,Be,nt.stretch,z),Mt=mp(at.stretch-fe,be,I,n.top),an=gp(at.fixed-Fe,He,at.stretch,H),wn=new et(pt,Ft),Cn=new et(qt,Ft),Qn=new et(qt,Mt),gn=new et(pt,Mt),Cr=new et(Ze/_,cn/_),An=new et(jt/_,an/_),Nn=e*Math.PI/180;if(Nn){const Ir=Math.sin(Nn),Sr=Math.cos(Nn),jr=[Sr,-Ir,Ir,Sr];wn._matMult(jr),Cn._matMult(jr),gn._matMult(jr),Qn._matMult(jr)}const pr=je.stretch+je.fixed,wr=Je.stretch+Je.fixed;return{tl:wn,tr:Cn,bl:gn,br:Qn,tex:{x:m.paddedRect.x+1+pr,y:m.paddedRect.y+1+wr,w:nt.stretch+nt.fixed-pr,h:at.stretch+at.fixed-wr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cr,pixelOffsetBR:An,minFontScaleX:Be/_/D,minFontScaleY:He/_/I,isSDF:r}};if(a&&(m.stretchX||m.stretchY)){const je=z_(A,Y,z),Je=z_(P,le,H);for(let nt=0;nt<je.length-1;nt++){const at=je[nt],pt=je[nt+1];for(let Ze=0;Ze<Je.length-1;Ze++)h.push(ht(at,Je[Ze],pt,Je[Ze+1]))}}else h.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function pp(n,e,r){let a=0;for(const h of n)a+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return a}function z_(n,e,r){const a=[{fixed:-1,stretch:0}];for(const[h,m]of n){const _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return a.push({fixed:e+1,stretch:r}),a}function mp(n,e,r,a){return n/e*r+a}function gp(n,e,r,a){return n-e*r/a}function tv(n,e,r,a){const h=e+n.positionedLines[a].lineOffset;return 0===a?r+h/2:r+(h+(e+n.positionedLines[a-1].lineOffset))/2}Xu.loadGlyphRange=function(n,e,r,a,h){const m=256*e,_=m+255,x=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${m}-${_}`),ut.Glyphs);Zn(x,(w,D)=>{if(w)h(w);else if(D){const I={},A=new zd(D).readFields(ev,{});for(const P of A.glyphs)I[P.id]=P;h(null,{glyphs:I,ascender:A.ascender,descender:A.descender})}})},Xu.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const x=this.size=n+4*e,w=this._createCanvas(x),D=this.ctx=w.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${m} ${n}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(n),_=Math.ceil(r),x=Math.min(this.size-this.buffer,Math.ceil(m-h)),w=Math.min(this.size-this.buffer,_+Math.ceil(a)),D=x+2*this.buffer,I=w+2*this.buffer,A=Math.max(D*I,0),P=new Uint8ClampedArray(A),F={data:P,width:D,height:I,glyphWidth:x,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===x||0===w)return F;const{ctx:z,buffer:H,gridInner:Y,gridOuter:le}=this;z.clearRect(H,H,x,w),z.fillText(n,H,H+_);const me=z.getImageData(H,H,x,w);le.fill($h,0,A),Y.fill(0,0,A);for(let ae=0;ae<w;ae++)for(let fe=0;fe<x;fe++){const be=me.data[4*(ae*x+fe)+3]/255;if(0===be)continue;const _e=(ae+H)*D+fe+H;if(1===be)le[_e]=0,Y[_e]=$h;else{const Be=.5-be;le[_e]=Be>0?Be*Be:0,Y[_e]=Be<0?Be*Be:0}}F_(le,0,0,D,I,D,this.f,this.v,this.z),F_(Y,H,H,x,w,D,this.f,this.v,this.z);for(let ae=0;ae<A;ae++){const fe=Math.sqrt(le[ae])-Math.sqrt(Y[ae]);P[ae]=Math.round(255-255*(fe/this.radius+this.cutoff))}return F}};class nv{constructor(e=[],r=rv){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,h=r[e];for(;e>0;){const m=e-1>>1,_=r[m];if(a(h,_)>=0)break;r[e]=_,e=m}r[e]=h}_down(e){const{data:r,compare:a}=this,h=this.length>>1,m=r[e];for(;e<h;){let _=1+(e<<1),x=r[_];const w=_+1;if(w<this.length&&a(r[w],x)<0&&(_=w,x=r[w]),a(x,m)>=0)break;r[e]=x,e=_}r[e]=m}}function rv(n,e){return n<e?-1:n>e?1:0}function iv(n,e=1,r=!1){let a=1/0,h=1/0,m=-1/0,_=-1/0;const x=n[0];for(let F=0;F<x.length;F++){const z=x[F];(!F||z.x<a)&&(a=z.x),(!F||z.y<h)&&(h=z.y),(!F||z.x>m)&&(m=z.x),(!F||z.y>_)&&(_=z.y)}const w=Math.min(m-a,_-h);let D=w/2;const I=new nv([],ov);if(0===w)return new et(a,h);for(let F=a;F<m;F+=w)for(let z=h;z<_;z+=w)I.push(new Gh(F+D,z+D,D,n));let A=function(F){let z=0,H=0,Y=0;const le=F[0];for(let me=0,ae=le.length,fe=ae-1;me<ae;fe=me++){const be=le[me],_e=le[fe],Be=be.x*_e.y-_e.x*be.y;H+=(be.x+_e.x)*Be,Y+=(be.y+_e.y)*Be,z+=3*Be}return new Gh(H/z,Y/z,0,F)}(n),P=I.length;for(;I.length;){const F=I.pop();(F.d>A.d||!A.d)&&(A=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,P)),F.max-A.d<=e||(D=F.h/2,I.push(new Gh(F.p.x-D,F.p.y-D,D,n)),I.push(new Gh(F.p.x+D,F.p.y-D,D,n)),I.push(new Gh(F.p.x-D,F.p.y+D,D,n)),I.push(new Gh(F.p.x+D,F.p.y+D,D,n)),P+=4)}return r&&(console.log(`num probes: ${P}`),console.log(`best distance: ${A.d}`)),A.p}function ov(n,e){return e.max-n.max}function Gh(n,e,r,a){this.p=new et(n,e),this.h=r,this.d=function(h,m){let _=!1,x=1/0;for(let w=0;w<m.length;w++){const D=m[w];for(let I=0,A=D.length,P=A-1;I<A;P=I++){const F=D[I],z=D[P];F.y>h.y!=z.y>h.y&&h.x<(z.x-F.x)*(h.y-F.y)/(z.y-F.y)+F.x&&(_=!_),x=Math.min(x,im(h,F,z))}}return(_?1:-1)*Math.sqrt(x)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const _l=Number.POSITIVE_INFINITY,_p=Math.sqrt(2);function Vm(n,e){return e[1]!==_l?function(r,a,h){let m=0,_=0;switch(a=Math.abs(a),h=Math.abs(h),r){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(r){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,_]}(n,e[0],e[1]):function(r,a){let h=0,m=0;a<0&&(a=0);const _=a/_p;switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-a;break;case"top":m=a-7}switch(r){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=a;break;case"right":h=-a}return[h,m]}(n,e[0])}function $m(n,e,r,a,h,m,_,x,w,D){n.createArrays(),n.tilePixelRatio=hn/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const I=n.layers[0].layout,A=n.layers[0]._unevaluatedLayout._values,P={};if("composite"===n.textSizeData.kind){const{minZoom:H,maxZoom:Y}=n.textSizeData;P.compositeTextSizes=[A["text-size"].possiblyEvaluate(new ue(H),x),A["text-size"].possiblyEvaluate(new ue(Y),x)]}if("composite"===n.iconSizeData.kind){const{minZoom:H,maxZoom:Y}=n.iconSizeData;P.compositeIconSizes=[A["icon-size"].possiblyEvaluate(new ue(H),x),A["icon-size"].possiblyEvaluate(new ue(Y),x)]}P.layoutTextSize=A["text-size"].possiblyEvaluate(new ue(w+1),x),P.layoutIconSize=A["icon-size"].possiblyEvaluate(new ue(w+1),x),P.textMaxSize=A["text-size"].possiblyEvaluate(new ue(18),x);const F="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),z=I.get("text-size");for(const H of n.features){const Y=I.get("text-font").evaluate(H,{},x).join(","),le=z.evaluate(H,{},x),me=P.layoutTextSize.evaluate(H,{},x),ae=(P.layoutIconSize.evaluate(H,{},x),{horizontal:{},vertical:void 0}),fe=H.text;let be,_e=[0,0];if(fe){const He=fe.toString(),ht=24*I.get("text-letter-spacing").evaluate(H,{},x),je=24*I.get("text-line-height").evaluate(H,{},x),Je=l(He)?ht:0,nt=I.get("text-anchor").evaluate(H,{},x),at=I.get("text-variable-anchor");if(!at){const jt=I.get("text-radial-offset").evaluate(H,{},x);_e=jt?Vm(nt,[24*jt,_l]):I.get("text-offset").evaluate(H,{},x).map(Mt=>24*Mt)}let pt=F?"center":I.get("text-justify").evaluate(H,{},x);const Ze=I.get("symbol-placement"),Ft="point"===Ze,cn="point"===Ze?24*I.get("text-max-width").evaluate(H,{},x):0,qt=jt=>{n.allowVerticalPlacement&&o(He)&&(ae.vertical=Nd(fe,e,r,h,Y,cn,je,nt,jt,Je,_e,ws.vertical,!0,Ze,me,le))};if(!F&&at){const jt="auto"===pt?at.map(an=>Hh(an)):[pt];let Mt=!1;for(let an=0;an<jt.length;an++){const wn=jt[an];if(!ae.horizontal[wn])if(Mt)ae.horizontal[wn]=ae.horizontal[0];else{const Cn=Nd(fe,e,r,h,Y,cn,je,"center",wn,Je,_e,ws.horizontal,!1,Ze,me,le);Cn&&(ae.horizontal[wn]=Cn,Mt=1===Cn.positionedLines.length)}}qt("left")}else{if("auto"===pt&&(pt=Hh(nt)),Ft||I.get("text-writing-mode").indexOf("horizontal")>=0||!o(He)){const jt=Nd(fe,e,r,h,Y,cn,je,nt,pt,Je,_e,ws.horizontal,!1,Ze,me,le);jt&&(ae.horizontal[pt]=jt)}qt("point"===Ze?"left":pt)}}let Be=!1;if(H.icon&&H.icon.name){const He=a[H.icon.name];He&&(be=Gd(h[H.icon.name],I.get("icon-offset").evaluate(H,{},x),I.get("icon-anchor").evaluate(H,{},x)),Be=He.sdf,void 0===n.sdfIcons?n.sdfIcons=He.sdf:n.sdfIcons!==He.sdf&&mn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==n.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(n.iconsNeedLinear=!0))}const Fe=Jl(ae.horizontal)||ae.vertical;n.iconsInText||(n.iconsInText=!!Fe&&Fe.iconsInText),(Fe||be)&&Gm(n,H,ae,be,a,P,me,0,_e,Be,_,x,D)}m&&n.generateCollisionDebugBuffers(w,n.collisionBoxArray)}function Hh(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gm(n,e,r,a,h,m,_,x,w,D,I,A,P){let F=m.textMaxSize.evaluate(e,{},A);void 0===F&&(F=_);const z=n.layers[0].layout,H=z.get("icon-offset").evaluate(e,{},A),Y=Jl(r.horizontal)||r.vertical,le="globe"===P.name,me=_/24,ae=n.tilePixelRatio*F/24,fe=(Je=n.overscaling,n.zoom>18&&Je>2&&(Je>>=1),Math.max(hn/(512*Je),1)*z.get("symbol-spacing")),be=z.get("text-padding")*n.tilePixelRatio,_e=z.get("icon-padding")*n.tilePixelRatio,Be=qe(z.get("text-max-angle")),Fe="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),He="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),ht=z.get("symbol-placement"),je=fe/2;var Je;const nt=z.get("icon-text-fit");let at;a&&"none"!==nt&&(n.allowVerticalPlacement&&r.vertical&&(at=Hd(a,r.vertical,nt,z.get("icon-text-fit-padding"),H,me)),Y&&(a=Hd(a,Y,nt,z.get("icon-text-fit-padding"),H,me)));const pt=(Ze,Ft,cn)=>{if(Ft.x<0||Ft.x>=hn||Ft.y<0||Ft.y>=hn)return;let qt=null;if(le){const{x:jt,y:Mt,z:an}=P.projectTilePoint(Ft.x,Ft.y,cn);qt={anchor:new Oa(jt,Mt,an,0,void 0),up:P.upVector(cn,Ft.x,Ft.y)}}!function(jt,Mt,an,wn,Cn,Qn,gn,Cr,An,Nn,pr,wr,Ir,Sr,jr,Kr,qi,In,pi,mi,rr,Gr,Pi,mr,ri){const Ii=jt.addToLineVertexArray(Mt,wn);let Wi,Xi,Ao,Yi,El,ld,nh,rh=0,Na=0,pg=0,mg=0,ga=-1,Ws=-1;const Ni={};let Pp=bc.exports("");const jc=an?an.anchor:Mt;let Rp=0,kp=0;if(void 0===An._unevaluatedLayout.getValue("text-radial-offset")?[Rp,kp]=An.layout.get("text-offset").evaluate(rr,{},ri).map(co=>24*co):(Rp=24*An.layout.get("text-radial-offset").evaluate(rr,{},ri),kp=_l),jt.allowVerticalPlacement&&Cn.vertical){const co=Cn.vertical;if(jr)ld=yp(co),Cr&&(nh=yp(Cr));else{const Cs=An.layout.get("text-rotate").evaluate(rr,{},ri)+90;Ao=Zh(Nn,jc,Mt,pr,wr,Ir,co,Sr,Cs,Kr),Cr&&(Yi=Zh(Nn,jc,Mt,pr,wr,Ir,Cr,In,Cs))}}if(Qn){const co=An.layout.get("icon-rotate").evaluate(rr,{},ri),Cs="none"!==An.layout.get("icon-text-fit"),ih=Wd(Qn,co,Pi,Cs),Fp=Cr?Wd(Cr,co,Pi,Cs):void 0;Xi=Zh(Nn,jc,Mt,pr,wr,Ir,Qn,In,co),rh=4*ih.length;const zp=jt.iconSizeData;let $c=null;"source"===zp.kind?($c=[Yl*An.layout.get("icon-size").evaluate(rr,{},ri)],$c[0]>yl&&mn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===zp.kind&&($c=[Yl*Gr.compositeIconSizes[0].evaluate(rr,{},ri),Yl*Gr.compositeIconSizes[1].evaluate(rr,{},ri)],($c[0]>yl||$c[1]>yl)&&mn(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,ih,$c,mi,pi,rr,!1,an,Mt,Ii.lineStartIndex,Ii.lineLength,-1,mr,ri),ga=jt.icon.placedSymbolArray.length-1,Fp&&(Na=4*Fp.length,jt.addSymbols(jt.icon,Fp,$c,mi,pi,rr,ws.vertical,an,Mt,Ii.lineStartIndex,Ii.lineLength,-1,mr,ri),Ws=jt.icon.placedSymbolArray.length-1)}for(const co in Cn.horizontal){const Cs=Cn.horizontal[co];Wi||(Pp=bc.exports(Cs.text),jr?El=yp(Cs):Wi=Zh(Nn,jc,Mt,pr,wr,Ir,Cs,Sr,An.layout.get("text-rotate").evaluate(rr,{},ri),Kr));const ih=1===Cs.positionedLines.length;if(pg+=Hm(jt,an,Mt,Cs,gn,An,jr,rr,Kr,Ii,Cn.vertical?ws.horizontal:ws.horizontalOnly,ih?Object.keys(Cn.horizontal):[co],Ni,ga,Gr,mr,ri),ih)break}Cn.vertical&&(mg+=Hm(jt,an,Mt,Cn.vertical,gn,An,jr,rr,Kr,Ii,ws.vertical,["vertical"],Ni,Ws,Gr,mr,ri));let Vc=-1;const Lp=(co,Cs)=>co?Math.max(co,Cs):Cs;Vc=Lp(El,Vc),Vc=Lp(ld,Vc),Vc=Lp(nh,Vc);const Op=Vc>-1?1:0;jt.glyphOffsetArray.length>=za.MAX_GLYPHS&&mn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==rr.sortKey&&jt.addToSortKeyRanges(jt.symbolInstances.length,rr.sortKey),jt.symbolInstances.emplaceBack(jc.x,jc.y,jc.z,Mt.x,Mt.y,Ni.right>=0?Ni.right:-1,Ni.center>=0?Ni.center:-1,Ni.left>=0?Ni.left:-1,Ni.vertical>=0?Ni.vertical:-1,ga,Ws,Pp,void 0!==Wi?Wi:jt.collisionBoxArray.length,void 0!==Wi?Wi+1:jt.collisionBoxArray.length,void 0!==Ao?Ao:jt.collisionBoxArray.length,void 0!==Ao?Ao+1:jt.collisionBoxArray.length,void 0!==Xi?Xi:jt.collisionBoxArray.length,void 0!==Xi?Xi+1:jt.collisionBoxArray.length,Yi||jt.collisionBoxArray.length,Yi?Yi+1:jt.collisionBoxArray.length,pr,pg,mg,rh,Na,Op,0,Rp,kp,Vc)}(n,Ft,qt,Ze,r,a,h,at,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,be,Fe,w,0,_e,He,H,e,m,D,I,A)};if("line"===ht)for(const Ze of O_(e.geometry,0,0,hn,hn)){const Ft=L_(Ze,fe,Be,r.vertical||Y,a,24,ae,n.overscaling,hn);for(const cn of Ft){const qt=Y;qt&&B_(n,qt.text,je,cn)||pt(Ze,cn,A)}}else if("line-center"===ht){for(const Ze of e.geometry)if(Ze.length>1){const Ft=k_(Ze,Be,r.vertical||Y,a,24,ae);Ft&&pt(Ze,Ft,A)}}else if("Polygon"===e.type)for(const Ze of Kf(e.geometry,0)){const Ft=iv(Ze,16);pt(Ze[0],new Oa(Ft.x,Ft.y,0,0,void 0),A)}else if("LineString"===e.type)for(const Ze of e.geometry)pt(Ze,new Oa(Ze[0].x,Ze[0].y,0,0,void 0),A);else if("Point"===e.type)for(const Ze of e.geometry)for(const Ft of Ze)pt([Ft],new Oa(Ft.x,Ft.y,0,0,void 0),A)}const yl=32640;function Hm(n,e,r,a,h,m,_,x,w,D,I,A,P,F,z,H,Y){const le=function(fe,be,_e,Be,Fe,He,ht,je){const Je=[];if(0===be.positionedLines.length)return Je;const nt=Be.layout.get("text-rotate").evaluate(He,{})*Math.PI/180,at=function(qt){const jt=qt[0],Mt=qt[1],an=jt*Mt;return an>0?[jt,-Mt]:an<0?[-jt,Mt]:0===jt?[Mt,jt]:[Mt,-jt]}(_e);let pt=Math.abs(be.top-be.bottom);for(const qt of be.positionedLines)pt-=qt.lineOffset;const Ze=be.positionedLines.length,Ft=pt/Ze;let cn=be.top-_e[1];for(let qt=0;qt<Ze;++qt){const jt=be.positionedLines[qt];cn=tv(be,Ft,cn,qt);for(const Mt of jt.positionedGlyphs){if(!Mt.rect)continue;const an=Mt.rect||{};let wn=4,Cn=!0,Qn=1,gn=0;if(Mt.imageName){const mr=ht[Mt.imageName];if(!mr)continue;if(mr.sdf){mn("SDF images are not supported in formatted text and will be ignored.");continue}Cn=!1,Qn=mr.pixelRatio,wn=1/Qn}const Cr=(Fe||je)&&Mt.vertical,An=Mt.metrics.advance*Mt.scale/2,Nn=Mt.metrics,pr=Mt.rect;if(null===pr)continue;je&&be.verticalizable&&(gn=Mt.imageName?An-Mt.metrics.width*Mt.scale/2:0);const wr=Fe?[Mt.x+An,Mt.y]:[0,0];let Ir=[0,0],Sr=[0,0],jr=!1;Fe||(Cr?(Sr=[Mt.x+An+at[0],Mt.y+at[1]-gn],jr=!0):Ir=[Mt.x+An+_e[0],Mt.y+_e[1]-gn]);const Kr=pr.w*Mt.scale/(Qn*(Mt.localGlyph?2:1)),qi=pr.h*Mt.scale/(Qn*(Mt.localGlyph?2:1));let In,pi,mi,rr;if(Cr){const mr=Mt.y-cn,ri=new et(-An,An-mr),Ii=-Math.PI/2,Wi=new et(...Sr);In=new et(-An+Ir[0],Ir[1]),In._rotateAround(Ii,ri)._add(Wi),In.x+=-mr+An,In.y-=(Nn.left-wn)*Mt.scale;const Xi=Mt.imageName?Nn.advance*Mt.scale:24*Mt.scale,Ao=String.fromCharCode(Mt.glyph);b_(Ao)?In.x+=(1-wn)*Mt.scale:Qy(Ao)?In.x+=Xi-Nn.height*Mt.scale+(-wn-1)*Mt.scale:In.x+=Mt.imageName||Nn.width+2*wn===pr.w&&Nn.height+2*wn===pr.h?(Xi-qi)/2:(Xi-(Nn.height+2*wn)*Mt.scale)/2,pi=new et(In.x,In.y-Kr),mi=new et(In.x+qi,In.y),rr=new et(In.x+qi,In.y-Kr)}else{const mr=(Nn.left-wn)*Mt.scale-An+Ir[0],ri=(-Nn.top-wn)*Mt.scale+Ir[1],Ii=mr+Kr,Wi=ri+qi;In=new et(mr,ri),pi=new et(Ii,ri),mi=new et(mr,Wi),rr=new et(Ii,Wi)}if(nt){let mr;mr=Fe?new et(0,0):jr?new et(at[0],at[1]):new et(_e[0],_e[1]),In._rotateAround(nt,mr),pi._rotateAround(nt,mr),mi._rotateAround(nt,mr),rr._rotateAround(nt,mr)}const Gr=new et(0,0),Pi=new et(0,0);Je.push({tl:In,tr:pi,bl:mi,br:rr,tex:an,writingMode:be.writingMode,glyphOffset:wr,sectionIndex:Mt.sectionIndex,isSDF:Cn,pixelOffsetTL:Gr,pixelOffsetBR:Pi,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,a,w,m,_,x,h,n.allowVerticalPlacement),me=n.textSizeData;let ae=null;"source"===me.kind?(ae=[Yl*m.layout.get("text-size").evaluate(x,{},Y)],ae[0]>yl&&mn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===me.kind&&(ae=[Yl*z.compositeTextSizes[0].evaluate(x,{},Y),Yl*z.compositeTextSizes[1].evaluate(x,{},Y)],(ae[0]>yl||ae[1]>yl)&&mn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,le,ae,w,_,x,I,e,r,D.lineStartIndex,D.lineLength,F,H,Y);for(const fe of A)P[fe]=n.text.placedSymbolArray.length-1;return 4*le.length}function Jl(n){for(const e in n)return n[e];return null}function Zh(n,e,r,a,h,m,_,x,w,D){let I=_.top,A=_.bottom,P=_.left,F=_.right;const z=_.collisionPadding;if(z&&(P-=z[0],I-=z[1],F+=z[2],A+=z[3]),w){const H=new et(P,I),Y=new et(F,I),le=new et(P,A),me=new et(F,A),ae=qe(w);let fe=new et(0,0);D&&(fe=new et(D[0],D[1])),H._rotateAround(ae,fe),Y._rotateAround(ae,fe),le._rotateAround(ae,fe),me._rotateAround(ae,fe),P=Math.min(H.x,Y.x,le.x,me.x),F=Math.max(H.x,Y.x,le.x,me.x),I=Math.min(H.y,Y.y,le.y,me.y),A=Math.max(H.y,Y.y,le.y,me.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,P,I,F,A,x,a,h,m),n.length-1}function yp(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function B_(n,e,r,a){const h=n.compareText;if(e in h){const m=h[e];for(let _=m.length-1;_>=0;_--)if(a.dist(m[_])<r)return!0}else h[e]=[];return h[e].push(a),!1}const Zm=yt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:qm}=Zm,Wm=yt([{name:"a_pos_3",components:3,type:"Int16"}]);var Oc=yt([{name:"a_pos",type:"Int16",components:2}]);const Es=hn/Math.PI/2,qh=2*sa(1,0)*Es*Math.PI,Fc=[64,32,16],Ds=-Es,ha=Es,vp=[new Io([Ds,Ds,Ds],[ha,ha,ha]),new Io([Ds,Ds,Ds],[0,0,ha]),new Io([0,Ds,Ds],[ha,0,ha]),new Io([Ds,0,Ds],[0,ha,ha]),new Io([0,0,Ds],[ha,ha,ha])];function Xd(n,e,r,a=!0){const h=qs([],n._camera.position,n.worldSize),m=[e,r,1,1];Zl(m,m,n.pixelMatrixInverse),jg(m,m,1/m[3]);const _=Go([],ca([],m,h)),x=n.globeMatrix,w=[x[12],x[13],x[14]],D=ca([],w,h),I=wh(D),A=Go([],D),P=n.worldSize/(2*Math.PI),F=la(A,_),z=Math.asin(P/I);if(z<Math.acos(F)){if(!a)return null;const ht=[],je=[];qs(ht,_,I/F),Go(je,ca(je,ht,D)),Go(_,Mc(_,D,qs(_,je,Math.tan(z)*I)))}const H=[];new Nf(h,_).closestPointOnSphere(w,P,H);const Y=Go([],$i(x,0)),le=Go([],$i(x,1)),me=Go([],$i(x,2)),ae=la(Y,H),fe=la(le,H),be=la(me,H),_e=Yt(Math.asin(-fe/P));let Be=Yt(Math.atan2(ae,be));Be=n.center.lng+function(ht,je){const Je=(je-ht+180)%360-180;return Je<-180?Je+360:Je}(n.center.lng,Be);const Fe=ka(Be),He=Ie(oa(_e),0,1);return new nu(Fe,He)}class xp{constructor(e,r,a){this.a=ca([],e,a),this.b=ca([],r,a),this.center=a;const h=Go([],this.a),m=Go([],this.b);this.angle=Math.acos(la(h,m))}}function Yd(n,e){if(0===n.angle)return null;let r;return r=0===n.a[e]?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(a,h,m,_){const x=Math.sin(m);return a*(Math.sin((1-_)*m)/x)+h*(Math.sin(_*m)/x)}(n.a[e],n.b[e],n.angle,Ie(r,0,1))+n.center[e]}function da(n){if(n.z<=1)return vp[n.z+2*n.y+n.x];const e=Kd(Wh(n));return Io.fromPoints(e)}function fu(n,e,r){return qs(n,n,1-r),Dh(n,n,e,r)}function Xm(n,e){const r=Ku(e.zoom);if(0===r)return da(n);const a=Wh(n),h=Kd(a),m=ka(a.getWest())*e.worldSize,_=ka(a.getEast())*e.worldSize,x=oa(a.getNorth())*e.worldSize,w=oa(a.getSouth())*e.worldSize,D=[m,x,0],I=[_,x,0],A=[m,w,0],P=[_,w,0],F=Cd([],e.globeMatrix);return Tr(D,D,F),Tr(I,I,F),Tr(A,A,F),Tr(P,P,F),h[0]=fu(h[0],A,r),h[1]=fu(h[1],P,r),h[2]=fu(h[2],I,r),h[3]=fu(h[3],D,r),Io.fromPoints(h)}function bp(n,e,r){for(const a of n)Tr(a,a,e),qs(a,a,r)}function Wh({x:n,y:e,z:r}){const a=1/(1<<r),h=new ar(Zs(n*a),Zi((e+1)*a)),m=new ar(Zs((n+1)*a),Zi(e*a));return new Dc(h,m)}function Kd(n){const e=qe(n.getNorth()),r=qe(n.getSouth()),a=Math.cos(e),h=Math.cos(r),m=Math.sin(e),_=Math.sin(r),x=n.getWest(),w=n.getEast();return[Yu(h,_,x),Yu(h,_,w),Yu(a,m,w),Yu(a,m,x)]}function Yu(n,e,r,a=Es){return r=qe(r),[n*Math.sin(r)*a,-e*a,n*Math.cos(r)*a]}function Xh(n,e,r){return Yu(Math.cos(qe(n)),Math.sin(qe(n)),e,r)}function Mo(n,e,r,a){const h=1<<r.z,m=(n/hn+r.x)/h;return Xh(Zi((e/hn+r.y)/h),Zs(m),a)}function Yh({min:n,max:e}){return 16383/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Ym=new Float64Array(16);function Jd(n){const e=Yh(n),r=lm(Ym,[e,e,e]);return Bu(r,r,((a=[])[0]=-(h=n.min)[0],a[1]=-h[1],a[2]=-h[2],a));var a,h}function Kh(n){const e=(a=n.min,(r=Ym)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const h=1/Yh(n);return Sc(e,e,[h,h,h])}function wp(n,e,r,a,h){const m=function(w){const D=hn/(2*Math.PI);return w/(2*Math.PI)/D}(r),_=[n,e,-r/(2*Math.PI)],x=aa(new Float64Array(16));return Bu(x,x,_),Sc(x,x,[m,m,m]),zf(x,x,qe(-h)),Id(x,x,qe(-a)),x}function Ku(n){return Ne(5,6,n)}function Km(n,e){const r=Xh(e.lat,e.lng);return _=(h=um([],function(z){const H=Xh(z._center.lat,z._center.lng);let Y=Th([],Eh(0,1,0),H);const le=cm([],-z.angle,H);Y=Tr(Y,Y,le),cm(le,-z._pitch,Y);const me=Go([],H);return qs(me,me,z.cameraToCenterDistance/z.pixelsPerMeter*qh),Tr(me,me,le),Mc([],H,me)}(n),r))[0],x=h[1],w=h[2],D=(m=r)[0],I=m[1],A=m[2],F=(P=Math.sqrt(_*_+x*x+w*w)*Math.sqrt(D*D+I*I+A*A))&&la(h,m)/P,Math.acos(Math.min(Math.max(F,-1),1));var h,m,_,x,w,D,I,A,P,F}const Jm=qe(85),Qm=Math.cos(Jm),U_=Math.sin(Jm);function eg(n,e){const r=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,h=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),m=Math.sin(r)*h/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),_=Math.sin(n._pitch)*m+h;return Math.min(1.01*_,h*(1/n._horizonShift))}function Ql(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),a=n.x*r,h=(n.x+1)*r,m=n.y*r,_=(n.y+1)*r,x=Zs(a),w=Zs(h),D=Zi(m),I=Zi(_),A=e.project(x,D),P=e.project(w,D),F=e.project(w,I),z=e.project(x,I);let H=Math.min(A.x,P.x,F.x,z.x),Y=Math.min(A.y,P.y,F.y,z.y),le=Math.max(A.x,P.x,F.x,z.x),me=Math.max(A.y,P.y,F.y,z.y);const ae=r/16;function fe(_e,Be,Fe,He,ht,je){const Je=(Fe+ht)/2,nt=(He+je)/2,at=e.project(Zs(Je),Zi(nt)),pt=Math.max(0,H-at.x,Y-at.y,at.x-le,at.y-me);H=Math.min(H,at.x),le=Math.max(le,at.x),Y=Math.min(Y,at.y),me=Math.max(me,at.y),pt>ae&&(fe(_e,at,Fe,He,Je,nt),fe(at,Be,Je,nt,ht,je))}fe(A,P,a,m,h,m),fe(P,F,h,m,h,_),fe(F,z,h,_,a,_),fe(z,A,a,_,a,m),H-=ae,Y-=ae,le+=ae,me+=ae;const be=1/Math.max(le-H,me-Y);return{scale:be,x:H*be,y:Y*be,x2:le*be,y2:me*be,projection:e}}const j_=aa(new Float32Array(16));class zc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new ar(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return sa(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return eg(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,h){const m=e.horizonLineFromTop(!1),_=new et(r,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,r,a){const h=new et(r,a);if(e.elevation)return e.elevation.pointCoordinate(h);{const m=this.pointCoordinate(e,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return j_}createTileMatrix(e,r,a){let h,m,_;const x=a.canonical,w=aa(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Ql(x,this);h=1,m=D.x+a.wrap*D.scale,_=D.y,Sc(w,w,[h/D.scale,h/D.scale,e.pixelsPerMeter/r])}else h=r/e.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*a.wrap)*h,_=x.y*h;return Bu(w,w,[m,_,0]),Sc(w,w,[h/hn,h/hn,1]),w}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class V_ extends zc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(qe(r));this.n=(h+Math.sin(qe(a)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:h,r0:m}=this,_=qe(e-this.center[0]),x=qe(r),w=Math.sqrt(h-2*a*Math.sin(x))/a;return{x:w*Math.sin(_*a),y:w*Math.cos(_*a)-m,z:0}}unproject(e,r){const{n:a,c:h,r0:m}=this,_=m+r;let x=Math.atan2(e,Math.abs(_))*Math.sign(_);_*a<0&&(x-=Math.PI*Math.sign(e)*Math.sign(_));const w=qe(this.center[0])*a;x=Ye(x,-Math.PI-w,Math.PI-w);const D=Ie(Yt(x/a)+this.center[0],-180,180),I=Math.asin(Ie((h-(e*e+_*_)*a*a)/(2*a),-1,1)),A=Ie(Yt(I),-85.051129,$o);return new ar(D,A)}}const Jh=1.340264,Qh=-.081106,Ts=893e-6,pu=.003796,Qd=Math.sqrt(3)/2;class $_ extends zc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Qd*Math.sin(r)),h=a*a,m=h*h*h;return{x:.5*(e*Math.cos(a)/(Qd*(Jh+3*Qh*h+m*(7*Ts+9*pu*h)))/Math.PI+.5),y:1-.5*(a*(Jh+Qh*h+m*(Ts+pu*h))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,h=a*a,m=h*h*h;for(let I,A,P,F=0;F<12&&(A=a*(Jh+Qh*h+m*(Ts+pu*h))-r,P=Jh+3*Qh*h+m*(7*Ts+9*pu*h),I=A/P,a=Ie(a-I,-Math.PI/3,Math.PI/3),h=a*a,m=h*h*h,!(Math.abs(I)<1e-12));++F);const _=Qd*e*(Jh+3*Qh*h+m*(7*Ts+9*pu*h))/Math.cos(a),x=Math.asin(Math.sin(a)/Qd),w=Ie(180*_/Math.PI,-180,180),D=Ie(180*x/Math.PI,-85.051129,$o);return new ar(w,D)}}class sv extends zc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),h=Ie(360*(.5-r),-85.051129,$o);return new ar(a,h)}}const mu=Math.PI/2;function ef(n){return Math.tan((mu+n)/2)}class G_ extends zc{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let h=qe(r),m=qe(a);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const _=Math.cos(h),x=ef(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(ef(m)/x),this.f=_*Math.pow(ef(h),this.n)/this.n}project(e,r){r=qe(r),this.southernCenter&&(r=-r),e=qe(e-this.center[0]);const a=1e-6,{n:h,f:m}=this;m>0?r<-mu+a&&(r=-mu+a):r>mu-a&&(r=mu-a);const _=m/Math.pow(ef(r),h);let x=_*Math.sin(h*e),w=m-_*Math.cos(h*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:h}=this,m=h-r,_=Math.sign(m),x=Math.sign(a)*Math.sqrt(e*e+m*m);let w=Math.atan2(e,Math.abs(m))*_;m*a<0&&(w-=Math.PI*Math.sign(e)*_);const D=Ie(Yt(w/a)+this.center[0],-180,180),I=Ie(Yt(2*Math.atan(Math.pow(h/x,1/a))-mu),-85.051129,$o);return new ar(D,this.southernCenter?-I:I)}}class tg extends zc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ka(e),y:oa(r),z:0}}unproject(e,r){const a=Zs(e),h=Zi(r);return new ar(a,h)}}const tf=qe($o);class H_ extends zc{project(e,r){const a=(r=qe(r))*r,h=a*a;return{x:.5*((e=qe(e))*(.8707-.131979*a+h*(h*(.003971*a-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+h*(.028874*a-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,h=25,m=0,_=a*a;do{_=a*a;const D=_*_;m=(a*(1.007226+_*(.015085+D*(.028874*_-.044475-.005916*D)))-r)/(1.007226+_*(.045255+D*(.259866*_-.311325-.005916*11*D))),a=Ie(a-m,-tf,tf)}while(Math.abs(m)>1e-6&&--h>0);_=a*a;const x=Ie(Yt(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),w=Yt(a);return new ar(x,w)}}const ng=qe($o);class nf extends zc{project(e,r){r=qe(r),e=qe(e);const a=Math.cos(r),h=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),_=Math.sin(m)/m,x=.5*(e*h+2*a*Math.sin(e/2)/_)||0,w=.5*(r+Math.sin(r)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,h=r=(2*(1-r)-1)*Math.PI,m=25;const _=1e-6;let x=0,w=0;do{const D=Math.cos(h),I=Math.sin(h),A=2*I*D,P=I*I,F=D*D,z=Math.cos(a/2),H=Math.sin(a/2),Y=2*z*H,le=H*H,me=1-F*z*z,ae=me?1/me:0,fe=me?Math.acos(D*z)*Math.sqrt(1/me):0,be=.5*(2*fe*D*H+2*a/Math.PI)-e,_e=.5*(fe*I+h)-r,Be=.5*ae*(F*le+fe*D*z*P)+1/Math.PI,Fe=ae*(Y*A/4-fe*I*H),He=.125*ae*(A*H-fe*I*F*Y),ht=.5*ae*(P*z+fe*le*D)+.5,je=Fe*He-ht*Be;x=(_e*Fe-be*ht)/je,w=(be*He-_e*Be)/je,a=Ie(a-x,-Math.PI,Math.PI),h=Ie(h-w,-ng,ng)}while((Math.abs(x)>_||Math.abs(w)>_)&&--m>0);return new ar(Yt(a),Yt(h))}}class rf extends zc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(qe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:h}=this;return{x:qe(e)*h*a+.5,y:-Math.sin(qe(r))/h*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:h}=this,m=-(r-.5)/a,_=Ie(Yt((e-.5)/a)/h,-180,180),x=Math.asin(Ie(m*h,-1,1)),w=Ie(Yt(x),-85.051129,$o);return new ar(_,w)}}class sf extends tg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,r,a){const h=Mo(e,r,a);return Tr(h,h,Jd(da(a))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,r){const a=Xh(r.lat,r.lng),h=Go([],a),m=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Dh(a,a,h,sa(1,0)*hn*m);const _=aa(new Float64Array(16));return ou(_,e.pixelMatrix,e.globeMatrix),Tr(a,a,_),new et(a[0],a[1])}pixelsPerMeter(e,r){return sa(1,0)*r}pixelSpaceConversion(e,r,a){const h=sa(1,e)*r,m=Dn(sa(1,45)*r,h,a);return this.pixelsPerMeter(e,r)/m}createTileMatrix(e,r,a){const h=Kh(da(a.canonical));return ou(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,r){const{center:a}=e,h=Jd(da(r));return Id(h,h,qe(a.lng)),zf(h,h,qe(a.lat)),Sc(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,r,a,h){return Xd(e,r,a,!0)||new nu(0,0)}pointCoordinate3D(e,r,a){const h=this.pointCoordinate(e,r,a,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,r){return!Xd(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(h,m){const _=h.cameraToCenterDistance,x=h._centerAltitude*m,w=h._camera,D=h._camera.forward(),I=Mc([],qs([],D,-_),[0,0,x]),A=h.worldSize/(2*Math.PI),P=[0,0,-A],F=h.width/h.height,z=Math.tan(h.fovAboveCenter),H=qs([],w.up(),z),Y=qs([],w.right(),z*F),le=Go([],Mc([],Mc([],D,H),Y)),me=[];let ae;if(new Nf(I,le).closestPointOnSphere(P,A,me)){const fe=Mc([],me,P),be=ca([],fe,I);ae=Math.cos(h.fovAboveCenter)*wh(be)}else{const fe=ca([],I,P),be=ca([],P,I);Go(be,be);const _e=wh(fe)-A;ae=Math.sqrt(_e*(_e+2*A));const Be=Math.acos(ae/(A+_e))-Math.acos(la(D,be));ae*=Math.cos(Be)}return 1.01*ae}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Ku(e.zoom);if(a>0){const h=eg(e,sa(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Dn(r,h+m*(1-Math.cos(_)),Math.pow(a,10))}return r}upVector(e,r,a){return Mo(r,a,e,1)}upVectorScale(e){return{metersToTile:qh*Yh(da(e))}}}function Z_(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new tg(n);case"equirectangular":return new sv(n);case"naturalEarth":return new H_(n);case"equalEarth":return new $_(n);case"winkelTripel":return new nf(n);case"albers":return r?new rf(n):new V_(n);case"lambertConformalConic":return r?new rf(n):new G_(n);case"globe":return new sf(n)}throw new Error(`Invalid projection name: ${n.name}`)}const Ep=Zu.types,av=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ed(n,e,r,a,h,m,_,x,w,D,I,A,P){const F=x?Math.min(yl,Math.round(x[0])):0,z=x?Math.min(yl,Math.round(x[1])):0;n.emplaceBack(e,r,Math.round(32*a),Math.round(32*h),m,_,(F<<1)+(w?1:0),z,16*D,16*I,256*A,256*P)}function td(n,e,r,a,h,m,_){n.emplaceBack(e,r,a,h,m,_)}function nd(n,e,r,a,h){n.emplaceBack(e,r,a,h),n.emplaceBack(e,r,a,h),n.emplaceBack(e,r,a,h),n.emplaceBack(e,r,a,h)}function rg(n){for(const e of n.sections)if(S(e.text))return!0;return!1}class rd{constructor(e){this.layoutVertexArray=new Xr,this.indexArray=new Vo,this.programConfigurations=e,this.segments=new Ti,this.dynamicLayoutVertexArray=new Ai,this.opacityVertexArray=new Di,this.placedSymbolArray=new Pa,this.globeExtVertexArray=new sr}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,r,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Am.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,__.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,av,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,g_.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}St(rd,"SymbolBuffers");class Fa{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Ti,this.collisionVertexArray=new jl,this.collisionVertexArrayExt=new ts}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,y_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}St(Fa,"CollisionBuffers");class za{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=aa([]),this.placementViewportMatrix=aa([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fd(this.zoom,r["text-size"]),this.iconSizeData=Fd(this.zoom,r["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(_=>ws[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new rd(new Hl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new rd(new Hl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Xp,this.lineVertexArray=new yf,this.symbolInstances=new Wp}calculateGlyphDependencies(e,r,a,h,m){for(let _=0;_<e.length;_++)if(r[e.charCodeAt(_)]=!0,h&&m){const x=cu[e.charAt(_)];x&&(r[x.charCodeAt(0)]=!0)}}populate(e,r,a,h){const m=this.layers[0],_=m.layout,x="globe"===this.projection.name,w=_.get("text-font"),D=_.get("text-field"),I=_.get("icon-image"),A=("constant"!==D.value.kind||D.value.value instanceof ei&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),P="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,F=_.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const z=r.iconDependencies,H=r.glyphDependencies,Y=r.availableImages,le=new ue(this.zoom);for(const{feature:me,id:ae,index:fe,sourceLayerIndex:be}of e){const _e=m._featureFilter.needGeometry,Be=Tc(me,_e);if(!m._featureFilter.filter(le,Be,a))continue;if(_e||(Be.geometry=La(me,a,h)),x&&1!==me.type&&a.z<=5){const je=Be.geometry,Je=.98078528056,nt=(at,pt)=>la(Mo(at.x,at.y,a,1),Mo(pt.x,pt.y,a,1))<Je;for(let at=0;at<je.length;at++)je[at]=zg(je[at],nt)}let Fe,He;if(A){const je=m.getValueAndResolveTokens("text-field",Be,a,Y),Je=ei.factory(je);rg(Je)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===re()||this.hasRTLText&&ge.isParsed())&&(Fe=lp(Je,m,Be))}if(P){const je=m.getValueAndResolveTokens("icon-image",Be,a,Y);He=je instanceof zn?je:zn.fromString(je)}if(!Fe&&!He)continue;const ht=this.sortFeaturesByKey?F.evaluate(Be,{},a):void 0;if(this.features.push({id:ae,text:Fe,icon:He,index:fe,sourceLayerIndex:be,geometry:Be.geometry,properties:me.properties,type:Ep[me.type],sortKey:ht}),He&&(z[He.name]=!0),Fe){const je=w.evaluate(Be,{},a).join(","),Je="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ws.vertical)>=0;for(const nt of Fe.sections)if(nt.image)z[nt.image.name]=!0;else{const at=o(Fe.toString()),pt=nt.fontStack||je,Ze=H[pt]=H[pt]||{};this.calculateGlyphDependencies(nt.text,Ze,Je,this.allowVerticalPlacement,at)}}}"line"===_.get("symbol-placement")&&(this.features=function(me){const ae={},fe={},be=[];let _e=0;function Be(je){be.push(me[je]),_e++}function Fe(je,Je,nt){const at=fe[je];return delete fe[je],fe[Je]=at,be[at].geometry[0].pop(),be[at].geometry[0]=be[at].geometry[0].concat(nt[0]),at}function He(je,Je,nt){const at=ae[Je];return delete ae[Je],ae[je]=at,be[at].geometry[0].shift(),be[at].geometry[0]=nt[0].concat(be[at].geometry[0]),at}function ht(je,Je,nt){const at=nt?Je[0][Je[0].length-1]:Je[0][0];return`${je}:${at.x}:${at.y}`}for(let je=0;je<me.length;je++){const Je=me[je],nt=Je.geometry,at=Je.text?Je.text.toString():null;if(!at){Be(je);continue}const pt=ht(at,nt),Ze=ht(at,nt,!0);if(pt in fe&&Ze in ae&&fe[pt]!==ae[Ze]){const Ft=He(pt,Ze,nt),cn=Fe(pt,Ze,be[Ft].geometry);delete ae[pt],delete fe[Ze],fe[ht(at,be[cn].geometry,!0)]=cn,be[Ft].geometry=null}else pt in fe?Fe(pt,Ze,nt):Ze in ae?He(pt,Ze,nt):(Be(je),ae[pt]=_e-1,fe[Ze]=_e-1)}return be.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,ae)=>me.sortKey-ae.sortKey)}update(e,r,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,h),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Z_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length,h=e.segment;if(void 0!==h){let m=e.dist(r[h+1]),_=e.dist(r[h]);const x={};for(let w=h+1;w<r.length;w++)x[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:m},w<r.length-1&&(m+=r[w+1].dist(r[w]));for(let w=h||0;w>=0;w--)x[w]={x:r[w].x,y:r[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=r[w-1].dist(r[w]));for(let w=0;w<r.length;w++){const D=x[w];this.lineVertexArray.emplaceBack(D.x,D.y,D.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,h,m,_,x,w,D,I,A,P,F,z){const H=e.indexArray,Y=e.layoutVertexArray,le=e.globeExtVertexArray,me=e.segments.prepareSegment(4*r.length,Y,H,this.canOverlap?_.sortKey:void 0),ae=this.glyphOffsetArray.length,fe=me.vertexLength,be=this.allowVerticalPlacement&&x===ws.vertical?Math.PI/2:0,_e=_.text&&_.text.sections;for(let Fe=0;Fe<r.length;Fe++){const{tl:He,tr:ht,bl:je,br:Je,tex:nt,pixelOffsetTL:at,pixelOffsetBR:pt,minFontScaleX:Ze,minFontScaleY:Ft,glyphOffset:cn,isSDF:qt,sectionIndex:jt}=r[Fe],Mt=me.vertexLength,an=cn[1];if(ed(Y,D.x,D.y,He.x,an+He.y,nt.x,nt.y,a,qt,at.x,at.y,Ze,Ft),ed(Y,D.x,D.y,ht.x,an+ht.y,nt.x+nt.w,nt.y,a,qt,pt.x,at.y,Ze,Ft),ed(Y,D.x,D.y,je.x,an+je.y,nt.x,nt.y+nt.h,a,qt,at.x,pt.y,Ze,Ft),ed(Y,D.x,D.y,Je.x,an+Je.y,nt.x+nt.w,nt.y+nt.h,a,qt,pt.x,pt.y,Ze,Ft),w){const wn=w.anchor,Cn=w.up;td(le,wn.x,wn.y,wn.z,Cn[0],Cn[1],Cn[2]),td(le,wn.x,wn.y,wn.z,Cn[0],Cn[1],Cn[2]),td(le,wn.x,wn.y,wn.z,Cn[0],Cn[1],Cn[2]),td(le,wn.x,wn.y,wn.z,Cn[0],Cn[1],Cn[2]),nd(e.dynamicLayoutVertexArray,wn.x,wn.y,wn.z,be)}else nd(e.dynamicLayoutVertexArray,D.x,D.y,D.z,be);H.emplaceBack(Mt,Mt+1,Mt+2),H.emplaceBack(Mt+1,Mt+2,Mt+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(cn[0]),Fe!==r.length-1&&jt===r[Fe+1].sectionIndex||e.programConfigurations.populatePaintArrays(Y.length,_,_.index,{},F,z,_e&&_e[jt])}const Be=w?w.anchor:D;e.placedSymbolArray.emplaceBack(Be.x,Be.y,Be.z,D.x,D.y,ae,this.glyphOffsetArray.length-ae,fe,I,A,D.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(e,r,a,h,m,_,x){e.emplaceBack(r,a,h,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,r,a,h,m,_,x){const w=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),D=w.vertexLength,I=x.tileAnchorX,A=x.tileAnchorY;for(let F=0;F<4;F++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,I,A,new et(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,I,A,new et(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,I,A,new et(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,I,A,new et(e.x1,e.y2)),w.vertexLength+=4;const P=a.indexArray;P.emplaceBack(D,D+1),P.emplaceBack(D+1,D+2),P.emplaceBack(D+2,D+3),P.emplaceBack(D+3,D),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,h,m,_){for(let x=h;x<m;x++){const w=a.get(x),D=this.getSymbolInstanceTextSize(e,_,r,x);this._addCollisionDebugVertices(w,D,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,r,a,h,m,_){for(let x=h;x<m;x++){const w=a.get(x),D=this.getSymbolInstanceIconSize(e,r,_.placedIconSymbolIndex);this._addCollisionDebugVertices(w,D,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fa(Dr,ap.members,ia),this.iconCollisionBox=new Fa(Dr,ap.members,ia);const a=ua(this.iconSizeData,e),h=ua(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(a,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,r,a,h){const m=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:h),_=Nh(this.textSizeData,e,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,r,a){const h=this.icon.placedSymbolArray.get(a),m=Nh(this.iconSizeData,e,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,h,m,_){for(let x=h;x<m;x++){const w=a.get(x),D=this.getSymbolInstanceTextSize(e,_,r,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,w.padding)}}_updateIconDebugCollisionBoxes(e,r,a,h,m,_){for(let x=h;x<m;x++){const w=a.get(x),D=this.getSymbolInstanceIconSize(e,r,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,w.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=ua(this.iconSizeData,e),h=ua(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,e,r,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,e,r,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(a,e,r,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,h,m,_,x,w,D){const I={};for(let A=r;A<a;A++){const P=e.get(A);I.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.textFeatureIndex=P.featureIndex;break}for(let A=h;A<m;A++){const P=e.get(A);I.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalTextFeatureIndex=P.featureIndex;break}for(let A=_;A<x;A++){const P=e.get(A);I.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.iconFeatureIndex=P.featureIndex;break}for(let A=w;A<D;A++){const P=e.get(A);I.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalIconFeatureIndex=P.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),h=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),h=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(r*w.tileAnchorX+a*w.tileAnchorY)),m.push(w.featureIndex)}return _.sort((x,w)=>h[x]-h[w]||m[w]-m[x]),_}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,m,_)=>{h>=0&&_.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}St(za,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),za.MAX_GLYPHS=65535,za.addDynamicAttributes=nd;const af=new _t({"symbol-placement":new ke($e.layout_symbol["symbol-placement"]),"symbol-spacing":new ke($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ke($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ce($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ke($e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ke($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ke($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new ke($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ke($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ce($e.layout_symbol["icon-size"]),"icon-text-fit":new ke($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ke($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ce($e.layout_symbol["icon-image"]),"icon-rotate":new Ce($e.layout_symbol["icon-rotate"]),"icon-padding":new ke($e.layout_symbol["icon-padding"]),"icon-keep-upright":new ke($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ce($e.layout_symbol["icon-offset"]),"icon-anchor":new Ce($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ke($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ke($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ke($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ce($e.layout_symbol["text-field"]),"text-font":new Ce($e.layout_symbol["text-font"]),"text-size":new Ce($e.layout_symbol["text-size"]),"text-max-width":new Ce($e.layout_symbol["text-max-width"]),"text-line-height":new Ce($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ce($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ce($e.layout_symbol["text-justify"]),"text-radial-offset":new Ce($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ke($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ce($e.layout_symbol["text-anchor"]),"text-max-angle":new ke($e.layout_symbol["text-max-angle"]),"text-writing-mode":new ke($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ce($e.layout_symbol["text-rotate"]),"text-padding":new ke($e.layout_symbol["text-padding"]),"text-keep-upright":new ke($e.layout_symbol["text-keep-upright"]),"text-transform":new Ce($e.layout_symbol["text-transform"]),"text-offset":new Ce($e.layout_symbol["text-offset"]),"text-allow-overlap":new ke($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ke($e.layout_symbol["text-ignore-placement"]),"text-optional":new ke($e.layout_symbol["text-optional"])});var gu={paint:new _t({"icon-opacity":new Ce($e.paint_symbol["icon-opacity"]),"icon-color":new Ce($e.paint_symbol["icon-color"]),"icon-halo-color":new Ce($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ce($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ce($e.paint_symbol["icon-halo-blur"]),"icon-translate":new ke($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new ke($e.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ce($e.paint_symbol["text-opacity"]),"text-color":new Ce($e.paint_symbol["text-color"],{runtimeType:kr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Ce($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ce($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ce($e.paint_symbol["text-halo-blur"]),"text-translate":new ke($e.paint_symbol["text-translate"]),"text-translate-anchor":new ke($e.paint_symbol["text-translate-anchor"])}),layout:af};class ig{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Un,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}St(ig,"FormatSectionOverride",{omit:["defaultValue"]});class Ju extends Ra{constructor(e){super(e,gu)}recalculate(e,r){super.recalculate(e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const m of a)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,h){const m=this.layout.get(e).evaluate(r,{},a,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Nr(_.value)||!m?m:(x=r.properties,m.replace(/{([^{}]+)}/g,(D,I)=>I in x?String(x[I]):""));var x}createBucket(e){return new za(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of gu.paint.overridableProperties){if(!Ju.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ig(r),h=new rn(a,r.property.specification);let m=null;m="constant"===r.value.kind||"source"===r.value.kind?new Yr("source",h):new Do("composite",h,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Xe(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&Ju.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),h=gu.paint.properties[r];let m=!1;const _=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(m=!0)};if("constant"===a.value.kind&&a.value.value instanceof ei)_(a.value.value.sections);else if("source"===a.value.kind){const x=D=>{m||(D instanceof ls&&Or(D.value)===ir?_(D.value.sections):D instanceof ai?_(D.sections):D.eachChild(x))},w=a.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(e){return new Ec(this,e)}}var og={paint:new _t({"background-color":new ke($e.paint_background["background-color"]),"background-pattern":new ft($e.paint_background["background-pattern"]),"background-opacity":new ke($e.paint_background["background-opacity"])})},q_={paint:new _t({"raster-opacity":new ke($e.paint_raster["raster-opacity"]),"raster-hue-rotate":new ke($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ke($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ke($e.paint_raster["raster-brightness-max"]),"raster-saturation":new ke($e.paint_raster["raster-saturation"]),"raster-contrast":new ke($e.paint_raster["raster-contrast"]),"raster-resampling":new ke($e.paint_raster["raster-resampling"]),"raster-fade-duration":new ke($e.paint_raster["raster-fade-duration"])})};class W_ extends Ra{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var id={paint:new _t({"sky-type":new ke($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new ke($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ke($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ke($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ke($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new xt($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ke($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ke($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ke($e.paint_sky["sky-opacity"])})};function Dp(n,e,r){const a=[0,0,1],h=$g([]);return Bf(h,h,r?-qe(n)+Math.PI:qe(n)),Gg(h,h,-qe(e)),ju(a,a,h),Go(a,a)}const lv={circle:class extends Ra{constructor(n){super(n,Bg)}createBucket(n){return new wd(n)}queryRadius(n){const e=n;return Ic("circle-radius",this,e)+Ic("circle-stroke-width",this,e)+dl(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,a,h,m,_,x){const w=am(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Ch(n,a,m,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,D)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new Ec(this,n)}},heatmap:class extends Ra{createBucket(n){return new dm(n)}constructor(n){super(n,Wg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"heatmap-color"===n&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Ic("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,a,h,m,_,x){const w=this.paint.get("heatmap-radius").evaluate(e,r);return Ch(n,a,m,_,x,!0,!0,new et(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new Ec(this,n)}},hillshade:class extends Ra{constructor(n){super(n,pm)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ra{constructor(n){super(n,ym)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new Ec(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Ah(n)}queryRadius(){return dl(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,a,h,m){return!n.queryGeometry.isAboveHorizon&&Dd(sm(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Ra{constructor(n){super(n,Cm)}createBucket(n){return new Fh(n)}queryRadius(){return dl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new Ec(this,n)}queryIntersectsFeature(n,e,r,a,h,m,_,x,w){const D=am(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),P=[0,0],F=x&&m.elevation,z=m.elevation?m.elevation.exaggeration():1,H=n.tile.getBucket(this);if(F&&H instanceof Fh){const fe=H.centroidVertexArray,be=w+1;if(be<fe.length){const _e=fe.get(be);P[0]=_e.a_centroid_pos0,P[1]=_e.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;"globe"===m.projection.name&&(a=rp([a],[new et(0,0),new et(hn,hn)],n.tileID.canonical).map(fe=>fe.polygon).flat());const Y=F?x:null,[le,me]=(be=a,_e=A,Be=I,Fe=D,He=_,ht=Y,je=P,Je=z,nt=m.center.lat,"globe"===(fe=m).projection.name?function(pt,Ze,Ft,cn,qt,jt,Mt,an,wn,Cn,Qn){const gn=[],Cr=[],An=pt.projection.upVectorScale(Qn,pt.center.lat,pt.worldSize).metersToTile,Nn=[0,0,0,1],pr=[0,0,0,1],wr=(Sr,jr,Kr,qi)=>{Sr[0]=jr,Sr[1]=Kr,Sr[2]=qi,Sr[3]=1},Ir=l_();Ft>0&&(Ft+=Ir),cn+=Ir;for(const Sr of Ze){const jr=[],Kr=[];for(const qi of Sr){const In=qi.x+qt.x,pi=qi.y+qt.y,mi=pt.projection.projectTilePoint(In,pi,Qn),rr=pt.projection.upVector(Qn,qi.x,qi.y);let Gr=Ft,Pi=cn;if(Mt){const mr=ip(In,pi,Ft,cn,Mt,an,wn,Cn);Gr+=mr.base,Pi+=mr.top}0!==Ft?wr(Nn,mi.x+rr[0]*An*Gr,mi.y+rr[1]*An*Gr,mi.z+rr[2]*An*Gr):wr(Nn,mi.x,mi.y,mi.z),wr(pr,mi.x+rr[0]*An*Pi,mi.y+rr[1]*An*Pi,mi.z+rr[2]*An*Pi),Tr(Nn,Nn,jt),Tr(pr,pr,jt),jr.push(new Wu(Nn[0],Nn[1],Nn[2])),Kr.push(new Wu(pr[0],pr[1],pr[2]))}gn.push(jr),Cr.push(Kr)}return[gn,Cr]}(fe,be,_e,Be,Fe,He,ht,je,Je,nt,n.tileID.canonical):ht?function(pt,Ze,Ft,cn,qt,jt,Mt,an,wn){const Cn=[],Qn=[],gn=[0,0,0,1];for(const Cr of pt){const An=[],Nn=[];for(const pr of Cr){const wr=pr.x+cn.x,Ir=pr.y+cn.y,Sr=ip(wr,Ir,Ze,Ft,jt,Mt,an,wn);gn[0]=wr,gn[1]=Ir,gn[2]=Sr.base,gn[3]=1,Zl(gn,gn,qt),gn[3]=Math.max(gn[3],1e-5);const jr=new Wu(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);gn[0]=wr,gn[1]=Ir,gn[2]=Sr.top,gn[3]=1,Zl(gn,gn,qt),gn[3]=Math.max(gn[3],1e-5);const Kr=new Wu(gn[0]/gn[3],gn[1]/gn[3],gn[2]/gn[3]);An.push(jr),Nn.push(Kr)}Cn.push(An),Qn.push(Nn)}return[Cn,Qn]}(be,_e,Be,Fe,He,ht,je,Je,nt):function(pt,Ze,Ft,cn,qt){const jt=[],Mt=[],an=qt[8]*Ze,wn=qt[9]*Ze,Cn=qt[10]*Ze,Qn=qt[11]*Ze,gn=qt[8]*Ft,Cr=qt[9]*Ft,An=qt[10]*Ft,Nn=qt[11]*Ft;for(const pr of pt){const wr=[],Ir=[];for(const Sr of pr){const jr=Sr.x+cn.x,Kr=Sr.y+cn.y,qi=qt[0]*jr+qt[4]*Kr+qt[12],In=qt[1]*jr+qt[5]*Kr+qt[13],pi=qt[2]*jr+qt[6]*Kr+qt[14],mi=qt[3]*jr+qt[7]*Kr+qt[15],rr=qi+an,Gr=In+wn,Pi=pi+Cn,mr=Math.max(mi+Qn,1e-5),ri=qi+gn,Ii=In+Cr,Wi=pi+An,Xi=Math.max(mi+Nn,1e-5);wr.push(new Wu(rr/mr,Gr/mr,Pi/mr)),Ir.push(new Wu(ri/Xi,Ii/Xi,Wi/Xi))}jt.push(wr),Mt.push(Ir)}return[jt,Mt]}(be,_e,Be,Fe,He)),ae=n.queryGeometry;var fe,be,_e,Be,Fe,He,ht,je,Je,nt;return function(fe,be,_e){let Be=1/0;Dd(_e,be)&&(Be=Sm(_e,be[0]));for(let Fe=0;Fe<be.length;Fe++){const He=be[Fe],ht=fe[Fe];for(let je=0;je<He.length-1;je++){const Je=He[je],nt=[Je,He[je+1],ht[je+1],ht[je],Je];Ed(_e,nt)&&(Be=Math.min(Be,Sm(_e,nt)))}}return Be!==1/0&&Be}(le,me,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends Ra{constructor(n){super(n,Bn),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if("line-gradient"===n){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof xa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=op.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Od(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new Ec(this,n)}queryRadius(n){const e=n,r=sp(Ic("line-width",this,e),Ic("line-gap-width",this,e)),a=Ic("line-offset",this,e);return r/2+Math.abs(a)+dl(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,a,h,m){if(n.queryGeometry.isAboveHorizon)return!1;const _=sm(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*sp(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),w=this.paint.get("line-offset").evaluate(e,r);return w&&(a=function(D,I){const A=[],P=new et(0,0);for(let F=0;F<D.length;F++){const z=D[F],H=[];for(let Y=0;Y<z.length;Y++){const le=z[Y-1],me=z[Y],ae=z[Y+1],fe=0===Y?P:me.sub(le)._unit()._perp(),be=Y===z.length-1?P:ae.sub(me)._unit()._perp(),_e=fe._add(be)._unit();_e._mult(1/(_e.x*be.x+_e.y*be.y)),H.push(_e._mult(I)._add(me))}A.push(H)}return A}(a,w*n.pixelToTileUnitsFactor)),function(D,I,A){for(let P=0;P<I.length;P++){const F=I[P];if(D.length>=3)for(let z=0;z<F.length;z++)if(Cc(D,F[z]))return!0;if(xh(D,F,A))return!0}return!1}(_,a,x)}isTileClipped(){return!0}},symbol:Ju,background:class extends Ra{constructor(n){super(n,og)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ra{constructor(n){super(n,q_)}getProgramIds(){return["raster"]}},sky:class extends Ra{constructor(n){super(n,id),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){"sky-gradient"===n?this._updateColorRamp():"sky-atmosphere-sun"!==n&&"sky-atmosphere-halo-color"!==n&&"sky-atmosphere-color"!==n&&"sky-atmosphere-sun-intensity"!==n||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if("atmosphere"===this.paint.get("sky-type")){const a=this.paint.get("sky-atmosphere-sun"),h=!a,m=n.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&mn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Dp(_.azimuthal,90-_.polar,e):Dp(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Dp(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return"atmosphere"===n?["skyboxCapture","skybox"]:"gradient"===n?["skyboxGradient"]:null}}};class od{constructor(e,r,a,h){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,h)}update(e,r,a){const{width:h,height:m}=e,{context:_}=this,{gl:x}=_,{HTMLImageElement:w,HTMLCanvasElement:D,HTMLVideoElement:I,ImageData:A,ImageBitmap:P}=Te;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!r||!1!==r.premultiply)),a||this.size&&this.size[0]===h&&this.size[1]===m){const{x:F,y:z}=a||{x:0,y:0};e instanceof w||e instanceof D||e instanceof I||e instanceof A||P&&e instanceof P?x.texSubImage2D(x.TEXTURE_2D,0,F,z,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,F,z,h,m,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[h,m],e instanceof w||e instanceof D||e instanceof I||e instanceof A||P&&e instanceof P?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,h,m,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class cv{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class X_{constructor(){this.tasks={},this.taskQueue=[],gi(["process"],this),this.invoker=new cv(this.process),this.nextId=0}add(e,r){const a=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-x:"maybePrepare"===m&&_?400-x:500:200-x:100-x}(r);if(0===h){Ki();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Ki();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<r&&(r=m.priority,e=h)}if(null===e)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Y_=["tile","layer","source","sourceLayer","state"];class ag{constructor(e,r,a,h,m){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=h,this.properties=e.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const r of Y_)void 0!==this[r]&&(e[r]=this[r]);return e}}const Bc=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,a=0,h=0,m=0,_=0,x=0;for(1&e?h=m=_=32:r=a=x=32;(e>>=1)>1;){const D=r+h>>1,I=a+m>>1;1&e?(h=r,m=a,r=_,a=x):(r=h,a=m,h=_,m=x),_=D,x=I}const w=4*n;Bc[w+0]=r,Bc[w+1]=a,Bc[w+2]=h,Bc[w+3]=m}const Ba=new Uint16Array(2178),ec=new Uint8Array(1089),lf=new Uint16Array(1089);function cf(n){return 0===n?-.03125:32===n?.03125:0}var lg=yt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cg={type:2,extent:hn,loadGeometry:()=>[[new et(0,0),new et(8193,0),new et(8193,8193),new et(0,8193),new et(0,0)]]};class Tp{constructor(e,r,a,h,m){this.tileID=e,this.uid=Gn(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Ln.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Ql(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const x of h){const w=x.layerIds.map(D=>m.getLayer(D)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(D=>w.filter(I=>I.id===D)[0]));for(const D of w)_[D.id]=x}}return _}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof za){if(this.hasSymbolBuckets=!0,!a)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof za&&m.hasRTLText){this.hasRTLText=!0,ge.isLoading()||ge.isLoaded()||"deferred"!==re()||pe();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new gd}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const h=this.buckets[a];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new od(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new od(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new od(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,h,m,_,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const h=a.loadVTLayers(),m=r?r.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const x=Vs(r&&r.filter),{z:w,x:D,y:I}=this.tileID.canonical,A={z:w,x:D,y:I};for(let P=0;P<_.length;P++){const F=_.feature(P);if(x.needGeometry){const Y=Tc(F,!0);if(!x.filter(new ue(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!x.filter(new ue(this.tileID.overscaledZ),F))continue;const z=a.getId(F,m),H=new ag(F,w,D,I,z);H.tile=A,e.push(H)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=Vi(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let h=!1;if(this.expirationTime>a)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const m=this.expirationTime-r;m?this.expirationTime=a+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),h=r.style.listImages();for(const m in this.buckets){if(!r.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=a[x],D=e[x];if(!w||!D||0===Object.keys(D).length)continue;if(_.update(D,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Od||_ instanceof Ah){const A=r.style._getSourceCache(_.layers[0].source);r._terrain&&r._terrain.enabled&&A&&_.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(A.id,this.tileID)}const I=r&&r.style&&r.style.getLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ln.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ln.now()+e}setTexture(e,r){const a=r.context,h=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new od(a,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),a.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax))}setDependencies(e,r){const a={};for(const h of r)a[h]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const h=this.dependencies[a];if(h)for(const m of r)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const a=La(cg,this.tileID.canonical,this.tileTransform)[0],h=new Mn,m=new fd;for(let _=0;_<a.length;_++){const{x,y:w}=a[_];h.emplaceBack(x,w),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(m),this._tileDebugBuffer=e.createVertexBuffer(h,Oc.members),this._tileDebugSegments=Ti.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const a=La(cg,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(x,w){const D=Ql(x,w),I=Math.pow(2,x.z);for(let Y=0;Y<33;Y++)for(let le=0;le<33;le++){const me=Zs((x.x+(le+cf(le))/32)/I),ae=Zi((x.y+(Y+cf(Y))/32)/I),fe=w.project(me,ae),be=33*Y+le;Ba[2*be+0]=Math.round((fe.x*D.scale-D.x)*hn),Ba[2*be+1]=Math.round((fe.y*D.scale-D.y)*hn)}ec.fill(0),lf.fill(0);for(let Y=2045;Y>=0;Y--){const le=4*Y,me=Bc[le+0],ae=Bc[le+1],fe=Bc[le+2],be=Bc[le+3],_e=me+fe>>1,Be=ae+be>>1,Fe=_e+Be-ae,He=Be+me-_e,ht=33*ae+me,je=33*be+fe,Je=33*Be+_e,nt=Math.hypot((Ba[2*ht+0]+Ba[2*je+0])/2-Ba[2*Je+0],(Ba[2*ht+1]+Ba[2*je+1])/2-Ba[2*Je+1])>=16;if(ec[Je]=ec[Je]||(nt?1:0),Y<1022){const at=33*(ae+He>>1)+(me+Fe>>1),pt=33*(be+He>>1)+(fe+Fe>>1);ec[Je]=ec[Je]||ec[at]||ec[pt]}}const A=new yr,P=new Vo;let F=0;function z(Y,le){const me=33*le+Y;return 0===lf[me]&&(A.emplaceBack(Ba[2*me+0],Ba[2*me+1],Y*hn/32,le*hn/32),lf[me]=++F),lf[me]-1}function H(Y,le,me,ae,fe,be){const _e=Y+me>>1,Be=le+ae>>1;if(Math.abs(Y-fe)+Math.abs(le-be)>1&&ec[33*Be+_e])H(fe,be,Y,le,_e,Be),H(me,ae,fe,be,_e,Be);else{const Fe=z(Y,le),He=z(me,ae),ht=z(fe,be);P.emplaceBack(Fe,He,ht)}}return H(0,0,32,32,32,0),H(32,32,0,0,0,32),{vertices:A,indices:P}}(this.tileID.canonical,r);h=_.vertices,m=_.indices}else{h=new yr,m=new Vo;for(const{x,y:w}of a)h.emplaceBack(x,w,0,0);const _=Wl.exports(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,lg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(m),this._tileBoundsSegments=Ti.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||"globe"!==a.name||r.freezeTileCoverage)return;const h=this.tileID.canonical,m=Jd(Xm(h,r)),_=Ku(r.zoom);let x;_>0&&(x=Cd(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,r,m,x,_),this._makeGlobeTileDebugTextBuffer(e,h,r,m,x,_)}_globePoint(e,r,a,h,m,_,x){let w=Mo(e,r,a);if(_){const D=1<<a.z,I=ka(h.center.lng),A=oa(h.center.lat),P=(a.x+.5)/D-I;let F=0;P>.5?F=-1:P<-.5&&(F=1);let z=(e/hn+a.x)/D+F,H=(r/hn+a.y)/D;z=(z-I)*h._pixelsPerMercatorPixel+I,H=(H-A)*h._pixelsPerMercatorPixel+A;const Y=[z*h.worldSize,H*h.worldSize,0];Tr(Y,Y,_),w=fu(w,Y,x)}return Tr(w,w,m)}_makeGlobeTileDebugBorderBuffer(e,r,a,h,m,_){const x=new Mn,w=new fd,D=new gr,I=(P,F,z,H,Y)=>{const le=(z-P)/(Y-1),me=(H-F)/(Y-1),ae=x.length;for(let fe=0;fe<Y;fe++){const be=P+fe*le,_e=F+fe*me;x.emplaceBack(be,_e);const Be=this._globePoint(be,_e,r,a,h,m,_);D.emplaceBack(Be[0],Be[1],Be[2]),w.emplaceBack(ae+fe)}},A=hn;I(0,0,A,0,16),I(A,0,A,A,16),I(A,A,0,A,16),I(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(x,Oc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(D,Wm.members),this._tileDebugSegments=Ti.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(e,r,a,h,m,_){const x=new Mn,w=new Vo,D=new gr,I=25;w.reserve(32),x.reserve(I),D.reserve(I);const A=(P,F)=>I*P+F;for(let P=0;P<I;P++){const F=2048*P;for(let z=0;z<I;z++){const H=2048*z;x.emplaceBack(H,F);const Y=this._globePoint(H,F,r,a,h,m,_);D.emplaceBack(Y[0],Y[1],Y[2])}}for(let P=0;P<4;P++)for(let F=0;F<4;F++){const z=A(P,F),H=A(P,F+1),Y=A(P+1,F),le=A(P+1,F+1);w.emplaceBack(z,H,Y),w.emplaceBack(Y,H,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(w),this._tileDebugTextBuffer=e.createVertexBuffer(x,Oc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,Wm.members),this._tileDebugTextSegments=Ti.simpleSegment(0,0,I,32)}}class K_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},gt(this.stateChanges[e][h],a),null===this.deletedStates[e]){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const m in this.state[e][h])a[m]||(this.deletedStates[e][h][m]=null)}else for(const m in a)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][m]&&delete this.deletedStates[e][h][m]}removeFeatureState(e,r,a){if(null===this.deletedStates[e])return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&void 0!==r)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][a]=null);else if(void 0!==r)if(this.stateChanges[e]&&this.stateChanges[e][h])for(a in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][a]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),h=gt({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const m=this.deletedStates[e][r];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),gt(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];a[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];m[_]=this.state[h][_]}a[h]=a[h]||{},gt(a[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(a).length)for(const h in e)e[h].setFeatureState(a,r)}}class ug{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function hg(n,e,r,a){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(r[_]<n[_]||r[_]>e[_])return null}else{const x=1/a[_];let w=(n[_]-r[_])*x,D=(e[_]-r[_])*x;if(w>D){const I=w;w=D,D=I}if(w>h&&(h=w),D<m&&(m=D),h>m)return null}return h}function dg(n,e,r,a,h,m,_,x,w,D,I){const A=a-n,P=h-e,F=m-r,z=_-n,H=x-e,Y=w-r,le=I[1]*Y-I[2]*H,me=I[2]*z-I[0]*Y,ae=I[0]*H-I[1]*z,fe=A*le+P*me+F*ae;if(Math.abs(fe)<1e-15)return null;const be=1/fe,_e=D[0]-n,Be=D[1]-e,Fe=D[2]-r,He=(_e*le+Be*me+Fe*ae)*be;if(He<0||He>1)return null;const ht=Be*F-Fe*P,je=Fe*A-_e*F,Je=_e*P-Be*A,nt=(I[0]*ht+I[1]*je+I[2]*Je)*be;return nt<0||He+nt>1?null:(z*ht+H*je+Y*Je)*be}function Cp(n,e,r){return(n-e)/(r-e)}function Ip(n,e,r,a,h,m,_,x,w){const D=1<<r,I=m-a,A=_-h,P=(n+1)/D*I+a,F=(e+0)/D*A+h,z=(e+1)/D*A+h;x[0]=(n+0)/D*I+a,x[1]=F,w[0]=P,w[1]=z}class fg{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,_));const D=1/w,I=(F,z,H,Y,le)=>{const me=Y?1:0,ae=(F+1)*H-me,fe=z*H,be=(z+1)*H-me;le[0]=F*H,le[1]=fe,le[2]=ae,le[3]=be};let A=new ug(w);const P=[];for(let F=0;F<w*w;F++){I(F%w,Math.floor(F/w),D,!1,P);const z=tc(P[0],P[1],m),H=tc(P[2],P[1],m),Y=tc(P[2],P[3],m),le=tc(P[0],P[3],m);A.minimums.push(Math.min(z,H,Y,le)),A.maximums.push(Math.max(z,H,Y,le)),A.leaves.push(1)}for(x.push(A),w/=2;w>=1;w/=2){const F=x[x.length-1];A=new ug(w);for(let z=0;z<w*w;z++){I(z%w,Math.floor(z/w),2,!0,P);const H=F.getElevation(P[0],P[1]),Y=F.getElevation(P[2],P[1]),le=F.getElevation(P[2],P[3]),me=F.getElevation(P[0],P[3]),ae=F.isLeaf(P[0],P[1]),fe=F.isLeaf(P[2],P[1]),be=F.isLeaf(P[2],P[3]),_e=F.isLeaf(P[0],P[3]),Be=Math.min(H.min,Y.min,le.min,me.min),Fe=Math.max(H.max,Y.max,le.max,me.max),He=ae&&fe&&be&&_e;A.maximums.push(Fe),A.minimums.push(Be),A.leaves.push(Fe-Be<=5&&He?1:0)}x.push(A)}return x}(this.dem),a=r.length-1,h=r[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,h,m,_,x=1){return hg([e,r,-100],[a,h,this.maximums[0]*x],m,_)}raycast(e,r,a,h,m,_,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,r,a,h,m,_,x);if(null==w)return null;const D=[],I=[],A=[],P=[],F=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:z,t:H,nodex:Y,nodey:le,depth:me}=F.pop();if(this.leaves[z]){Ip(Y,le,me,e,r,a,h,A,P);const fe=1<<me,be=(Y+0)/fe,_e=(Y+1)/fe,Be=(le+0)/fe,Fe=(le+1)/fe,He=tc(be,Be,this.dem)*x,ht=tc(_e,Be,this.dem)*x,je=tc(_e,Fe,this.dem)*x,Je=tc(be,Fe,this.dem)*x,nt=dg(A[0],A[1],He,P[0],A[1],ht,P[0],P[1],je,m,_),at=dg(P[0],P[1],je,A[0],P[1],Je,A[0],A[1],He,m,_),pt=Math.min(null!==nt?nt:Number.MAX_VALUE,null!==at?at:Number.MAX_VALUE);if(pt!==Number.MAX_VALUE)return pt;{const Ze=Dh([],m,_,H);if(J_(He,ht,Je,je,Cp(Ze[0],A[0],P[0]),Cp(Ze[1],A[1],P[1]))>=Ze[2])return H}continue}let ae=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Ip((Y<<1)+this._siblingOffset[fe][0],(le<<1)+this._siblingOffset[fe][1],me+1,e,r,a,h,A,P),A[2]=-100,P[2]=this.maximums[this.childOffsets[z]+fe]*x;const be=hg(A,P,m,_);if(null!=be){const _e=be;D[fe]=_e;let Be=!1;for(let Fe=0;Fe<ae&&!Be;Fe++)_e>=D[I[Fe]]&&(I.splice(Fe,0,fe),Be=!0);Be||(I[ae]=fe),ae++}}for(let fe=0;fe<ae;fe++){const be=I[fe];F.push({idx:this.childOffsets[z]+be,t:D[be],nodex:(Y<<1)+this._siblingOffset[be][0],nodey:(le<<1)+this._siblingOffset[be][1],depth:me+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,h,m){if(1===e[h].isLeaf(r,a))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,x=e[_];let w=0,D=0;for(let I=0;I<this._siblingOffset.length;I++){const A=2*r+this._siblingOffset[I][0],P=2*a+this._siblingOffset[I][1],F=x.getElevation(A,P),z=x.isLeaf(A,P),H=this._addNode(F.min,F.max,z);z&&(w|=1<<I),D||(D=H)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*r+this._siblingOffset[I][0],2*a+this._siblingOffset[I][1],_,D+I)}}function J_(n,e,r,a,h,m){return Dn(Dn(n,r,m),Dn(e,a,m),h)}function tc(n,e,r){const a=r.dim,h=Ie(n*a-.5,0,a-1),m=Ie(e*a-.5,0,a-1),_=Math.floor(h),x=Math.floor(m),w=Math.min(_+1,a-1),D=Math.min(x+1,a-1);return J_(r.get(_,x),r.get(w,x),r.get(_,D),r.get(w,D),h-_,m-x)}const sd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class bl{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,h=!1,m=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&"mapbox"!==a&&"terrarium"!==a)return mn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const _=this.dim=r.height-2,x=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=h,!h){for(let w=0;w<_;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(_,w)]=x[this._idx(_-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,_)]=x[this._idx(w,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new fg(this)}get(e,r,a=!1){a&&(e=Ie(e,-1,this.dim),r=Ie(r,-1,this.dim));const h=4*this._idx(e,r);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return sd[e]}get unpackVector(){return sd[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,a){return(256*e*256+256*r+a)/10-1e4}_unpackTerrarium(e,r,a){return 256*e+r+a/256-32768}static pack(e,r){const a=[0,0,0,0],h=bl.getUnpackVector(r);let m=Math.floor((e+h[3])/h[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new bs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,m=r*this.dim+this.dim,_=a*this.dim,x=a*this.dim+this.dim;switch(r){case-1:h=m-1;break;case 1:m=h+1}switch(a){case-1:_=x-1;break;case 1:x=_+1}const w=-r*this.dim,D=-a*this.dim;for(let I=_;I<x;I++)for(let A=h;A<m;A++){const P=4*this._idx(A,I),F=4*this._idx(A+w,I+D);this.pixels[P+0]=e.pixels[F+0],this.pixels[P+1]=e.pixels[F+1],this.pixels[P+2]=e.pixels[F+2],this.pixels[P+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}St(bl,"DEMData"),St(fg,"DemMinMaxQuadTree",{omit:["dem"]});class uv{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:r,timeout:void 0};if(void 0!==a&&(m.timeout=setTimeout(()=>{this.remove(e,m)},a)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,h=void 0===r?0:this.data[a].indexOf(r),m=this.data[a][h];return this.data[a].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const h of this.data[a])e(h.value)||r.push(h);for(const a of r)this.remove(a.value.tileID,a)}}class wl{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}wl.ReadOnly=!1,wl.ReadWrite=!0,wl.disabled=new wl(519,wl.ReadOnly,[0,1]);class Mp{constructor(e,r,a,h,m,_){this.test=e,this.ref=r,this.mask=a,this.fail=h,this.depthFail=m,this.pass=_}}Mp.disabled=new Mp({func:519,mask:0},0,0,7680,7680,7680);class pa{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}pa.Replace=[1,0],pa.disabled=new pa(pa.Replace,Wn.transparent,[!1,!1,!1,!1]),pa.unblended=new pa(pa.Replace,Wn.transparent,[!0,!0,!0,!0]),pa.alphaBlended=new pa([1,771],Wn.transparent,[!0,!0,!0,!0]);class os{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}os.disabled=new os(!1,1029,2305),os.backCCW=new os(!0,1029,2305),os.backCW=new os(!0,1029,2304),os.frontCW=new os(!0,1028,2304),os.frontCCW=new os(!0,1028,2305);class Ci extends mo{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new uv(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new K_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Dt(this._tiles).map(e=>e.tileID).sort(Nc).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,h)=>{const m=a.tileID,_=h.tileID,x=new et(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new et(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(Nc).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&("loading"!==a.state&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new po(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ln.now(),"expired"===a&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new qn("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const m=r[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const _=this.getTileByID(m);a(e,_),a(_,e)}}function a(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const x=m.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),D=m.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,x),h.neighboringTiles&&h.neighboringTiles[D]&&(h.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=r||_.tileID.overscaledZ>a)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>r+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(x=D)}let w=x;for(;w.overscaledZ>r;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){h[x.key]=x;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const h=e.scaledTo(a),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,h=Math.ceil(e.height/r)+1,m=Math.floor(a*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(e){const r=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+r),a[m.tileID.key]=m}this._tiles=a;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let h;this.updateCacheSize(e,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new So(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const m=this._updateRetainedTiles(h);if(ad(this._source.type)&&0!==h.length){const x={},w={},D=Object.keys(m);for(const A of D){const P=m[A],F=this._tiles[A];if(!F||F.fadeEndTime&&F.fadeEndTime<=Ln.now())continue;const z=this.findLoadedParent(P,Math.max(P.overscaledZ-Ci.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),x[z.tileID.key]=z.tileID),w[A]=P}const I=h[h.length-1].overscaledZ;for(const A in this._tiles){const P=this._tiles[A];if(m[A]||!P.hasData())continue;let F=P.tileID;for(;F.overscaledZ>I;){F=F.scaledTo(F.overscaledZ-1);const z=this._tiles[F.key];if(z&&z.hasData()&&w[F.key]){m[A]=P.tileID;break}}}for(const A in x)m[A]||(this._coveredTiles[A]=!0,m[A]=x[A])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,w){const D=[];for(const I in x)I in w||D.push(I);return D}(this._tiles,m);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(0===e.length)return r;const a={},h=e.reduce((D,I)=>Math.min(D,I.overscaledZ),1/0),m=e[0].overscaledZ,_=Math.max(m-Ci.maxOverzooming,this._source.minzoom),x=Math.max(m+Ci.maxUnderzooming,this._source.minzoom),w={};for(const D of e){const I=this._addTile(D);r[D.key]=D,I.hasData()||h<this._source.maxzoom&&(w[D.key]=D)}this._retainLoadedChildren(w,h,x,r);for(const D of e){let I=this._tiles[D.key];if(I.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const P=D.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){r[P.key]=P;continue}}else{const P=D.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let A=I.wasRequested();for(let P=D.overscaledZ-1;P>=_;--P){const F=D.scaledTo(P);if(a[F.key]||(a[F.key]=!0,I=this.getTile(F),!I&&A&&(I=this._addTile(F)),I&&(r[F.key]=F,A=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}r.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(m),a)break;h=m}for(const m of r)this._loadedParentTiles[m]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=Boolean(r);if(!a){const h=this.map?this.map.painter:null;r=new Tp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new qn("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const h=[],m=this.transform;if(!m)return h;const _="globe"===m.projection.name,x=ka(m.center.lng);for(const w in this._tiles){const D=this._tiles[w];if(a&&D.clearQueryDebugViz(),D.holdingForFade())continue;let I;if(_){const A=D.tileID.canonical;if(0===A.z){const P=[Math.abs(Ie(x,...Zo(A,-1))-x),Math.abs(Ie(x,...Zo(A,1))-x)];I=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(Ie(x,...Zo(A,-1))-x),Math.abs(Ie(x,...Zo(A,0))-x),Math.abs(Ie(x,...Zo(A,1))-x)];I=[P.indexOf(Math.min(...P))-1]}}else I=[0];for(const A of I){const P=e.containsTile(D,m,r,A);P&&h.push(P)}}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(ad(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=Ln.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const h=this._tiles[e];h&&h.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){const a=new Map,h=Array.isArray(e)?e:[e],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of h){const w=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of w)a.set(D.key,D);this.usedForTerrain&&x.updateElevation(!1)}Ve(Array.from(a.values()),(x,w)=>{const D=new Tp(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,I=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),w(I,D)})},r)}}function Nc(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function ad(n){return"raster"===n||"image"===n||"video"===n||"custom"===n}function Zo(n,e){const r=1<<n.z;return[n.x/r+e,(n.x+1)/r+e]}Ci.maxOverzooming=10,Ci.maxUnderzooming=3;class Qu{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const h=a||e.findDEMTileFor(r);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,x=1<<r.canonical.z-_.canonical.z;return new Qu(h,h.tileSize/hn/x,[(r.canonical.x/x-_.canonical.x)*m.dim,(r.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(a);return new et(h,m)}getElevationAt(e,r,a,h){const m=e*this._scale+this._offset[0],_=r*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(_),D=this._dem;return h=!!h,a?Dn(Dn(D.get(x,w,h),D.get(x,w+1,h),_-w),Dn(D.get(x+1,w,h),D.get(x+1,w+1,h),_-w),m-x):D.get(x,w,h)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*sa(1,e)*this._dem.stride}}class _u{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ll(hn,16,0),this.featureIndexArray=new Yp,this.promoteId=r}insert(e,r,a,h,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,m,_);const w=this.grid;for(let D=0;D<r.length;D++){const I=r[D],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){const F=I[P];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<hn&&A[1]<hn&&A[2]>=0&&A[3]>=0&&w.insert(x,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new np(new zd(this.rawTileData)).layers,this.sourceLayerCoder=new sg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,h){this.loadVTLayers();const m=e.params||{},_=Vs(m.filter),x=e.tileResult,w=e.transform,D=x.bufferedTilespaceBounds,I=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(z,H,Y,le)=>Of(x.bufferedTilespaceGeometry,z,H,Y,le));I.sort(eh);let A=null;w.elevation&&I.length>0&&(A=Qu.create(w.elevation,this.tileID));const P={};let F;for(let z=0;z<I.length;z++){const H=I[z];if(H===F)continue;F=H;const Y=this.featureIndexArray.get(H);let le=null;this.loadMatchingFeature(P,Y,_,m.layers,m.availableImages,r,a,h,(me,ae,fe,be=0)=>(le||(le=La(me,this.tileID.canonical,e.tileTransform)),ae.queryIntersectsFeature(x,me,fe,le,this.z,e.transform,e.pixelPosMatrix,A,be)))}return P}loadMatchingFeature(e,r,a,h,m,_,x,w,D){const{featureIndex:I,bucketIndex:A,sourceLayerIndex:P,layoutVertexArrayOffset:F}=r,z=this.bucketLayerIDs[A];if(h&&!function(me,ae){for(let fe=0;fe<me.length;fe++)if(ae.indexOf(me[fe])>=0)return!0;return!1}(h,z))return;const H=this.sourceLayerCoder.decode(P),Y=this.vtLayers[H].feature(I);if(a.needGeometry){const me=Tc(Y,!0);if(!a.filter(new ue(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!a.filter(new ue(this.tileID.overscaledZ),Y))return;const le=this.getId(Y,H);for(let me=0;me<z.length;me++){const ae=z[me];if(h&&h.indexOf(ae)<0)continue;const fe=_[ae];if(!fe)continue;let be={};void 0!==le&&w&&(be=w.getState(fe.sourceLayer||"_geojsonTileLayer",le));const _e=gt({},x[ae]);_e.paint=yu(_e.paint,fe.paint,Y,be,m),_e.layout=yu(_e.layout,fe.layout,Y,be,m);const Be=!D||D(Y,fe,be,F);if(!Be)continue;const Fe=new ag(Y,this.z,this.x,this.y,le);Fe.layer=_e;let He=e[ae];void 0===He&&(He=e[ae]=[]),He.push({featureIndex:I,feature:Fe,intersectionZ:Be})}}lookupSymbolFeatures(e,r,a,h,m,_,x,w){const D={};this.loadVTLayers();const I=Vs(m);for(const A of e)this.loadMatchingFeature(D,{bucketIndex:a,sourceLayerIndex:h,featureIndex:A,layoutVertexArrayOffset:0},I,_,x,w,r);return D}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),m=this.vtFeatures[h];if(m[r])return m[r];const _=this.vtLayers[h].feature(r);return m[r]=_,_}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[r];null!=h&&(a=e.properties[h]),"boolean"==typeof a&&(a=Number(a))}return a}}function yu(n,e,r,a,h){return hr(n,(m,_)=>{const x=e instanceof Ke?e.get(_):null;return x&&x.evaluate?x.evaluate(r,a,h):x})}function eh(n,e){return e-n}St(_u,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class vu{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ql({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=en(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const h=[];let m=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,x=!0;h.push({left:m,right:_,isDash:x,zeroLength:0===e[0]});let w=e[0];for(let D=1;D<e.length;D++){x=!x;const I=e[D];m=w*a,w+=I,_=w*a,h.push({left:m,right:_,isDash:x,zeroLength:0===I})}return h}addRoundDash(e,r,a){const h=r/2;for(let m=-a;m<=a;m++){const _=this.width*(this.nextRow+a+m);let x=0,w=e[x];for(let D=0;D<this.width;D++){D/w.right>1&&(w=e[++x]);const I=Math.abs(D-w.left),A=Math.abs(D-w.right),P=Math.min(I,A);let F;const z=m/a*(h+1);if(w.isDash){const H=h-Math.abs(z);F=Math.sqrt(P*P+H*H)}else F=h-Math.sqrt(P*P+z*z);this.image.data[_+D]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,r){for(let w=e.length-1;w>=0;--w){const D=e[w],I=e[w+1];D.zeroLength?e.splice(w,1):I&&I.isDash===D.isDash&&(I.left=D.left,e.splice(w,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const m=this.width*this.nextRow;let _=0,x=e[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++_]);const D=Math.abs(w-x.left),I=Math.abs(w-x.right),A=Math.min(D,I);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?A:-A)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const h="round"===r,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return mn("LineAtlas out of space"),null;0===e.length&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(mn("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(0!==x){const I=this.width/x,A=this.getDashRanges(e,this.width,I);h?this.addRoundDash(A,I,m):this.addRegularDash(A,"square"===r?.5*I:0)}const w=this.nextRow+m;this.nextRow+=_;const D={tl:[w,m],br:[x,0]};return this.positions[a]=D,D}}St(vu,"LineAtlas");class xu{constructor(e){const r={},a=[];for(const x in e){const w=e[x],D=r[x]={};for(const I in w.glyphs){const A=w.glyphs[+I];if(!A||0===A.bitmap.width||0===A.bitmap.height)continue;const P=A.metrics.localGlyph?2:1,F={x:0,y:0,w:A.bitmap.width+2*P,h:A.bitmap.height+2*P};a.push(F),D[I]=F}}const{w:h,h:m}=zm(a),_=new ql({width:h||1,height:m||1});for(const x in e){const w=e[x];for(const D in w.glyphs){const I=w.glyphs[+D];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const A=r[x][D],P=I.metrics.localGlyph?2:1;ql.copy(I.bitmap,_,{x:0,y:0},{x:A.x+P,y:A.y+P},I.bitmap)}}this.image=_,this.positions=r}}St(xu,"GlyphAtlas");class th{constructor(e){this.tileID=new So(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ql(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,h,m){this.status="parsing",this.data=e,this.collisionBoxArray=new gd;const _=new sg(Object.keys(e.layers).sort()),x=new _u(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},D=new vu(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:a},A=r.familiesBySource[this.source];for(const be in A){const _e=e.layers[be];if(!_e)continue;let Be=!1,Fe=!1;for(const je of A[be])"symbol"===je[0].type?Be=!0:Fe=!0;if(!0===this.isSymbolTile&&!Be||!1===this.isSymbolTile&&!Fe)continue;1===_e.version&&mn(`Vector tile source "${this.source}" layer "${be}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const He=_.encode(be),ht=[];for(let je=0;je<_e.length;je++){const Je=_e.feature(je),nt=x.getId(Je,be);ht.push({feature:Je,id:nt,index:je,sourceLayerIndex:He})}for(const je of A[be]){const Je=je[0];void 0!==this.isSymbolTile&&"symbol"===Je.type!==this.isSymbolTile||Je.minzoom&&this.zoom<Math.floor(Je.minzoom)||Je.maxzoom&&this.zoom>=Je.maxzoom||"none"!==Je.visibility&&(Uc(je,this.zoom,a),(w[Je.id]=Je.createBucket({index:x.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:He,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(ht,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(je.map(nt=>nt.id)))}}let P,F,z,H;D.trim();const Y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},le=hr(I.glyphDependencies,be=>Object.keys(be).map(Number));Object.keys(le).length?h.send("getGlyphs",{uid:this.uid,stacks:le},(be,_e)=>{P||(P=be,F=_e,fe.call(this))},void 0,!1,Y):F={};const me=Object.keys(I.iconDependencies);me.length?h.send("getImages",{icons:me,source:this.source,tileID:this.tileID,type:"icons"},(be,_e)=>{P||(P=be,z=_e,fe.call(this))},void 0,!1,Y):z={};const ae=Object.keys(I.patternDependencies);function fe(){if(P)return m(P);if(F&&z&&H){const be=new xu(F),_e=new up(z,H);for(const Be in w){const Fe=w[Be];Fe instanceof za?(Uc(Fe.layers,this.zoom,a),$m(Fe,F,be.positions,z,_e.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Fe.hasPattern&&(Fe instanceof Od||Fe instanceof Ah||Fe instanceof Fh)&&(Uc(Fe.layers,this.zoom,a),Fe.addFeatures(I,this.tileID.canonical,_e.patternPositions,a,this.tileTransform))}this.status="done",m(null,{buckets:Dt(w).filter(Be=>!Be.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:be.image,lineAtlas:D,imageAtlas:_e,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?be.positions:null})}}ae.length?h.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"patterns"},(be,_e)=>{P||(P=be,H=_e,fe.call(this))},void 0,!1,Y):H={},fe.call(this)}}function Uc(n,e,r){const a=new ue(e);for(const h of n)h.recalculate(a,r)}class bu{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,h){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},r):h(_,x),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=a((_,x)=>{m.result=[_,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,x)},r):w(_,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function wu(n,e,r){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},h=>{const m=Zn(n.request,(_,x,w,D)=>{_?h(_):x&&h(null,{vectorTile:r?void 0:new np(new zd(x)),rawData:x,cacheControl:w,expires:D})});return()=>{m.cancel(),h()}},e)}u.ARRAY_TYPE=xs,u.AUTH_ERR_MSG=Rn,u.Aabb=Io,u.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},gi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ki()?n:Te,this.scheduler=new X_}send(n,e,r,a,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=m,this.callbacks[_]=r);const x=Ar(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:n,hasCallback:!!r,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Ia(e,x)},x),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||Ki()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if("<response>"===e.type){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(Ei(e.error)):r(null,Ei(e.data)))}else{const r=Ar(this.globalScope)?void 0:[],a=e.hasCallback?(m,_)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?Ia(m):null,data:Ia(_,r)},r)}:m=>{},h=Ei(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,a);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],h.source)[m[1]](h,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=zh,u.Color=Wn,u.ColorMode=pa,u.CullFaceMode=os,u.DEMData=bl,u.DataConstantProperty=ke,u.DedupedRequest=bu,u.DepthMode=wl,u.EXTENT=hn,u.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,h=Math.floor(n.x),m=Math.floor((n.x-h)*a),_=Math.floor(n.y*a),x=this.findDEMTileFor(new So(r,h,r,m,_));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const h=a.getSource().maxzoom,m=1<<h,_=Math.floor(n.x),x=n.x-_,w=new So(h,_,h,Math.floor(x*m),Math.floor(n.y*m)),D=this.findDEMTileFor(w);if(!D||!D.dem)return e;const I=D.dem,A=1<<D.tileID.canonical.z,P=(x*A-D.tileID.canonical.x)*I.dim,F=(n.y*A-D.tileID.canonical.y)*I.dim,z=Math.floor(P),H=Math.floor(F);return(r?this.exaggeration():1)*Dn(Dn(I.get(z,H),I.get(z,H+1),F-H),Dn(I.get(z+1,H),I.get(z+1,H+1),F-H),P-z)}getAtTileOffset(n,e,r){const a=1<<n.canonical.z;return this.getAtPointOrZero(new nu(n.wrap+(n.canonical.x+e/hn)/a,(n.canonical.y+r/hn)/a))}getAtTileOffsetFunc(n,e,r,a){return h=>{const m=this.getAtTileOffset(n,h.x,h.y),_=a.upVector(n.canonical,h.x,h.y);return qs(_,_,m*a.upVectorScale(n.canonical,e,r).metersToTile),_}}getForTilePoints(n,e,r,a){if(this.isUsingMockSource())return!1;const h=Qu.create(this,n,a);return!!h&&(e.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,h=1<<n.canonical.z-a.canonical.z;let m=n.canonical.x/h-a.canonical.x,_=n.canonical.y/h-a.canonical.y,x=0;for(let w=0;w<n.canonical.z-a.canonical.z&&!r.leaves[x];w++){m*=2,_*=2;const D=2*Math.floor(_)+Math.floor(m);x=r.childOffsets[x]+D,m%=1,_%=1}return{min:this.exaggeration()*r.minimums[x],max:this.exaggeration()*r.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=po,u.EvaluationParameters=ue,u.Event=qn,u.Evented=mo,u.FillExtrusionBucket=Fh,u.Frustum=jf,u.FrustumCorners=Uf,u.GLOBE_METERS_TO_ECEF=qh,u.GLOBE_RADIUS=Es,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GLOBE_ZOOM_THRESHOLD_MIN=5,u.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_createGrid(n){const e=new Mn,r=new Vo,a=65;for(let h=0;h<a;h++)for(let m=0;m<a;m++)e.emplaceBack(m,h);this._gridSegments=[];for(let h=0,m=0;h<Fc.length;h++){const _=Fc[h];for(let w=0;w<_;w++)for(let D=0;D<64;D++){const I=w*a+D;r.emplaceBack(I+1,I,I+a),r.emplaceBack(I+a,I+a+1,I+1)}const x=64*_*2;this._gridSegments.push(Ti.simpleSegment(0,m,(_+1)*a,x)),m+=x}this._gridBuffer=n.createVertexBuffer(e,Oc.members),this._gridIndexBuffer=n.createIndexBuffer(r,!0)}_createPoles(n){const e=new Vo;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new Aa,a=new Aa;this._poleSegments=[];for(let h=0,m=0;h<5;h++){const _=360/(1<<h);r.emplaceBack(0,-Es,0,.5,0),a.emplaceBack(0,-Es,0,.5,1);for(let x=0;x<=64;x++){const w=x/64,D=Dn(0,_,w),[I,A,P]=Yu(Qm,U_,D,Es);r.emplaceBack(I,A,P,w,0),a.emplaceBack(I,A,P,w,1)}this._poleSegments.push(Ti.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,qm,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,qm,!1)}getGridBuffers(n){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[n]]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const r=new ia,a=64,h=a+1;this._wireframeSegments=[];for(let m=0,_=0;m<Fc.length;m++){const x=Fc[m];for(let D=0;D<x;D++)for(let I=0;I<a;I++){const A=D*h+I;r.emplaceBack(A,A+1),r.emplaceBack(A,A+h),r.emplaceBack(A,A+h+1)}const w=x*a*3;this._wireframeSegments.push(Ti.simpleSegment(0,_,(x+1)*h,w)),_+=w}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},u.GlyphManager=Xu,u.ImagePosition=kc,u.LivePerformanceUtils=ee,u.LngLat=ar,u.LngLatBounds=Dc,u.LocalGlyphMode=qd,u.MAX_MERCATOR_LATITUDE=$o,u.MercatorCoordinate=nu,u.ONE_EM=24,u.OverscaledTileID=So,u.PerformanceMarkers=Q,u.Properties=_t,u.RGBAImage=bs,u.Ray=Nf,u.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ht,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!di(n))return n;const r=ii(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!di(n))return n;const r=ii(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e,r,a){if(!di(n))return n;const h=ii(n);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),r&&h.params.push(`language=${r}`),a&&h.params.push(`worldview=${a}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,a){const h=ii(n);return di(n)?(h.path=`/styles/v1${h.path}/sprite${e}${r}`,this._makeAPIURL(h,this._customAccessToken||a)):(h.path+=`${e}${r}`,ki(h))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!di(n))return n;const a=ii(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==a.authority&&512===r?"@2x":""}${vt.supported?".webp":"$1"}`),"raster"===a.authority?a.path=`/${At.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${At.TILE_URL_VERSION}${a.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(a.params)||At.ACCESS_TOKEN;return At.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,h)}canonicalizeTileURL(n,e){const r=ii(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${At.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${At.TILE_URL_VERSION}/`,"")}`;let h=r.params;return e&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(a+=`?${h.join("&")}`),a}canonicalizeTileset(n,e){const r=!!e&&di(e),a=[];for(const h of n.tiles||[])Ri(h)?a.push(this.canonicalizeTileURL(h,r)):a.push(h);return a}_makeAPIURL(n,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",a=ii(At.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,"http"===n.protocol){const h=n.params.indexOf("secure");h>=0&&n.params.splice(h,1)}if("/"!==a.path&&(n.path=`${a.path}${n.path}`),!At.REQUIRE_ACCESS_TOKEN)return ki(n);if(e=e||At.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(h=>-1===h.indexOf("access_token")),n.params.push(`access_token=${e||""}`),ki(n)}},u.ResourceType=ut,u.SegmentVector=Ti,u.SourceCache=Ci,u.StencilMode=Mp,u.StructArrayLayout1ui2=fd,u.StructArrayLayout2f1f2i16=jo,u.StructArrayLayout2i4=Mn,u.StructArrayLayout2ui4=ia,u.StructArrayLayout3f12=ts,u.StructArrayLayout3ui6=Vo,u.StructArrayLayout4i8=yr,u.StructArrayLayout5f20=Aa,u.Texture=od,u.Tile=Tp,u.Transitionable=Ue,u.Uniform1f=mh,u.Uniform1i=class extends $l{constructor(n){super(n),this.current=0}set(n,e,r){this.fetchUniformLocation(n,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},u.Uniform2f=class extends $l{constructor(n){super(n),this.current=[0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},u.Uniform3f=class extends $l{constructor(n){super(n),this.current=[0,0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},u.Uniform4f=em,u.UniformColor=Ef,u.UniformMatrix2f=class extends $l{constructor(n){super(n),this.current=Df}set(n,e,r){if(this.fetchUniformLocation(n,e))for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}},u.UniformMatrix3f=class extends $l{constructor(n){super(n),this.current=Lg}set(n,e,r){if(this.fetchUniformLocation(n,e))for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},u.UniformMatrix4f=class extends $l{constructor(n){super(n),this.current=kg}set(n,e,r){if(this.fetchUniformLocation(n,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},u.UnwrappedTileID=Im,u.ValidationError=Tt,u.VectorTileFeature=Zu,u.VectorTileWorkerSource=class extends mo{constructor(n,e,r,a,h){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=h||wu,this.loading={},this.loaded={},this.deduped=new bu(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,a=n&&n.request,h=a&&a.collectResourceTiming,m=this.loading[r]=new th(n);m.abort=this.loadVectorData(n,(_,x)=>{const w=!this.loading[r];if(delete this.loading[r],w||_||!x)return m.status="done",w||(this.loaded[r]=m),e(_);const D=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new np(new zd(D));const A=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,F)=>{if(P||!F)return e(P);const z={};if(h){const H=Re(a);H.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(H)))}e(null,gt({rawTileData:D.slice(0)},F,I,z))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[r]=m})}reloadTile(n,e){const r=this.loaded,a=n.uid,h=this;if(r&&r[a]){const m=r[a];m.showCollisionBoxes=n.showCollisionBoxes,m.enableTerrain=!!n.enableTerrain,m.projection=n.projection,m.tileTransform=Ql(n.tileID.canonical,n.projection);const _=(x,w)=>{const D=m.reloadCallback;D&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,D)),e(x,w)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(n,e){const r=n.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,a=n.uid;r&&r[a]&&delete r[a],e()}},u.WritingMode=ws,u.ZoomHistory=vc,u.add=Mc,u.addDynamicAttributes=nd,u.adjoint=function(n,e){var r=e[0],a=e[1],h=e[2],m=e[3],_=e[4],x=e[5],w=e[6],D=e[7],I=e[8];return n[0]=_*I-x*D,n[1]=h*D-a*I,n[2]=a*x-h*_,n[3]=x*w-m*I,n[4]=r*I-h*w,n[5]=h*m-r*x,n[6]=m*D-_*w,n[7]=a*w-r*D,n[8]=r*_-a*m,n},u.asyncAll=Ve,u.bezier=st,u.bindAll=gi,u.boundsAttributes=lg,u.bufferConvexPolygon=function(n,e){const r=[];for(let a=0;a<n.length;a++){const h=Ye(a-1,-1,n.length-1),m=Ye(a+1,-1,n.length-1),_=n[a],x=n[m],w=n[h].sub(_).unit(),D=x.sub(_).unit(),I=D.angleWithSep(w.x,w.y),A=w.add(D).unit().mult(-1*e/Math.sin(I/2));r.push(_.add(A))}return r},u.cacheEntryPossiblyAdded=function(n){ur++,ur>ss&&(n.getActor().send("enforceCacheSizeLimit",Is),ur=0)},u.calculateGlobeLabelMatrix=function(n,e){const{x:r,y:a}=n.point,h=wp(r,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return ou(h,h,Kh(da(e)))},u.calculateGlobeMatrix=function(n){const{x:e,y:r}=n.point,{lng:a,lat:h}=n._center;return wp(e,r,n.worldSize,a,h)},u.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,r=e/sa(1,n.center.lat),a=aa(new Float64Array(16));return Bu(a,a,[n.point.x,n.point.y,0]),Sc(a,a,[r,r,e]),Float32Array.from(a)},u.circumferenceAtLatitude=vh,u.clamp=Ie,u.clearTileCache=function(n){if(!Ji())return;const e=Te.caches.delete(Jr);n&&e.catch(n).then(()=>n())},u.clipLine=O_,u.clone=function(n){var e=new xs(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},u.clone$1=cr,u.collisionCircleLayout=v_,u.config=At,u.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},u.create=function(){var n=new xs(16);return xs!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},u.create$1=Ff,u.createExpression=nr,u.createLayout=yt,u.createStyleLayer=function(n){return"custom"===n.type?new W_(n):new lv[n.type](n)},u.cross=Th,u.degToRad=qe,u.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},u.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},u.dot=la,u.earthRadius=xd,u.ease=kt,u.easeCubicInOut=tn,u.ecefToLatLng=function([n,e,r]){const a=Math.hypot(n,e,r),h=Math.atan2(n,r),m=.5*Math.PI-Math.acos(-e/a);return new ar(Yt(h),Yt(m))},u.emitValidationErrors=Jc,u.endsWith=kn,u.enforceCacheSizeLimit=function(n){_i(),Pr&&Pr.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-n;a++)e.delete(r[a])})})},u.evaluateSizeForFeature=Nh,u.evaluateSizeForZoom=ua,u.evaluateVariableOffset=Vm,u.evented=se,u.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},u.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},u.exported=Ln,u.exported$1=vt,u.extend=gt,u.extend$1=Qi,u.fillExtrusionHeightLift=l_,u.filterObject=ui,u.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},u.fromQuat=function(n,e){var r=e[0],a=e[1],h=e[2],m=e[3],_=r+r,x=a+a,w=h+h,D=r*_,I=a*_,A=a*x,P=h*_,F=h*x,z=h*w,H=m*_,Y=m*x,le=m*w;return n[0]=1-A-z,n[1]=I+le,n[2]=P-Y,n[3]=0,n[4]=I-le,n[5]=1-D-z,n[6]=F+H,n[7]=0,n[8]=P+Y,n[9]=F-H,n[10]=1-D-A,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},u.fromRotation=function(n,e){var r=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=r,n[2]=0,n[3]=-r,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},u.fromScaling=lm,u.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Pt[e]},u.getAABBPointSquareDist=function(n,e,r){let a=0;for(let h=0;h<2;++h){const m=r?r[h]:0;n[h]>m&&(a+=(n[h]-m)*(n[h]-m)),e[h]<m&&(a+=(m-e[h])*(m-e[h]))}return a},u.getAnchorAlignment=Nm,u.getAnchorJustification=Hh,u.getBounds=function(n){let e=1/0,r=1/0,a=-1/0,h=-1/0;for(const m of n)e=Math.min(e,m.x),r=Math.min(r,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return{min:new et(e,r),max:new et(a,h)}},u.getColumn=$i,u.getGridMatrix=function(n,e,r,a){const h=e.getNorth(),m=e.getSouth(),_=e.getWest(),x=e.getEast(),w=1<<n.z,D=x-_,I=h-m,A=D/64,P=-I/Fc[r],F=[0,A,0,P,0,0,h,_,0];if(n.z>0){const z=180/a;bh(F,F,[z/D+1,0,0,0,z/I+1,0,-.5*z/A,.5*z/P,1])}return F[2]=w,F[5]=n.x,F[8]=n.y,F},u.getImage=Vr,u.getJSON=function(n,e){return xr(gt(n,{type:"json"}),e)},u.getLatitudinalLod=function(n){const e=80.051129;n=Ie(n,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(qe(n))),3);return Math.round(r*(Fc.length-1))},u.getMapSessionAPI=Me,u.getPerformanceMeasurement=Re,u.getProjection=Z_,u.getRTLTextPluginStatus=re,u.getReferrer=Ss,u.getTilePoint=function(n,{x:e,y:r},a=0){return new et(((e-a)*n.scale-n.x)*hn,(r*n.scale-n.y)*hn)},u.getTileVec3=function(n,e,r=0){return Eh(((e.x-r)*n.scale-n.x)*hn,(e.y*n.scale-n.y)*hn,Sf(e.z,e.y))},u.getVideo=function(n,e){const r=Te.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<n.length;a++){const h=Te.document.createElement("source");Po(n[a])||(r.crossOrigin="Anonymous"),h.src=n[a],r.appendChild(h)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(n){const e=[0,0,0],r=aa(new Float64Array(16));return ou(r,n.pixelMatrix,n.globeMatrix),Tr(e,e,r),new et(e[0],e[1])},u.globeDenormalizeECEF=Kh,u.globeECEFOrigin=function(n,e){const r=[0,0,0];return Tr(r,r,Jd(da(e.canonical))),Tr(r,r,n),r},u.globeNormalizeECEF=Jd,u.globePixelsToTileUnits=function(n,e){return hn/(512*Math.pow(2,n))*Yh(da(e))},u.globePoleMatrixForTile=function(n,e,r){const a=aa(new Float64Array(16)),h=(e/(1<<n)-.5)*Math.PI*2;return Id(a,r.globeMatrix,h),Float32Array.from(a)},u.globeTileBounds=da,u.globeTiltAtLngLat=Km,u.globeToMercatorTransition=Ku,u.globeUseCustomAntiAliasing=function(n,e,r){const a=Ku(r.zoom),h=n.style.map._antialias,m=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return 0===a&&!h&&!_&&m},u.identity=aa,u.identity$1=$g,u.invert=Cd,u.isFullscreen=function(){return!!Te.document.fullscreenElement||!!Te.document.webkitFullscreenElement},u.isLngLatBehindGlobe=function(n,e){return Km(n,e)>Math.PI/2*1.01},u.isMapAuthenticated=function(n){return we.has(n)},u.isMapboxURL=di,u.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Ar(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=Zi,u.latLngToECEF=Xh,u.len=Zy,u.length=wh,u.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},u.lngFromMercatorX=Zs,u.loadVectorTile=wu,u.makeRequest=xr,u.mapValue=function(n,e,r,a,h){return Ie((n-e)/(r-e)*(h-a)+a,a,h)},u.mercatorScale=Mf,u.mercatorXfromLng=ka,u.mercatorYfromLat=oa,u.mercatorZfromAltitude=sa,u.mul=Ng,u.mul$1=hm,u.multiply=ou,u.multiply$1=bh,u.multiply$2=Ug,u.nextPowerOfTwo=en,u.normalize=Go,u.normalize$1=Hg,u.normalize$2=Vg,u.number=Dn,u.ortho=function(n,e,r,a,h,m,_){var x=1/(e-r),w=1/(a-h),D=1/(m-_);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*D,n[11]=0,n[12]=(e+r)*x,n[13]=(h+a)*w,n[14]=(_+m)*D,n[15]=1,n},u.pbf=zd,u.perspective=function(n,e,r,a,h){var m,_=1/Math.tan(e/2);return n[0]=_/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=_,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,null!=h&&h!==1/0?(n[10]=(h+a)*(m=1/(a-h)),n[14]=2*h*a*m):(n[10]=-1,n[14]=-2*a),n},u.pick=function(n,e){const r={};for(let a=0;a<e.length;a++){const h=e[a];h in n&&(r[h]=n[h])}return r},u.plugin=ge,u.pointGeometry=et,u.polygonContainsPoint=Cc,u.polygonIntersectsBox=Of,u.polygonIntersectsPolygon=Ed,u.polygonizeBounds=function(n,e,r=0,a=!0){const h=new et(r,r),m=n.sub(h),_=e.add(h),x=[m,new et(_.x,m.y),_,new et(m.x,_.y)];return a&&x.push(m.clone()),x},u.posAttributes=Oc,u.postMapLoadEvent=oe,u.postPerformanceEvent=ye,u.postTurnstileEvent=U,u.potpack=zm,u.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},u.radToDeg=Yt,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(n){return n({pluginStatus:X,pluginURL:ne}),se.on("pluginStateChange",n),n},u.removeAuthState=function(n){we.delete(n)},u.renderColorRamp=$f,u.resample=Fg,u.rotateX=zf,u.rotateX$1=Gg,u.rotateY=Id,u.rotateY$1=Bf,u.rotateZ=function(n,e,r){var a=Math.sin(r),h=Math.cos(r),m=e[0],_=e[1],x=e[2],w=e[3],D=e[4],I=e[5],A=e[6],P=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*h+D*a,n[1]=_*h+I*a,n[2]=x*h+A*a,n[3]=w*h+P*a,n[4]=D*h-m*a,n[5]=I*h-_*a,n[6]=A*h-x*a,n[7]=P*h-w*a,n},u.rotateZ$1=function(n,e,r){r*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],x=Math.sin(r),w=Math.cos(r);return n[0]=a*w+h*x,n[1]=h*w-a*x,n[2]=m*w+_*x,n[3]=_*w-m*x,n},u.scale=Sc,u.scale$1=jg,u.scale$2=qs,u.scaleAndAdd=Dh,u.set=function(n,e,r,a){return n[0]=e,n[1]=r,n[2]=a,n},u.setCacheLimits=function(n,e){Is=n,ss=e},u.setColumn=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},u.setRTLTextPlugin=function(n,e,r=!1){if(X===R||X===B||X===$)throw new Error("setRTLTextPlugin cannot be called multiple times.");ne=Ln.resolveURL(n),X=R,K=e,W(),r||pe()},u.smoothstep=Ne,u.spec=$e,u.squaredLength=function(n){var e=n[0],r=n[1],a=n[2];return e*e+r*r+a*a},u.storeAuthState=function(n,e){e?we.add(n):we.delete(n)},u.sub=ca,u.subtract=um,u.symbolSize=x_,u.tileAABB=function(n,e,r,a,h,m,_,x,w){if("globe"===w.name)return function N_(n,e,r){const a=e/n.worldSize,h=n.globeMatrix;if(r.z<=1){const Fe=da(r).getCorners();return bp(Fe,h,a),Io.fromPoints(Fe)}const m=Wh(r),_=Kd(m);bp(_,h,a);const x=Number.MAX_VALUE,w=[-x,-x,-x],D=[x,x,x];if(m.contains(n.center)){for(const ht of _)Sd(D,D,ht),Uu(w,w,ht);w[2]=0;const Fe=n.point,He=[Fe.x*a,Fe.y*a,0];return Sd(D,D,He),Uu(w,w,He),new Io(D,w)}const I=[h[12]*a,h[13]*a,h[14]*a],A=m.getCenter(),P=Ie(n.center.lat,-85.051129,$o),F=Ie(A.lat,-85.051129,$o),z=ka(n.center.lng),H=oa(P);let Y=z-ka(A.lng);const le=H-oa(F);Y>.5?Y-=1:Y<-.5&&(Y+=1);let me=0;Math.abs(Y)>Math.abs(le)?me=Y>=0?1:3:(me=le>=0?0:2,Dh(I,I,[h[4]*a,h[5]*a,h[6]*a],-Math.sin(qe(le>=0?m.getSouth():m.getNorth()))*Es));const ae=_[me],fe=_[(me+1)%4],be=new xp(ae,fe,I),_e=[Yd(be,0)||ae[0],Yd(be,1)||ae[1],Yd(be,2)||ae[2]],Be=Ku(n.zoom);if(Be>0){const Fe=function({x:ht,y:je,z:Je},nt,at,pt,Ze){const Ft=1/(1<<Je);let cn=ht*Ft,qt=cn+Ft,jt=je*Ft,Mt=jt+Ft,an=0;const wn=(cn+qt)/2-pt;return wn>.5?an=-1:wn<-.5&&(an=1),cn=((cn+an)*nt-(pt*=nt))*at+pt,qt=((qt+an)*nt-pt)*at+pt,jt=(jt*nt-(Ze*=nt))*at+Ze,Mt=(Mt*nt-Ze)*at+Ze,[[cn,Mt,0],[qt,Mt,0],[qt,jt,0],[cn,jt,0]]}(r,e,n._pixelsPerMercatorPixel,z,H);for(let ht=0;ht<_.length;ht++)fu(_[ht],Fe[ht],Be);const He=Mc([],Fe[me],Fe[(me+1)%4]);qs(He,He,.5),fu(_e,He,Be)}for(const Fe of _)Sd(D,D,Fe),Uu(w,w,Fe);return D[2]=Math.min(ae[2],fe[2]),Sd(D,D,_e),Uu(w,w,_e),new Io(D,w)}(n,e,new zh(r,a,h));const D=Ql({z:r,x:a,y:h},w);return new Io([(m+D.x/D.scale)*e,e*(D.y/D.scale),_],[(m+D.x2/D.scale)*e,e*(D.y2/D.scale),x])},u.tileCornersToBounds=Wh,u.tileTransform=Ql,u.transformMat3=function(n,e,r){var a=e[0],h=e[1],m=e[2];return n[0]=a*r[0]+h*r[3]+m*r[6],n[1]=a*r[1]+h*r[4]+m*r[7],n[2]=a*r[2]+h*r[5]+m*r[8],n},u.transformMat4=Tr,u.transformMat4$1=Zl,u.transformQuat=ju,u.transitionTileAABBinECEF=Xm,u.translate=Bu,u.transpose=function(n,e){if(n===e){var r=e[1],a=e[2],h=e[5];n[1]=e[3],n[2]=e[6],n[3]=r,n[5]=e[7],n[6]=a,n[7]=h}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},u.triggerPluginCompletionEvent=J,u.uniqueId=Gn,u.updateGlobeVertexNormal=function(n,e,r,a,h){const m=5*e+2;n.float32[m+0]=r,n.float32[m+1]=a,n.float32[m+2]=h},u.validateCustomStyleLayer=function(n){const e=[],r=n.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===n.render&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&"2d"!==n.renderingMode&&"3d"!==n.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFilter=n=>Qo(Uo(n)),u.validateFog=n=>Qo(al(n)),u.validateLayer=n=>Qo(Bl(n)),u.validateLight=n=>Qo(so(n)),u.validateSource=n=>Qo(yc(n)),u.validateStyle=Ta,u.validateTerrain=n=>Qo(Kc(n)),u.values=Dt,u.vectorTile=Xl,u.version=Gt,u.warnOnce=mn,u.window=Te,u.wrap=Ye}),Ee(0,function(u){function Te(ie){if("number"==typeof ie||"boolean"==typeof ie||"string"==typeof ie||null==ie)return JSON.stringify(ie);if(Array.isArray(ie)){let V="[";for(const oe of ie)V+=`${Te(oe)},`;return`${V}]`}let U="{";for(const V of Object.keys(ie).sort())U+=`${V}:${Te(ie[V])},`;return`${U}}`}function Gt(ie){let U="";for(const V of u.refProperties)U+=`/${Te(ie[V])}`;return U}class Nt{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,V){for(const he of U)this._layerConfigs[he.id]=he,(this._layers[he.id]=u.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of V)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const oe=function(he,ye){const Pe={};for(let we=0;we<he.length;we++){const Q=ye&&ye[he[we].id]||Gt(he[we]);ye&&(ye[he[we].id]=Q);let ee=Pe[Q];ee||(ee=Pe[Q]=[]),ee.push(he[we])}const Me=[];for(const we in Pe)Me.push(Pe[we]);return Me}(u.values(this._layerConfigs),this.keyCache);for(const he of oe){const ye=he.map(te=>this._layers[te.id]),Pe=ye[0];if("none"===Pe.visibility)continue;const Me=Pe.source||"";let we=this.familiesBySource[Me];we||(we=this.familiesBySource[Me]={});const Q=Pe.sourceLayer||"_geojsonTileLayer";let ee=we[Q];ee||(ee=we[Q]=[]),ee.push(ye)}}}class At{loadTile(U,V){const{uid:oe,encoding:he,rawImageData:ye,padding:Pe,buildQuadTree:Me}=U,we=u.window.ImageBitmap&&ye instanceof u.window.ImageBitmap?this.getImageData(ye,Pe):ye;V(null,new u.DEMData(oe,we,he,Pe<1,Me))}getImageData(U,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const oe=this.offscreenCanvasContext.getImageData(-V,-V,U.width+2*V,U.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),oe}}var vt=function ie(U,V){var oe,he=U&&U.type;if("FeatureCollection"===he)for(oe=0;oe<U.features.length;oe++)ie(U.features[oe],V);else if("GeometryCollection"===he)for(oe=0;oe<U.geometries.length;oe++)ie(U.geometries[oe],V);else if("Feature"===he)ie(U.geometry,V);else if("Polygon"===he)mt(U.coordinates,V);else if("MultiPolygon"===he)for(oe=0;oe<U.coordinates.length;oe++)mt(U.coordinates[oe],V);return U};function mt(ie,U){if(0!==ie.length){Qe(ie[0],U);for(var V=1;V<ie.length;V++)Qe(ie[V],!U)}}function Qe(ie,U){for(var V=0,oe=0,he=0,ye=ie.length,Pe=ye-1;he<ye;Pe=he++){var Me=(ie[he][0]-ie[Pe][0])*(ie[Pe][1]+ie[he][1]),we=V+Me;oe+=Math.abs(V)>=Math.abs(Me)?V-we+Me:Me-we+V,V=we}V+oe>=0!=!!U&&ie.reverse()}const It=u.VectorTileFeature.prototype.toGeoJSON;class xn{constructor(U){this._feature=U,this.extent=u.EXTENT,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(1===this._feature.type){const U=[];for(const V of this._feature.geometry)U.push([new u.pointGeometry(V[0],V[1])]);return U}{const U=[];for(const V of this._feature.geometry){const oe=[];for(const he of V)oe.push(new u.pointGeometry(he[0],he[1]));U.push(oe)}return U}}toGeoJSON(U,V,oe){return It.call(this,U,V,oe)}}class wt{constructor(U){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=U.length,this._features=U}feature(U){return new xn(this._features[U])}}var Ht={exports:{}},Xt=u.pointGeometry,Lt=u.vectorTile.VectorTileFeature,et=Yn;function Yn(ie,U){this.options=U||{},this.features=ie,this.length=ie.length}function Ut(ie,U){this.id="number"==typeof ie.id?ie.id:void 0,this.type=ie.type,this.rawGeometry=1===ie.type?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=U||4096}Yn.prototype.feature=function(ie){return new Ut(this.features[ie],this.options.extent)},Ut.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var U=0;U<ie.length;U++){for(var V=ie[U],oe=[],he=0;he<V.length;he++)oe.push(new Xt(V[he][0],V[he][1]));this.geometry.push(oe)}return this.geometry},Ut.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,U=1/0,V=-1/0,oe=1/0,he=-1/0,ye=0;ye<ie.length;ye++)for(var Pe=ie[ye],Me=0;Me<Pe.length;Me++){var we=Pe[Me];U=Math.min(U,we.x),V=Math.max(V,we.x),oe=Math.min(oe,we.y),he=Math.max(he,we.y)}return[U,oe,V,he]},Ut.prototype.toGeoJSON=Lt.prototype.toGeoJSON;var Zt=u.pbf,qe=et;function Yt(ie){var U=new Zt;return function(V,oe){for(var he in V.layers)oe.writeMessage(3,Pt,V.layers[he])}(ie,U),U.finish()}function Pt(ie,U){var V;U.writeVarintField(15,ie.version||1),U.writeStringField(1,ie.name||""),U.writeVarintField(5,ie.extent||4096);var oe={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ie.length;V++)oe.feature=ie.feature(V),U.writeMessage(2,tn,oe);var he=oe.keys;for(V=0;V<he.length;V++)U.writeStringField(3,he[V]);var ye=oe.values;for(V=0;V<ye.length;V++)U.writeMessage(4,Ye,ye[V])}function tn(ie,U){var V=ie.feature;void 0!==V.id&&U.writeVarintField(1,V.id),U.writeMessage(2,st,ie),U.writeVarintField(3,V.type),U.writeMessage(4,Ne,V)}function st(ie,U){var V=ie.feature,oe=ie.keys,he=ie.values,ye=ie.keycache,Pe=ie.valuecache;for(var Me in V.properties){var we=V.properties[Me],Q=ye[Me];if(null!==we){void 0===Q&&(oe.push(Me),ye[Me]=Q=oe.length-1),U.writeVarint(Q);var ee=typeof we;"string"!==ee&&"boolean"!==ee&&"number"!==ee&&(we=JSON.stringify(we));var te=ee+":"+we,de=Pe[te];void 0===de&&(he.push(we),Pe[te]=de=he.length-1),U.writeVarint(de)}}}function kt(ie,U){return(U<<3)+(7&ie)}function Ie(ie){return ie<<1^ie>>31}function Ne(ie,U){for(var V=ie.loadGeometry(),oe=ie.type,he=0,ye=0,Pe=V.length,Me=0;Me<Pe;Me++){var we=V[Me],Q=1;1===oe&&(Q=we.length),U.writeVarint(kt(1,Q));for(var ee=3===oe?we.length-1:we.length,te=0;te<ee;te++){1===te&&1!==oe&&U.writeVarint(kt(2,ee-1));var de=we[te].x-he,Re=we[te].y-ye;U.writeVarint(Ie(de)),U.writeVarint(Ie(Re)),he+=de,ye+=Re}3===oe&&U.writeVarint(kt(7,1))}}function Ye(ie,U){var V=typeof ie;"string"===V?U.writeStringField(1,ie):"boolean"===V?U.writeBooleanField(7,ie):"number"===V&&(ie%1!=0?U.writeDoubleField(3,ie):ie<0?U.writeSVarintField(6,ie):U.writeVarintField(5,ie))}function Ve(ie,U,V,oe,he,ye){if(he-oe<=V)return;const Pe=oe+he>>1;Dt(ie,U,Pe,oe,he,ye%2),Ve(ie,U,V,oe,Pe-1,ye+1),Ve(ie,U,V,Pe+1,he,ye+1)}function Dt(ie,U,V,oe,he,ye){for(;he>oe;){if(he-oe>600){const Q=he-oe+1,ee=V-oe+1,te=Math.log(Q),de=.5*Math.exp(2*te/3),Re=.5*Math.sqrt(te*de*(Q-de)/Q)*(ee-Q/2<0?-1:1);Dt(ie,U,V,Math.max(oe,Math.floor(V-ee*de/Q+Re)),Math.min(he,Math.floor(V+(Q-ee)*de/Q+Re)),ye)}const Pe=U[2*V+ye];let Me=oe,we=he;for(gt(ie,U,oe,V),U[2*he+ye]>Pe&&gt(ie,U,oe,he);Me<we;){for(gt(ie,U,Me,we),Me++,we--;U[2*Me+ye]<Pe;)Me++;for(;U[2*we+ye]>Pe;)we--}U[2*oe+ye]===Pe?gt(ie,U,oe,we):(we++,gt(ie,U,we,he)),we<=V&&(oe=we+1),V<=we&&(he=we-1)}}function gt(ie,U,V,oe){fn(ie,V,oe),fn(U,2*V,2*oe),fn(U,2*V+1,2*oe+1)}function fn(ie,U,V){const oe=ie[U];ie[U]=ie[V],ie[V]=oe}function Gn(ie,U,V,oe){const he=ie-V,ye=U-oe;return he*he+ye*ye}Ht.exports=Yt,Ht.exports.fromVectorTileJs=Yt,Ht.exports.fromGeojsonVt=function(ie,U){U=U||{};var V={};for(var oe in ie)V[oe]=new qe(ie[oe].features,U),V[oe].name=oe,V[oe].version=U.version,V[oe].extent=U.extent;return Yt({layers:V})},Ht.exports.GeoJSONWrapper=qe;const lr=ie=>ie[0],en=ie=>ie[1];class Mr{constructor(U,V=lr,oe=en,he=64,ye=Float64Array){this.nodeSize=he,this.points=U;const Pe=U.length<65536?Uint16Array:Uint32Array,Me=this.ids=new Pe(U.length),we=this.coords=new ye(2*U.length);for(let Q=0;Q<U.length;Q++)Me[Q]=Q,we[2*Q]=V(U[Q]),we[2*Q+1]=oe(U[Q]);Ve(Me,we,he,0,Me.length-1,0)}range(U,V,oe,he){return function(ye,Pe,Me,we,Q,ee,te){const de=[0,ye.length-1,0],Re=[];let rt,We;for(;de.length;){const Ot=de.pop(),nn=de.pop(),Ln=de.pop();if(nn-Ln<=te){for(let qn=Ln;qn<=nn;qn++)rt=Pe[2*qn],We=Pe[2*qn+1],rt>=Me&&rt<=Q&&We>=we&&We<=ee&&Re.push(ye[qn]);continue}const Jt=Math.floor((Ln+nn)/2);rt=Pe[2*Jt],We=Pe[2*Jt+1],rt>=Me&&rt<=Q&&We>=we&&We<=ee&&Re.push(ye[Jt]);const On=(Ot+1)%2;(0===Ot?Me<=rt:we<=We)&&(de.push(Ln),de.push(Jt-1),de.push(On)),(0===Ot?Q>=rt:ee>=We)&&(de.push(Jt+1),de.push(nn),de.push(On))}return Re}(this.ids,this.coords,U,V,oe,he,this.nodeSize)}within(U,V,oe){return function(he,ye,Pe,Me,we,Q){const ee=[0,he.length-1,0],te=[],de=we*we;for(;ee.length;){const Re=ee.pop(),rt=ee.pop(),We=ee.pop();if(rt-We<=Q){for(let On=We;On<=rt;On++)Gn(ye[2*On],ye[2*On+1],Pe,Me)<=de&&te.push(he[On]);continue}const Ot=Math.floor((We+rt)/2),nn=ye[2*Ot],Ln=ye[2*Ot+1];Gn(nn,Ln,Pe,Me)<=de&&te.push(he[Ot]);const Jt=(Re+1)%2;(0===Re?Pe-we<=nn:Me-we<=Ln)&&(ee.push(We),ee.push(Ot-1),ee.push(Jt)),(0===Re?Pe+we>=nn:Me+we>=Ln)&&(ee.push(Ot+1),ee.push(rt),ee.push(Jt))}return te}(this.ids,this.coords,U,V,oe,this.nodeSize)}}const gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},kn=Math.fround||(hr=new Float32Array(1),ie=>(hr[0]=+ie,hr[0]));var hr;class ui{constructor(U){this.options=Jn(Object.create(gi),U),this.trees=new Array(this.options.maxZoom+1)}load(U){const{log:V,minZoom:oe,maxZoom:he,nodeSize:ye}=this.options;V&&console.time("total time");const Pe=`prepare ${U.length} points`;V&&console.time(Pe),this.points=U;let Me=[];for(let we=0;we<U.length;we++)U[we].geometry&&Me.push(ji(U[we],we));this.trees[he+1]=new Mr(Me,Ar,hi,ye,Float32Array),V&&console.timeEnd(Pe);for(let we=he;we>=oe;we--){const Q=+Date.now();Me=this._cluster(Me,we),this.trees[we]=new Mr(Me,Ar,hi,ye,Float32Array),V&&console.log("z%d: %d clusters in %dms",we,Me.length,+Date.now()-Q)}return V&&console.timeEnd("total time"),this}getClusters(U,V){let oe=((U[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,U[1]));let ye=180===U[2]?180:((U[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)oe=-180,ye=180;else if(oe>ye){const ee=this.getClusters([oe,he,180,Pe],V),te=this.getClusters([-180,he,ye,Pe],V);return ee.concat(te)}const Me=this.trees[this._limitZoom(V)],we=Me.range(jn(oe),Ki(Pe),jn(ye),Ki(he)),Q=[];for(const ee of we){const te=Me.points[ee];Q.push(te.numPoints?mn(te):this.points[te.index])}return Q}getChildren(U){const V=this._getOriginId(U),oe=this._getOriginZoom(U),he="No cluster with the specified id.",ye=this.trees[oe];if(!ye)throw new Error(he);const Pe=ye.points[V];if(!Pe)throw new Error(he);const Me=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),we=ye.within(Pe.x,Pe.y,Me),Q=[];for(const ee of we){const te=ye.points[ee];te.parentId===U&&Q.push(te.numPoints?mn(te):this.points[te.index])}if(0===Q.length)throw new Error(he);return Q}getLeaves(U,V,oe){const he=[];return this._appendLeaves(he,U,V=V||10,oe=oe||0,0),he}getTile(U,V,oe){const he=this.trees[this._limitZoom(U)],ye=Math.pow(2,U),{extent:Pe,radius:Me}=this.options,we=Me/Pe,Q=(oe-we)/ye,ee=(oe+1+we)/ye,te={features:[]};return this._addTileFeatures(he.range((V-we)/ye,Q,(V+1+we)/ye,ee),he.points,V,oe,ye,te),0===V&&this._addTileFeatures(he.range(1-we/ye,Q,1,ee),he.points,ye,oe,ye,te),V===ye-1&&this._addTileFeatures(he.range(0,Q,we/ye,ee),he.points,-1,oe,ye,te),te.features.length?te:null}getClusterExpansionZoom(U){let V=this._getOriginZoom(U)-1;for(;V<=this.options.maxZoom;){const oe=this.getChildren(U);if(V++,1!==oe.length)break;U=oe[0].properties.cluster_id}return V}_appendLeaves(U,V,oe,he,ye){const Pe=this.getChildren(V);for(const Me of Pe){const we=Me.properties;if(we&&we.cluster?ye+we.point_count<=he?ye+=we.point_count:ye=this._appendLeaves(U,we.cluster_id,oe,he,ye):ye<he?ye++:U.push(Me),U.length===oe)break}return ye}_addTileFeatures(U,V,oe,he,ye,Pe){for(const Me of U){const we=V[Me],Q=we.numPoints;let ee,te,de;if(Q)ee=Sn(we),te=we.x,de=we.y;else{const We=this.points[we.index];ee=We.properties,te=jn(We.geometry.coordinates[0]),de=Ki(We.geometry.coordinates[1])}const Re={type:1,geometry:[[Math.round(this.options.extent*(te*ye-oe)),Math.round(this.options.extent*(de*ye-he))]],tags:ee};let rt;Q?rt=we.id:this.options.generateId?rt=we.index:this.points[we.index].id&&(rt=this.points[we.index].id),void 0!==rt&&(Re.id=rt),Pe.features.push(Re)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,V){const oe=[],{radius:he,extent:ye,reduce:Pe,minPoints:Me}=this.options,we=he/(ye*Math.pow(2,V));for(let Q=0;Q<U.length;Q++){const ee=U[Q];if(ee.zoom<=V)continue;ee.zoom=V;const te=this.trees[V+1],de=te.within(ee.x,ee.y,we),Re=ee.numPoints||1;let rt=Re;for(const We of de){const Ot=te.points[We];Ot.zoom>V&&(rt+=Ot.numPoints||1)}if(rt>Re&&rt>=Me){let We=ee.x*Re,Ot=ee.y*Re,nn=Pe&&Re>1?this._map(ee,!0):null;const Ln=(Q<<5)+(V+1)+this.points.length;for(const Jt of de){const On=te.points[Jt];if(On.zoom<=V)continue;On.zoom=V;const qn=On.numPoints||1;We+=On.x*qn,Ot+=On.y*qn,On.parentId=Ln,Pe&&(nn||(nn=this._map(ee,!0)),Pe(nn,this._map(On)))}ee.parentId=Ln,oe.push(cr(We/rt,Ot/rt,Ln,rt,nn))}else if(oe.push(ee),rt>1)for(const We of de){const Ot=te.points[We];Ot.zoom<=V||(Ot.zoom=V,oe.push(Ot))}}return oe}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,V){if(U.numPoints)return V?Jn({},U.properties):U.properties;const oe=this.points[U.index].properties,he=this.options.map(oe);return V&&he===oe?Jn({},he):he}}function cr(ie,U,V,oe,he){return{x:kn(ie),y:kn(U),zoom:1/0,id:V,parentId:-1,numPoints:oe,properties:he}}function ji(ie,U){const[V,oe]=ie.geometry.coordinates;return{x:kn(jn(V)),y:kn(Ki(oe)),zoom:1/0,index:U,parentId:-1}}function mn(ie){return{type:"Feature",id:ie.id,properties:Sn(ie),geometry:{type:"Point",coordinates:[(U=ie.x,360*(U-.5)),Vi(ie.y)]}};var U}function Sn(ie){const U=ie.numPoints,V=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U;return Jn(Jn({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:U,point_count_abbreviated:V})}function jn(ie){return ie/360+.5}function Ki(ie){const U=Math.sin(ie*Math.PI/180),V=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return V<0?0:V>1?1:V}function Vi(ie){const U=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Jn(ie,U){for(const V in U)ie[V]=U[V];return ie}function Ar(ie){return ie.x}function hi(ie){return ie.y}function $i(ie,U,V,oe){for(var he,ye=oe,Pe=V-U>>1,Me=V-U,we=ie[U],Q=ie[U+1],ee=ie[V],te=ie[V+1],de=U+3;de<V;de+=3){var Re=Jr(ie[de],ie[de+1],we,Q,ee,te);if(Re>ye)he=de,ye=Re;else if(Re===ye){var rt=Math.abs(de-Pe);rt<Me&&(he=de,Me=rt)}}ye>oe&&(he-U>3&&$i(ie,U,he,oe),ie[he+2]=ye,V-he>3&&$i(ie,he,V,oe))}function Jr(ie,U,V,oe,he,ye){var Pe=he-V,Me=ye-oe;if(0!==Pe||0!==Me){var we=((ie-V)*Pe+(U-oe)*Me)/(Pe*Pe+Me*Me);we>1?(V=he,oe=ye):we>0&&(V+=Pe*we,oe+=Me*we)}return(Pe=ie-V)*Pe+(Me=U-oe)*Me}function Pr(ie,U,V,oe){var he={id:void 0===ie?null:ie,type:U,geometry:V,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Pe=ye.geometry,Me=ye.type;if("Point"===Me||"MultiPoint"===Me||"LineString"===Me)uo(ye,Pe);else if("Polygon"===Me||"MultiLineString"===Me)for(var we=0;we<Pe.length;we++)uo(ye,Pe[we]);else if("MultiPolygon"===Me)for(we=0;we<Pe.length;we++)for(var Q=0;Q<Pe[we].length;Q++)uo(ye,Pe[we][Q])}(he),he}function uo(ie,U){for(var V=0;V<U.length;V+=3)ie.minX=Math.min(ie.minX,U[V]),ie.minY=Math.min(ie.minY,U[V+1]),ie.maxX=Math.max(ie.maxX,U[V]),ie.maxY=Math.max(ie.maxY,U[V+1])}function Is(ie,U,V,oe){if(U.geometry){var he=U.geometry.coordinates,ye=U.geometry.type,Pe=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Me=[],we=U.id;if(V.promoteId?we=U.properties[V.promoteId]:V.generateId&&(we=oe||0),"Point"===ye)ss(he,Me);else if("MultiPoint"===ye)for(var Q=0;Q<he.length;Q++)ss(he[Q],Me);else if("LineString"===ye)Ji(he,Me,Pe,!1);else if("MultiLineString"===ye){if(V.lineMetrics){for(Q=0;Q<he.length;Q++)Ji(he[Q],Me=[],Pe,!1),ie.push(Pr(we,"LineString",Me,U.properties));return}_i(he,Me,Pe,!1)}else if("Polygon"===ye)_i(he,Me,Pe,!0);else{if("MultiPolygon"!==ye){if("GeometryCollection"===ye){for(Q=0;Q<U.geometry.geometries.length;Q++)Is(ie,{id:we,geometry:U.geometry.geometries[Q],properties:U.properties},V,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Q=0;Q<he.length;Q++){var ee=[];_i(he[Q],ee,Pe,!0),Me.push(ee)}}ie.push(Pr(we,ye,Me,U.properties))}}function ss(ie,U){U.push(bn(ie[0])),U.push(ur(ie[1])),U.push(0)}function Ji(ie,U,V,oe){for(var he,ye,Pe=0,Me=0;Me<ie.length;Me++){var we=bn(ie[Me][0]),Q=ur(ie[Me][1]);U.push(we),U.push(Q),U.push(0),Me>0&&(Pe+=oe?(he*Q-we*ye)/2:Math.sqrt(Math.pow(we-he,2)+Math.pow(Q-ye,2))),he=we,ye=Q}var ee=U.length-3;U[2]=1,$i(U,0,ee,V),U[ee+2]=1,U.size=Math.abs(Pe),U.start=0,U.end=U.size}function _i(ie,U,V,oe){for(var he=0;he<ie.length;he++){var ye=[];Ji(ie[he],ye,V,oe),U.push(ye)}}function bn(ie){return ie/360+.5}function ur(ie){var U=Math.sin(ie*Math.PI/180),V=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return V<0?0:V>1?1:V}function ut(ie,U,V,oe,he,ye,Pe,Me){if(oe/=U,ye>=(V/=U)&&Pe<oe)return ie;if(Pe<V||ye>=oe)return null;for(var we=[],Q=0;Q<ie.length;Q++){var ee=ie[Q],te=ee.geometry,de=ee.type,Re=0===he?ee.minX:ee.minY,rt=0===he?ee.maxX:ee.maxY;if(Re>=V&&rt<oe)we.push(ee);else if(!(rt<V||Re>=oe)){var We=[];if("Point"===de||"MultiPoint"===de)un(te,We,V,oe,he);else if("LineString"===de)Ss(te,We,V,oe,he,!1,Me.lineMetrics);else if("MultiLineString"===de)Zn(te,We,V,oe,he,!1);else if("Polygon"===de)Zn(te,We,V,oe,he,!0);else if("MultiPolygon"===de)for(var Ot=0;Ot<te.length;Ot++){var nn=[];Zn(te[Ot],nn,V,oe,he,!0),nn.length&&We.push(nn)}if(We.length){if(Me.lineMetrics&&"LineString"===de){for(Ot=0;Ot<We.length;Ot++)we.push(Pr(ee.id,de,We[Ot],ee.tags));continue}"LineString"!==de&&"MultiLineString"!==de||(1===We.length?(de="LineString",We=We[0]):de="MultiLineString"),"Point"!==de&&"MultiPoint"!==de||(de=3===We.length?"Point":"MultiPoint"),we.push(Pr(ee.id,de,We,ee.tags))}}}return we.length?we:null}function un(ie,U,V,oe,he){for(var ye=0;ye<ie.length;ye+=3){var Pe=ie[ye+he];Pe>=V&&Pe<=oe&&(U.push(ie[ye]),U.push(ie[ye+1]),U.push(ie[ye+2]))}}function Ss(ie,U,V,oe,he,ye,Pe){for(var Me,we,Q=xr(ie),ee=0===he?Hn:Ro,te=ie.start,de=0;de<ie.length-3;de+=3){var Re=ie[de],rt=ie[de+1],We=ie[de+2],Ot=ie[de+3],nn=ie[de+4],Ln=0===he?Re:rt,Jt=0===he?Ot:nn,On=!1;Pe&&(Me=Math.sqrt(Math.pow(Re-Ot,2)+Math.pow(rt-nn,2))),Ln<V?Jt>V&&(we=ee(Q,Re,rt,Ot,nn,V),Pe&&(Q.start=te+Me*we)):Ln>oe?Jt<oe&&(we=ee(Q,Re,rt,Ot,nn,oe),Pe&&(Q.start=te+Me*we)):Po(Q,Re,rt,We),Jt<V&&Ln>=V&&(we=ee(Q,Re,rt,Ot,nn,V),On=!0),Jt>oe&&Ln<=oe&&(we=ee(Q,Re,rt,Ot,nn,oe),On=!0),!ye&&On&&(Pe&&(Q.end=te+Me*we),U.push(Q),Q=xr(ie)),Pe&&(te+=Me)}var qn=ie.length-3;Re=ie[qn],rt=ie[qn+1],We=ie[qn+2],(Ln=0===he?Re:rt)>=V&&Ln<=oe&&Po(Q,Re,rt,We),qn=Q.length-3,ye&&qn>=3&&(Q[qn]!==Q[0]||Q[qn+1]!==Q[1])&&Po(Q,Q[0],Q[1],Q[2]),Q.length&&U.push(Q)}function xr(ie){var U=[];return U.size=ie.size,U.start=ie.start,U.end=ie.end,U}function Zn(ie,U,V,oe,he,ye){for(var Pe=0;Pe<ie.length;Pe++)Ss(ie[Pe],U,V,oe,he,ye,!1)}function Po(ie,U,V,oe){ie.push(U),ie.push(V),ie.push(oe)}function Hn(ie,U,V,oe,he,ye){var Pe=(ye-U)/(oe-U);return ie.push(ye),ie.push(V+(he-V)*Pe),ie.push(1),Pe}function Ro(ie,U,V,oe,he,ye){var Pe=(ye-V)/(he-V);return ie.push(U+(oe-U)*Pe),ie.push(ye),ie.push(1),Pe}function fr(ie,U){for(var V=[],oe=0;oe<ie.length;oe++){var he,ye=ie[oe],Pe=ye.type;if("Point"===Pe||"MultiPoint"===Pe||"LineString"===Pe)he=Vr(ye.geometry,U);else if("MultiLineString"===Pe||"Polygon"===Pe){he=[];for(var Me=0;Me<ye.geometry.length;Me++)he.push(Vr(ye.geometry[Me],U))}else if("MultiPolygon"===Pe)for(he=[],Me=0;Me<ye.geometry.length;Me++){for(var we=[],Q=0;Q<ye.geometry[Me].length;Q++)we.push(Vr(ye.geometry[Me][Q],U));he.push(we)}V.push(Pr(ye.id,Pe,he,ye.tags))}return V}function Vr(ie,U){var V=[];V.size=ie.size,void 0!==ie.start&&(V.start=ie.start,V.end=ie.end);for(var oe=0;oe<ie.length;oe+=3)V.push(ie[oe]+U,ie[oe+1],ie[oe+2]);return V}function Rn(ie,U){if(ie.transformed)return ie;var V,oe,he,ye=1<<ie.z,Pe=ie.x,Me=ie.y;for(V=0;V<ie.features.length;V++){var we=ie.features[V],Q=we.geometry,ee=we.type;if(we.geometry=[],1===ee)for(oe=0;oe<Q.length;oe+=2)we.geometry.push(di(Q[oe],Q[oe+1],U,ye,Pe,Me));else for(oe=0;oe<Q.length;oe++){var te=[];for(he=0;he<Q[oe].length;he+=2)te.push(di(Q[oe][he],Q[oe][he+1],U,ye,Pe,Me));we.geometry.push(te)}}return ie.transformed=!0,ie}function di(ie,U,V,oe,he,ye){return[Math.round(V*(ie*oe-he)),Math.round(V*(U*oe-ye))]}function Ri(ie,U,V,oe,he){for(var ye=U===he.maxZoom?0:he.tolerance/((1<<U)*he.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:oe,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<ie.length;Me++){Pe.numFeatures++,Ys(Pe,ie[Me],ye,he);var we=ie[Me].minX,Q=ie[Me].minY,ee=ie[Me].maxX,te=ie[Me].maxY;we<Pe.minX&&(Pe.minX=we),Q<Pe.minY&&(Pe.minY=Q),ee>Pe.maxX&&(Pe.maxX=ee),te>Pe.maxY&&(Pe.maxY=te)}return Pe}function Ys(ie,U,V,oe){var he=U.geometry,ye=U.type,Pe=[];if("Point"===ye||"MultiPoint"===ye)for(var Me=0;Me<he.length;Me+=3)Pe.push(he[Me]),Pe.push(he[Me+1]),ie.numPoints++,ie.numSimplified++;else if("LineString"===ye)ho(Pe,he,ie,V,!1,!1);else if("MultiLineString"===ye||"Polygon"===ye)for(Me=0;Me<he.length;Me++)ho(Pe,he[Me],ie,V,"Polygon"===ye,0===Me);else if("MultiPolygon"===ye)for(var we=0;we<he.length;we++){var Q=he[we];for(Me=0;Me<Q.length;Me++)ho(Pe,Q[Me],ie,V,!0,0===Me)}if(Pe.length){var ee=U.tags||null;if("LineString"===ye&&oe.lineMetrics){for(var te in ee={},U.tags)ee[te]=U.tags[te];ee.mapbox_clip_start=he.start/he.size,ee.mapbox_clip_end=he.end/he.size}var de={geometry:Pe,type:"Polygon"===ye||"MultiPolygon"===ye?3:"LineString"===ye||"MultiLineString"===ye?2:1,tags:ee};null!==U.id&&(de.id=U.id),ie.features.push(de)}}function ho(ie,U,V,oe,he,ye){var Pe=oe*oe;if(oe>0&&U.size<(he?Pe:oe))V.numPoints+=U.length/3;else{for(var Me=[],we=0;we<U.length;we+=3)(0===oe||U[we+2]>Pe)&&(V.numSimplified++,Me.push(U[we]),Me.push(U[we+1])),V.numPoints++;he&&function(Q,ee){for(var te=0,de=0,Re=Q.length,rt=Re-2;de<Re;rt=de,de+=2)te+=(Q[de]-Q[rt])*(Q[de+1]+Q[rt+1]);if(te>0===ee)for(de=0,Re=Q.length;de<Re/2;de+=2){var We=Q[de],Ot=Q[de+1];Q[de]=Q[Re-2-de],Q[de+1]=Q[Re-1-de],Q[Re-2-de]=We,Q[Re-1-de]=Ot}}(Me,ye),ie.push(Me)}}function Ms(ie,U){var V=(U=this.options=function(he,ye){for(var Pe in ye)he[Pe]=ye[Pe];return he}(Object.create(this.options),U)).debug;if(V&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,ye,Pe,Me,we,Q,oe=function(he,ye){var Pe=[];if("FeatureCollection"===he.type)for(var Me=0;Me<he.features.length;Me++)Is(Pe,he.features[Me],ye,Me);else Is(Pe,"Feature"===he.type?he:{geometry:he},ye);return Pe}(ie,U);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=he=oe,we=ut(he,1,-1-(Pe=(ye=U).buffer/ye.extent),Pe,0,-1,2,ye),Q=ut(he,1,1-Pe,2+Pe,0,-1,2,ye),(we||Q)&&(Me=ut(he,1,-Pe,1+Pe,0,-1,2,ye)||[],we&&(Me=fr(we,1).concat(Me)),Q&&(Me=Me.concat(fr(Q,-1)))),(oe=Me).length&&this.splitTile(oe,0,0,0),V&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ii(ie,U,V){return 32*((1<<ie)*V+U)+ie}function ki(ie,U){const V=ie.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const oe=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!oe)return U(null,null);const he=new wt(oe.features);let ye=Ht.exports(he);0===ye.byteOffset&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),U(null,{vectorTile:he,rawData:ye.buffer})}Ms.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ms.prototype.splitTile=function(ie,U,V,oe,he,ye,Pe){for(var Me=[ie,U,V,oe],we=this.options,Q=we.debug;Me.length;){oe=Me.pop(),V=Me.pop(),U=Me.pop(),ie=Me.pop();var ee=1<<U,te=ii(U,V,oe),de=this.tiles[te];if(!de&&(Q>1&&console.time("creation"),de=this.tiles[te]=Ri(ie,U,V,oe,we),this.tileCoords.push({z:U,x:V,y:oe}),Q)){Q>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,V,oe,de.numFeatures,de.numPoints,de.numSimplified),console.timeEnd("creation"));var Re="z"+U;this.stats[Re]=(this.stats[Re]||0)+1,this.total++}if(de.source=ie,he){if(U===we.maxZoom||U===he)continue;var rt=1<<he-U;if(V!==Math.floor(ye/rt)||oe!==Math.floor(Pe/rt))continue}else if(U===we.indexMaxZoom||de.numPoints<=we.indexMaxPoints)continue;if(de.source=null,0!==ie.length){Q>1&&console.time("clipping");var We,Ot,nn,Ln,Jt,On,qn=.5*we.buffer/we.extent,po=.5-qn,mo=.5+qn,$e=1+qn;We=Ot=nn=Ln=null,Jt=ut(ie,ee,V-qn,V+mo,0,de.minX,de.maxX,we),On=ut(ie,ee,V+po,V+$e,0,de.minX,de.maxX,we),ie=null,Jt&&(We=ut(Jt,ee,oe-qn,oe+mo,1,de.minY,de.maxY,we),Ot=ut(Jt,ee,oe+po,oe+$e,1,de.minY,de.maxY,we),Jt=null),On&&(nn=ut(On,ee,oe-qn,oe+mo,1,de.minY,de.maxY,we),Ln=ut(On,ee,oe+po,oe+$e,1,de.minY,de.maxY,we),On=null),Q>1&&console.timeEnd("clipping"),Me.push(We||[],U+1,2*V,2*oe),Me.push(Ot||[],U+1,2*V,2*oe+1),Me.push(nn||[],U+1,2*V+1,2*oe),Me.push(Ln||[],U+1,2*V+1,2*oe+1)}}},Ms.prototype.getTile=function(ie,U,V){var oe=this.options,he=oe.extent,ye=oe.debug;if(ie<0||ie>24)return null;var Pe=1<<ie,Me=ii(ie,U=(U%Pe+Pe)%Pe,V);if(this.tiles[Me])return Rn(this.tiles[Me],he);ye>1&&console.log("drilling down to z%d-%d-%d",ie,U,V);for(var we,Q=ie,ee=U,te=V;!we&&Q>0;)Q--,ee=Math.floor(ee/2),te=Math.floor(te/2),we=this.tiles[ii(Q,ee,te)];return we&&we.source?(ye>1&&console.log("found parent tile z%d-%d-%d",Q,ee,te),ye>1&&console.time("drilling down"),this.splitTile(we.source,Q,ee,te,ie,U,V),ye>1&&console.timeEnd("drilling down"),this.tiles[Me]?Rn(this.tiles[Me],he):null):null};class yi extends u.VectorTileWorkerSource{constructor(U,V,oe,he,ye){super(U,V,oe,he,ki),ye&&(this.loadGeoJSON=ye)}loadData(U,V){const oe=U&&U.request,he=oe&&oe.collectResourceTiming;this.loadGeoJSON(U,(ye,Pe)=>{if(ye||!Pe)return V(ye);if("object"!=typeof Pe)return V(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{vt(Pe,!0);try{if(U.filter){const we=u.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===we.result)throw new Error(we.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));Pe={type:"FeatureCollection",features:Pe.features.filter(ee=>we.value.evaluate({zoom:0},ee))}}this._geoJSONIndex=U.cluster?new ui(function({superclusterOptions:we,clusterProperties:Q}){if(!Q||!we)return we;const ee={},te={},de={accumulated:null,zoom:0},Re={properties:null},rt=Object.keys(Q);for(const We of rt){const[Ot,nn]=Q[We],Ln=u.createExpression(nn),Jt=u.createExpression("string"==typeof Ot?[Ot,["accumulated"],["get",We]]:Ot);ee[We]=Ln.value,te[We]=Jt.value}return we.map=We=>{Re.properties=We;const Ot={};for(const nn of rt)Ot[nn]=ee[nn].evaluate(de,Re);return Ot},we.reduce=(We,Ot)=>{Re.properties=Ot;for(const nn of rt)de.accumulated=We[nn],We[nn]=te[nn].evaluate(de,Re)},we}(U)).load(Pe.features):new Ms(we=Pe,U.geojsonVtOptions)}catch(we){return V(we)}this.loaded={};const Me={};if(he){const we=u.getPerformanceMeasurement(oe);we&&(Me.resourceTiming={},Me.resourceTiming[U.source]=JSON.parse(JSON.stringify(we)))}V(null,Me)}var we})}reloadTile(U,V){const oe=this.loaded;return oe&&oe[U.uid]?super.reloadTile(U,V):this.loadTile(U,V)}loadGeoJSON(U,V){if(U.request)u.getJSON(U.request,V);else{if("string"!=typeof U.data)return V(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(U.data))}catch{return V(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(oe){V(oe)}}getClusterChildren(U,V){try{V(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(oe){V(oe)}}getClusterLeaves(U,V){try{V(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(oe){V(oe)}}}class fo{constructor(U){this.self=U,this.actor=new u.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:yi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,oe)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=oe},this.self.registerRTLTextPlugin=V=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=V.applyArabicShaping,u.plugin.processBidirectionalText=V.processBidirectionalText,u.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(U,V,oe){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],oe()}checkIfReady(U,V,oe){oe()}setReferrer(U,V){this.referrer=V}spriteLoaded(U,V){this.isSpriteLoaded[U]=V;for(const oe in this.workerSources[U]){const he=this.workerSources[U][oe];for(const ye in he)he[ye]instanceof u.VectorTileWorkerSource&&(he[ye].isSpriteLoaded=V,he[ye].fire(new u.Event("isSpriteLoaded")))}}setImages(U,V,oe){this.availableImages[U]=V;for(const he in this.workerSources[U]){const ye=this.workerSources[U][he];for(const Pe in ye)ye[Pe].availableImages=V}oe()}enableTerrain(U,V,oe){this.terrain=V,oe()}setProjection(U,V){this.projections[U]=u.getProjection(V)}setLayers(U,V,oe){this.getLayerIndex(U).replace(V),oe()}updateLayers(U,V,oe){this.getLayerIndex(U).update(V.layers,V.removedIds),oe()}loadTile(U,V,oe){const he=this.enableTerrain?u.extend({enableTerrain:this.terrain},V):V;he.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,V.type,V.source).loadTile(he,oe)}loadDEMTile(U,V,oe){const he=this.enableTerrain?u.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(U,V.source).loadTile(he,oe)}reloadTile(U,V,oe){const he=this.enableTerrain?u.extend({enableTerrain:this.terrain},V):V;he.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,V.type,V.source).reloadTile(he,oe)}abortTile(U,V,oe){this.getWorkerSource(U,V.type,V.source).abortTile(V,oe)}removeTile(U,V,oe){this.getWorkerSource(U,V.type,V.source).removeTile(V,oe)}removeSource(U,V,oe){if(!this.workerSources[U]||!this.workerSources[U][V.type]||!this.workerSources[U][V.type][V.source])return;const he=this.workerSources[U][V.type][V.source];delete this.workerSources[U][V.type][V.source],void 0!==he.removeSource?he.removeSource(V,oe):oe()}loadWorkerSource(U,V,oe){try{this.self.importScripts(V.url),oe()}catch(he){oe(he.toString())}}syncRTLPluginState(U,V,oe){try{u.plugin.setState(V);const he=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=he){this.self.importScripts(he);const ye=u.plugin.isParsed();oe(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),ye)}}catch(he){oe(he.toString())}}getAvailableImages(U){let V=this.availableImages[U];return V||(V=[]),V}getLayerIndex(U){let V=this.layerIndexes[U];return V||(V=this.layerIndexes[U]=new Nt),V}getWorkerSource(U,V,oe){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][V]||(this.workerSources[U][V]={}),this.workerSources[U][V][oe]||(this.workerSources[U][V][oe]=new this.workerSourceTypes[V]({send:(ye,Pe,Me,we,Q,ee)=>{this.actor.send(ye,Pe,Me,U,Q,ee)},scheduler:this.actor.scheduler},this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])),this.workerSources[U][V][oe]}getDEMWorkerSource(U,V){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][V]||(this.demWorkerSources[U][V]=new At),this.demWorkerSources[U][V]}enforceCacheSizeLimit(U,V){u.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(U,V,oe){oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new fo(self)),fo}),Ee(0,function(u){function Te(f,t){if(Array.isArray(f)){if(!Array.isArray(t)||f.length!==t.length)return!1;for(let o=0;o<f.length;o++)if(!Te(f[o],t[o]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==t){if("object"!=typeof t||Object.keys(f).length!==Object.keys(t).length)return!1;for(const o in f)if(!Te(f[o],t[o]))return!1;return!0}return f===t}var Gt=Nt;function Nt(f){return t=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var l,d,g=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(g);try{d=new Worker(v),l=!0}catch{l=!1}return d&&d.terminate(),URL.revokeObjectURL(v),l}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var l=document.createElement("canvas");l.width=l.height=1;var d=l.getContext("2d");if(!d)return!1;var g=d.getImageData(0,0,1,1);return g&&g.width===l.width}()||(void 0===At[o=t&&t.failIfMajorPerformanceCaveat]&&(At[o]=function(l){var d,v,E,T,g=(v=l,E=document.createElement("canvas"),(T=Object.create(Nt.webGLContextAttributes)).failIfMajorPerformanceCaveat=v,E.getContext("webgl",T)||E.getContext("experimental-webgl",T));if(!g)return!1;try{d=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!d||g.isContextLost())&&(g.shaderSource(d,"void main() {}"),g.compileShader(d),!0===g.getShaderParameter(d,g.COMPILE_STATUS))}(o)),!At[o]||document.documentMode));var t,o}var At={};function vt(f,t,o){const l=u.window.document.createElement(f);return void 0!==t&&(l.className=t),o&&o.appendChild(l),l}function mt(f,t,o){const l=u.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const d of Object.keys(t))l.setAttributeNS(null,d,t[d]);return o&&o.appendChild(l),l}Nt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Qe=u.window.document&&u.window.document.documentElement.style,It=Qe&&void 0!==Qe.userSelect?"userSelect":"WebkitUserSelect";let xn;function wt(){Qe&&It&&(xn=Qe[It],Qe[It]="none")}function Ht(){Qe&&It&&(Qe[It]=xn)}function Xt(f){f.preventDefault(),f.stopPropagation(),u.window.removeEventListener("click",Xt,!0)}function Lt(){u.window.addEventListener("click",Xt,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",Xt,!0)},0)}function et(f,t){const o=f.getBoundingClientRect();return Zt(f,o,t)}function Yn(f,t){const o=f.getBoundingClientRect(),l=[];for(let d=0;d<t.length;d++)l.push(Zt(f,o,t[d]));return l}function Ut(f){return void 0!==u.window.InstallTrigger&&2===f.button&&f.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Zt(f,t,o){const l=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new u.pointGeometry((o.clientX-t.left)*l,(o.clientY-t.top)*l)}function qe(f,t){var o=t[0],l=t[1],d=t[2],g=t[3],v=o*g-d*l;return v?(f[0]=g*(v=1/v),f[1]=-l*v,f[2]=-d*v,f[3]=o*v,f):null}function Yt(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class Pt extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:o,callback:l}of this.requestors)this._notify(o,l);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,o){this._validate(t,o)&&(this.images[t]=o)}_validate(t,o){let l=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(o.content,o)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,o){if(!t)return!0;let l=0;for(const d of t){if(d[0]<l||d[1]<d[0]||o<d[1])return!1;l=d[1]}return!0}_validateContent(t,o){return!(t&&(4!==t.length||t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,o){o.version=this.images[t].version+1,this.images[t]=o,this.updatedImages[t]=!0}removeImage(t){const o=this.images[t];delete this.images[t],delete this.patterns[t],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,o){let l=!0;if(!this.isLoaded())for(const d of t)this.images[d]||(l=!1);this.isLoaded()||l?this._notify(t,o):this.requestors.push({ids:t,callback:o})}_notify(t,o){const l={};for(const d of t){this.images[d]||this.fire(new u.Event("styleimagemissing",{id:d}));const g=this.images[d];g?l[d]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:u.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}o(null,l)}getPixelSize(){const{width:t,height:o}=this.atlasImage;return{width:t,height:o}}getPattern(t){const o=this.patterns[t],l=this.getImage(t);if(!l)return null;if(o&&o.position.version===l.version)return o.position;if(o)o.position.version=l.version;else{const d={w:l.data.width+2,h:l.data.height+2,x:0,y:0},g=new u.ImagePosition(d,l);this.patterns[t]={bin:d,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const o=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(t,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:o,h:l}=u.potpack(t),d=this.atlasImage;d.resize({width:o||1,height:l||1});for(const g in this.patterns){const{bin:v}=this.patterns[g],E=v.x+1,T=v.y+1,S=this.images[g].data,R=S.width,B=S.height;u.RGBAImage.copy(S,d,{x:0,y:0},{x:E,y:T},{width:R,height:B}),u.RGBAImage.copy(S,d,{x:0,y:B-1},{x:E,y:T-1},{width:R,height:1}),u.RGBAImage.copy(S,d,{x:0,y:0},{x:E,y:T+B},{width:R,height:1}),u.RGBAImage.copy(S,d,{x:R-1,y:0},{x:E-1,y:T},{width:1,height:B}),u.RGBAImage.copy(S,d,{x:0,y:0},{x:E+R,y:T},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const o of t){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const l=this.images[o];Yt(l)&&this.updateImage(o,l)}}}const tn=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(f,t){return function([o,l,d]){const g=u.degToRad(l+90),v=u.degToRad(d);return{x:o*Math.cos(g)*Math.sin(v),y:o*Math.sin(g)*Math.sin(v),z:o*Math.cos(v),azimuthal:l,polar:d}}(f.expression.evaluate(t))}interpolate(f,t,o){return{x:u.number(f.x,t.x,o),y:u.number(f.y,t.y,o),z:u.number(f.z,t.z,o),azimuthal:u.number(f.azimuthal,t.azimuthal,o),polar:u.number(f.polar,t.polar,o)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),st="-transition";class kt extends u.Evented{constructor(t){super(),this._transitionable=new u.Transitionable(tn),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o={}){if(!this._validate(u.validateLight,t,o))for(const l in t){const d=t[l];u.endsWith(l,st)?this._transitionable.setTransition(l.slice(0,-st.length),d):this._transitionable.setValue(l,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,l){return(!l||!1!==l.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const Ie=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),Ne="-transition";class Ye extends u.Evented{constructor(t,o){super(),this._transitionable=new u.Transitionable(Ie),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(t){for(const o in t){const l=t[o];u.endsWith(o,Ne)?this._transitionable.setTransition(o.slice(0,-Ne.length),l):this._transitionable.setValue(o,l)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function Ve(f,t,o,l){const d=u.smoothstep(45,65,o),[g,v]=Dt(f,l),E=u.length(t);let T=1-Math.min(1,Math.exp((E-g)/(v-g)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*d*f.alpha}function Dt(f,t){const o=.5/Math.tan(.5*t);return[f.range[0]+o,f.range[1]+o]}const gt=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])}),fn="-transition";class Gn extends u.Evented{constructor(t,o){super(),this._transitionable=new u.Transitionable(gt),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=o}get state(){const t=this._transform,o="globe"===t.projection.name,l=u.globeToMercatorTransition(t.zoom),d=this.properties.get("range"),g=[.5,3];return{range:o?[u.number(g[0],d[0],l),u.number(g[1],d[1],l)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o={}){if(!this._validate(u.validateFog,t,o)){for(const l of Object.keys(u.spec.fog))t&&void 0===t[l]&&(t[l]=u.spec.fog[l].default);for(const l in t){const d=t[l];u.endsWith(l,fn)?this._transitionable.setTransition(l.slice(0,-fn.length),d):this._transitionable.setValue(l,d)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(l,d,g){const v=u.MercatorCoordinate.fromLngLat(d),E=g.elevation?g.elevation.getAtPointOrZero(v):0,T=[v.x,v.y,E];return u.transformMat4(T,T,g.mercatorFogMatrix),Ve(l,T,g.pitch,g._fov)}(this.state,t,o):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Dt(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,l){return(!l||!1!==l.validate)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:o,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class lr{constructor(t,o){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const l=this.workerPool.acquire(this.id);for(let d=0;d<l.length;d++){const g=new lr.Actor(l[d],o,this.id);g.name=`Worker ${d}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,o,l){u.asyncAll(this.actors,(d,g)=>{d.send(t,o,g)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function en(f,t,o){return t*(u.EXTENT/(f.tileSize*Math.pow(2,o-f.tileID.overscaledZ)))}lr.Actor=u.Actor;class Mr{constructor(t,o,l,d){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,o){let l,d;if(t instanceof u.pointGeometry||"number"==typeof t[0]){const g=u.pointGeometry.convert(t);l=[g],d=o.isPointAboveHorizon(g)}else{const g=u.pointGeometry.convert(t[0]),v=u.pointGeometry.convert(t[1]);l=[g,v],d=u.polygonizeBounds(g,v).every(E=>o.isPointAboveHorizon(E))}return new Mr(l,o.getCameraPoint(),d,o)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],l=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],d=u.polygonizeBounds(o,l,0,!1);return this.cameraPoint.y>l.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<l.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=l.x?d[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(d[3]=this.cameraPoint)),u.bufferConvexPolygon(d,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],l=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],d=u.polygonizeBounds(o,l,t),g=this.cameraPoint.clone();switch(3*((g.y>o.y)+(g.y>l.y))+((g.x>o.x)+(g.x>l.x))){case 0:d[0]=g,d[4]=g.clone();break;case 1:d.splice(1,0,g);break;case 2:d[1]=g;break;case 3:d.splice(4,0,g);break;case 5:d.splice(2,0,g);break;case 6:d[3]=g;break;case 7:d.splice(3,0,g);break;case 8:d[2]=g}return d}containsTile(t,o,l,d=0){const g=t.queryPadding/o._pixelsPerMercatorPixel+1,v=l?this._bufferedCameraMercator(g,o):this._bufferedScreenMercator(g,o);let E=t.tileID.wrap+(v.unwrapped?d:0);const T=v.polygon.map(J=>u.getTilePoint(t.tileTransform,J,E));if(!u.polygonIntersectsBox(T,0,0,u.EXTENT,u.EXTENT))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const S=this.screenGeometryMercator.polygon.map(J=>u.getTileVec3(t.tileTransform,J,E)),R=S.map(J=>new u.pointGeometry(J[0],J[1])),B=o.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),$=u.getTileVec3(t.tileTransform,B,E),K=S.map(J=>{const W=u.sub(J,J,$);return u.normalize(W,W),new u.Ray($,W)}),X=en(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:K,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(ne=u.getBounds(T),ne.min.x=u.clamp(ne.min.x,0,u.EXTENT),ne.min.y=u.clamp(ne.min.y,0,u.EXTENT),ne.max.x=u.clamp(ne.max.x,0,u.EXTENT),ne.max.y=u.clamp(ne.max.y,0,u.EXTENT),ne),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var ne}_bufferedScreenMercator(t,o){const l=hr(t);if(this._screenRaycastCache[l])return this._screenRaycastCache[l];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(g=>o.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[l]=d,d}}_bufferedCameraMercator(t,o){const l=hr(t);if(this._cameraRaycastCache[l])return this._cameraRaycastCache[l];{let d;return d="globe"===o.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(g=>o.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[l]=d,d}}_projectAndResample(t,o){const l=function(g,v){const E=u.multiply([],v.pixelMatrix,v.globeMatrix),T=[0,-u.GLOBE_RADIUS,0,1],S=[0,u.GLOBE_RADIUS,0,1],R=[0,0,0,1];u.transformMat4$1(T,T,E),u.transformMat4$1(S,S,E),u.transformMat4$1(R,R,E);const B=new u.pointGeometry(T[0]/T[3],T[1]/T[3]),$=new u.pointGeometry(S[0]/S[3],S[1]/S[3]),K=u.polygonContainsPoint(g,B)&&T[3]<R[3],X=u.polygonContainsPoint(g,$)&&S[3]<R[3];if(!K&&!X)return null;const ne=function(xe,Le,Ue){for(let Oe=1;Oe<xe.length;Oe++){const ct=kn(Le.pointCoordinate3D(xe[Oe-1]).x),Se=kn(Le.pointCoordinate3D(xe[Oe]).x);if(Ue<0){if(ct<Se)return{idx:Oe,t:-ct/(Se-1-ct)}}else if(Se<ct)return{idx:Oe,t:(1-ct)/(Se+1-ct)}}return null}(g,v,K?-1:1);if(!ne)return null;const{idx:J,t:W}=ne;let se=J>1?gi(g.slice(0,J),v):[],re=J<g.length?gi(g.slice(J),v):[];se=se.map(xe=>new u.pointGeometry(kn(xe.x),xe.y)),re=re.map(xe=>new u.pointGeometry(kn(xe.x),xe.y));const pe=[...se];0===pe.length&&pe.push(re[re.length-1]);const ge=u.number(pe[pe.length-1].y,(0===re.length?se[0]:re[0]).y,W);let ue;return ue=K?[new u.pointGeometry(0,ge),new u.pointGeometry(0,0),new u.pointGeometry(1,0),new u.pointGeometry(1,ge)]:[new u.pointGeometry(1,ge),new u.pointGeometry(1,1),new u.pointGeometry(0,1),new u.pointGeometry(0,ge)],pe.push(...ue),0===re.length?pe.push(se[0]):pe.push(...re),{polygon:pe.map(xe=>new u.MercatorCoordinate(xe.x,xe.y)),unwrapped:!1}}(t,o);if(l)return l;const d=function(g,v){let E=!1,T=-1/0,S=0;for(let B=0;B<g.length-1;B++)g[B].x>T&&(T=g[B].x,S=B);for(let B=0;B<g.length-1;B++){const $=(S+B)%(g.length-1),K=g[$],X=g[$+1];Math.abs(K.x-X.x)>.5&&(K.x<X.x?(K.x+=1,0===$&&(g[g.length-1].x+=1)):(X.x+=1,$+1===g.length-1&&(g[0].x+=1)),E=!0)}const R=u.mercatorXfromLng(v.center.lng);return E&&R<Math.abs(R-1)&&g.forEach(B=>{B.x-=1}),{polygon:g,unwrapped:E}}(gi(t,o).map(g=>new u.pointGeometry(kn(g.x),g.y)),o);return{polygon:d.polygon.map(g=>new u.MercatorCoordinate(g.x,g.y)),unwrapped:d.unwrapped}}}function gi(f,t){return u.resample(f,o=>{const l=t.pointCoordinate3D(o);o.x=l.x,o.y=l.y},1/256)}function kn(f){return f<0?1+f%1:f%1}function hr(f){return 100*f|0}function ui(f,t,o,l,d){const g=function(v,E){if(v)return d(v);if(E){f.url&&E.tiles&&f.tiles&&delete f.tiles;const T=u.pick(u.extend(E,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(T.vectorLayers=E.vector_layers,T.vectorLayerIds=T.vectorLayers.map(S=>S.id)),T.tiles=t.canonicalizeTileset(T,f.url),d(null,T)}};return f.url?u.getJSON(t.transformRequest(t.normalizeSourceURL(f.url,null,o,l),u.ResourceType.Source),g):u.exported.frame(()=>g(null,f))}class cr{constructor(t,o,l){this.bounds=u.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=o||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const o=Math.pow(2,t.z),l=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*o),d=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*o),g=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*o),v=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*o);return t.x>=l&&t.x<g&&t.y>=d&&t.y<v}}class ji{constructor(t,o,l){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(l),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Sn{constructor(t,o,l,d){this.length=o.length,this.attributes=l,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let l=0;l<this.attributes.length;l++){const d=o.attributes[this.attributes[l].name];void 0!==d&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,o,l){for(let d=0;d<this.attributes.length;d++){const g=this.attributes[d],v=o.attributes[g.name];void 0!==v&&t.vertexAttribPointer(v,g.components,t[mn[g.type]],!1,this.itemSize,g.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ki extends jn{getDefault(){return u.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Vi extends jn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jn extends jn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ar extends jn{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hi extends jn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $i extends jn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Jr extends jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Pr extends jn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class uo extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Is extends jn{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ss extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ji extends jn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class _i extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class bn extends jn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ur extends jn{getDefault(){return u.Color.transparent}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ut extends jn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class un extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Ss extends jn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class xr extends jn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Zn extends jn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Po extends jn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Hn extends jn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ro extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class fr extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Vr extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Rn extends jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class di extends jn{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ri extends jn{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Ys extends jn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ho extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ms extends jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ii extends jn{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class ki extends ii{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class yi extends ii{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fo extends yi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ie{constructor(t,o,l,d){this.context=t,this.width=o,this.height=l;const g=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new ki(t,g),d&&(this.depthAttachment=new yi(t,g))}destroy(){const t=this.context.gl,o=this.colorAttachment.get();if(o&&t.deleteTexture(o),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class U{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ki(this),this.clearDepth=new Vi(this),this.clearStencil=new Jn(this),this.colorMask=new Ar(this),this.depthMask=new hi(this),this.stencilMask=new $i(this),this.stencilFunc=new Jr(this),this.stencilOp=new Pr(this),this.stencilTest=new uo(this),this.depthRange=new Is(this),this.depthTest=new ss(this),this.depthFunc=new Ji(this),this.blend=new _i(this),this.blendFunc=new bn(this),this.blendColor=new ur(this),this.blendEquation=new ut(this),this.cullFace=new un(this),this.cullFaceSide=new Ss(this),this.frontFace=new xr(this),this.program=new Zn(this),this.activeTexture=new Po(this),this.viewport=new Hn(this),this.bindFramebuffer=new Ro(this),this.bindRenderbuffer=new fr(this),this.bindTexture=new Vr(this),this.bindVertexBuffer=new Rn(this),this.bindElementBuffer=new di(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ri(this),this.pixelStoreUnpack=new Ys(this),this.pixelStoreUnpackPremultiplyAlpha=new ho(this),this.pixelStoreUnpackFlipY=new Ms(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o){return new ji(this,t,o)}createVertexBuffer(t,o,l){return new Sn(this,t,o,l)}createRenderbuffer(t,o,l){const d=this.gl,g=d.createRenderbuffer();return this.bindRenderbuffer.set(g),d.renderbufferStorage(d.RENDERBUFFER,t,o,l),this.bindRenderbuffer.set(null),g}createFramebuffer(t,o,l){return new ie(this,t,o,l)}clear({color:t,depth:o,stencil:l}){const d=this.gl;let g=0;t&&(g|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==o&&(g|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),void 0!==l&&(g|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),d.clear(g)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){Te(t.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends u.Evented{constructor(t,o,l,d){super(),this.id=t,this.dispatcher=l,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},o),u.extend(this,u.pick(o,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ui(this._options,this.map._requestManager,null,null,(t,o)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):o&&(u.extend(this,o),o.bounds&&(this.tileBounds=new cr(o.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(o.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const l=u.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),l,this.tileSize);t.request=u.getImage(this.map._requestManager.transformRequest(d,u.ResourceType.Tile),(g,v,E,T)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):g?(t.state="errored",o(g)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:E,expires:T}),t.setTexture(v,this.map.painter),t.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void o(null)):o(null)))}static loadTileData(t,o,l){t.setTexture(o,l)}static unloadTileData(t,o){t.texture&&o.saveTileTexture(t.texture)}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o()}unloadTile(t,o){t.texture&&this.map.painter.saveTileTexture(t.texture),o()}hasTransition(){return!1}}let oe;function he(f,t,o,l,d,g,v,E){const T=[f,o,d,t,l,g,1,1,1],S=[v,E,1],R=u.adjoint([],T),[B,$,K]=u.transformMat3(S,S,u.transpose(R,R));return u.multiply$1(T,[B,0,0,0,$,0,0,0,K],T)}class ye extends u.Evented{constructor(t,o,l,d){super(),this.id=t,this.dispatcher=l,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o,this._dirty=!1}load(t,o){this._loaded=o||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(l,d)=>{if(this._imageRequest=null,this._loaded=!0,l)this.fire(new u.ErrorEvent(l));else if(d){const{HTMLImageElement:g}=u.window;this.image=d instanceof g?u.exported.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;const o=t.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(l){let d=1/0,g=1/0,v=-1/0,E=-1/0;for(const B of l)d=Math.min(d,B.x),g=Math.min(g,B.y),v=Math.max(v,B.x),E=Math.max(E,B.y);const T=Math.max(v-d,E-g),S=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),R=Math.pow(2,S);return new u.CanonicalTileID(S,Math.floor((d+v)/2*R),Math.floor((g+E)/2*R))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(const T in this.tiles){const S=this.tiles[T];"loaded"!==S.state&&(S.state="loaded",S.texture=this.texture)}if(this._boundsArray)return;const o=u.tileTransform(this.tileID,this.map.transform.projection),[l,d,g,v]=this.coordinates.map(T=>{const S=o.projection.project(T[0],T[1]);return u.getTilePoint(o,S)._round()});this.perspectiveTransform=function(T,S,R,B,$,K,X,ne,J,W){const se=he(0,0,T,0,0,S,T,S),re=he(R,B,$,K,X,ne,J,W);return u.multiply$1(re,u.adjoint(se,se),re),[re[6]/re[8]*T/u.EXTENT,re[7]/re[8]*S/u.EXTENT]}(this.width,this.height,l.x,l.y,d.x,d.y,v.x,v.y,g.x,g.y);const E=this._boundsArray=new u.StructArrayLayout4i8;E.emplaceBack(l.x,l.y,0,0),E.emplaceBack(d.x,d.y,u.EXTENT,0),E.emplaceBack(v.x,v.y,0,u.EXTENT),E.emplaceBack(g.x,g.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(E,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const t=this.map.painter.context,o=t.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(t,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(t)}loadTile(t,o){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},o(null)):(t.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Pe={vector:class extends u.Evented{constructor(f,t,o,l){if(super(),this.id=f,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(t,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(l),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(f){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map._worldview;this._tileJSONRequest=ui(this._options,this.map._requestManager,t,o,(l,d)=>{this._tileJSONRequest=null,this._loaded=!0,l?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&2!==o.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new u.ErrorEvent(l))):d&&(u.extend(this,d),d.bounds&&(this.tileBounds=new cr(d.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),f&&f(l)})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const f=this.map.style._getSourceCaches(this.id);for(const t of f)t.clearTiles()})}setSourceProperty(f){f(),this.reload()}setTiles(f){return this._options.tiles=f,this.reload(),this}setUrl(f){return this.url=f,this._options.url=f,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),l={request:this.map._requestManager.transformRequest(o,u.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(l.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=t:f.request=f.actor.send("reloadTile",l,d.bind(this));else if(f.actor=this._tileWorkers[o]=this._tileWorkers[o]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",l,d.bind(this),void 0,!0);else{const g=u.loadVectorTile.call({deduped:this._deduped},l,(v,E)=>{v||!E?d.call(this,v):(l.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},f.actor&&f.actor.send("loadTile",l,d.bind(this),void 0,!0))},!0);f.request={cancel:g}}function d(g,v){return delete f.request,f.aborted?t(null):g&&404!==g.status?t(g):(v&&v.resourceTiming&&(f.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&f.setExpiryData(v),f.loadVectorData(v,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:V,"raster-dem":class extends V{constructor(f,t,o,l){super(f,t,o,l),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function l(d,g){d&&(f.state="errored",t(d)),g&&(f.dem=g,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=u.getImage(this.map._requestManager.transformRequest(o,u.ResourceType.Tile),function(d,g,v,E){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(d)f.state="errored",t(d);else if(g){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:v,expires:E});const T=u.window.ImageBitmap&&g instanceof u.window.ImageBitmap&&(null==oe&&(oe=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),oe),S=1-(g.width-u.prevPowerOfTwo(g.width))/2;S<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=T?g:u.exported.getImageData(g,S),B={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:S};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,l.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const t=f.canonical,o=Math.pow(2,t.z),l=(t.x-1+o)%o,d=0===t.x?f.wrap-1:f.wrap,g=(t.x+1+o)%o,v=t.x+1===o?f.wrap+1:f.wrap,E={};return E[new u.OverscaledTileID(f.overscaledZ,d,t.z,l,t.y).key]={backfilled:!1},E[new u.OverscaledTileID(f.overscaledZ,v,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(E[new u.OverscaledTileID(f.overscaledZ,d,t.z,l,t.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(f.overscaledZ,v,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<o&&(E[new u.OverscaledTileID(f.overscaledZ,d,t.z,l,t.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(f.overscaledZ,v,t.z,g,t.y+1).key]={backfilled:!1}),E}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends u.Evented{constructor(f,t,o,l){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(l),this._data=t.data,this._options=u.extend({},t),this._collectResourceTiming=t.collectResourceTiming,void 0!==t.maxzoom&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const d=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(void 0!==t.buffer?t.buffer:128)*d,tolerance:(void 0!==t.tolerance?t.tolerance:.375)*d,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:void 0!==t.clusterMaxZoom?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==t.clusterRadius?t.clusterRadius:50)*d,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},t),this}getClusterLeaves(f,t,o,l){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:t,offset:o},l),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=u.extend({},this.workerOptions),t=this._data;"string"==typeof t?(f.request=this.map._requestManager.transformRequest(u.exported.resolveURL(t),u.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(o,l)=>{if(this._loaded=!0,this._pendingLoad=null,o)this.fire(new u.ErrorEvent(o));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&l&&l.resourceTiming&&l.resourceTiming[this.id]&&(d.resourceTiming=l.resourceTiming[this.id]),this.fire(new u.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,t){const o=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(o,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(l,d)=>(delete f.request,f.unloadVectorData(),f.aborted?t(null):l?t(l):(f.loadVectorData(d,this.map.painter,"reloadTile"===o),t(null))),void 0,"loadTile"===o)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ye{constructor(f,t,o,l){super(f,t,o,l),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,u.ResourceType.Source).url);u.getVideo(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(f,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ye,canvas:class extends ye{constructor(f,t,o,l){super(f,t,o,l),t.coordinates?Array.isArray(t.coordinates)&&4===t.coordinates.length&&!t.coordinates.some(d=>!Array.isArray(d)||2!==d.length||d.some(g=>"number"!=typeof g))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&"boolean"!=typeof t.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?"string"==typeof t.canvas||t.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=void 0===t.animate||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const t=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends u.Evented{constructor(f,t,o,l){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(l),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new cr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:o,z:l}=f.canonical;return this._implementation.hasTile({x:t,y:o,z:l})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:o,y:l,z:d}=f.tileID.canonical,g=new u.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:o,y:l,z:d},{signal:g.signal})).then(function(v){return delete f.request,f.aborted?(f.state="unloaded",t(null)):void 0===v?(f.state="errored",t(null)):null===v?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):(E=v)instanceof u.window.ImageData||E instanceof u.window.HTMLCanvasElement||E instanceof u.window.ImageBitmap||E instanceof u.window.HTMLImageElement?(this.loadTileData(f,v),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var E}.bind(this)).catch(v=>{20!==v.code&&(f.state="errored",t(v))}),f.request.cancel=()=>g.abort()}loadTileData(f,t){V.loadTileData(f,t,this._map.painter)}unloadTileData(f){V.unloadTileData(f,this._map.painter)}unloadTile(f,t){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:o,y:l,z:d}=f.tileID.canonical;this._implementation.unloadTile({x:o,y:l,z:d})}t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Me=function(f,t,o,l){const d=new Pe[t.type](f,t,o,l);if(d.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${d.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],d),d};function we(f,t){const o=u.identity([]);return u.scale(o,o,[.5*f.width,.5*-f.height,1]),u.translate(o,o,[1,-1,0]),u.multiply(o,o,f.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(o)}function Q(f,t,o,l,d,g,v,E=!1){const T=f.tilesIn(l,v,E);T.sort(te);const S=[];for(const B of T)S.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(t,o,f._state,B,d,g,we(f.transform,B.tile.tileID),E)});const R=function(B){const $={},K={};for(const X of B){const ne=X.queryResults,J=X.wrappedTileID,W=K[J]=K[J]||{};for(const se in ne){const re=ne[se],pe=W[se]=W[se]||{},ge=$[se]=$[se]||[];for(const ue of re)pe[ue.featureIndex]||(pe[ue.featureIndex]=!0,ge.push(ue))}}return $}(S);for(const B in R)R[B].forEach($=>{const K=$.feature,X=K.layer;X&&"background"!==X.type&&"sky"!==X.type&&(K.source=X.source,X["source-layer"]&&(K.sourceLayer=X["source-layer"]),K.state=void 0!==K.id?f.getFeatureState(X["source-layer"],K.id):{})});return R}function ee(f,t){const o=f.getRenderableIds().map(g=>f.getTileByID(g)),l=[],d={};for(let g=0;g<o.length;g++){const v=o[g],E=v.tileID.canonical.key;d[E]||(d[E]=!0,v.querySourceFeatures(l,t))}return l}function te(f,t){const o=f.tileID,l=t.tileID;return o.overscaledZ-l.overscaledZ||o.canonical.y-l.canonical.y||o.wrap-l.wrap||o.canonical.x-l.canonical.x}function de(){return null!=Wr.workerClass?new Wr.workerClass:new u.window.Worker(Wr.workerUrl)}const Re="mapboxgl_preloaded_worker_pool";class rt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<rt.workerCount;)this.workers.push(new de);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Re]}numActive(){return Object.keys(this.active).length}}let We;function Ot(){return We||(We=new rt),We}function nn(f,t){const o={};for(const l in f)"ref"!==l&&(o[l]=f[l]);return u.refProperties.forEach(l=>{l in t&&(o[l]=t[l])}),o}function Ln(f){f=f.slice();const t=Object.create(null);for(let o=0;o<f.length;o++)t[f[o].id]=f[o];for(let o=0;o<f.length;o++)"ref"in f[o]&&(f[o]=nn(f[o],t[f[o].ref]));return f}rt.workerCount=2;const Jt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function On(f,t,o){o.push({command:Jt.addSource,args:[f,t[f]]})}function qn(f,t,o){t.push({command:Jt.removeSource,args:[f]}),o[f]=!0}function po(f,t,o,l){qn(f,o,l),On(f,t,o)}function mo(f,t,o){let l;for(l in f[o])if(f[o].hasOwnProperty(l)&&"data"!==l&&!Te(f[o][l],t[o][l]))return!1;for(l in t[o])if(t[o].hasOwnProperty(l)&&"data"!==l&&!Te(f[o][l],t[o][l]))return!1;return!0}function $e(f,t,o,l,d,g){let v;for(v in t=t||{},f=f||{})f.hasOwnProperty(v)&&(Te(f[v],t[v])||o.push({command:g,args:[l,v,t[v],d]}));for(v in t)t.hasOwnProperty(v)&&!f.hasOwnProperty(v)&&(Te(f[v],t[v])||o.push({command:g,args:[l,v,t[v],d]}))}function Qi(f){return f.id}function Rr(f,t){return f[t.id]=t,f}class ko{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=u.clamp(t,0,1);let o=1,l=this._distances[o];const d=t*this.paddedLength+this.padding;for(;l<d&&o<this._distances.length;)l=this._distances[++o];const g=o-1,v=this._distances[g],E=l-v,T=E>0?(d-v)/E:0;return this.points[g].mult(1-T).add(this.points[o].mult(T))}}class Tl{constructor(t,o,l){const d=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(o/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)d.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,l,d,g){this._forEachCell(o,l,d,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g)}insertCircle(t,o,l,d){this._forEachCell(o-d,l-d,o+d,l+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(l),this.circles.push(d)}_insertBoxCell(t,o,l,d,g,v){this.boxCells[g].push(v)}_insertCircleCell(t,o,l,d,g,v){this.circleCells[g].push(v)}_query(t,o,l,d,g,v){if(l<0||t>this.width||d<0||o>this.height)return!g&&[];const E=[];if(t<=0&&o<=0&&this.width<=l&&this.height<=d){if(g)return!0;for(let T=0;T<this.boxKeys.length;T++)E.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const S=this.circles[3*T],R=this.circles[3*T+1],B=this.circles[3*T+2];E.push({key:this.circleKeys[T],x1:S-B,y1:R-B,x2:S+B,y2:R+B})}return v?E.filter(v):E}return this._forEachCell(t,o,l,d,this._queryCell,E,{hitTest:g,seenUids:{box:{},circle:{}}},v),g?E.length>0:E}_queryCircle(t,o,l,d,g){const v=t-l,E=t+l,T=o-l,S=o+l;if(E<0||v>this.width||S<0||T>this.height)return!d&&[];const R=[];return this._forEachCell(v,T,E,S,this._queryCellCircle,R,{hitTest:d,circle:{x:t,y:o,radius:l},seenUids:{box:{},circle:{}}},g),d?R.length>0:R}query(t,o,l,d,g){return this._query(t,o,l,d,!1,g)}hitTest(t,o,l,d,g){return this._query(t,o,l,d,!0,g)}hitTestCircle(t,o,l,d){return this._queryCircle(t,o,l,!0,d)}_queryCell(t,o,l,d,g,v,E,T){const S=E.seenUids,R=this.boxCells[g];if(null!==R){const $=this.bboxes;for(const K of R)if(!S.box[K]){S.box[K]=!0;const X=4*K;if(t<=$[X+2]&&o<=$[X+3]&&l>=$[X+0]&&d>=$[X+1]&&(!T||T(this.boxKeys[K]))){if(E.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[K],x1:$[X],y1:$[X+1],x2:$[X+2],y2:$[X+3]})}}}const B=this.circleCells[g];if(null!==B){const $=this.circles;for(const K of B)if(!S.circle[K]){S.circle[K]=!0;const X=3*K;if(this._circleAndRectCollide($[X],$[X+1],$[X+2],t,o,l,d)&&(!T||T(this.circleKeys[K]))){if(E.hitTest)return v.push(!0),!0;{const ne=$[X],J=$[X+1],W=$[X+2];v.push({key:this.circleKeys[K],x1:ne-W,y1:J-W,x2:ne+W,y2:J+W})}}}}}_queryCellCircle(t,o,l,d,g,v,E,T){const S=E.circle,R=E.seenUids,B=this.boxCells[g];if(null!==B){const K=this.bboxes;for(const X of B)if(!R.box[X]){R.box[X]=!0;const ne=4*X;if(this._circleAndRectCollide(S.x,S.y,S.radius,K[ne+0],K[ne+1],K[ne+2],K[ne+3])&&(!T||T(this.boxKeys[X])))return v.push(!0),!0}}const $=this.circleCells[g];if(null!==$){const K=this.circles;for(const X of $)if(!R.circle[X]){R.circle[X]=!0;const ne=3*X;if(this._circlesCollide(K[ne],K[ne+1],K[ne+2],S.x,S.y,S.radius)&&(!T||T(this.circleKeys[X])))return v.push(!0),!0}}}_forEachCell(t,o,l,d,g,v,E,T){const S=this._convertToXCellCoord(t),R=this._convertToYCellCoord(o),B=this._convertToXCellCoord(l),$=this._convertToYCellCoord(d);for(let K=S;K<=B;K++)for(let X=R;X<=$;X++)if(g.call(this,t,o,l,d,this.xCellCount*X+K,v,E,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,l,d,g,v){const E=d-t,T=g-o,S=l+v;return S*S>E*E+T*T}_circleAndRectCollide(t,o,l,d,g,v,E){const T=(v-d)/2,S=Math.abs(t-(d+T));if(S>T+l)return!1;const R=(E-g)/2,B=Math.abs(o-(g+R));if(B>R+l)return!1;if(S<=T||B<=R)return!0;const $=S-T,K=B-R;return $*$+K*K<=l*l}}const Li=Math.tan(85*Math.PI/180);function As(f,t,o,l,d,g,v){const E=u.create();if(o)if("globe"===g.name){const T=u.calculateGlobeLabelMatrix(d,t);u.multiply(E,E,T)}else{const T=qe([],v);E[0]=T[0],E[1]=T[1],E[4]=T[2],E[5]=T[3],l||u.rotateZ(E,E,d.angle)}else u.multiply(E,d.labelPlaneMatrix,f);return E}function qo(f,t,o,l,d,g,v){const E=As(f,t,o,l,d,g,v);return"globe"===g.name&&o||(E[2]=E[6]=E[10]=E[14]=0),E}function Un(f,t,o,l,d,g,v){if(o){if("globe"===g.name){const E=As(f,t,o,l,d,g,v);return u.invert(E,E),u.multiply(E,f,E),E}{const E=u.clone(f),T=u.identity([]);return T[0]=v[0],T[1]=v[1],T[4]=v[2],T[5]=v[3],u.multiply(E,E,T),l||u.rotateZ(E,E,-d.angle),E}}return d.glCoordMatrix}function dt(f,t,o=0){const l=[f.x,f.y,o,1];o?u.transformMat4$1(l,l,t):Lo(l,l,t);const d=l[3];return{point:[l[0]/d,l[1]/d,l[2]/d],signedDistanceFromCamera:d}}function on(f,t){const o=[f[0],f[1],f[2],1];u.transformMat4$1(o,o,t);const l=o[3];return{point:[o[0]/l,o[1]/l,o[2]/l],signedDistanceFromCamera:l}}function _n(f,t){return Math.min(.5+f/t*.5,1.5)}function kr(f,t){const o=f[0]/f[3],l=f[1]/f[3];return o>=-t[0]&&o<=t[0]&&l>=-t[1]&&l<=t[1]}function Hr(f,t,o,l,d,g,v,E,T,S){const R=o.transform,B=l?f.textSizeData:f.iconSizeData,$=u.evaluateSizeForZoom(B,o.transform.zoom),K="globe"===R.projection.name,X=[256/o.width*2+1,256/o.height*2+1],ne=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ne.clear();let J=null;K&&(J=l?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const W=f.lineVertexArray,se=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,re=o.transform.width/o.transform.height;let pe=!1;for(let ge=0;ge<se.length;ge++){const ue=se.get(ge);if(ue.writingMode!==u.WritingMode.vertical||pe||0!==ge&&se.get(ge-1).writingMode===u.WritingMode.horizontal||(pe=!0),(ue.hidden||ue.writingMode===u.WritingMode.vertical)&&!pe){or(ue.numGlyphs,ne);continue}pe=!1;const xe=new u.pointGeometry(ue.tileAnchorX,ue.tileAnchorY),Le=T?T(xe):[0,0,0],Ue=R.projection.projectTilePoint(xe.x,xe.y,S.canonical),Oe=[Ue.x+Le[0],Ue.y+Le[1],Ue.z+Le[2]],ct=[...Oe,1];if(u.transformMat4$1(ct,ct,t),!kr(ct,X)){or(ue.numGlyphs,ne);continue}const Se=_n(o.transform.cameraToCenterDistance,ct[3]),Xe=u.evaluateSizeForFeature(B,$,ue),Ke=v?Xe/Se:Xe*Se,ke=dt(new u.pointGeometry(Oe[0],Oe[1]),d,Oe[2]);if(ke.signedDistanceFromCamera<=0){or(ue.numGlyphs,ne);continue}let Ce={};const Ct=v?null:T,ft=ir(ue,Ke,!1,E,t,d,g,f.glyphOffsetArray,W,ne,J,ke.point,xe,Ce,re,Ct,R.projection,S,v);pe=ft.useVertical,Ct&&ft.needsFlipping&&(Ce={}),(ft.notEnoughRoom||pe||ft.needsFlipping&&ir(ue,Ke,!0,E,t,d,g,f.glyphOffsetArray,W,ne,J,ke.point,xe,Ce,re,Ct,R.projection,S,v).notEnoughRoom)&&or(ue.numGlyphs,ne)}l?(f.text.dynamicLayoutVertexBuffer.updateData(ne),J&&f.text.globeExtVertexBuffer.updateData(J)):(f.icon.dynamicLayoutVertexBuffer.updateData(ne),J&&f.icon.globeExtVertexBuffer.updateData(J))}function ot(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne){const J=E.glyphStartIndex+E.numGlyphs,W=E.lineStartIndex,se=E.lineStartIndex+E.lineLength,re=t.getoffsetX(E.glyphStartIndex),pe=t.getoffsetX(J-1),ge=yn(f*re,o,l,d,g,v,E.segment,W,se,T,S,R,B,$,!0,K,X,ne);if(!ge)return null;const ue=yn(f*pe,o,l,d,g,v,E.segment,W,se,T,S,R,B,$,!0,K,X,ne);return ue?{first:ge,last:ue}:null}function pn(f,t,o,l){return f.writingMode===u.WritingMode.horizontal&&Math.abs(o.y-t.y)>Math.abs(o.x-t.x)*l?{useVertical:!0}:f.writingMode===u.WritingMode.vertical?t.y<o.y?{needsFlipping:!0}:null:0!==f.flipState&&function(d,g,v){const E=(g.x-d.x)*v;return 0===E||Math.abs((g.y-d.y)/E)>Li}(t,o,l)?1===f.flipState?{needsFlipping:!0}:null:t.x>o.x?{needsFlipping:!0}:null}function ir(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne,J,W,se){const re=t/24,pe=f.lineOffsetX*re,ge=f.lineOffsetY*re;let ue=[];if(f.numGlyphs>1){const xe=f.glyphStartIndex+f.numGlyphs,Le=f.lineStartIndex,Ue=f.lineStartIndex+f.lineLength,Oe=ot(re,E,pe,ge,o,B,$,f,T,g,K,ne,!1,J,W,se);if(!Oe)return{notEnoughRoom:!0};const ct=on(Oe.first.point,v).point,Se=on(Oe.last.point,v).point,Xe=new u.pointGeometry(ct[0],ct[1]),Ke=new u.pointGeometry(Se[0],Se[1]);if(l&&!o){const ke=pn(f,Xe,Ke,X);if(f.flipState=ke&&ke.needsFlipping?1:2,ke)return ke}ue=[Oe.first];for(let ke=f.glyphStartIndex+1;ke<xe-1;ke++){const Ce=yn(re*E.getoffsetX(ke),pe,ge,o,B,$,f.segment,Le,Ue,T,g,K,ne,!1,!1,J,W,se);if(!Ce)return{notEnoughRoom:!0};ue.push(Ce)}ue.push(Oe.last)}else{if(l&&!o){const Le=dt($,d).point,Ue=f.lineStartIndex+f.segment+1,Oe=new u.pointGeometry(T.getx(Ue),T.gety(Ue)),ct=dt(Oe,d),Se=ct.signedDistanceFromCamera>0?ct.point:$r($,Oe,Le,1,d,void 0,J,W.canonical),Xe=pn(f,new u.pointGeometry(Le[0],Le[1]),new u.pointGeometry(Se[0],Se[1]),X);if(f.flipState=Xe&&Xe.needsFlipping?1:2,Xe)return Xe}const xe=yn(re*E.getoffsetX(f.glyphStartIndex),pe,ge,o,B,$,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,T,g,K,ne,!1,!1,J,W,se);if(!xe)return{notEnoughRoom:!0};ue=[xe]}if(R)for(const xe of ue)u.updateGlobeVertexNormal(R,S.length+0,xe.up[0],xe.up[1],xe.up[2]),u.updateGlobeVertexNormal(R,S.length+1,xe.up[0],xe.up[1],xe.up[2]),u.updateGlobeVertexNormal(R,S.length+2,xe.up[0],xe.up[1],xe.up[2]),u.updateGlobeVertexNormal(R,S.length+3,xe.up[0],xe.up[1],xe.up[2]),u.addDynamicAttributes(S,xe.point[0],xe.point[1],xe.point[2],xe.angle);else for(const xe of ue)u.addDynamicAttributes(S,xe.point[0],xe.point[1],xe.point[2],xe.angle);return{}}function Zr(f,t,o,l,d){const g=l.projectTilePoint(f.x,f.y,t);if(!d)return dt(g,o,g.z);const v=d(f);return dt(new u.pointGeometry(g.x+v[0],g.y+v[1]),o,g.z+v[2])}function $r(f,t,o,l,d,g,v,E){const T=Zr(f.add(f.sub(t)._unit()),E,d,v,g).point,S=u.sub([],o,T);return u.scaleAndAdd([],o,S,l/u.length(S))}function yn(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne,J,W){const se=l?f-t:f+t;let re=se>0?1:-1,pe=0;l&&(re*=-1,pe=Math.PI),re<0&&(pe+=Math.PI);let ge=re>0?E+v:E+v+1,ue=d,xe=d,Le=0,Ue=0;const Oe=Math.abs(se),ct=[],Se=[];let Xe=g;const Ke=()=>{const yt=ge-re;return 0===Le?g:new u.pointGeometry(S.getx(yt),S.gety(yt))},ke=()=>{const yt=Ke();return $r(yt,Xe||yt,xe,Oe-Le+1,R,$,ne,J.canonical)};for(;Le+Ue<=Oe;){if(ge+=re,ge<E||ge>=T)return null;if(xe=ue,ct.push(ue),K&&Se.push(Xe||Ke()),ue=B[ge],void 0===ue){Xe=new u.pointGeometry(S.getx(ge),S.gety(ge));const yt=Zr(Xe,J.canonical,R,ne,$);ue=yt.signedDistanceFromCamera>0?B[ge]=yt.point:ke()}else Xe=null;Le+=Ue,Ue=u.distance(xe,ue)}Xe=Xe||new u.pointGeometry(S.getx(ge),S.gety(ge));const Ce=Ke();X&&$&&(B[ge]=ue=void 0===B[ge]?ue:ke(),Ue=u.distance(xe,ue));const Ct=(Oe-Le)/Ue,ft=Xe.sub(Ce).mult(Ct)._add(Ce),xt=u.sub([],ue,xe),_t=u.scaleAndAdd([],xe,xt,Ct);let Vt=[0,0,1],ln=xt[0],Qt=xt[1];if(W&&(Vt=ne.upVector(J.canonical,ft.x,ft.y),0!==Vt[0]||0!==Vt[1]||1!==Vt[2])){const yt=[1,0,0],vn=[0,1,0];yt[0]=Vt[2],yt[1]=0,yt[2]=-Vt[0],u.cross(vn,Vt,yt),u.normalize(yt,yt),u.normalize(vn,vn),ln=u.dot(xt,yt),Qt=u.dot(xt,vn)}if(o){const yt=u.cross([],Vt,xt);u.normalize(yt,yt),u.scaleAndAdd(_t,_t,yt,o*re)}const $t=pe+Math.atan2(Qt,ln);return ct.push(_t),K&&Se.push(ft),{point:_t,angle:$t,path:ct,tilePath:Se,up:Vt}}const Ps=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function or(f,t){for(let o=0;o<f;o++){const l=t.length;t.resize(l+4),t.float32.set(Ps,4*l)}}function Lo(f,t,o){const l=t[0],d=t[1];return f[0]=o[0]*l+o[4]*d+o[12],f[1]=o[1]*l+o[5]*d+o[13],f[3]=o[3]*l+o[7]*d+o[15],f}const oi=100;class En{constructor(t,o,l=new Tl(t.width+200,t.height+200,25),d=new Tl(t.width+200,t.height+200,25)){this.transform=t,this.grid=l,this.ignoredGrid=d,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+oi,this.screenBottomBoundary=t.height+oi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,l,d,g,v,E,T){let S=l.projectedAnchorX,R=l.projectedAnchorY,B=l.projectedAnchorZ;const $=l.elevation,K=l.tileID;if($&&K){const ge=t.getProjection().upVector(K.canonical,l.tileAnchorX,l.tileAnchorY),ue=t.getProjection().upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;S+=ge[0]*$*ue,R+=ge[1]*$*ue,B+=ge[2]*$*ue}const X=this.projectAndGetPerspectiveRatio(E,[S,R,B],l.tileID,"globe"===t.projection.name||!!$||this.transform.pitch>0,t.getProjection()),ne=v*X.perspectiveRatio,J=(l.x1*o+d.x-l.padding)*ne+X.point.x,W=(l.y1*o+d.y-l.padding)*ne+X.point.y,se=(l.x2*o+d.x+l.padding)*ne+X.point.x,re=(l.y2*o+d.y+l.padding)*ne+X.point.y,pe=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(J,W,se,re)||!g&&this.grid.hitTest(J,W,se,re,T)||pe?{box:[],offscreen:!1,occluded:X.occluded}:{box:[J,W,se,re],offscreen:this.isOffscreen(J,W,se,re),occluded:!1}}placeCollisionCircles(t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne){const J=[],W=this.transform.elevation,se=W?W.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,t.getProjection()):Ce=>[0,0,0],re=new u.pointGeometry(l.tileAnchorX,l.tileAnchorY),pe=t.getProjection().projectTilePoint(l.tileAnchorX,l.tileAnchorY,ne.canonical),ge=se(re),ue=[pe.x+ge[0],pe.y+ge[1],pe.z+ge[2]],xe="globe"===t.projection.name,Le=this.projectAndGetPerspectiveRatio(E,[ue[0],ue[1],ue[2]],ne,xe||!!W||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:Ue}=Le,Oe=(B?v/Ue:v*Ue)/u.ONE_EM,ct=dt(new u.pointGeometry(ue[0],ue[1]),T,ue[2]).point,Se=Le.signedDistanceFromCamera>0?ot(Oe,g,l.lineOffsetX*Oe,l.lineOffsetY*Oe,!1,ct,re,l,d,T,{},W&&!B?se:null,B&&!!W,t.getProjection(),ne,B):null;let Xe=!1,Ke=!1,ke=!0;if(Se&&!Le.occluded){const Ce=.5*K*Ue+X,Ct=new u.pointGeometry(-100,-100),ft=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),xt=new ko,_t=Se.first,Vt=Se.last;let ln=[];for(let yt=_t.path.length-1;yt>=1;yt--)ln.push(_t.path[yt]);for(let yt=1;yt<Vt.path.length;yt++)ln.push(Vt.path[yt]);const Qt=2.5*Ce;if(S){const yt=ln.map(W&&!xe?(vn,Mn)=>{const gr=se(Mn<_t.path.length-1?_t.tilePath[_t.path.length-1-Mn]:Vt.tilePath[Mn-_t.path.length+2]);return vn[2]=gr[2],on(vn,S)}:vn=>on(vn,S));ln=yt.some(vn=>vn.signedDistanceFromCamera<=0)?[]:yt.map(vn=>vn.point)}let $t=[];if(ln.length>0){const yt=ln.map(dr=>new u.pointGeometry(dr[0],dr[1]));let vn=1/0,Mn=-1/0,gr=1/0,yr=-1/0;for(let dr=0;dr<yt.length;dr++)vn=Math.min(vn,yt[dr].x),gr=Math.min(gr,yt[dr].y),Mn=Math.max(Mn,yt[dr].x),yr=Math.max(yr,yt[dr].y);$t=vn>=Ct.x&&Mn<=ft.x&&gr>=Ct.y&&yr<=ft.y?[yt]:Mn<Ct.x||vn>ft.x||yr<Ct.y||gr>ft.y?[]:u.clipLine([yt],Ct.x,Ct.y,ft.x,ft.y)}for(const yt of $t){xt.reset(yt,.25*Ce);let vn=0;vn=xt.length<=.5*Ce?1:Math.ceil(xt.paddedLength/Qt)+1;for(let Mn=0;Mn<vn;Mn++){const gr=Mn/Math.max(vn-1,1),yr=xt.lerp(gr),dr=yr.x+oi,Ai=yr.y+oi;J.push(dr,Ai,Ce,0);const To=dr-Ce,es=Ai-Ce,br=dr+Ce,Xr=Ai+Ce;if(ke=ke&&this.isOffscreen(To,es,br,Xr),Ke=Ke||this.isInsideGrid(To,es,br,Xr),!o&&this.grid.hitTestCircle(dr,Ai,Ce,$)&&(Xe=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!R&&Xe||!Ke?[]:J,offscreen:ke,collisionDetected:Xe,occluded:Le.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const o=[];let l=1/0,d=1/0,g=-1/0,v=-1/0;for(const R of t){const B=new u.pointGeometry(R.x+oi,R.y+oi);l=Math.min(l,B.x),d=Math.min(d,B.y),g=Math.max(g,B.x),v=Math.max(v,B.y),o.push(B)}const E=this.grid.query(l,d,g,v).concat(this.ignoredGrid.query(l,d,g,v)),T={},S={};for(const R of E){const B=R.key;if(void 0===T[B.bucketInstanceId]&&(T[B.bucketInstanceId]={}),T[B.bucketInstanceId][B.featureIndex])continue;const $=[new u.pointGeometry(R.x1,R.y1),new u.pointGeometry(R.x2,R.y1),new u.pointGeometry(R.x2,R.y2),new u.pointGeometry(R.x1,R.y2)];u.polygonIntersectsPolygon(o,$)&&(T[B.bucketInstanceId][B.featureIndex]=!0,void 0===S[B.bucketInstanceId]&&(S[B.bucketInstanceId]=[]),S[B.bucketInstanceId].push(B.featureIndex))}return S}insertCollisionBox(t,o,l,d,g){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:d,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,l,d,g){const v=o?this.ignoredGrid:this.grid,E={bucketInstanceId:l,featureIndex:d,collisionGroupID:g};for(let T=0;T<t.length;T+=4)v.insertCircle(E,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,o,l,d,g){const v=[o[0],o[1],o[2],1];let E=!1;if(o[2]||this.transform.pitch>0){u.transformMat4$1(v,v,t);const T="globe"===g.name;this.fogState&&l&&!T&&(E=function(S,R,B,$,K,X){const ne=X.calculateFogTileMatrix(K),J=[R,B,$];return u.transformMat4(J,J,ne),Ve(S,J,X.pitch,X._fov)}(this.fogState,o[0],o[1],o[2],l.toUnwrapped(),this.transform)>.9)}else Lo(v,v,t);return{point:new u.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+oi,(-v[1]/v[3]+1)/2*this.transform.height+oi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(g)/v[3]*.5,1.5),signedDistanceFromCamera:v[3],occluded:d&&v[2]>v[3]||E}}isOffscreen(t,o,l,d){return l<oi||t>=this.screenRightBoundary||d<oi||o>this.screenBottomBoundary}isInsideGrid(t,o,l,d){return l>=0&&t<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function go(f,t,o){const l=t.createTileMatrix(f,f.worldSize,o.toUnwrapped());return u.multiply(new Float32Array(16),f.projMatrix,l)}function as(f,t,o){if(t.projection.name===o.projection.name)return f.projMatrix;const l=o.clone();return l.setProjection(t.projection),go(l,t.getProjection(),f)}function Qr(f,t,o){return t.name===o.projection.name?f.projMatrix:go(o,t,f)}class _o{constructor(t,o,l,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):d&&l?1:0,this.placed=l}isHidden(){return 0===this.opacity&&!this.placed}}class Lr{constructor(t,o,l,d,g,v=!1){this.text=new _o(t?t.text:null,o,l,g),this.icon=new _o(t?t.icon:null,o,d,g),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qr{constructor(t,o,l,d=!1){this.text=t,this.icon=o,this.skipFade=l,this.clipped=d}}class Wn{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Mi{constructor(t,o,l,d,g){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=l,this.bucketIndex=d,this.tileID=g}}class Oi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:l=>l.collisionGroupID===o}}return this.collisionGroups[t]}}function ei(f,t,o,l,d){const{horizontalAlign:g,verticalAlign:v}=u.getAnchorAlignment(f),E=-(g-.5)*t,T=-(v-.5)*o,S=u.evaluateVariableOffset(f,l);return new u.pointGeometry(E+S[0]*d,T+S[1]*d)}function zn(f,t,o,l,d){const g=new u.pointGeometry(f,t);return o&&g._rotate(l?d:-d),g}class rc{constructor(t,o,l,d,g){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new En(this.transform,g),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Oi(l),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,l,d){const g=l.getBucket(o),v=l.latestFeatureIndex;if(!g||!v||o.id!==g.layerIds[0])return;const E=g.layers[0].layout,T=l.collisionBoxArray,S=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/u.EXTENT,B=l.tileID.toUnwrapped();this.transform.setProjection(g.projection);const $=(K=l.tileID,X=g.getProjection(),ne=this.transform,X.name===this.projection?ne.calculateProjMatrix(K.toUnwrapped()):go(ne,X,K));var K,X,ne;const J="map"===E.get("text-pitch-alignment"),W="map"===E.get("text-rotation-alignment");o.compileFilter();const se=o.dynamicFilter(),re=o.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(l),ge=qo($,l.tileID.canonical,J,W,this.transform,g.getProjection(),pe);let ue=null;if(J){const Ue=Un($,l.tileID.canonical,J,W,this.transform,g.getProjection(),pe);ue=u.multiply([],this.transform.labelPlaneMatrix,Ue)}let xe=null;se&&l.latestFeatureIndex&&(xe={unwrappedTileID:B,dynamicFilter:se,dynamicFilterNeedsFeature:re,featureIndex:l.latestFeatureIndex}),this.retainedQueryData[g.bucketInstanceId]=new Mi(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,l.tileID);const Le={bucket:g,layout:E,posMatrix:$,textLabelPlaneMatrix:ge,labelToScreenMatrix:ue,clippingData:xe,scale:S,textPixelRatio:R,holdingForFade:l.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(g.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(d)for(const Ue of g.sortKeyRanges){const{sortKey:Oe,symbolInstanceStart:ct,symbolInstanceEnd:Se}=Ue;t.push({sortKey:Oe,symbolInstanceStart:ct,symbolInstanceEnd:Se,parameters:Le})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne,J,W,se){const re=[$.textOffset0,$.textOffset1],pe=ei(t,l,d,re,g),ge=this.collisionIndex.placeCollisionBox(X,g,o,zn(pe.x,pe.y,v,E,this.transform.angle),B,T,S,R.predicate);if(J){const ue=X.getSymbolInstanceIconSize(se,this.transform.zoom,$.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(X,ue,J,zn(pe.x,pe.y,v,E,this.transform.angle),B,T,S,R.predicate).box.length)return}if(ge.box.length>0){let ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(ue=this.prevPlacement.variableOffsets[$.crossTileID].anchor),this.variableOffsets[$.crossTileID]={textOffset:re,width:l,height:d,anchor:t,textScale:g,prevAnchor:ue},this.markUsedJustification(X,t,$,ne),X.allowVerticalPlacement&&(this.markUsedOrientation(X,ne,$),this.placedOrientations[$.crossTileID]=ne),{shift:pe,placedGlyphBoxes:ge}}}placeLayerBucketPart(t,o,l,d){const{bucket:g,layout:v,posMatrix:E,textLabelPlaneMatrix:T,labelToScreenMatrix:S,clippingData:R,textPixelRatio:B,holdingForFade:$,collisionBoxArray:K,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:ne,collisionGroup:J}=t.parameters,W=v.get("text-optional"),se=v.get("icon-optional"),re=v.get("text-allow-overlap"),pe=v.get("icon-allow-overlap"),ge="map"===v.get("text-rotation-alignment"),ue="map"===v.get("text-pitch-alignment"),xe="none"!==v.get("icon-text-fit"),Le="viewport-y"===v.get("symbol-z-order");this.transform.setProjection(g.projection);let Ue=re&&(pe||!g.hasIconData()||se),Oe=pe&&(re||!g.hasTextData()||W);!g.collisionArrays&&K&&g.deserializeCollisionBoxes(K),l&&d&&g.updateCollisionDebugBuffers(this.transform.zoom,K);const ct=(Se,Xe,Ke)=>{if(R){const br={zoom:this.transform.zoom,pitch:this.transform.pitch};let Xr=null;if(R.dynamicFilterNeedsFeature){const sr=this.retainedQueryData[g.bucketInstanceId];Xr=R.featureIndex.loadFeature({featureIndex:Se.featureIndex,bucketIndex:sr.bucketIndex,sourceLayerIndex:sr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(br,Xr,this.retainedQueryData[g.bucketInstanceId].tileID.canonical,new u.pointGeometry(Se.tileAnchorX,Se.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[Se.crossTileID]=new qr(!1,!1,!1,!0),void(o[Se.crossTileID]=!0)}if(o[Se.crossTileID])return;if($)return void(this.placements[Se.crossTileID]=new qr(!1,!1,!1));let ke=!1,Ce=!1,Ct=!0,ft=!1,xt=!1,_t=null,Vt={box:null,offscreen:null,occluded:null},ln={box:null,offscreen:null,occluded:null},Qt=null,$t=null,yt=null,vn=0,Mn=0,gr=0;Ke.textFeatureIndex?vn=Ke.textFeatureIndex:Se.useRuntimeCollisionCircles&&(vn=Se.featureIndex),Ke.verticalTextFeatureIndex&&(Mn=Ke.verticalTextFeatureIndex);const yr=br=>{br.tileID=this.retainedQueryData[g.bucketInstanceId].tileID,(this.transform.elevation||br.elevation)&&(br.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[g.bucketInstanceId].tileID,br.tileAnchorX,br.tileAnchorY):0)},dr=Ke.textBox;if(dr){yr(dr);const br=sr=>{let Di=u.WritingMode.horizontal;if(g.allowVerticalPlacement&&!sr&&this.prevPlacement){const Hi=this.prevPlacement.placedOrientations[Se.crossTileID];Hi&&(this.placedOrientations[Se.crossTileID]=Hi,Di=Hi,this.markUsedOrientation(g,Di,Se))}return Di},Xr=(sr,Di)=>{if(g.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&Ke.verticalTextBox){for(const Hi of g.writingModes)if(Hi===u.WritingMode.vertical?(Vt=Di(),ln=Vt):Vt=sr(),Vt&&Vt.box&&Vt.box.length)break}else Vt=sr()};if(v.get("text-variable-anchor")){let sr=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Se.crossTileID]){const Dr=this.prevPlacement.variableOffsets[Se.crossTileID];sr.indexOf(Dr.anchor)>0&&(sr=sr.filter(jo=>jo!==Dr.anchor),sr.unshift(Dr.anchor))}const Di=(Dr,jo,jl)=>{const ts=g.getSymbolInstanceTextSize(X,Se,this.transform.zoom,Xe),Vo=(Dr.x2-Dr.x1)*ts+2*Dr.padding,eu=(Dr.y2-Dr.y1)*ts+2*Dr.padding,ra=xe&&!pe?jo:null;ra&&yr(ra);let ao={box:[],offscreen:!1,occluded:!1};const Aa=re?2*sr.length:sr.length;for(let Vl=0;Vl<Aa;++Vl){const ia=this.attemptAnchorPlacement(sr[Vl%sr.length],Dr,Vo,eu,ts,ge,ue,B,E,J,Vl>=sr.length,Se,Xe,g,jl,ra,X,ne);if(ia&&(ao=ia.placedGlyphBoxes,ao&&ao.box&&ao.box.length)){ke=!0,_t=ia.shift;break}}return ao};Xr(()=>Di(dr,Ke.iconBox,u.WritingMode.horizontal),()=>{const Dr=Ke.verticalTextBox;return Dr&&yr(Dr),g.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&Se.numVerticalGlyphVertices>0&&Dr?Di(Dr,Ke.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(ke=Vt.box,Ct=Vt.offscreen,ft=Vt.occluded);const Hi=br(Vt&&Vt.box);if(!ke&&this.prevPlacement){const Dr=this.prevPlacement.variableOffsets[Se.crossTileID];Dr&&(this.variableOffsets[Se.crossTileID]=Dr,this.markUsedJustification(g,Dr.anchor,Se,Hi))}}else{const sr=(Di,Hi)=>{const Dr=g.getSymbolInstanceTextSize(X,Se,this.transform.zoom,Xe),jo=this.collisionIndex.placeCollisionBox(g,Dr,Di,new u.pointGeometry(0,0),re,B,E,J.predicate);return jo&&jo.box&&jo.box.length&&(this.markUsedOrientation(g,Hi,Se),this.placedOrientations[Se.crossTileID]=Hi),jo};Xr(()=>sr(dr,u.WritingMode.horizontal),()=>{const Di=Ke.verticalTextBox;return g.allowVerticalPlacement&&Se.numVerticalGlyphVertices>0&&Di?(yr(Di),sr(Di,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),br(Vt&&Vt.box&&Vt.box.length)}}if(Qt=Vt,ke=Qt&&Qt.box&&Qt.box.length>0,Ct=Qt&&Qt.offscreen,ft=Qt&&Qt.occluded,Se.useRuntimeCollisionCircles){const br=g.text.placedSymbolArray.get(Se.centerJustifiedTextSymbolIndex>=0?Se.centerJustifiedTextSymbolIndex:Se.verticalPlacedTextSymbolIndex),Xr=u.evaluateSizeForFeature(g.textSizeData,X,br),sr=v.get("text-padding");$t=this.collisionIndex.placeCollisionCircles(g,re,br,g.lineVertexArray,g.glyphOffsetArray,Xr,E,T,S,l,ue,J.predicate,Se.collisionCircleDiameter*Xr/u.ONE_EM,sr,this.retainedQueryData[g.bucketInstanceId].tileID),ke=re||$t.circles.length>0&&!$t.collisionDetected,Ct=Ct&&$t.offscreen,ft=$t.occluded}if(Ke.iconFeatureIndex&&(gr=Ke.iconFeatureIndex),Ke.iconBox){const br=Xr=>{yr(Xr);const sr=xe&&_t?zn(_t.x,_t.y,ge,ue,this.transform.angle):new u.pointGeometry(0,0),Di=g.getSymbolInstanceIconSize(ne,this.transform.zoom,Se.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(g,Di,Xr,sr,pe,B,E,J.predicate)};ln&&ln.box&&ln.box.length&&Ke.verticalIconBox?(yt=br(Ke.verticalIconBox),Ce=yt.box.length>0):(yt=br(Ke.iconBox),Ce=yt.box.length>0),Ct=Ct&&yt.offscreen,xt=yt.occluded}const Ai=W||0===Se.numHorizontalGlyphVertices&&0===Se.numVerticalGlyphVertices,To=se||0===Se.numIconVertices;if(Ai||To?To?Ai||(Ce=Ce&&ke):ke=Ce&&ke:Ce=ke=Ce&&ke,ke&&Qt&&Qt.box&&this.collisionIndex.insertCollisionBox(Qt.box,v.get("text-ignore-placement"),g.bucketInstanceId,ln&&ln.box&&Mn?Mn:vn,J.ID),Ce&&yt&&this.collisionIndex.insertCollisionBox(yt.box,v.get("icon-ignore-placement"),g.bucketInstanceId,gr,J.ID),$t&&(ke&&this.collisionIndex.insertCollisionCircles($t.circles,v.get("text-ignore-placement"),g.bucketInstanceId,vn,J.ID),l)){const br=g.bucketInstanceId;let Xr=this.collisionCircleArrays[br];void 0===Xr&&(Xr=this.collisionCircleArrays[br]=new Wn);for(let sr=0;sr<$t.circles.length;sr+=4)Xr.circles.push($t.circles[sr+0]),Xr.circles.push($t.circles[sr+1]),Xr.circles.push($t.circles[sr+2]),Xr.circles.push($t.collisionDetected?1:0)}const es="globe"!==g.projection.name;Ue=Ue&&(es||!ft),Oe=Oe&&(es||!xt),this.placements[Se.crossTileID]=new qr(ke||Ue,Ce||Oe,Ct||g.justReloaded),o[Se.crossTileID]=!0};if(Le){const Se=g.getSortedSymbolIndexes(this.transform.angle);for(let Xe=Se.length-1;Xe>=0;--Xe){const Ke=Se[Xe];ct(g.symbolInstances.get(Ke),Ke,g.collisionArrays[Ke])}}else for(let Se=t.symbolInstanceStart;Se<t.symbolInstanceEnd;Se++)ct(g.symbolInstances.get(Se),Se,g.collisionArrays[Se]);if(l&&g.bucketInstanceId in this.collisionCircleArrays){const Se=this.collisionCircleArrays[g.bucketInstanceId];u.invert(Se.invProjMatrix,E),Se.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(t,o,l,d){let g;g=d===u.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(o)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const E of v)E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=g>=0&&E!==g?0:l.crossTileID)}markUsedOrientation(t,o,l){const d=o===u.WritingMode.horizontal||o===u.WritingMode.horizontalOnly?o:0,g=o===u.WritingMode.vertical?o:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex].filter(E=>-1!==E);for(const E of v)t.text.placedSymbolArray.get(E).placedOrientation=d;-1!==l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let l=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(t):1,g=o?o.opacities:{},v=o?o.variableOffsets:{},E=o?o.placedOrientations:{};for(const T in this.placements){const S=this.placements[T],R=g[T];R?(this.opacities[T]=new Lr(R,d,S.text,S.icon,null,S.clipped),l=l||S.text!==R.text.placed||S.icon!==R.icon.placed):(this.opacities[T]=new Lr(null,d,S.text,S.icon,S.skipFade,S.clipped),l=l||S.text||S.icon)}for(const T in g){const S=g[T];if(!this.opacities[T]){const R=new Lr(S,d,!1,!1);R.isHidden()||(this.opacities[T]=R,l=l||S.text.placed||S.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in E)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=E[T]);l?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o){const l={};for(const d of o){const g=d.getBucket(t);g&&d.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,l,d.collisionBoxArray)}}updateBucketOpacities(t,o,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const d=t.layers[0].layout,g=!!t.layers[0].dynamicFilter(),v=new Lr(null,0,!1,!1,!0),E=d.get("text-allow-overlap"),T=d.get("icon-allow-overlap"),S=d.get("text-variable-anchor"),R="map"===d.get("text-rotation-alignment"),B="map"===d.get("text-pitch-alignment"),$="none"!==d.get("icon-text-fit"),K=new Lr(null,0,E&&(T||!t.hasIconData()||d.get("icon-optional")),T&&(E||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&l&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(l);const X=(J,W,se)=>{for(let re=0;re<W/4;re++)J.opacityVertexArray.emplaceBack(se)};let ne=0;for(let J=0;J<t.symbolInstances.length;J++){const W=t.symbolInstances.get(J),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:re,crossTileID:pe}=W;let ge=this.opacities[pe];o[pe]?ge=v:ge||(ge=K,this.opacities[pe]=ge),o[pe]=!0;const ue=se>0||re>0,xe=W.numIconVertices>0,Le=this.placedOrientations[W.crossTileID],Ue=Le===u.WritingMode.vertical,Oe=Le===u.WritingMode.horizontal||Le===u.WritingMode.horizontalOnly;if(!ue&&!xe||ge.isHidden()||ne++,ue){const ct=zr(ge.text);X(t.text,se,Ue?ai:ct),X(t.text,re,Oe?ai:ct);const Se=ge.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(ke=>{ke>=0&&(t.text.placedSymbolArray.get(ke).hidden=Se||Ue?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=Se||Oe?1:0);const Xe=this.variableOffsets[W.crossTileID];Xe&&this.markUsedJustification(t,Xe.anchor,W,Le);const Ke=this.placedOrientations[W.crossTileID];Ke&&(this.markUsedJustification(t,"left",W,Ke),this.markUsedOrientation(t,Ke,W))}if(xe){const ct=zr(ge.icon);W.placedIconSymbolIndex>=0&&(X(t.icon,W.numIconVertices,Ue?ai:ct),t.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=ge.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,W.numVerticalIconVertices,Oe?ai:ct),t.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=ge.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ct=t.collisionArrays[J];if(ct){let Se=new u.pointGeometry(0,0),Xe=!0;if(ct.textBox||ct.verticalTextBox){if(S){const ke=this.variableOffsets[pe];ke?(Se=ei(ke.anchor,ke.width,ke.height,ke.textOffset,ke.textScale),R&&Se._rotate(B?this.transform.angle:-this.transform.angle)):Xe=!1}g&&(Xe=!ge.clipped),ct.textBox&&Rs(t.textCollisionBox.collisionVertexArray,ge.text.placed,!Xe||Ue,Se.x,Se.y),ct.verticalTextBox&&Rs(t.textCollisionBox.collisionVertexArray,ge.text.placed,!Xe||Oe,Se.x,Se.y)}const Ke=Xe&&Boolean(!Oe&&ct.verticalIconBox);ct.iconBox&&Rs(t.iconCollisionBox.collisionVertexArray,ge.icon.placed,Ke,$?Se.x:0,$?Se.y:0),ct.verticalIconBox&&Rs(t.iconCollisionBox.collisionVertexArray,ge.icon.placed,!Ke,$?Se.x:0,$?Se.y:0)}}}if(t.fullyClipped=0===ne,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const l=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function Rs(f,t,o,l,d){f.emplaceBack(t?1:0,o?1:0,l||0,d||0),f.emplaceBack(t?1:0,o?1:0,l||0,d||0),f.emplaceBack(t?1:0,o?1:0,l||0,d||0),f.emplaceBack(t?1:0,o?1:0,l||0,d||0)}const Or=Math.pow(2,25),ks=Math.pow(2,24),Ls=Math.pow(2,17),ls=Math.pow(2,16),Fr=Math.pow(2,9),si=Math.pow(2,8),Cl=Math.pow(2,1);function zr(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const t=f.placed?1:0,o=Math.floor(127*f.opacity);return o*Or+t*ks+o*Ls+t*ls+o*Fr+t*si+o*Cl+t}const ai=0;class cs{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,o,l,d,g){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(v,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((E,T)=>E.sortKey-T.sortKey));this._currentPartIndex<v.length;){const E=v[this._currentPartIndex];if(o.placeLayerBucketPart(E,this._seenCrossTileIDs,l,0===E.symbolInstanceStart),this._currentPartIndex++,g())return!0}return!1}}class _a{constructor(t,o,l,d,g,v,E,T){this.placement=new rc(t,g,v,E,T),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,o,l){const d=u.exported.now(),g=()=>{const v=u.exported.now()-d;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=o[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if("symbol"===v.type&&(!v.minzoom||v.minzoom<=E)&&(!v.maxzoom||v.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new cs(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Os=512/u.EXTENT/2;class li{constructor(t,o,l){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=l;for(let d=0;d<o.length;d++){const g=o.get(d),v=g.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,o){const l=Os/Math.pow(2,o.canonical.z-this.tileID.canonical.z);return{x:Math.floor((o.canonical.x*u.EXTENT+t.tileAnchorX)*l),y:Math.floor((o.canonical.y*u.EXTENT+t.tileAnchorY)*l)}}findMatches(t,o,l){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let g=0;g<t.length;g++){const v=t.get(g);if(v.crossTileID)continue;const E=this.indexedSymbolInstances[v.key];if(!E)continue;const T=this.getScaledCoordinates(v,o);for(const S of E)if(Math.abs(S.coord.x-T.x)<=d&&Math.abs(S.coord.y-T.y)<=d&&!l[S.crossTileID]){l[S.crossTileID]=!0,v.crossTileID=S.crossTileID;break}}}}class ya{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class yo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(0!==o)for(const l in this.indexes){const d=this.indexes[l],g={};for(const v in d){const E=d[v];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+o),g[E.tileID.key]=E}this.indexes[l]=g}this.lng=t}addBucket(t,o,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<o.symbolInstances.length;g++)o.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const v=this.indexes[g];if(Number(g)>t.overscaledZ)for(const E in v){const T=v[E];T.tileID.isChildOf(t)&&T.findMatches(o.symbolInstances,t,d)}else{const E=v[t.scaledTo(Number(g)).key];E&&E.findMatches(o.symbolInstances,t,d)}}for(let g=0;g<o.symbolInstances.length;g++){const v=o.symbolInstances.get(g);v.crossTileID||(v.crossTileID=l.generate(),d[v.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new li(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const l in o.indexedSymbolInstances)for(const d of o.indexedSymbolInstances[l])delete this.usedCrossTileIDs[t][d.crossTileID]}removeStaleBuckets(t){let o=!1;for(const l in this.indexes){const d=this.indexes[l];for(const g in d)t[d[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,d[g]),delete d[g],o=!0)}return o}}class eo{constructor(){this.layerIndexes={},this.crossTileIDs=new ya,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,l,d){let g=this.layerIndexes[t.id];void 0===g&&(g=this.layerIndexes[t.id]=new yo);let v=!1;const E={};"globe"!==d.name&&g.handleWrapJump(l);for(const T of o){const S=T.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(T.tileID,S,this.crossTileIDs)&&(v=!0),E[S.bucketInstanceId]=!0)}return g.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(t){const o={};t.forEach(l=>{o[l]=!0});for(const l in this.layerIndexes)o[l]||delete this.layerIndexes[l]}}const vo=(f,t)=>u.emitValidationErrors(f,t&&t.filter(o=>"source.canvas"!==o.identifier)),Ua=u.pick(Jt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),us=u.pick(Jt,["setCenter","setZoom","setBearing","setPitch"]),Fs={version:8,layers:[],sources:{}},ja={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Wo extends u.Evented{constructor(t,o={}){super(),this.map=t,this.dispatcher=new lr(Ot(),this),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(t._requestManager,o.localFontFamily?u.LocalGlyphMode.all:o.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,o.localFontFamily||o.localIdeographFontFamily),this.crossTileSymbolIndex=new eo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const l=this;this._rtlTextPluginCallback=Wo.registerForPluginStateChange(d=>{l.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(g,v)=>{if(u.triggerPluginCompletionEvent(g),v&&v.every(E=>E))for(const E in l._sourceCaches){const T=l._sourceCaches[E],S=T.getSource().type;"vector"!==S&&"geojson"!==S||T.reload()}})}),this.on("data",d=>{if("source"!==d.dataType||"metadata"!==d.sourceDataType)return;const g=this.getSource(d.sourceId);if(g&&g.vectorLayerIds)for(const v in this._layers){const E=this._layers[v];E.source===g.id&&this._validateLayer(E)}})}loadURL(t,o={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const l="boolean"==typeof o.validate?o.validate:!u.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,o.accessToken);const d=this.map._requestManager.transformRequest(t,u.ResourceType.Style);this._request=u.getJSON(d,(g,v)=>{this._request=null,g?this.fire(new u.ErrorEvent(g)):v&&this._load(v,l)})}loadJSON(t,o={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(t,!1!==o.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Fs,!1)}_updateLayerCount(t,o){const l=o?1:-1;t.is3D()&&(this._num3DLayers+=l),"circle"===t.type&&(this._numCircleLayers+=l),"symbol"===t.type&&(this._numSymbolLayers+=l)}_load(t,o){if(o&&vo(this,u.validateStyle(t)))return;this._loaded=!0,this.stylesheet=u.clone$1(t),this._updateMapProjection();for(const d in t.sources)this.addSource(d,t.sources[d],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const l=Ln(this.stylesheet.layers);this._order=l.map(d=>d.id),this._layers={},this._serializedLayers={};for(let d of l)d=u.createStyleLayer(d),d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(t){this._spriteRequest=function(o,l,d){let g,v,E;const T=u.exported.devicePixelRatio>1?"@2x":"";let S=u.getJSON(l.transformRequest(l.normalizeSpriteURL(o,T,".json"),u.ResourceType.SpriteJSON),($,K)=>{S=null,E||(E=$,g=K,B())}),R=u.getImage(l.transformRequest(l.normalizeSpriteURL(o,T,".png"),u.ResourceType.SpriteImage),($,K)=>{R=null,E||(E=$,v=K,B())});function B(){if(E)d(E);else if(g&&v){const $=u.exported.getImageData(v),K={};for(const X in g){const{width:ne,height:J,x:W,y:se,sdf:re,pixelRatio:pe,stretchX:ge,stretchY:ue,content:xe}=g[X],Le=new u.RGBAImage({width:ne,height:J});u.RGBAImage.copy($,Le,{x:W,y:se},{x:0,y:0},{width:ne,height:J}),K[X]={data:Le,pixelRatio:pe,sdf:re,stretchX:ge,stretchY:ue,content:xe}}d(null,K)}}return{cancel(){S&&(S.cancel(),S=null),R&&(R.cancel(),R=null)}}}(t,this.map._requestManager,(o,l)=>{if(this._spriteRequest=null,o)this.fire(new u.ErrorEvent(o));else if(l)for(const d in l)this.imageManager.addImage(d,l[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(t){const o=this.getSource(t.source);if(!o)return;const l=t.sourceLayer;l&&("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(l))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${l}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const o=[];for(const l of t){const d=this._layers[l];"custom"!==d.type&&o.push(d.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&ja[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const o=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(d.length||g.length)&&this._updateWorkerLayers(d,g);for(const v in this._updatedSources){const E=this._updatedSources[v];"reload"===E?this._reloadSource(v):"clear"===E&&this._clearSource(v)}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const l={};for(const d in this._sourceCaches){const g=this._sourceCaches[d];l[d]=g.used,g.used=!1}for(const d of this._order){const g=this._layers[d];if(g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)){const E=this._getLayerSourceCache(g);E&&(E.used=!0)}const v=this.map.painter;if(v){const E=g.getProgramIds();if(!E)continue;const T=g.getProgramConfiguration(t.zoom);for(const S of E)v.useProgram(S,T)}}for(const d in l){const g=this._sourceCaches[d];l[d]!==g.used&&g.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:g.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),o&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const o in this._sourceCaches)this._sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,o){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),vo(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=Ln(t.layers);const o=function(d,g){if(!d)return[{command:Jt.setStyle,args:[g]}];let v=[];try{if(!Te(d.version,g.version))return[{command:Jt.setStyle,args:[g]}];Te(d.center,g.center)||v.push({command:Jt.setCenter,args:[g.center]}),Te(d.zoom,g.zoom)||v.push({command:Jt.setZoom,args:[g.zoom]}),Te(d.bearing,g.bearing)||v.push({command:Jt.setBearing,args:[g.bearing]}),Te(d.pitch,g.pitch)||v.push({command:Jt.setPitch,args:[g.pitch]}),Te(d.sprite,g.sprite)||v.push({command:Jt.setSprite,args:[g.sprite]}),Te(d.glyphs,g.glyphs)||v.push({command:Jt.setGlyphs,args:[g.glyphs]}),Te(d.transition,g.transition)||v.push({command:Jt.setTransition,args:[g.transition]}),Te(d.light,g.light)||v.push({command:Jt.setLight,args:[g.light]}),Te(d.fog,g.fog)||v.push({command:Jt.setFog,args:[g.fog]}),Te(d.projection,g.projection)||v.push({command:Jt.setProjection,args:[g.projection]});const E={},T=[];!function(B,$,K,X){let ne;for(ne in $=$||{},B=B||{})B.hasOwnProperty(ne)&&($.hasOwnProperty(ne)||qn(ne,K,X));for(ne in $)$.hasOwnProperty(ne)&&(B.hasOwnProperty(ne)?Te(B[ne],$[ne])||("geojson"===B[ne].type&&"geojson"===$[ne].type&&mo(B,$,ne)?K.push({command:Jt.setGeoJSONSourceData,args:[ne,$[ne].data]}):po(ne,$,K,X)):On(ne,$,K))}(d.sources,g.sources,T,E);const S=[];d.layers&&d.layers.forEach(B=>{B.source&&E[B.source]?v.push({command:Jt.removeLayer,args:[B.id]}):S.push(B)});let R=d.terrain;R&&E[R.source]&&(v.push({command:Jt.setTerrain,args:[void 0]}),R=void 0),v=v.concat(T),Te(R,g.terrain)||v.push({command:Jt.setTerrain,args:[g.terrain]}),function(B,$,K){$=$||[];const X=(B=B||[]).map(Qi),ne=$.map(Qi),J=B.reduce(Rr,{}),W=$.reduce(Rr,{}),se=X.slice(),re=Object.create(null);let pe,ge,ue,xe,Le,Ue,Oe;for(pe=0,ge=0;pe<X.length;pe++)ue=X[pe],W.hasOwnProperty(ue)?ge++:(K.push({command:Jt.removeLayer,args:[ue]}),se.splice(se.indexOf(ue,ge),1));for(pe=0,ge=0;pe<ne.length;pe++)ue=ne[ne.length-1-pe],se[se.length-1-pe]!==ue&&(J.hasOwnProperty(ue)?(K.push({command:Jt.removeLayer,args:[ue]}),se.splice(se.lastIndexOf(ue,se.length-ge),1)):ge++,Ue=se[se.length-pe],K.push({command:Jt.addLayer,args:[W[ue],Ue]}),se.splice(se.length-pe,0,ue),re[ue]=!0);for(pe=0;pe<ne.length;pe++)if(ue=ne[pe],xe=J[ue],Le=W[ue],!re[ue]&&!Te(xe,Le))if(Te(xe.source,Le.source)&&Te(xe["source-layer"],Le["source-layer"])&&Te(xe.type,Le.type)){for(Oe in $e(xe.layout,Le.layout,K,ue,null,Jt.setLayoutProperty),$e(xe.paint,Le.paint,K,ue,null,Jt.setPaintProperty),Te(xe.filter,Le.filter)||K.push({command:Jt.setFilter,args:[ue,Le.filter]}),Te(xe.minzoom,Le.minzoom)&&Te(xe.maxzoom,Le.maxzoom)||K.push({command:Jt.setLayerZoomRange,args:[ue,Le.minzoom,Le.maxzoom]}),xe)xe.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&(0===Oe.indexOf("paint.")?$e(xe[Oe],Le[Oe],K,ue,Oe.slice(6),Jt.setPaintProperty):Te(xe[Oe],Le[Oe])||K.push({command:Jt.setLayerProperty,args:[ue,Oe,Le[Oe]]}));for(Oe in Le)Le.hasOwnProperty(Oe)&&!xe.hasOwnProperty(Oe)&&"layout"!==Oe&&"paint"!==Oe&&"filter"!==Oe&&"metadata"!==Oe&&"minzoom"!==Oe&&"maxzoom"!==Oe&&(0===Oe.indexOf("paint.")?$e(xe[Oe],Le[Oe],K,ue,Oe.slice(6),Jt.setPaintProperty):Te(xe[Oe],Le[Oe])||K.push({command:Jt.setLayerProperty,args:[ue,Oe,Le[Oe]]}))}else K.push({command:Jt.removeLayer,args:[ue]}),Ue=se[se.lastIndexOf(ue)+1],K.push({command:Jt.addLayer,args:[Le,Ue]})}(S,g.layers,v)}catch(E){console.warn("Unable to compute style diff:",E),v=[{command:Jt.setStyle,args:[g]}]}return v}(this.serialize(),t).filter(d=>!(d.command in us));if(0===o.length)return!1;const l=o.filter(d=>!(d.command in Ua));if(l.length>0)throw new Error(`Unimplemented: ${l.map(d=>d.command).join(", ")}.`);return o.forEach(d=>{"setTransition"!==d.command&&"setProjection"!==d.command&&this[d.command].apply(this,d.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,o){return this.getImage(t)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,o),this._afterImageUpdated(t),this)}updateImage(t,o){this.imageManager.updateImage(t,o)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,o,l={}){if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(u.validateSource,`sources.${t}`,o,null,l))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=Me(t,o,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:d.serialize(),sourceId:t}));const g=v=>{const E=(v?"symbol:":"other:")+t,T=this._sourceCaches[E]=new u.SourceCache(E,d,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[t]=T,T.style=this,T.onAdd(this.map)};g(!1),"vector"!==o.type&&"geojson"!==o.type||g(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const o=this.getSource(t);if(!o)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const l=this._getSourceCaches(t);for(const d of l)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getSource(t).setData(o),this._changed=!0}getSource(t){const o=this._getSourceCache(t);return o&&o.getSource()}_getSources(){const t=[];for(const o in this._otherSourceCaches){const l=this._getSourceCache(o);l&&t.push(l.getSource())}return t}addLayer(t,o,l={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let g;if("custom"===t.type){if(vo(this,u.validateCustomStyleLayer(t)))return;g=u.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(d,t.source),t=u.clone$1(t),t=u.extend(t,{source:d})),this._validate(u.validateLayer,`layers.${d}`,t,{arrayIndex:-1},l))return;g=u.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[g.id]=g.serialize(),this._updateLayerCount(g,!0)}const v=o?this._order.indexOf(o):this._order.length;if(o&&-1===v)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`)));this._order.splice(v,0,d),this._layerOrderChanged=!0,this._layers[d]=g;const E=this._getLayerSourceCache(g);if(this._removedLayers[d]&&g.source&&E&&"custom"!==g.type){const T=this._removedLayers[d];delete this._removedLayers[d],T.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",E.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,o){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===o)return;const l=this._order.indexOf(t);this._order.splice(l,1);const d=o?this._order.indexOf(o):this._order.length;o&&-1===d?this.fire(new u.ErrorEvent(new Error(`Layer with id "${o}" does not exist on this map.`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const o=this._layers[t];if(!o)return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));o.setEventedParent(null),this._updateLayerCount(o,!1);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=o,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],o.onRemove&&o.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,l){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===o&&d.maxzoom===l||(null!=o&&(d.minzoom=o),null!=l&&(d.maxzoom=l),this._updateLayer(d)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,o,l={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!Te(d.filter,o))return null==o?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(u.validateFilter,`layers.${d.id}.filter`,o,{layerType:d.type},l)||(d.filter=u.clone$1(o),this._updateLayer(d)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){const o=this.getLayer(t);return o&&u.clone$1(o.filter)}setLayoutProperty(t,o,l,d={}){this._checkLoaded();const g=this.getLayer(t);g?Te(g.getLayoutProperty(o),l)||(g.setLayoutProperty(o,l,d),this._updateLayer(g)):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,o){const l=this.getLayer(t);if(l)return l.getLayoutProperty(o);this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,o,l,d={}){this._checkLoaded();const g=this.getLayer(t);g?Te(g.getPaintProperty(o),l)||(g.setPaintProperty(o,l,d)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,o){const l=this.getLayer(t);return l&&l.getPaintProperty(o)}setFeatureState(t,o){this._checkLoaded();const l=t.source,d=t.sourceLayer,g=this.getSource(l);if(!g)return void this.fire(new u.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const v=g.type;if("geojson"===v&&d)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===v&&!d)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(l);for(const T of E)T.setFeatureState(d,t.id,o)}removeFeatureState(t,o){this._checkLoaded();const l=t.source,d=this.getSource(l);if(!d)return void this.fire(new u.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)));const g=d.type,v="vector"===g?t.sourceLayer:void 0;if("vector"===g&&!v)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(l);for(const T of E)T.removeFeatureState(v,t.id,o)}getFeatureState(t){this._checkLoaded();const o=t.source,l=t.sourceLayer,d=this.getSource(o);if(d){if("vector"!==d.type||l)return void 0===t.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(o)[0].getFeatureState(l,t.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const o in this._sourceCaches){const l=this._sourceCaches[o].getSource();t[l.id]||(t[l.id]=l.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},o=>void 0!==o)}_updateLayer(t){this._updatedLayers[t.id]=!0;const o=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&o&&"raster"!==o.getSource().type&&(this._updatedSources[t.source]="reload",o.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=v=>"fill-extrusion"===this._layers[v].type,l={},d=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(o(E)){l[E]=v;for(const T of t){const S=T[E];if(S)for(const R of S)d.push(R)}}}d.sort((v,E)=>E.intersectionZ-v.intersectionZ);const g=[];for(let v=this._order.length-1;v>=0;v--){const E=this._order[v];if(o(E))for(let T=d.length-1;T>=0;T--){const S=d[T].feature;if(l[S.layer.id]<v)break;g.push(S),d.pop()}else for(const T of t){const S=T[E];if(S)for(const R of S)g.push(R.feature)}}return g}queryRenderedFeatures(t,o,l){o&&o.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const T of o.layers){const S=this._layers[T];if(!S)return this.fire(new u.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];d[S.source]=!0}}const g=[];o.availableImages=this._availableImages;const v=o&&o.layers?o.layers.some(T=>{const S=this.getLayer(T);return S&&S.is3D()}):this.has3DLayers(),E=Mr.createFromScreenPoints(t,l);for(const T in this._sourceCaches){const S=this._sourceCaches[T].getSource().id;o.layers&&!d[S]||g.push(Q(this._sourceCaches[T],this._layers,this._serializedLayers,E,o,l,v,!!this.map._showQueryGeometry))}return this.placement&&g.push(function(T,S,R,B,$,K,X){const ne={},J=K.queryRenderedSymbols(B),W=[];for(const se of Object.keys(J).map(Number))W.push(X[se]);W.sort(te);for(const se of W){const re=se.featureIndex.lookupSymbolFeatures(J[se.bucketInstanceId],S,se.bucketIndex,se.sourceLayerIndex,$.filter,$.layers,$.availableImages,T);for(const pe in re){const ge=ne[pe]=ne[pe]||[],ue=re[pe];ue.sort((xe,Le)=>{const Ue=se.featureSortOrder;if(Ue){const Oe=Ue.indexOf(xe.featureIndex);return Ue.indexOf(Le.featureIndex)-Oe}return Le.featureIndex-xe.featureIndex});for(const xe of ue)ge.push(xe)}}for(const se in ne)ne[se].forEach(re=>{const pe=re.feature,ge=R(T[se]).getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=ge});return ne}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,o,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,o){o&&o.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",o.filter,null,o);const l=this._getSourceCaches(t);let d=[];for(const g of l)d=d.concat(ee(g,o));return d}addSourceType(t,o,l){return Wo.getSourceType(t)?l(new Error(`A source type called "${t}" already exists.`)):(Wo.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},l):l(null,null))}getLight(){return this.light.getLight()}setLight(t,o={}){this._checkLoaded();const l=this.light.getLight();let d=!1;for(const v in t)if(!Te(t[v],l[v])){d=!0;break}if(!d)return;const g=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,o),this.light.updateTransitions(g)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,o=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===o){if("object"==typeof t.source){const l="terrain-dem-src";this.addSource(l,t.source),t=u.clone$1(t),t=u.extend(t,{source:l})}if(this._validate(u.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&o!==this.terrain.drapeRenderMode)this._createTerrain(t,o);else{const l=this.terrain,d=l.get();for(const g of Object.keys(u.spec.terrain))!t.hasOwnProperty(g)&&u.spec.terrain[g].default&&(t[g]=u.spec.terrain[g].default);for(const g in t)if(!Te(t[g],d[g])){l.set(t),this.stylesheet.terrain=t;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new Gn(t,this.map.transform);this.stylesheet.fog=t;const l=this._setTransitionParameters({duration:0});o.updateTransitions(l)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog,l=o.get();0===Object.keys(t).length&&o.set(t);for(const d in t)if(!Te(t[d],l[d])){o.set(t),this.stylesheet.fog=t;const g=this._setTransitionParameters({duration:0});o.updateTransitions(g);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:u.exported.now(),transition:u.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(l=>this.isLayerDraped(this._layers[l])),o=this._order.filter(l=>!this.isLayerDraped(this._layers[l]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const l=this.terrain=new Ye(t,o);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const d=this._setTransitionParameters({duration:0});l.updateTransitions(d)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];"fill-extrusion"===o.type&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];"symbol"===o.type&&this._updateLayer(o)}}_validate(t,o,l,d,g={}){return(!g||!1!==g.validate)&&vo(this,t.call(u.validateStyle,u.extend({key:o,style:this.serialize(),value:l,styleSpec:u.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const o=this._getSourceCaches(t);for(const l of o)l.clearTiles()}_reloadSource(t){const o=this._getSourceCaches(t);for(const l of o)l.resume(),l.reload()}_reloadSources(){for(const t of this._getSources())t.reload&&t.reload()}_updateSources(t){for(const o in this._sourceCaches)this._sourceCaches[o].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,l,d,g=!1){let v=!1,E=!1;const T={};for(const S of this._order){const R=this._layers[S];if("symbol"!==R.type)continue;if(!T[R.source]){const $=this._getLayerSourceCache(R);if(!$)continue;T[R.source]=$.getRenderableIds(!0).map(K=>$.getTileByID(K)).sort((K,X)=>X.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(X.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(R,T[R.source],t.center.lng,t.projection);v=v||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),g=g||this._layerOrderChanged||0===l,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(g||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),t.zoom))&&(this.pauseablePlacement=new _a(t,this._order,g,o,l,d,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),E=!0),v&&this.pauseablePlacement.placement.setStale()),E||v)for(const S of this._order){const R=this._layers[S];"symbol"===R.type&&this.placement.updateLayerOpacities(R,T[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,o,l){this.imageManager.getImages(o.icons,l),this._updateTilesForChangedImages();const d=g=>{g&&g.setDependencies(o.tileID.key,o.type,o.icons)};d(this._otherSourceCaches[o.source]),d(this._symbolSourceCaches[o.source])}getGlyphs(t,o,l){this.glyphManager.getGlyphs(o.stacks,l)}getResource(t,o,l){return u.makeRequest(o,l)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this._getSourceCaches(t);return 0===o.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):o.every(l=>l.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Wo.getSourceType=function(f){return Pe[f]},Wo.setSourceType=function(f,t){Pe[f]=t},Wo.registerForPluginStateChange=u.registerForPluginStateChange;var Il="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Sl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ic="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",oc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",sc="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Va={},ac={};const xo=[];to(Il,xo),to(ic,xo),to(oc,xo),to(sc,xo),Va=Kn("",ic),ac=Kn(sc,oc);const lc=Kn("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ml=Il,hs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var cc={background:Kn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Kn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Kn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Kn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Kn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Kn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Kn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Kn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Kn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Kn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Kn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Kn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Kn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Kn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Kn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Kn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Kn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Kn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Kn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Kn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Kn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Kn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Kn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sl),skyboxGradient:Kn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sl),skyboxCapture:Kn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Kn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function to(f,t){const o=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let l of o)if(l=l.trim(),"#"===l[0]&&l.includes("if")&&!l.includes("endif")){l=l.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=l.split(" ");for(const g of d)t.includes(g)||t.push(g)}}function Kn(f,t){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),d={},g=[...xo];return to(f,g),to(t,g),{fragmentSource:f=f.replace(o,(v,E,T,S,R)=>(d[R]=!0,"define"===E?`\n#ifndef HAS_UNIFORM_u_${R}\nvarying ${T} ${S} ${R};\n#else\nuniform ${T} ${S} u_${R};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${R}\n    ${T} ${S} ${R} = u_${R};\n#endif\n`)),vertexSource:t=t.replace(o,(v,E,T,S,R)=>{const B="float"===S?"vec2":"vec4",$=R.match(/color/)?"color":B;return d[R]?"define"===E?`\n#ifndef HAS_UNIFORM_u_${R}\nuniform lowp float u_${R}_t;\nattribute ${T} ${B} a_${R};\nvarying ${T} ${S} ${R};\n#else\nuniform ${T} ${S} u_${R};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${R}\n    ${R} = a_${R};\n#else\n    ${T} ${S} ${R} = u_${R};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${R}\n    ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);\n#else\n    ${T} ${S} ${R} = u_${R};\n#endif\n`:"define"===E?`\n#ifndef HAS_UNIFORM_u_${R}\nuniform lowp float u_${R}_t;\nattribute ${T} ${B} a_${R};\n#else\nuniform ${T} ${S} u_${R};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${R}\n    ${T} ${S} ${R} = a_${R};\n#else\n    ${T} ${S} ${R} = u_${R};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${R}\n    ${T} ${S} ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);\n#else\n    ${T} ${S} ${R} = u_${R};\n#endif\n`}),staticAttributes:l,usedDefines:g}}class no{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,l,d,g,v,E){this.context=t;let T=this.boundPaintVertexBuffers.length!==d.length;for(let R=0;!T&&R<d.length;R++)this.boundPaintVertexBuffers[R]!==d[R]&&(T=!0);let S=this.boundDynamicVertexBuffers.length!==E.length;for(let R=0;!S&&R<E.length;R++)this.boundDynamicVertexBuffers[R]!==E[R]&&(S=!0);if(!t.extVertexArrayObject||!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==l||T||S||this.boundIndexBuffer!==g||this.boundVertexOffset!==v)this.freshBind(o,l,d,g,v,E);else{t.bindVertexArrayOES.set(this.vao);for(const R of E)R&&R.bind();g&&g.dynamicDraw&&g.bind()}}freshBind(t,o,l,d,g,v){let E;const T=t.numAttributes,S=this.context,R=S.gl;if(S.extVertexArrayObject)this.vao&&this.destroy(),this.vao=S.extVertexArrayObject.createVertexArrayOES(),S.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=d,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=v;else{E=S.currentNumAttributes||0;for(let B=T;B<E;B++)R.disableVertexAttribArray(B)}o.enableAttributes(R,t),o.bind(),o.setVertexAttribPointers(R,t,g);for(const B of l)B.enableAttributes(R,t),B.bind(),B.setVertexAttribPointers(R,t,g);for(const B of v)B&&(B.enableAttributes(R,t),B.bind(),B.setVertexAttribPointers(R,t,g));d&&d.bind(),S.currentNumAttributes=T}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function $a(f,t){const o=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new u.MercatorCoordinate(0,l/o).toLngLat().lat,new u.MercatorCoordinate(0,(l+1)/o).toLngLat().lat]}function Oo(f,t,o,l,d,g,v){const E=f.context,T=E.gl,S=o.fbo;if(!S)return;f.prepareDrawTile();const R=f.useProgram("hillshade");E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get());const B=((ne,J,W,se)=>{const re=W.paint.get("hillshade-shadow-color"),pe=W.paint.get("hillshade-highlight-color"),ge=W.paint.get("hillshade-accent-color");let ue=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(ue-=ne.transform.angle);const xe=!ne.options.moving;return{u_matrix:se||ne.transform.calculateProjMatrix(J.tileID.toUnwrapped(),xe),u_image:0,u_latrange:$a(0,J.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ue],u_shadow:re,u_highlight:pe,u_accent:ge}})(f,o,l,f.terrain?t.projMatrix:null);f.prepareDrawProgram(E,R,t.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:K,tileBoundsSegments:X}=f.getTileBoundsBuffers(o);R.draw(E,T.TRIANGLES,d,g,v,u.CullFaceMode.disabled,B,l.id,$,K,X)}function Xo(f,t,o){if(!t.needsDEMTextureUpload)return;const l=f.context,d=l.gl;l.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(o.stride);const g=o.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new u.Texture(l,g,d.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Ga(f,t,o,l,d,g){const v=f.context,E=v.gl;if(!t.dem)return;const T=t.dem;if(v.activeTexture.set(E.TEXTURE1),Xo(f,t,T),!t.demTexture)return;t.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const S=T.dim;v.activeTexture.set(E.TEXTURE0);let R=t.fbo;if(!R){const X=new u.Texture(v,{width:S,height:S,data:null},E.RGBA);X.bind(E.LINEAR,E.CLAMP_TO_EDGE),R=t.fbo=v.createFramebuffer(S,S,!0),R.colorAttachment.set(X.texture)}v.bindFramebuffer.set(R.framebuffer),v.viewport.set([0,0,S,S]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:K}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(v,E.TRIANGLES,l,d,g,u.CullFaceMode.disabled,((X,ne)=>{const J=ne.stride,W=u.create();return u.ortho(W,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(W,W,[0,-u.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[J,J],u_zoom:X.overscaledZ,u_unpack:ne.unpackVector}})(t.tileID,T),o.id,B,$,K),t.needsHillshadePrepare=!1}const zs=f=>({u_matrix:new u.UniformMatrix4f(f),u_image0:new u.Uniform1i(f),u_skirt_height:new u.Uniform1f(f)}),Ha=(f,t)=>({u_matrix:f,u_image0:0,u_skirt_height:t}),Bs=(f,t,o,l,d,g,v,E,T,S,R,B,$,K)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(l),u_merc_matrix:o,u_zoom_transition:d,u_merc_center:g,u_image0:0,u_frustum_tl:v,u_frustum_tr:E,u_frustum_br:T,u_frustum_bl:S,u_globe_pos:R,u_globe_radius:B,u_viewport:$,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9)});function va(f,t){return null!=f&&null!=t&&!(!f.hasData()||!t.hasData())&&null!=f.demTexture&&null!=t.demTexture&&f.tileID.key!==t.tileID.key}const Yo=new class{constructor(){this.operations={}}newMorphing(f,t,o,l,d){if(f in this.operations){const g=this.operations[f];g.to.tileID.key!==o.tileID.key&&(g.queued=o)}else this.operations[f]={startTime:l,phase:0,duration:d,from:t,to:o,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const o=this.operations[t];for(o.phase=(f-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},xa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Dn(f,t){const o=1<<f.z;return!t&&(0===f.x||f.x===o-1)||0===f.y||f.y===o-1}const Ns=f=>({u_matrix:f});function Za(f,t,o,l,d){if(d>0){const g=u.exported.now(),v=(g-f.timeAdded)/d,E=t?(g-t.timeAdded)/d:-1,T=o.getSource(),S=l.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-S)>Math.abs(f.tileID.overscaledZ-S),B=R&&f.refreshedUponExpiration?1:u.clamp(R?v:1-E,0,1);return f.refreshedUponExpiration&&v>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class qa extends u.SourceCache{constructor(t){const o={type:"raster-dem",maxzoom:t.transform.maxZoom},l=new lr(Ot(),null),d=Me("mock-dem",o,l,t.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class uc extends u.SourceCache{constructor(t){const o=Me("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new lr(Ot(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,l){if(t.freezeTileCoverage)return;this.transform=t;const d=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,v)=>{if(g[v.key]="",!this._tiles[v.key]){const E=new u.Tile(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);E.state="loaded",this._tiles[v.key]=E}return g},{});for(const g in this._tiles)g in d||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const o=this.proxyCachedFBO[t];if(void 0!==o){const l=Object.values(o);this.renderCachePool.push(...l),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Al extends u.OverscaledTileID{constructor(t,o,l){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=l}}class Br extends u.Elevation{constructor(t,o){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[l,d,g]=function(T){const S=new u.StructArrayLayout4i8,R=new u.StructArrayLayout3ui6,B=131;S.reserve(17161),R.reserve(33800);const $=u.EXTENT/128,K=u.EXTENT+$/2,X=K+$;for(let J=-$;J<X;J+=$)for(let W=-$;W<X;W+=$){const se=W<0||W>K||J<0||J>K?24575:0,re=u.clamp(Math.round(W),0,u.EXTENT),pe=u.clamp(Math.round(J),0,u.EXTENT);S.emplaceBack(re+se,pe,re,pe)}const ne=(J,W)=>{const se=W*B+J;R.emplaceBack(se+1,se,se+B),R.emplaceBack(se+B,se+B+1,se+1)};for(let J=1;J<129;J++)for(let W=1;W<129;W++)ne(W,J);return[0,129].forEach(J=>{for(let W=0;W<130;W++)ne(W,J),ne(J,W)}),[S,R,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(l,u.boundsAttributes.members),this.gridIndexBuffer=v.createIndexBuffer(d),this.gridSegments=u.SegmentVector.simpleSegment(0,0,l.length,d.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,l.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new uc(o.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const E=v.gl;this._overlapStencilMode=new u.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new qa(o.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,o,l){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const d=t.terrain.properties;this.sourceCache=0===t.terrain.drapeRenderMode?this._mockSourceCache:t._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const g=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const v=this.getScaledDemTileSize();this.sourceCache.update(o,v,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,g(),this._initializing=!0),g(),o.updateElevation(!l),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==t.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,l=this.painter.transform;this._initializing&&(this._initializing=0===l._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(l.center),-1),this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=o.getIds().map(T=>{const S=o.getTileByID(T).tileID;return S.projMatrix=l.calculateProjMatrix(S.toUnwrapped()),S});(function(T,S){const R=S.transform.pointCoordinate(S.transform.getCameraPoint()),B=new u.pointGeometry(R.x,R.y);T.sort(($,K)=>{if(K.overscaledZ-$.overscaledZ)return K.overscaledZ-$.overscaledZ;const X=new u.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ne=new u.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),J=B.mult(1<<$.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(X)-J.distSqr(ne)})})(d,this.painter),this._previousZoom=l.zoom;const g=this.proxyToSource||{};this.proxyToSource={},d.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};const v=this._style._sourceCaches;for(const T in v){const S=v[T];if(!S.used||(S!==this.sourceCache&&this.resetTileLookupCache(S.id),this._setupProxiedCoordsForOrtho(S,t[T],g),S.usedForTerrain))continue;const R=t[T];S.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[o.id]=d.map(T=>new Al(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const E={};this._visibleDemTiles=[];for(const T of this.proxyCoords){const S=this.terrainTileForTile[T.key];if(!S)continue;const R=S.tileID.key;R in E||(this._visibleDemTiles.push(S),E[R]=R)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const l=this._findTileCoveringTileID(o,this.sourceCache);l&&(this.terrainTileForTile[o.key]=l)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const l in this.terrainTileForTile){const d=this.terrainTileForTile[l],g=d.dem;!g||d.demTexture&&!d.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Xo(this.painter,d,g))}}_prepareDemTileUniforms(t,o,l,d){if(!o||null==o.demTexture)return!1;const g=t.tileID.canonical,v=Math.pow(2,o.tileID.canonical.z-g.z),E=d||"";return l[`u_dem_tl${E}`]=[g.x*v%1,g.y*v%1],l[`u_dem_scale${E}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,o=t.gl;if(!this._emptyDepthBufferTexture){const l=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(t,l,o.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const o=this._visibleDemTiles.reduce((l,d)=>{if(!d.dem)return l;const g=d.dem.tree.minimums[0];return g>0&&t++,l+g},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const l=this._getLoadedAreaMinimum(),d=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(l,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(d,{premultiply:!1}):g=this._emptyDEMTexture=new u.Texture(t,d,o.RGBA,{premultiply:!1}),g}setupElevationDraw(t,o,l){const d=this.painter.context,g=d.gl,v=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var E;v.u_dem_size=this.sourceCache.getSource().tileSize,v.u_exaggeration=this.exaggeration();let T=null,S=null,R=1;if(l&&l.morphing&&this._useVertexMorphing){const B=l.morphing.srcDemTile,$=l.morphing.dstDemTile;R=l.morphing.phase,B&&$&&(this._prepareDemTileUniforms(t,B,v,"_prev")&&(S=B),this._prepareDemTileUniforms(t,$,v)&&(T=$))}if(S&&T?(d.activeTexture.set(g.TEXTURE2),T.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),d.activeTexture.set(g.TEXTURE4),S.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE,g.NEAREST),v.u_dem_lerp=R):(T=this.terrainTileForTile[t.tileID.key],d.activeTexture.set(g.TEXTURE2),(this._prepareDemTileUniforms(t,T,v)?T.demTexture:this.emptyDEMTexture).bind(g.NEAREST,g.CLAMP_TO_EDGE)),d.activeTexture.set(g.TEXTURE3),l&&l.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),this._depthFBO&&(v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),v.u_depth_size_inv=[1,1]),l&&l.useMeterToDem&&T){const B=(1<<T.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=B}if(l&&l.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=l.labelPlaneMatrixInv),o.setTerrainUniformValues(d,v),"globe"===this.painter.transform.projection.name){const B=this.globeUniformValues(this.painter.transform,t.tileID.canonical,l&&l.useDenormalizedUpVectorScale);o.setGlobeUniformValues(d,B)}}globeUniformValues(t,o,l){const d=t.projection;return{u_tile_tl_up:d.upVector(o,0,0),u_tile_tr_up:d.upVector(o,u.EXTENT,0),u_tile_br_up:d.upVector(o,u.EXTENT,u.EXTENT),u_tile_bl_up:d.upVector(o,0,u.EXTENT),u_tile_up_scale:l?u.GLOBE_METERS_TO_ECEF:d.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,l=this.painter.context;0!==t.length&&(l.bindFramebuffer.set(null),l.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,g,v,E,T){if("globe"===d.transform.projection.name)!function(S,R,B,$,K){const X=S.context,ne=X.gl;let J,W;const se=S.options.showTerrainWireframe?2:0,re=S.transform,pe=u.globeUseCustomAntiAliasing(S,X,re),ge=(ke,Ce)=>{if(W===ke)return;const Ct=[xa[ke],"PROJECTION_GLOBE_VIEW"];pe&&Ct.push("CUSTOM_ANTIALIASING"),Ce&&Ct.push(xa[se]),J=S.useProgram("globeRaster",null,Ct),W=ke},ue=S.colorModeForRenderPass(),xe=new u.DepthMode(ne.LEQUAL,u.DepthMode.ReadWrite,S.depthRangeFor3D);Yo.update(K);const Le=u.calculateGlobeMercatorMatrix(re),Ue=[u.mercatorXfromLng(re.center.lng),u.mercatorYfromLat(re.center.lat)],Oe=se?[!1,!0]:[!1],ct=S.globeSharedBuffers,Se=[re.width*u.exported.devicePixelRatio,re.height*u.exported.devicePixelRatio],Xe=Float32Array.from(re.globeMatrix),Ke={useDenormalizedUpVectorScale:!0};if(Oe.forEach(ke=>{W=-1;const Ce=ke?ne.LINES:ne.TRIANGLES;for(const Ct of $){const ft=B.getTile(Ct),xt=u.StencilMode.disabled,_t=R.prevTerrainTileForTile[Ct.key],Vt=R.terrainTileForTile[Ct.key];va(_t,Vt)&&Yo.newMorphing(Ct.key,_t,Vt,K,250),X.activeTexture.set(ne.TEXTURE0),ft.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const ln=Yo.getMorphValuesForProxy(Ct.key),Qt=ln?1:0;ln&&u.extend$1(Ke,{morphing:{srcDemTile:ln.from,dstDemTile:ln.to,phase:u.easeCubicInOut(ln.phase)}});const $t=u.tileCornersToBounds(Ct.canonical),yt=u.getLatitudinalLod($t.getCenter().lat),vn=u.getGridMatrix(Ct.canonical,$t,yt,re.worldSize/re._pixelsPerMercatorPixel),Mn=u.globeNormalizeECEF(u.globeTileBounds(Ct.canonical)),gr=Bs(re.projMatrix,Xe,Le,Mn,u.globeToMercatorTransition(re.zoom),Ue,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Se,vn);if(ge(Qt,ke),R.setupElevationDraw(ft,J,Ke),S.prepareDrawProgram(X,J,Ct.toUnwrapped()),ct){const[yr,dr,Ai]=ke?ct.getWirefameBuffers(S.context,yt):ct.getGridBuffers(yt);J.draw(X,Ce,xe,xt,ue,u.CullFaceMode.backCCW,gr,"globe_raster",yr,dr,Ai)}}}),ct){const ke=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&ke.push("CUSTOM_ANTIALIASING"),J=S.useProgram("globeRaster",null,ke);for(const Ce of $){const{x:Ct,y:ft,z:xt}=Ce.canonical,_t=0===ft,Vt=ft===(1<<xt)-1,[ln,Qt,$t,yt]=ct.getPoleBuffers(xt);if(yt&&(_t||Vt)){const vn=B.getTile(Ce);X.activeTexture.set(ne.TEXTURE0),vn.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);let Mn=u.globePoleMatrixForTile(xt,Ct,re);const gr=u.globeNormalizeECEF(u.globeTileBounds(Ce.canonical)),yr=(dr,Ai)=>dr.draw(X,ne.TRIANGLES,xe,u.StencilMode.disabled,ue,u.CullFaceMode.disabled,Bs(re.projMatrix,Mn,Mn,gr,0,Ue,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Se),"globe_pole_raster",Ai,$t,yt);R.setupElevationDraw(vn,J,Ke),S.prepareDrawProgram(X,J,Ce.toUnwrapped()),_t&&yr(J,ln),Vt&&(Mn=u.scale(u.create(),Mn,[1,-1,1]),yr(J,Qt))}}}}(d,g,v,E,T);else{const S=d.context,R=S.gl;let B,$;const K=d.options.showTerrainWireframe?2:0,X=(re,pe)=>{if($===re)return;const ge=[xa[re]];pe&&ge.push(xa[K]),B=d.useProgram("terrainRaster",null,ge),$=re},ne=d.colorModeForRenderPass(),J=new u.DepthMode(R.LEQUAL,u.DepthMode.ReadWrite,d.depthRangeFor3D);Yo.update(T);const W=d.transform,se=6*Math.pow(1.5,22-W.zoom)*g.exaggeration();(K?[!1,!0]:[!1]).forEach(re=>{$=-1;const pe=re?R.LINES:R.TRIANGLES,[ge,ue]=re?g.getWirefameBuffer():[g.gridIndexBuffer,g.gridSegments];for(const xe of E){const Le=v.getTile(xe),Ue=u.StencilMode.disabled,Oe=g.prevTerrainTileForTile[xe.key],ct=g.terrainTileForTile[xe.key];va(Oe,ct)&&Yo.newMorphing(xe.key,Oe,ct,T,250),S.activeTexture.set(R.TEXTURE0),Le.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Se=Yo.getMorphValuesForProxy(xe.key),Xe=Se?1:0;let Ke;Se&&(Ke={morphing:{srcDemTile:Se.from,dstDemTile:Se.to,phase:u.easeCubicInOut(Se.phase)}});const ke=Ha(xe.projMatrix,Dn(xe.canonical,W.renderWorldCopies)?se/10:se);X(Xe,re),g.setupElevationDraw(Le,B,Ke),d.prepareDrawProgram(S,B,xe.toUnwrapped()),B.draw(S,pe,J,Ue,ne,u.CullFaceMode.backCCW,ke,"terrain_raster",g.gridBuffer,ge,ue)}})}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const o=this.painter,l=this.painter.context,d=this.proxySourceCache,g=this.proxiedCoords[d.id],v=this._drapedRenderBatches.shift(),E=[],T=o.style.order;let S=0;for(const R of g){const B=d.getTileByID(R.proxyTileKey),$=d.proxyCachedFBO[R.key]?d.proxyCachedFBO[R.key][t]:void 0,K=void 0!==$?d.renderCache[$]:this.pool[S++],X=void 0!==$;if(B.texture=K.tex,X&&!K.dirty){E.push(B.tileID);continue}let ne;l.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(l.clear({color:u.Color.transparent,stencil:0}),K.dirty=!1);for(let J=v.start;J<=v.end;++J){const W=o.style._layers[T[J]];if(W.isHidden(o.transform.zoom))continue;const se=o.style._getLayerSourceCache(W),re=se?this.proxyToSource[R.key][se.id]:[R];if(!re)continue;const pe=re;l.viewport.set([0,0,K.fb.width,K.fb.height]),ne!==(se?se.id:null)&&(this._setupStencil(K,re,W,se),ne=se?se.id:null),o.renderLayer(o,se,W,pe)}this.renderedToTile?(K.dirty=!0,E.push(B.tileID)):X||--S,5===S&&(S=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,l.bindFramebuffer.set(null),l.viewport.set([0,0,o.width,o.height]),v.end+1}postRender(){}renderCacheEfficiency(t){const o=t.order.length;if(0===o)return{efficiency:100};let l,d=0,g=0,v=!1;for(let E=0;E<o;++E){const T=t._layers[t.order[E]];this._style.isLayerDraped(T)?(v&&++d,++g):v||(v=!0,l=T.id)}return 0===g?{efficiency:100}:{efficiency:100*(1-d/g),firstUndrapedLayer:l}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,o,l){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const v=g.tileID,E=1<<v.overscaledZ,{x:T,y:S}=v.canonical,R=T/E,B=(T+1)/E,$=S/E,K=(S+1)/E;return{minx:R,miny:$,maxx:B,maxy:K,t:g.dem.tree.raycastRoot(R,$,B,K,t,o,l),tile:g}});d.sort((g,v)=>(null!==g.t?g.t:Number.MAX_VALUE)-(null!==v.t?v.t:Number.MAX_VALUE));for(const g of d){if(null==g.t)return null;const v=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,o,l);if(null!=v)return v}return null}_createFBO(){const t=this.painter.context,o=t.gl,l=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const d=new u.Texture(t,{width:l[0],height:l[1],data:null},o.RGBA);d.bind(o.LINEAR,o.CLAMP_TO_EDGE);const g=t.createFramebuffer(l[0],l[1],!1);return g.colorAttachment.set(d.texture),g.depthAttachment=new fo(t,g.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,l[0],l[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._layers[t],l=o.isHidden(this.painter.transform.zoom),d=o.getCrossfadeParameters(),g=!!d&&1!==d.t,v=o.hasTransition();return"custom"!==o.type&&!l&&(g||v)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o]._source instanceof V){t=!0;break}if(t)for(let o=0;o<this._style.order.length;++o){const l=this._style._layers[this._style.order[o]],d=l.isHidden(this.painter.transform.zoom),g=this._style._getLayerSourceCache(l);if("raster"!==l.type||d||!g)continue;const v=l.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const T=this.proxyToSource[E.key][g.id];if(T)for(const S of T){const R=Za(g.getTile(S),g.findLoadedParent(S,0),g,this.painter.transform,v);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(g.id,S)}}}}_setupDrapedRenderBatches(){const t=this._style.order,o=t.length;if(0===o)return;const l=[];let d,g=0,v=this._style._layers[t[g]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++g<o;)v=this._style._layers[t[g]];for(;g<o;++g){const E=this._style._layers[t[g]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?void 0===d&&(d=g):void 0!==d&&(l.push({start:d,end:g-1}),d=void 0))}void 0!==d&&l.push({start:d,end:g-1}),this._drapedRenderBatches=l}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const v=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let E=0;E<v.length;++E){const T=Object.values(v[E]);o.renderCachePool.push(...T)}}return}this._clearRasterFadeFromRenderCache();const l=this.proxyCoords,d=this._tilesDirty;for(let v=l.length-1;v>=0;v--){const E=l[v];if(o.getTileByID(E.key),void 0!==o.proxyCachedFBO[E.key]){const T=t[E.key],S=this.proxyToSource[E.key];let R=0;for(const B in S){const $=S[B],K=T[B];if(!K||K.length!==$.length||$.some((X,ne)=>X!==K[ne]||d[B]&&d[B].hasOwnProperty(X.key))){R=-1;break}++R}for(const B in o.proxyCachedFBO[E.key])o.renderCache[o.proxyCachedFBO[E.key][B]].dirty=R<0||R!==Object.values(T).length}}const g=[...this._drapedRenderBatches];g.sort((v,E)=>E.end-E.start-(v.end-v.start));for(const v of g)for(const E of l){if(o.proxyCachedFBO[E.key])continue;let T=o.renderCachePool.pop();void 0===T&&o.renderCache.length<50&&(T=o.renderCache.length,o.renderCache.push(this._createFBO())),void 0!==T&&(o.proxyCachedFBO[E.key]={},o.proxyCachedFBO[E.key][v.start]=T,o.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,l,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,v=g.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let E;if(l.isTileClipped())E=o.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,l.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(t,o){const l=this.painter,d=this.painter.context,g=d.gl;l._tileClippingMaskIDs={},d.setColorMode(u.ColorMode.disabled),d.setDepthMode(u.DepthMode.disabled);const v=l.useProgram("clippingMask");for(const E of t){const T=l._tileClippingMaskIDs[E.key]=--o;v.draw(d,g.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:g.ALWAYS,mask:0},T,255,g.KEEP,g.KEEP,g.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Ns(E.projMatrix),"$clipping",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const l=[t.x,t.y,1,1];u.transformMat4$1(l,l,o.pixelMatrixInverse),u.scale$1(l,l,1/l[3]),l[0]/=o.worldSize,l[1]/=o.worldSize;const d=o._camera.position,g=u.mercatorZfromAltitude(1,o.center.lat),v=[d[0],d[1],d[2]/g,0],E=u.subtract([],l.slice(0,3),v);u.normalize(E,E);const T=this.raycast(v,E,this._exaggeration);return null!==T&&T?(u.scaleAndAdd(v,v,E,T),v[3]=v[2],v[2]*=g,v):null}drawDepth(){const t=this.painter,o=t.context,l=this.proxySourceCache,d=Math.ceil(t.width),g=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===g||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const v=o.gl,E=o.createFramebuffer(d,g,!0);o.activeTexture.set(v.TEXTURE0);const T=new u.Texture(o,{width:d,height:g,data:null},v.RGBA);T.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.colorAttachment.set(T.texture);const S=o.createRenderbuffer(o.gl.DEPTH_COMPONENT16,d,g);E.depthAttachment.set(S),this._depthFBO=E,this._depthTexture=T}o.bindFramebuffer.set(this._depthFBO.framebuffer),o.viewport.set([0,0,d,g]),function(v,E,T,S){if("globe"===v.transform.projection.name)return;const R=v.context,B=R.gl;R.clear({depth:1});const $=v.useProgram("terrainDepth"),K=new u.DepthMode(B.LESS,u.DepthMode.ReadWrite,v.depthRangeFor3D);for(const X of S){const ne=T.getTile(X),J=Ha(X.projMatrix,0);E.setupElevationDraw(ne,$),$.draw(R,B.TRIANGLES,K,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,J,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(t,this,l,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,o,l){if(t.getSource()instanceof ye)return this._setupProxiedCoordsForImageSource(t,o,l);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const d=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let E=0;E<g.length;E++){const T=g[E],S=this._findTileCoveringTileID(T,t);if(S){const R=this._createProxiedId(T,S,l[T.key]&&l[T.key][t.id]);d.push(R),this.proxyToSource[T.key][t.id]=[R]}}let v=!1;for(let E=0;E<o.length;E++){const T=t.getTile(o[E]);if(!T||!T.hasData())continue;const S=this._findTileCoveringTileID(T.tileID,this.proxySourceCache);if(S&&S.tileID.canonical.z!==T.tileID.canonical.z){const R=this.proxyToSource[S.tileID.key][t.id],B=this._createProxiedId(S.tileID,T,l[S.tileID.key]&&l[S.tileID.key][t.id]);R?R.splice(R.length-1,0,B):this.proxyToSource[S.tileID.key][t.id]=[B],d.push(B),v=!0}}this._sourceTilesOverlap[t.id]=v}_setupProxiedCoordsForImageSource(t,o,l){if(!t.getSource().loaded())return;const d=this.proxiedCoords[t.id]=[],g=this.proxyCoords,v=t.getSource(),E=new u.pointGeometry(v.tileID.x,v.tileID.y)._div(1<<v.tileID.z),T=v.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((R,B)=>(R.min.x=Math.min(R.min.x,B.x-E.x),R.min.y=Math.min(R.min.y,B.y-E.y),R.max.x=Math.max(R.max.x,B.x-E.x),R.max.y=Math.max(R.max.y,B.y-E.y),R),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),S=(R,B)=>{const $=R.wrap+R.canonical.x/(1<<R.canonical.z),K=R.canonical.y/(1<<R.canonical.z),X=u.EXTENT/(1<<R.canonical.z),ne=B.wrap+B.canonical.x/(1<<B.canonical.z),J=B.canonical.y/(1<<B.canonical.z);return $+X<ne+T.min.x||$>ne+T.max.x||K+X<J+T.min.y||K>J+T.max.y};for(let R=0;R<g.length;R++){const B=g[R];for(let $=0;$<o.length;$++){const K=t.getTile(o[$]);if(!K||!K.hasData()||S(B,K.tileID))continue;const X=this._createProxiedId(B,K,l[B.key]&&l[B.key][t.id]),ne=this.proxyToSource[B.key][t.id];ne?ne.push(X):this.proxyToSource[B.key][t.id]=[X],d.push(X)}}}_createProxiedId(t,o,l){let d=this.orthoMatrix;if(l){const g=l.find(v=>v.key===o.tileID.key);if(g)return g}if(o.tileID.key!==t.key){const g=t.canonical.z-o.tileID.canonical.z;let v,E,T;d=u.create();const S=o.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(v=u.EXTENT>>g,E=v*((o.tileID.canonical.x<<g)-t.canonical.x+S),T=v*((o.tileID.canonical.y<<g)-t.canonical.y)):(v=u.EXTENT<<-g,E=u.EXTENT*(o.tileID.canonical.x-(t.canonical.x+S<<-g)),T=u.EXTENT*(o.tileID.canonical.y-(t.canonical.y<<-g))),u.ortho(d,0,v,0,v,0,1),u.translate(d,d,[E,T,0])}return new Al(o.tileID,t.key,d)}_findTileCoveringTileID(t,o){let l=o.getTile(t);if(l&&l.hasData())return l;const d=this._findCoveringTileCache[o.id],g=d[t.key];if(l=g?o.getTileByID(g):null,l&&l.hasData()||null===g)return l;let v=l?l.tileID:t,E=v.overscaledZ;const T=o.getSource().minzoom,S=[];if(!g){const B=o.getSource().maxzoom;if(t.canonical.z>=B){const $=t.canonical.z-B;o.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,o.transform.tileZoom),v=new u.OverscaledTileID(E,t.wrap,B,t.canonical.x>>$,t.canonical.y>>$)):0!==$&&(E=B,v=new u.OverscaledTileID(E,t.wrap,B,t.canonical.x>>$,t.canonical.y>>$))}v.key!==t.key&&(S.push(v.key),l=o.getTile(v))}const R=B=>{S.forEach($=>{d[$]=B}),S.length=0};for(E-=1;E>=T&&(!l||!l.hasData());E--){l&&R(l.tileID.key);const B=v.calculateScaledKey(E);if(l=o.getTileByID(B),l&&l.hasData())break;const $=d[B];if(null===$)break;void 0===$?S.push(B):l=o.getTileByID($)}return R(l?l.tileID.key:null),l&&l.hasData()?l:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let l=this._tilesDirty[t];l||(l=this._tilesDirty[t]={}),l[o.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(o){let l=0;const d=new u.StructArrayLayout2ui4,g=131;for(let v=1;v<129;v++){for(let E=1;E<129;E++)l=v*g+E,d.emplaceBack(l,l+1),d.emplaceBack(l,l+g),d.emplaceBack(l+1,l+g),128===v&&d.emplaceBack(l+g,l+g+1);d.emplaceBack(l+1,l+1+g)}return d}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ro{static cacheKey(t,o,l,d){let g=`${o}${d?d.cacheKey:""}`;for(const v of l)t.usedDefines.includes(v)&&(g+=`/${v}`);return g}constructor(t,o,l,d,g,v){const E=t.gl;this.program=E.createProgram();const T=function(J){const W=[];for(let se=0;se<J.length;se++){if(null===J[se])continue;const re=J[se].split(" ");W.push(re.pop())}return W}(l.staticAttributes),S=d?d.getBinderAttributes():[],R=T.concat(S);let B=d?d.defines():[];B=B.concat(v.map(J=>`#define ${J}`));const $=B.concat(t.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(hs):hs,hs,Ml,lc.fragmentSource,ac.fragmentSource,l.fragmentSource).join("\n"),K=B.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ml,lc.vertexSource,ac.vertexSource,Va.vertexSource,l.vertexSource).join("\n"),X=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(X,$),E.compileShader(X),E.attachShader(this.program,X);const ne=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(ne,K),E.compileShader(ne),E.attachShader(this.program,ne),this.attributes={},this.numAttributes=R.length;for(let J=0;J<this.numAttributes;J++)R[J]&&(E.bindAttribLocation(this.program,J,R[J]),this.attributes[R[J]]=J);E.linkProgram(this.program),E.deleteShader(ne),E.deleteShader(X),this.fixedUniforms=g(t),this.binderUniforms=d?d.getUniforms(t):[],v.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(J=t),u_dem_prev:new u.Uniform1i(J),u_dem_unpack:new u.Uniform4f(J),u_dem_tl:new u.Uniform2f(J),u_dem_scale:new u.Uniform1f(J),u_dem_tl_prev:new u.Uniform2f(J),u_dem_scale_prev:new u.Uniform1f(J),u_dem_size:new u.Uniform1f(J),u_dem_lerp:new u.Uniform1f(J),u_exaggeration:new u.Uniform1f(J),u_depth:new u.Uniform1i(J),u_depth_size_inv:new u.Uniform2f(J),u_meter_to_dem:new u.Uniform1f(J),u_label_plane_matrix_inv:new u.UniformMatrix4f(J)}),v.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new u.Uniform3f(J),u_tile_tr_up:new u.Uniform3f(J),u_tile_br_up:new u.Uniform3f(J),u_tile_bl_up:new u.Uniform3f(J),u_tile_up_scale:new u.Uniform1f(J)}))(t)),v.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new u.UniformMatrix4f(J),u_fog_range:new u.Uniform2f(J),u_fog_color:new u.Uniform4f(J),u_fog_horizon_blend:new u.Uniform1f(J),u_fog_temporal_offset:new u.Uniform1f(J),u_frustum_tl:new u.Uniform3f(J),u_frustum_tr:new u.Uniform3f(J),u_frustum_br:new u.Uniform3f(J),u_frustum_bl:new u.Uniform3f(J),u_globe_pos:new u.Uniform3f(J),u_globe_radius:new u.Uniform1f(J),u_globe_transition:new u.Uniform1f(J),u_is_globe:new u.Uniform1i(J),u_viewport:new u.Uniform2f(J)}))(t))}var J}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const l=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in o)l[d]&&l[d].set(this.program,d,o[d])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const l=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in o)l[d]&&l[d].set(this.program,d,o[d])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const l=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in o)l[d].set(this.program,d,o[d])}}draw(t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne){const J=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(d),t.setColorMode(g),t.setCullFace(v);for(const se of Object.keys(this.fixedUniforms))this.fixedUniforms[se].set(this.program,se,E[se]);X&&X.setUniforms(this.program,t,this.binderUniforms,$,{zoom:K});const W={[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[o];for(const se of B.get()){const re=se.vaos||(se.vaos={});(re[T]||(re[T]=new no)).bind(t,this,S,X?X.getPaintVertexBuffers():[],R,se.vertexOffset,ne||[]),J.drawElements(o,se.primitiveLength*W,J.UNSIGNED_SHORT,se.primitiveOffset*W*2)}}}function hc(f,t,o){const l=1/en(o,1,t.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,t.transform.tileZoom)/d,v=g*(o.tileID.canonical.x+o.tileID.wrap*d),E=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,E>>16],u_pixel_coord_lower:[65535&v,65535&E]}}const Fo=u.create(),vi=(f,t,o,l,d,g,v,E,T,S,R)=>{const B=t.style.light,$=B.properties.get("position"),K=[$.x,$.y,$.z],X=u.create$1();"viewport"===B.properties.get("anchor")&&(u.fromRotation(X,-t.transform.angle),u.transformMat3(K,K,X));const ne=B.properties.get("color"),J=t.transform,W={u_matrix:f,u_lightpos:K,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+o,u_opacity:l,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fo,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:g};return"globe"===J.projection.name&&(W.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],W.u_zoom_transition=T,W.u_inv_rot_matrix=R,W.u_merc_center=S,W.u_up_dir=J.projection.upVector(new u.CanonicalTileID(0,0,0),S[0]*u.EXTENT,S[1]*u.EXTENT),W.u_height_lift=E),W},Pl=(f,t,o,l,d,g,v,E,T,S,R,B,$)=>{const K=vi(f,t,o,l,d,g,v,S,R,B,$),X={u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8};return u.extend(K,hc(E,t,T),X)},Ks=f=>({u_matrix:f}),bo=(f,t,o,l)=>u.extend(Ks(f),hc(o,t,l)),er=(f,t)=>({u_matrix:f,u_world:t}),Du=(f,t,o,l,d)=>u.extend(bo(f,t,o,l),{u_world:d}),io=u.create(),ds=(f,t,o,l,d,g)=>{const v=f.transform,E="globe"===v.projection.name;let T;if("map"===g.paint.get("circle-pitch-alignment"))if(E){const R=u.globePixelsToTileUnits(v.zoom,t.canonical)*v._pixelsPerMercatorPixel;T=Float32Array.from([R,0,0,R])}else T=v.calculatePixelsToTileUnitsMatrix(o);else T=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:v.cameraToCenterDistance,u_matrix:f.translatePosMatrix(t.projMatrix,o,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:io,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){S.u_inv_rot_matrix=l,S.u_merc_center=d,S.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],S.u_zoom_transition=u.globeToMercatorTransition(v.zoom);const R=d[0]*u.EXTENT,B=d[1]*u.EXTENT;S.u_up_dir=v.projection.upVector(new u.CanonicalTileID(0,0,0),R,B)}return S},fs=f=>{const t=[];return"map"===f.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},Wa=(f,t,o,l)=>{const d=u.EXTENT/o.tileSize;return{u_matrix:f,u_camera_to_center_distance:t.getCameraToCenterDistance(l),u_extrude_scale:[t.pixelsToGLUnits[0]/d,t.pixelsToGLUnits[1]/d]}},Ko=(f,t,o=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:o}),sn=u.create(),Rl=(f,t,o,l,d,g,v)=>{const E=f.transform,T="globe"===E.projection.name,S=T?u.globePixelsToTileUnits(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:en(o,1,g),R={u_matrix:t.projMatrix,u_extrude_scale:S,u_intensity:v,u_inv_rot_matrix:sn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){R.u_inv_rot_matrix=l,R.u_merc_center=d,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=u.globeToMercatorTransition(E.zoom);const B=d[0]*u.EXTENT,$=d[1]*u.EXTENT;R.u_up_dir=E.projection.upVector(new u.CanonicalTileID(0,0,0),B,$)}return R},Tu=(f,t,o,l,d,g,v,E)=>{const T=f.transform,S=T.calculatePixelsToTileUnitsMatrix(t),R={u_matrix:Ya(f,t,o,d),u_pixels_to_tile_units:S,u_device_pixel_ratio:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:E};if(kl(o)){const B=Xa(t,f.transform);R.u_texsize=t.lineAtlasTexture.size,R.u_scale=[B,l.fromScale,l.toScale],R.u_mix=l.t}return R},dc=(f,t,o,l,d,g)=>{const v=f.transform,E=Xa(t,v);return{u_matrix:Ya(f,t,o,d),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:g,u_image:0,u_scale:[E,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Xa(f,t){return 1/en(f,1,t.tileZoom)}function Ya(f,t,o,l){return f.translatePosMatrix(l||t.tileID.projMatrix,t,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}function kl(f){const t=f.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Ka=(f,t,o,l,d,g)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:o,u_fade_t:l.mix,u_opacity:l.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(E=d.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=d.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:ba(d.paint.get("raster-hue-rotate")),u_perspective_transform:g};var v,E};function ba(f){f*=Math.PI/180;const t=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const lt=u.create(),Vn=(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne)=>{const J=d.transform,W={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_rotate_symbol:+o,u_aspect_ratio:J.width/J.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:v,u_coord_matrix:E,u_is_text:+T,u_pitch_with_map:+l,u_texsize:S,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lt,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:lt,u_up_vector:[0,-1,0]};return"globe"===ne.name&&(W.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],W.u_zoom_transition=B,W.u_inv_rot_matrix=K,W.u_merc_center=$,W.u_camera_forward=J._camera.forward(),W.u_ecef_origin=u.globeECEFOrigin(J.globeMatrix,R.toUnwrapped()),W.u_tile_matrix=Float32Array.from(J.globeMatrix),W.u_up_vector=X),W},wo=(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne,J)=>u.extend(Vn(f,t,o,l,d,g,v,E,T,S,B,$,K,X,ne,J),{u_gamma_scale:l?d.transform.cameraToCenterDistance*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+R}),Ll=(f,t,o,l,d,g,v,E,T,S,R,B,$,K,X,ne)=>u.extend(wo(f,t,o,l,d,g,v,E,!0,T,!0,R,B,$,K,X,ne),{u_texsize_icon:S,u_texture_icon:1}),ti=(f,t,o)=>({u_matrix:f,u_opacity:t,u_color:o}),Ol=(f,t,o,l,d,g)=>u.extend(function(v,E,T,S){const R=T.imageManager.getPattern(v.from.toString()),B=T.imageManager.getPattern(v.to.toString()),{width:$,height:K}=T.imageManager.getPixelSize(),X=Math.pow(2,S.tileID.overscaledZ),ne=S.tileSize*Math.pow(2,T.transform.tileZoom)/X,J=ne*(S.tileID.canonical.x+S.tileID.wrap*X),W=ne*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[$,K],u_mix:E.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/en(S,1,T.transform.tileZoom),u_pixel_coord_upper:[J>>16,W>>16],u_pixel_coord_lower:[65535&J,65535&W]}}(l,g,o,d),{u_matrix:f,u_opacity:t}),Us={fillExtrusion:f=>({u_matrix:new u.UniformMatrix4f(f),u_lightpos:new u.Uniform3f(f),u_lightintensity:new u.Uniform1f(f),u_lightcolor:new u.Uniform3f(f),u_vertical_gradient:new u.Uniform1f(f),u_opacity:new u.Uniform1f(f),u_edge_radius:new u.Uniform1f(f),u_ao:new u.Uniform2f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_up_dir:new u.Uniform3f(f),u_height_lift:new u.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new u.UniformMatrix4f(f),u_lightpos:new u.Uniform3f(f),u_lightintensity:new u.Uniform1f(f),u_lightcolor:new u.Uniform3f(f),u_vertical_gradient:new u.Uniform1f(f),u_height_factor:new u.Uniform1f(f),u_edge_radius:new u.Uniform1f(f),u_ao:new u.Uniform2f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_up_dir:new u.Uniform3f(f),u_height_lift:new u.Uniform1f(f),u_image:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_pixel_coord_upper:new u.Uniform2f(f),u_pixel_coord_lower:new u.Uniform2f(f),u_scale:new u.Uniform3f(f),u_fade:new u.Uniform1f(f),u_opacity:new u.Uniform1f(f)}),fill:f=>({u_matrix:new u.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new u.UniformMatrix4f(f),u_image:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_pixel_coord_upper:new u.Uniform2f(f),u_pixel_coord_lower:new u.Uniform2f(f),u_scale:new u.Uniform3f(f),u_fade:new u.Uniform1f(f)}),fillOutline:f=>({u_matrix:new u.UniformMatrix4f(f),u_world:new u.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new u.UniformMatrix4f(f),u_world:new u.Uniform2f(f),u_image:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_pixel_coord_upper:new u.Uniform2f(f),u_pixel_coord_lower:new u.Uniform2f(f),u_scale:new u.Uniform3f(f),u_fade:new u.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new u.Uniform1f(f),u_extrude_scale:new u.UniformMatrix2f(f),u_device_pixel_ratio:new u.Uniform1f(f),u_matrix:new u.UniformMatrix4f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_up_dir:new u.Uniform3f(f)}),collisionBox:f=>({u_matrix:new u.UniformMatrix4f(f),u_camera_to_center_distance:new u.Uniform1f(f),u_extrude_scale:new u.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new u.UniformMatrix4f(f),u_inv_matrix:new u.UniformMatrix4f(f),u_camera_to_center_distance:new u.Uniform1f(f),u_viewport_size:new u.Uniform2f(f)}),debug:f=>({u_color:new u.UniformColor(f),u_matrix:new u.UniformMatrix4f(f),u_overlay:new u.Uniform1i(f),u_overlay_scale:new u.Uniform1f(f)}),clippingMask:f=>({u_matrix:new u.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new u.Uniform1f(f),u_intensity:new u.Uniform1f(f),u_matrix:new u.UniformMatrix4f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_up_dir:new u.Uniform3f(f)}),heatmapTexture:f=>({u_image:new u.Uniform1i(f),u_color_ramp:new u.Uniform1i(f),u_opacity:new u.Uniform1f(f)}),hillshade:f=>({u_matrix:new u.UniformMatrix4f(f),u_image:new u.Uniform1i(f),u_latrange:new u.Uniform2f(f),u_light:new u.Uniform2f(f),u_shadow:new u.UniformColor(f),u_highlight:new u.UniformColor(f),u_accent:new u.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new u.UniformMatrix4f(f),u_image:new u.Uniform1i(f),u_dimension:new u.Uniform2f(f),u_zoom:new u.Uniform1f(f),u_unpack:new u.Uniform4f(f)}),line:f=>({u_matrix:new u.UniformMatrix4f(f),u_pixels_to_tile_units:new u.UniformMatrix2f(f),u_device_pixel_ratio:new u.Uniform1f(f),u_units_to_pixels:new u.Uniform2f(f),u_dash_image:new u.Uniform1i(f),u_gradient_image:new u.Uniform1i(f),u_image_height:new u.Uniform1f(f),u_texsize:new u.Uniform2f(f),u_scale:new u.Uniform3f(f),u_mix:new u.Uniform1f(f),u_alpha_discard_threshold:new u.Uniform1f(f),u_trim_offset:new u.Uniform2f(f)}),linePattern:f=>({u_matrix:new u.UniformMatrix4f(f),u_texsize:new u.Uniform2f(f),u_pixels_to_tile_units:new u.UniformMatrix2f(f),u_device_pixel_ratio:new u.Uniform1f(f),u_image:new u.Uniform1i(f),u_units_to_pixels:new u.Uniform2f(f),u_scale:new u.Uniform3f(f),u_fade:new u.Uniform1f(f),u_alpha_discard_threshold:new u.Uniform1f(f)}),raster:f=>({u_matrix:new u.UniformMatrix4f(f),u_tl_parent:new u.Uniform2f(f),u_scale_parent:new u.Uniform1f(f),u_fade_t:new u.Uniform1f(f),u_opacity:new u.Uniform1f(f),u_image0:new u.Uniform1i(f),u_image1:new u.Uniform1i(f),u_brightness_low:new u.Uniform1f(f),u_brightness_high:new u.Uniform1f(f),u_saturation_factor:new u.Uniform1f(f),u_contrast_factor:new u.Uniform1f(f),u_spin_weights:new u.Uniform3f(f),u_perspective_transform:new u.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new u.Uniform1i(f),u_is_size_feature_constant:new u.Uniform1i(f),u_size_t:new u.Uniform1f(f),u_size:new u.Uniform1f(f),u_camera_to_center_distance:new u.Uniform1f(f),u_rotate_symbol:new u.Uniform1i(f),u_aspect_ratio:new u.Uniform1f(f),u_fade_change:new u.Uniform1f(f),u_matrix:new u.UniformMatrix4f(f),u_label_plane_matrix:new u.UniformMatrix4f(f),u_coord_matrix:new u.UniformMatrix4f(f),u_is_text:new u.Uniform1i(f),u_pitch_with_map:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_camera_forward:new u.Uniform3f(f),u_tile_matrix:new u.UniformMatrix4f(f),u_up_vector:new u.Uniform3f(f),u_ecef_origin:new u.Uniform3f(f),u_texture:new u.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new u.Uniform1i(f),u_is_size_feature_constant:new u.Uniform1i(f),u_size_t:new u.Uniform1f(f),u_size:new u.Uniform1f(f),u_camera_to_center_distance:new u.Uniform1f(f),u_rotate_symbol:new u.Uniform1i(f),u_aspect_ratio:new u.Uniform1f(f),u_fade_change:new u.Uniform1f(f),u_matrix:new u.UniformMatrix4f(f),u_label_plane_matrix:new u.UniformMatrix4f(f),u_coord_matrix:new u.UniformMatrix4f(f),u_is_text:new u.Uniform1i(f),u_pitch_with_map:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_texture:new u.Uniform1i(f),u_gamma_scale:new u.Uniform1f(f),u_device_pixel_ratio:new u.Uniform1f(f),u_tile_id:new u.Uniform3f(f),u_zoom_transition:new u.Uniform1f(f),u_inv_rot_matrix:new u.UniformMatrix4f(f),u_merc_center:new u.Uniform2f(f),u_camera_forward:new u.Uniform3f(f),u_tile_matrix:new u.UniformMatrix4f(f),u_up_vector:new u.Uniform3f(f),u_ecef_origin:new u.Uniform3f(f),u_is_halo:new u.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new u.Uniform1i(f),u_is_size_feature_constant:new u.Uniform1i(f),u_size_t:new u.Uniform1f(f),u_size:new u.Uniform1f(f),u_camera_to_center_distance:new u.Uniform1f(f),u_rotate_symbol:new u.Uniform1i(f),u_aspect_ratio:new u.Uniform1f(f),u_fade_change:new u.Uniform1f(f),u_matrix:new u.UniformMatrix4f(f),u_label_plane_matrix:new u.UniformMatrix4f(f),u_coord_matrix:new u.UniformMatrix4f(f),u_is_text:new u.Uniform1i(f),u_pitch_with_map:new u.Uniform1i(f),u_texsize:new u.Uniform2f(f),u_texsize_icon:new u.Uniform2f(f),u_texture:new u.Uniform1i(f),u_texture_icon:new u.Uniform1i(f),u_gamma_scale:new u.Uniform1f(f),u_device_pixel_ratio:new u.Uniform1f(f),u_is_halo:new u.Uniform1i(f)}),background:f=>({u_matrix:new u.UniformMatrix4f(f),u_opacity:new u.Uniform1f(f),u_color:new u.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new u.UniformMatrix4f(f),u_opacity:new u.Uniform1f(f),u_image:new u.Uniform1i(f),u_pattern_tl_a:new u.Uniform2f(f),u_pattern_br_a:new u.Uniform2f(f),u_pattern_tl_b:new u.Uniform2f(f),u_pattern_br_b:new u.Uniform2f(f),u_texsize:new u.Uniform2f(f),u_mix:new u.Uniform1f(f),u_pattern_size_a:new u.Uniform2f(f),u_pattern_size_b:new u.Uniform2f(f),u_scale_a:new u.Uniform1f(f),u_scale_b:new u.Uniform1f(f),u_pixel_coord_upper:new u.Uniform2f(f),u_pixel_coord_lower:new u.Uniform2f(f),u_tile_units_to_pixels:new u.Uniform1f(f)}),terrainRaster:zs,terrainDepth:zs,skybox:f=>({u_matrix:new u.UniformMatrix4f(f),u_sun_direction:new u.Uniform3f(f),u_cubemap:new u.Uniform1i(f),u_opacity:new u.Uniform1f(f),u_temporal_offset:new u.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new u.UniformMatrix4f(f),u_color_ramp:new u.Uniform1i(f),u_center_direction:new u.Uniform3f(f),u_radius:new u.Uniform1f(f),u_opacity:new u.Uniform1f(f),u_temporal_offset:new u.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new u.UniformMatrix3f(f),u_sun_direction:new u.Uniform3f(f),u_sun_intensity:new u.Uniform1f(f),u_color_tint_r:new u.Uniform4f(f),u_color_tint_m:new u.Uniform4f(f),u_luminance:new u.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new u.UniformMatrix4f(f),u_globe_matrix:new u.UniformMatrix4f(f),u_normalize_matrix:new u.UniformMatrix4f(f),u_merc_matrix:new u.UniformMatrix4f(f),u_zoom_transition:new u.Uniform1f(f),u_merc_center:new u.Uniform2f(f),u_image0:new u.Uniform1i(f),u_grid_matrix:new u.UniformMatrix3f(f),u_frustum_tl:new u.Uniform3f(f),u_frustum_tr:new u.Uniform3f(f),u_frustum_br:new u.Uniform3f(f),u_frustum_bl:new u.Uniform3f(f),u_globe_pos:new u.Uniform3f(f),u_globe_radius:new u.Uniform1f(f),u_viewport:new u.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new u.Uniform3f(f),u_frustum_tr:new u.Uniform3f(f),u_frustum_br:new u.Uniform3f(f),u_frustum_bl:new u.Uniform3f(f),u_horizon:new u.Uniform1f(f),u_transition:new u.Uniform1f(f),u_fadeout_range:new u.Uniform1f(f),u_color:new u.Uniform4f(f),u_high_color:new u.Uniform4f(f),u_space_color:new u.Uniform4f(f),u_star_intensity:new u.Uniform1f(f),u_star_density:new u.Uniform1f(f),u_star_size:new u.Uniform1f(f),u_temporal_offset:new u.Uniform1f(f),u_horizon_angle:new u.Uniform1f(f),u_rotation_matrix:new u.UniformMatrix4f(f)})};let oo;function Ja(f,t,o,l,d,g,v){const E=f.context,T=E.gl,S=f.transform,R=f.useProgram("collisionBox"),B=[];let $=0,K=0;for(let pe=0;pe<l.length;pe++){const ge=l[pe],ue=t.getTile(ge),xe=ue.getBucket(o);if(!xe)continue;const Le=as(ge,xe,S);let Ue=Le;0===d[0]&&0===d[1]||(Ue=f.translatePosMatrix(Le,ue,d,g));const Oe=v?xe.textCollisionBox:xe.iconCollisionBox,ct=xe.collisionCircleArray;if(ct.length>0){const Se=u.create(),Xe=Ue;u.mul(Se,xe.placementInvProjMatrix,S.glCoordMatrix),u.mul(Se,Se,xe.placementViewportMatrix),B.push({circleArray:ct,circleOffset:K,transform:Xe,invTransform:Se,projection:xe.getProjection()}),$+=ct.length/4,K=$}Oe&&(f.terrain&&f.terrain.setupElevationDraw(ue,R),R.draw(E,T.LINES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,Wa(Ue,S,ue,xe.getProjection()),o.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,S.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!v||!B.length)return;const X=f.useProgram("collisionCircle"),ne=new u.StructArrayLayout2f1f2i16;ne.resize(4*$),ne._trim();let J=0;for(const pe of B)for(let ge=0;ge<pe.circleArray.length/4;ge++){const ue=4*ge,xe=pe.circleArray[ue+0],Le=pe.circleArray[ue+1],Ue=pe.circleArray[ue+2],Oe=pe.circleArray[ue+3];ne.emplace(J++,xe,Le,Ue,Oe,0),ne.emplace(J++,xe,Le,Ue,Oe,1),ne.emplace(J++,xe,Le,Ue,Oe,2),ne.emplace(J++,xe,Le,Ue,Oe,3)}(!oo||oo.length<2*$)&&(oo=function(pe){const ge=2*pe,ue=new u.StructArrayLayout3ui6;ue.resize(ge),ue._trim();for(let xe=0;xe<ge;xe++){const Le=6*xe;ue.uint16[Le+0]=4*xe+0,ue.uint16[Le+1]=4*xe+1,ue.uint16[Le+2]=4*xe+2,ue.uint16[Le+3]=4*xe+2,ue.uint16[Le+4]=4*xe+3,ue.uint16[Le+5]=4*xe+0}return ue}($));const W=E.createIndexBuffer(oo,!0),se=E.createVertexBuffer(ne,u.collisionCircleLayout.members,!0);for(const pe of B){const ge={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(re=S).getCameraToCenterDistance(pe.projection),u_viewport_size:[re.width,re.height]};X.draw(E,T.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,ge,o.id,se,W,u.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,S.zoom)}var re;se.destroy(),W.destroy()}const Qa=u.create();function el(f,t,o,l,d,g){const{horizontalAlign:v,verticalAlign:E}=u.getAnchorAlignment(f),T=-(v-.5)*t,S=-(E-.5)*o,R=u.evaluateVariableOffset(f,l);return new u.pointGeometry((T/d+R[0])*g,(S/d+R[1])*g)}function Cu(f,t,o,l,d,g,v,E,T,S,R){const B=f.text.placedSymbolArray,$=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,X={},ne=Qr(E,f.getProjection(),g),J=g.elevation,W=f.getProjection().upVectorScale(E.canonical,g.center.lat,g.worldSize);$.clear();for(let se=0;se<B.length;se++){const re=B.get(se),pe=f.allowVerticalPlacement&&!re.placedOrientation,ge=re.hidden||!re.crossTileID||pe?null:l[re.crossTileID];if(ge){const ue=new u.pointGeometry(re.tileAnchorX,re.tileAnchorY),xe=f.getProjection().upVector(E.canonical,ue.x,ue.y),Le=J?J.getAtTileOffset(E,ue.x,ue.y):0,Ue=on([re.projectedAnchorX+Le*xe[0]*W.metersToTile,re.projectedAnchorY+Le*xe[1]*W.metersToTile,re.projectedAnchorZ+Le*xe[2]*W.metersToTile],o?ne:v),Oe=_n(g.getCameraToCenterDistance(f.getProjection()),Ue.signedDistanceFromCamera);let ct=d.evaluateSizeForFeature(f.textSizeData,S,re)*Oe/u.ONE_EM;o&&(ct*=f.tilePixelRatio/T);const{width:Se,height:Xe,anchor:Ke,textOffset:ke,textScale:Ce}=ge,Ct=el(Ke,Se,Xe,ke,Ce,ct);let ft;if(o){const _t=ue.add(Ct),{x:Vt,y:ln,z:Qt}=f.getProjection().projectTilePoint(_t.x,_t.y,E.canonical);ft=on([Vt+Le*xe[0]*W.metersToTile,ln+Le*xe[1]*W.metersToTile,Qt+Le*xe[2]*W.metersToTile],v).point}else{const _t=t?Ct.rotate(-g.angle):Ct;ft=[Ue.point[0]+_t.x,Ue.point[1]+_t.y,0]}const xt=f.allowVerticalPlacement&&re.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let _t=0;_t<re.numGlyphs;_t++)u.addDynamicAttributes($,ft[0],ft[1],ft[2],xt);R&&re.associatedIconIndex>=0&&(X[re.associatedIconIndex]={shiftedAnchor:ft,angle:xt})}else or(re.numGlyphs,$)}if(R){K.clear();const se=f.icon.placedSymbolArray;for(let re=0;re<se.length;re++){const pe=se.get(re);if(pe.hidden)or(pe.numGlyphs,K);else{const ge=X[re];if(ge)for(let ue=0;ue<pe.numGlyphs;ue++)u.addDynamicAttributes(K,ge.shiftedAnchor[0],ge.shiftedAnchor[1],ge.shiftedAnchor[2],ge.angle);else or(pe.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData($)}function Iu(f,t,o){return o.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function fc(f,t,o,l,d,g,v,E,T,S,R,B){const $=f.context,K=$.gl,X=f.transform,ne="map"===E,J="map"===T,W=ne&&"point"!==o.layout.get("symbol-placement"),se=ne&&!J&&!W,re=void 0!==o.layout.get("symbol-sort-key").constantOr(1);let pe=!1;const ge=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),ue=[u.mercatorXfromLng(X.center.lng),u.mercatorYfromLat(X.center.lat)],xe=o.layout.get("text-variable-anchor"),Le="globe"===X.projection.name,Ue=[],Oe=[0,-1,0];let ct=Oe;!Le&&!X.mercatorFromTransition||ne||(ct=function(Se){const Xe=Se._camera.getWorldToCamera(Se.worldSize,1),Ke=u.multiply([],Xe,Se.globeMatrix);u.invert(Ke,Ke);const ke=[0,0,0],Ce=[0,1,0,0];return u.transformMat4$1(Ce,Ce,Ke),ke[0]=Ce[0],ke[1]=Ce[1],ke[2]=Ce[2],u.normalize(ke,ke),ke}(X));for(const Se of l){const Xe=t.getTile(Se),Ke=Xe.getBucket(o);if(!Ke||"mercator"===Ke.projection.name&&Le)continue;const ke=d?Ke.text:Ke.icon;if(!ke||Ke.fullyClipped||!ke.segments.get().length)continue;const Ce=ke.programConfigurations.get(o.id),Ct=d||Ke.sdfIcons,ft=d?Ke.textSizeData:Ke.iconSizeData,xt=J||0!==X.pitch,_t=u.evaluateSizeForZoom(ft,X.zoom);let Vt,ln,Qt,$t,yt=[0,0],vn=null;if(d){if(ln=Xe.glyphAtlasTexture,Qt=K.LINEAR,Vt=Xe.glyphAtlasTexture.size,Ke.iconsInText){yt=Xe.imageAtlasTexture.size,vn=Xe.imageAtlasTexture;const ao="composite"===ft.kind||"camera"===ft.kind;$t=xt||f.options.rotating||f.options.zooming||ao?K.LINEAR:K.NEAREST}}else{const ao=1!==o.layout.get("icon-size").constantOr(0)||Ke.iconsNeedLinear;ln=Xe.imageAtlasTexture,Qt=Ct||f.options.rotating||f.options.zooming||ao||xt?K.LINEAR:K.NEAREST,Vt=Xe.imageAtlasTexture.size}const Mn="globe"===Ke.projection.name,gr=Mn?ct:Oe,yr=Mn?u.globeToMercatorTransition(X.zoom):0,dr=Qr(Se,Ke.getProjection(),X),Ai=X.calculatePixelsToTileUnitsMatrix(Xe),To=As(dr,Xe.tileID.canonical,J,ne,X,Ke.getProjection(),Ai),es=f.terrain&&J&&W?u.invert(u.create(),To):Qa,br=Un(dr,Xe.tileID.canonical,J,ne,X,Ke.getProjection(),Ai),Xr=xe&&Ke.hasTextData(),sr="none"!==o.layout.get("icon-text-fit")&&Xr&&Ke.hasIconData();if(W){const ao=X.elevation,Aa=ao?ao.getAtTileOffsetFunc(Se,X.center.lat,X.worldSize,Ke.getProjection()):ia=>[0,0,0],Vl=qo(dr,Xe.tileID.canonical,J,ne,X,Ke.getProjection(),Ai);Hr(Ke,dr,f,d,Vl,br,J,S,Aa,Se)}const Di=W||d&&xe||sr,Hi=f.translatePosMatrix(dr,Xe,g,v),Dr=Di?Qa:To,jo=f.translatePosMatrix(br,Xe,g,v,!0),jl=Ke.getProjection().createInversionMatrix(X,Se.canonical),ts=[];f.terrainRenderModeElevated()&&J&&ts.push("PITCH_WITH_MAP_TERRAIN"),Mn&&ts.push("PROJECTION_GLOBE_VIEW"),Di&&ts.push("PROJECTED_POS_ON_VIEWPORT");const Vo=Ct&&0!==o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1);let eu;eu=Ct?Ke.iconsInText?Ll(ft.kind,_t,se,J,f,Hi,Dr,jo,Vt,yt,Se,yr,ue,jl,gr,Ke.getProjection()):wo(ft.kind,_t,se,J,f,Hi,Dr,jo,d,Vt,!0,Se,yr,ue,jl,gr,Ke.getProjection()):Vn(ft.kind,_t,se,J,f,Hi,Dr,jo,d,Vt,Se,yr,ue,jl,gr,Ke.getProjection());const ra={program:f.useProgram(Iu(Ct,d,Ke),Ce,ts),buffers:ke,uniformValues:eu,atlasTexture:ln,atlasTextureIcon:vn,atlasInterpolation:Qt,atlasInterpolationIcon:$t,isSDF:Ct,hasHalo:Vo,tile:Xe,labelPlaneMatrixInv:es};if(re&&Ke.canOverlap){pe=!0;const ao=ke.segments.get();for(const Aa of ao)Ue.push({segments:new u.SegmentVector([Aa]),sortKey:Aa.sortKey,state:ra})}else Ue.push({segments:ke.segments,sortKey:0,state:ra})}pe&&Ue.sort((Se,Xe)=>Se.sortKey-Xe.sortKey);for(const Se of Ue){const Xe=Se.state;if(f.terrain&&f.terrain.setupElevationDraw(Xe.tile,Xe.program,{useDepthForOcclusion:!Le,labelPlaneMatrixInv:Xe.labelPlaneMatrixInv}),$.activeTexture.set(K.TEXTURE0),Xe.atlasTexture.bind(Xe.atlasInterpolation,K.CLAMP_TO_EDGE),Xe.atlasTextureIcon&&($.activeTexture.set(K.TEXTURE1),Xe.atlasTextureIcon&&Xe.atlasTextureIcon.bind(Xe.atlasInterpolationIcon,K.CLAMP_TO_EDGE)),Xe.isSDF){const Ke=Xe.uniformValues;Xe.hasHalo&&(Ke.u_is_halo=1,fi(Xe.buffers,Se.segments,o,f,Xe.program,ge,R,B,Ke)),Ke.u_is_halo=0}fi(Xe.buffers,Se.segments,o,f,Xe.program,ge,R,B,Xe.uniformValues)}}function fi(f,t,o,l,d,g,v,E,T){const S=l.context,R=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];d.draw(S,S.gl.TRIANGLES,g,v,E,u.CullFaceMode.disabled,T,o.id,f.layoutVertexBuffer,f.indexBuffer,t,o.paint,l.transform.zoom,f.programConfigurations.get(o.id),R)}function zo(f,t,o,l,d,g,v){const E=f.context.gl,T=o.paint.get("fill-pattern"),S=T&&T.constantOr(1),R=o.getCrossfadeParameters();let B,$,K,X,ne;v?($=S&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=E.LINES):($=S?"fillPattern":"fill",B=E.TRIANGLES);for(const J of l){const W=t.getTile(J);if(S&&!W.patternsLoaded())continue;const se=W.getBucket(o);if(!se)continue;f.prepareDrawTile();const re=se.programConfigurations.get(o.id),pe=f.useProgram($,re);S&&(f.context.activeTexture.set(E.TEXTURE0),W.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),re.updatePaintBuffers(R));const ge=T.constantOr(null);if(ge&&W.imageAtlas){const xe=W.imageAtlas,Le=xe.patternPositions[ge.to.toString()],Ue=xe.patternPositions[ge.from.toString()];Le&&Ue&&re.setConstantPatternPositions(Le,Ue)}const ue=f.translatePosMatrix(J.projMatrix,W,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(v){X=se.indexBuffer2,ne=se.segments2;const xe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];K="fillOutlinePattern"===$&&S?Du(ue,f,R,W,xe):er(ue,xe)}else X=se.indexBuffer,ne=se.segments,K=S?bo(ue,f,R,W):Ks(ue);f.prepareDrawProgram(f.context,pe,J.toUnwrapped()),pe.draw(f.context,B,d,f.stencilModeForClipping(J),g,u.CullFaceMode.disabled,K,o.id,se.layoutVertexBuffer,X,ne,o.paint,f.transform.zoom,re)}}function Js(f,t,o,l,d,g,v){const E=f.context,T=E.gl,S=f.transform,R=o.paint.get("fill-extrusion-pattern"),B=R.constantOr(1),$=o.getCrossfadeParameters(),K=o.paint.get("fill-extrusion-opacity"),X=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),o.paint.get("fill-extrusion-ambient-occlusion-radius")],ne=o.layout.get("fill-extrusion-edge-radius"),J="globe"===S.projection.name?u.fillExtrusionHeightLift():0,W="globe"===S.projection.name,se=W?u.globeToMercatorTransition(S.zoom):0,re=[u.mercatorXfromLng(S.center.lng),u.mercatorYfromLat(S.center.lat)],pe=[];W&&(pe.push("PROJECTION_GLOBE_VIEW"),f.style.terrainSetForDrapingOnly()&&pe.push("TERRAIN")),X[0]>0&&pe.push("FAUX_AO");for(const ge of l){const ue=t.getTile(ge),xe=ue.getBucket(o);if(!xe||xe.projection.name!==S.projection.name)continue;const Le=xe.programConfigurations.get(o.id),Ue=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",Le,pe);if(f.terrain){const Ce=f.terrain;if(f.style.terrainSetForDrapingOnly())Ce.setupElevationDraw(ue,Ue,{useMeterToDem:!0});else{if(!xe.enableTerrain)continue;if(Ce.setupElevationDraw(ue,Ue,{useMeterToDem:!0}),Bo(E,t,ge,xe,o,Ce),!xe.centroidVertexBuffer){const Ct=Ue.attributes.a_centroid_pos;void 0!==Ct&&T.vertexAttrib2f(Ct,0,0)}}}B&&(f.context.activeTexture.set(T.TEXTURE0),ue.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Le.updatePaintBuffers($));const Oe=R.constantOr(null);if(Oe&&ue.imageAtlas){const Ce=ue.imageAtlas,Ct=Ce.patternPositions[Oe.to.toString()],ft=Ce.patternPositions[Oe.from.toString()];Ct&&ft&&Le.setConstantPatternPositions(Ct,ft)}const ct=f.translatePosMatrix(ge.projMatrix,ue,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Se=S.projection.createInversionMatrix(S,ge.canonical),Xe=o.paint.get("fill-extrusion-vertical-gradient"),Ke=B?Pl(ct,f,Xe,K,X,ne,ge,$,ue,J,se,re,Se):vi(ct,f,Xe,K,X,ne,ge,J,se,re,Se);f.prepareDrawProgram(E,Ue,ge.toUnwrapped());const ke=[];f.terrain&&ke.push(xe.centroidVertexBuffer),W&&ke.push(xe.layoutVertexExtBuffer),Ue.draw(E,E.gl.TRIANGLES,d,g,v,u.CullFaceMode.backCCW,Ke,o.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,o.paint,f.transform.zoom,Le,ke)}}function Bo(f,t,o,l,d,g){const v=[W=>{let se=W.canonical.x-1,re=W.wrap;return se<0&&(se=(1<<W.canonical.z)-1,re--),new u.OverscaledTileID(W.overscaledZ,re,W.canonical.z,se,W.canonical.y)},W=>{let se=W.canonical.x+1,re=W.wrap;return se===1<<W.canonical.z&&(se=0,re++),new u.OverscaledTileID(W.overscaledZ,re,W.canonical.z,se,W.canonical.y)},W=>new u.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new u.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],E=W=>{const se=t.getSource().minzoom,re=ge=>{const ue=t.getTileByID(ge);if(ue&&ue.hasData())return ue.getBucket(d)},pe=[0,-1,1];for(const ge of pe){if(W.overscaledZ+ge<se)continue;const ue=re(W.calculateScaledKey(W.overscaledZ+ge));if(ue)return ue}},T=[0,0,0],S=(W,se)=>(T[0]=Math.min(W.min.y,se.min.y),T[1]=Math.max(W.max.y,se.max.y),T[2]=u.EXTENT-se.min.x>W.max.x?se.min.x-u.EXTENT:W.max.x,T),R=(W,se)=>(T[0]=Math.min(W.min.x,se.min.x),T[1]=Math.max(W.max.x,se.max.x),T[2]=u.EXTENT-se.min.y>W.max.y?se.min.y-u.EXTENT:W.max.y,T),B=[(W,se)=>S(W,se),(W,se)=>S(se,W),(W,se)=>R(W,se),(W,se)=>R(se,W)],$=new u.pointGeometry(0,0);let K,X,ne;const J=(W,se,re,pe,ge)=>{const ue=[[pe?re:W,pe?W:re,0],[pe?re:se,pe?se:re,0]],xe=ge<0?u.EXTENT+ge:ge,Le=[pe?xe:(W+se)/2,pe?(W+se)/2:xe,0];return 0===re&&ge<0||0!==re&&ge>0?g.getForTilePoints(ne,[Le],!0,X):ue.push(Le),g.getForTilePoints(o,ue,!0,K),Math.max(ue[0][2],ue[1][2],Le[2])/g.exaggeration()};for(let W=0;W<4;W++){const se=(W<2?1:5)-W,re=l.borders[W];if(0===re.length)continue;const pe=ne=v[W](o),ge=E(pe);if(!(ge&&ge instanceof u.FillExtrusionBucket&&ge.enableTerrain)||l.borderDoneWithNeighborZ[W]===ge.canonical.z&&ge.borderDoneWithNeighborZ[se]===l.canonical.z||(X=g.findDEMTileFor(pe),!X||!X.dem))continue;if(!K){const Ue=g.findDEMTileFor(o);if(!Ue||!Ue.dem)return;K=Ue}const ue=ge.borders[se];let xe=0;const Le=ge.borderDoneWithNeighborZ[se]!==l.canonical.z;if(l.canonical.z===ge.canonical.z){for(let Ue=0;Ue<re.length;Ue++){const Oe=l.featuresOnBorder[re[Ue]],ct=Oe.borders[W];let Se;for(;xe<ue.length&&(Se=ge.featuresOnBorder[ue[xe]],!(Se.borders[se][1]>ct[0]+3));)Le&&ge.encodeCentroid(void 0,Se,!1),xe++;if(Se&&xe<ue.length){const Xe=xe;let Ke=0;for(;!(Se.borders[se][0]>ct[1]-3)&&(Ke++,++xe!==ue.length);)Se=ge.featuresOnBorder[ue[xe]];if(Se=ge.featuresOnBorder[ue[Xe]],Oe.intersectsCount()>1||Se.intersectsCount()>1||1!==Ke){1!==Ke&&(xe=Xe),l.encodeCentroid(void 0,Oe,!1),Le&&ge.encodeCentroid(void 0,Se,!1);continue}const ke=B[W](Oe,Se),Ce=W%2?u.EXTENT-1:0;$.x=J(ke[0],Math.min(u.EXTENT-1,ke[1]),Ce,W<2,ke[2]),$.y=0,l.encodeCentroid($,Oe,!1),Le&&ge.encodeCentroid($,Se,!1)}else l.encodeCentroid(void 0,Oe,!1)}l.borderDoneWithNeighborZ[W]=ge.canonical.z,l.needsCentroidUpdate=!0,Le&&(ge.borderDoneWithNeighborZ[se]=l.canonical.z,ge.needsCentroidUpdate=!0)}else{for(const Ue of re)l.encodeCentroid(void 0,l.featuresOnBorder[Ue],!1);if(Le){for(const Ue of ue)ge.encodeCentroid(void 0,ge.featuresOnBorder[Ue],!1);ge.borderDoneWithNeighborZ[se]=l.canonical.z,ge.needsCentroidUpdate=!0}l.borderDoneWithNeighborZ[W]=ge.canonical.z,l.needsCentroidUpdate=!0}}(l.needsCentroidUpdate||!l.centroidVertexBuffer&&0!==l.centroidVertexArray.length)&&l.uploadCentroid(f)}const Eo=new u.Color(1,0,0,1),pc=new u.Color(0,1,0,1),mc=new u.Color(0,0,1,1),Hc=new u.Color(1,0,1,1),wa=new u.Color(0,1,1,1);function Jo(f,t,o){const l=f.context,d=f.transform,g=l.gl,v="globe"===d.projection.name,E=v?["PROJECTION_GLOBE_VIEW"]:null;let T=o.projMatrix;if(v&&u.globeToMercatorTransition(d.zoom)>0){const Oe=u.transitionTileAABBinECEF(o.canonical,d),ct=u.globeDenormalizeECEF(Oe);T=u.multiply(new Float32Array(16),d.globeMatrix,ct),u.multiply(T,d.projMatrix,T)}const S=f.useProgram("debug",null,E),R=t.getTileByID(o.key);f.terrain&&f.terrain.setupElevationDraw(R,S);const B=u.DepthMode.disabled,$=u.StencilMode.disabled,K=f.colorModeForRenderPass(),X="$debug";l.activeTexture.set(g.TEXTURE0),f.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),v?R._makeGlobeTileDebugBuffers(f.context,d):R._makeDebugTileBoundsBuffers(f.context,d.projection);const ne=R._tileDebugBuffer||f.debugBuffer,J=R._tileDebugIndexBuffer||f.debugIndexBuffer,W=R._tileDebugSegments||f.debugSegments;S.draw(l,g.LINE_STRIP,B,$,K,u.CullFaceMode.disabled,Ko(T,u.Color.red),X,ne,J,W,null,null,null,[R._globeTileDebugBorderBuffer]);const se=R.latestRawTileData,re=Math.floor((se&&se.byteLength||0)/1024),pe=t.getTile(o).tileSize,ge=512/Math.min(pe,512)*(o.overscaledZ/d.zoom)*.5;let ue=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(ue+=` => ${o.overscaledZ}`),ue+=` ${re}kb`,function(Oe,ct){Oe.initDebugOverlayCanvas();const Se=Oe.debugOverlayCanvas,Xe=Oe.context.gl,Ke=Oe.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Se.width,Se.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(ct,5,5),Ke.strokeText(ct,5,5),Oe.debugOverlayTexture.update(Se),Oe.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(f,ue);const xe=R._tileDebugTextBuffer||f.debugBuffer,Le=R._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ue=R._tileDebugTextSegments||f.debugSegments;S.draw(l,g.TRIANGLES,B,$,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Ko(T,u.Color.transparent,ge),X,xe,Le,Ue,null,null,null,[R._globeTileDebugTextBuffer])}function ps(f,t,o,l){Gi(f,0,t+o/2,f.transform.width,o,l)}function Qs(f,t,o,l){Gi(f,t-o/2,0,o,f.transform.height,l)}function Gi(f,t,o,l,d,g){const v=f.context,E=v.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*u.exported.devicePixelRatio,o*u.exported.devicePixelRatio,l*u.exported.devicePixelRatio,d*u.exported.devicePixelRatio),v.clear({color:g}),E.disable(E.SCISSOR_TEST)}const ea=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:k}=ea;function j(f,t,o,l){f.emplaceBack(t,o,l)}class L{constructor(t){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,j(this.vertexArray,-1,-1,1),j(this.vertexArray,1,-1,1),j(this.vertexArray,-1,1,1),j(this.vertexArray,1,1,1),j(this.vertexArray,-1,-1,-1),j(this.vertexArray,1,-1,-1),j(this.vertexArray,-1,1,-1),j(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,k),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Z(f,t,o,l,d,g){const v=f.gl,E=t.paint.get("sky-atmosphere-color"),T=t.paint.get("sky-atmosphere-halo-color"),S=t.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:u.fromMat4(u.create$1(),l),u_sun_direction:d,u_sun_intensity:S,u_color_tint_r:[(X=E).r,X.g,X.b,X.a],u_color_tint_m:[(ne=T).r,ne.g,ne.b,ne.a],u_luminance:5e-5};var X,ne;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),o.draw(f,v.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,R,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ve=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ge{constructor(t){const o=new u.StructArrayLayout5f20;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const l=new u.StructArrayLayout3ui6;l.emplaceBack(0,1,2),l.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,ve.members),this.indexBuffer=t.createIndexBuffer(l),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const tt={symbol:function(f,t,o,l,d){if("translucent"!==f.renderPass)return;const g=u.StencilMode.disabled,v=f.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(E,T,S,R,B,$,K){const X=T.transform,ne="map"===B,J="map"===$;for(const W of E){const se=R.getTile(W),re=se.getBucket(S);if(!re||!re.text||!re.text.segments.get().length)continue;const pe=u.evaluateSizeForZoom(re.textSizeData,X.zoom),ge=Qr(W,re.getProjection(),X),ue=X.calculatePixelsToTileUnitsMatrix(se),xe=As(ge,se.tileID.canonical,J,ne,X,re.getProjection(),ue),Le="none"!==S.layout.get("icon-text-fit")&&re.hasIconData();if(pe){const Ue=Math.pow(2,X.zoom-se.tileID.overscaledZ);Cu(re,ne,J,K,u.symbolSize,X,xe,W,Ue,pe,Le)}}}(l,f,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),d),0!==o.paint.get("icon-opacity").constantOr(1)&&fc(f,t,o,l,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),g,v),0!==o.paint.get("text-opacity").constantOr(1)&&fc(f,t,o,l,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),g,v),t.map.showCollisionBoxes&&(Ja(f,t,o,l,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Ja(f,t,o,l,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,o,l){if("translucent"!==f.renderPass)return;const d=o.paint.get("circle-opacity"),g=o.paint.get("circle-stroke-width"),v=o.paint.get("circle-stroke-opacity"),E=void 0!==o.layout.get("circle-sort-key").constantOr(1);if(0===d.constantOr(1)&&(0===g.constantOr(1)||0===v.constantOr(1)))return;const T=f.context,S=T.gl,R=f.transform,B=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),$=u.StencilMode.disabled,K=f.colorModeForRenderPass(),X="globe"===R.projection.name,ne=[u.mercatorXfromLng(R.center.lng),u.mercatorYfromLat(R.center.lat)],J=[];for(let se=0;se<l.length;se++){const re=l[se],pe=t.getTile(re),ge=pe.getBucket(o);if(!ge||ge.projection.name!==R.projection.name)continue;const ue=ge.programConfigurations.get(o.id),xe=fs(o);X&&xe.push("PROJECTION_GLOBE_VIEW");const Le=f.useProgram("circle",ue,xe),Ue=ge.layoutVertexBuffer,Oe=ge.globeExtVertexBuffer,ct=ge.indexBuffer,Se=R.projection.createInversionMatrix(R,re.canonical),Xe={programConfiguration:ue,program:Le,layoutVertexBuffer:Ue,globeExtVertexBuffer:Oe,indexBuffer:ct,uniformValues:ds(f,re,pe,Se,ne,o),tile:pe};if(E){const Ke=ge.segments.get();for(const ke of Ke)J.push({segments:new u.SegmentVector([ke]),sortKey:ke.sortKey,state:Xe})}else J.push({segments:ge.segments,sortKey:0,state:Xe})}E&&J.sort((se,re)=>se.sortKey-re.sortKey);const W={useDepthForOcclusion:!X};for(const se of J){const{programConfiguration:re,program:pe,layoutVertexBuffer:ge,globeExtVertexBuffer:ue,indexBuffer:xe,uniformValues:Le,tile:Ue}=se.state,Oe=se.segments;f.terrain&&f.terrain.setupElevationDraw(Ue,pe,W),f.prepareDrawProgram(T,pe,Ue.tileID.toUnwrapped()),pe.draw(T,S.TRIANGLES,B,$,K,u.CullFaceMode.disabled,Le,o.id,ge,xe,Oe,o.paint,R.zoom,re,[ue])}},heatmap:function(f,t,o,l){if(0!==o.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const d=f.context,g=d.gl,v=u.StencilMode.disabled,E=new u.ColorMode([g.ONE,g.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(K,X,ne,J){const W=K.gl,se=X.width*J,re=X.height*J;K.activeTexture.set(W.TEXTURE1),K.viewport.set([0,0,se,re]);let pe=ne.heatmapFbo;if(!pe||pe&&(pe.width!==se||pe.height!==re)){pe&&pe.destroy();const ge=W.createTexture();W.bindTexture(W.TEXTURE_2D,ge),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),pe=ne.heatmapFbo=K.createFramebuffer(se,re,!1),function(ue,xe,Le,Ue,Oe,ct){const Se=ue.gl;Se.texImage2D(Se.TEXTURE_2D,0,Se.RGBA,Oe,ct,0,Se.RGBA,ue.extRenderToTextureHalfFloat?ue.extTextureHalfFloat.HALF_FLOAT_OES:Se.UNSIGNED_BYTE,null),Ue.colorAttachment.set(Le)}(K,0,ge,pe,se,re)}else W.bindTexture(W.TEXTURE_2D,pe.colorAttachment.get()),K.bindFramebuffer.set(pe.framebuffer)})(d,f,o,"globe"===f.transform.projection.name?.5:.25),d.clear({color:u.Color.transparent});const T=f.transform,S="globe"===T.projection.name,R=S?["PROJECTION_GLOBE_VIEW"]:null,B=S?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,$=[u.mercatorXfromLng(T.center.lng),u.mercatorYfromLat(T.center.lat)];for(let K=0;K<l.length;K++){const X=l[K];if(t.hasRenderableParent(X))continue;const ne=t.getTile(X),J=ne.getBucket(o);if(!J||J.projection.name!==T.projection.name)continue;const W=J.programConfigurations.get(o.id),se=f.useProgram("heatmap",W,R),{zoom:re}=f.transform;f.terrain&&f.terrain.setupElevationDraw(ne,se),f.prepareDrawProgram(d,se,X.toUnwrapped());const pe=T.projection.createInversionMatrix(T,X.canonical);se.draw(d,g.TRIANGLES,u.DepthMode.disabled,v,E,B,Rl(f,X,ne,pe,$,re,o.paint.get("heatmap-intensity")),o.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,o.paint,f.transform.zoom,W,S?[J.globeExtVertexBuffer]:null)}d.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(d,g){const v=d.context,E=v.gl,T=g.heatmapFbo;if(!T)return;v.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,T.colorAttachment.get()),v.activeTexture.set(E.TEXTURE1);let S=g.colorRampTexture;S||(S=g.colorRampTexture=new u.Texture(v,g.colorRamp,E.RGBA)),S.bind(E.LINEAR,E.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(v,E.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,d.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:g.paint.get("heatmap-opacity")},g.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,g.paint,d.transform.zoom)}(f,o))},line:function(f,t,o,l){if("translucent"!==f.renderPass)return;const d=o.paint.get("line-opacity"),g=o.paint.get("line-width");if(0===d.constantOr(1)||0===g.constantOr(1))return;const v=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),T=f.terrain&&f.terrain.renderingToTexture?1:u.exported.devicePixelRatio,S=o.paint.get("line-dasharray"),R=S.constantOr(1),B=o.layout.get("line-cap"),$=o.paint.get("line-pattern"),K=$.constantOr(1),X=o.paint.get("line-gradient"),ne=o.getCrossfadeParameters(),J=K?"linePattern":"line",W=f.context,se=W.gl,re=(ge=>{const ue=[];kl(ge)&&ue.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&ue.push("RENDER_LINE_GRADIENT");const xe=ge.paint.get("line-trim-offset");0===xe[0]&&0===xe[1]||ue.push("RENDER_LINE_TRIM_OFFSET");const Le=ge.paint.get("line-pattern").constantOr(1),Ue=1!==ge.paint.get("line-opacity").constantOr(1);return!Le&&Ue&&ue.push("RENDER_LINE_ALPHA_DISCARD"),ue})(o);let pe=re.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(pe=!1);for(const ge of l){const ue=t.getTile(ge);if(K&&!ue.patternsLoaded())continue;const xe=ue.getBucket(o);if(!xe)continue;f.prepareDrawTile();const Le=xe.programConfigurations.get(o.id),Ue=f.useProgram(J,Le,re),Oe=$.constantOr(null);if(Oe&&ue.imageAtlas){const ft=ue.imageAtlas,xt=ft.patternPositions[Oe.to.toString()],_t=ft.patternPositions[Oe.from.toString()];xt&&_t&&Le.setConstantPatternPositions(xt,_t)}const ct=S.constantOr(null),Se=B.constantOr(null);if(!K&&ct&&Se&&ue.lineAtlas){const ft=ue.lineAtlas,xt=ft.getDash(ct.to,Se),_t=ft.getDash(ct.from,Se);xt&&_t&&Le.setConstantPatternPositions(xt,_t)}let[Xe,Ke]=o.paint.get("line-trim-offset");("round"===Se||"square"===Se)&&Xe!==Ke&&(0===Xe&&(Xe-=1),1===Ke&&(Ke+=1));const ke=f.terrain?ge.projMatrix:null,Ce=K?dc(f,ue,o,ne,ke,T):Tu(f,ue,o,ne,ke,xe.lineClipsArray.length,T,[Xe,Ke]);if(X){const ft=xe.gradients[o.id];let xt=ft.texture;if(o.gradientVersion!==ft.version){let _t=256;if(o.stepInterpolant){const Vt=t.getSource().maxzoom,ln=ge.canonical.z===Vt?Math.ceil(1<<f.transform.maxZoom-ge.canonical.z):1;_t=u.clamp(u.nextPowerOfTwo(xe.maxLineLength/u.EXTENT*1024*ln),256,W.maxTextureSize)}ft.gradient=u.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:ft.gradient||void 0,clips:xe.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new u.Texture(W,ft.gradient,se.RGBA),ft.version=o.gradientVersion,xt=ft.texture}W.activeTexture.set(se.TEXTURE1),xt.bind(o.stepInterpolant?se.NEAREST:se.LINEAR,se.CLAMP_TO_EDGE)}R&&(W.activeTexture.set(se.TEXTURE0),ue.lineAtlasTexture.bind(se.LINEAR,se.REPEAT),Le.updatePaintBuffers(ne)),K&&(W.activeTexture.set(se.TEXTURE0),ue.imageAtlasTexture.bind(se.LINEAR,se.CLAMP_TO_EDGE),Le.updatePaintBuffers(ne)),f.prepareDrawProgram(W,Ue,ge.toUnwrapped());const Ct=ft=>{Ue.draw(W,se.TRIANGLES,v,ft,E,u.CullFaceMode.disabled,Ce,o.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,o.paint,f.transform.zoom,Le,[xe.layoutVertexBuffer2])};if(pe){const ft=f.stencilModeForClipping(ge).ref;0===ft&&f.terrain&&W.clear({stencil:0});const xt={func:se.EQUAL,mask:255};Ce.u_alpha_discard_threshold=.8,Ct(new u.StencilMode(xt,ft,255,se.KEEP,se.KEEP,se.INVERT)),Ce.u_alpha_discard_threshold=0,Ct(new u.StencilMode(xt,ft,255,se.KEEP,se.KEEP,se.KEEP))}else Ct(f.stencilModeForClipping(ge))}pe&&(f.resetStencilClippingMasks(),f.terrain&&W.clear({stencil:0}))},fill:function(f,t,o,l){const d=o.paint.get("fill-color"),g=o.paint.get("fill-opacity");if(0===g.constantOr(1))return;const v=f.colorModeForRenderPass(),E=o.paint.get("fill-pattern"),T=f.opaquePassEnabledForLayer()&&!E.constantOr(1)&&1===d.constantOr(u.Color.transparent).a&&1===g.constantOr(0)?"opaque":"translucent";if(f.renderPass===T){const S=f.depthModeForSublayer(1,"opaque"===f.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);zo(f,t,o,l,S,v,!1)}if("translucent"===f.renderPass&&o.paint.get("fill-antialias")){const S=f.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);zo(f,t,o,l,S,v,!0)}},"fill-extrusion":function(f,t,o,l){const d=o.paint.get("fill-extrusion-opacity");if(0!==d&&"translucent"===f.renderPass){const g=new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==d||o.paint.get("fill-extrusion-pattern").constantOr(1))Js(f,t,o,l,g,u.StencilMode.disabled,u.ColorMode.disabled),Js(f,t,o,l,g,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const v=f.colorModeForRenderPass();Js(f,t,o,l,g,u.StencilMode.disabled,v)}}},hillshade:function(f,t,o,l){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const d=f.context,g=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),v=f.colorModeForRenderPass(),E=f.terrain&&f.terrain.renderingToTexture,[T,S]="translucent"!==f.renderPass||E?[{},l]:f.stencilConfigForOverlap(l);for(const R of S){const B=t.getTile(R);if(B.needsHillshadePrepare&&"offscreen"===f.renderPass)Ga(f,B,o,g,u.StencilMode.disabled,v);else if("translucent"===f.renderPass){const $=E&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):T[R.overscaledZ];Oo(f,R,B,o,g,$,v)}}d.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,o,l,d,g){if("translucent"!==f.renderPass||0===o.paint.get("raster-opacity")||!l.length)return;const v=f.context,E=v.gl,T=t.getSource(),S=f.useProgram("raster"),R=f.colorModeForRenderPass(),B=f.terrain&&f.terrain.renderingToTexture,[$,K]=T instanceof ye||B?[{},l]:f.stencilConfigForOverlap(l),X=K[K.length-1].overscaledZ,ne=!f.options.moving;for(const J of K){const W=B?u.DepthMode.disabled:f.depthModeForSublayer(J.overscaledZ-X,1===o.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,E.LESS),se=J.toUnwrapped(),re=t.getTile(J);if(B&&(!re||!re.hasData()))continue;const pe=B?J.projMatrix:f.transform.calculateProjMatrix(se,ne),ge=f.terrain&&B?f.terrain.stencilModeForRTTOverlap(J):$[J.overscaledZ],ue=g?0:o.paint.get("raster-fade-duration");re.registerFadeDuration(ue);const xe=t.findLoadedParent(J,0),Le=Za(re,xe,t,f.transform,ue);let Ue,Oe;f.terrain&&f.terrain.prepareDrawTile();const ct="nearest"===o.paint.get("raster-resampling")?E.NEAREST:E.LINEAR;v.activeTexture.set(E.TEXTURE0),re.texture.bind(ct,E.CLAMP_TO_EDGE),v.activeTexture.set(E.TEXTURE1),xe?(xe.texture.bind(ct,E.CLAMP_TO_EDGE),Ue=Math.pow(2,xe.tileID.overscaledZ-re.tileID.overscaledZ),Oe=[re.tileID.canonical.x*Ue%1,re.tileID.canonical.y*Ue%1]):re.texture.bind(ct,E.CLAMP_TO_EDGE);const Se=Ka(pe,Oe||[0,0],Ue||1,Le,o,T instanceof ye?T.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(v,S,se),T instanceof ye)T.boundsBuffer&&T.boundsSegments&&S.draw(v,E.TRIANGLES,W,u.StencilMode.disabled,R,u.CullFaceMode.disabled,Se,o.id,T.boundsBuffer,f.quadTriangleIndexBuffer,T.boundsSegments);else{const{tileBoundsBuffer:Xe,tileBoundsIndexBuffer:Ke,tileBoundsSegments:ke}=f.getTileBoundsBuffers(re);S.draw(v,E.TRIANGLES,W,ge,R,u.CullFaceMode.disabled,Se,o.id,Xe,Ke,ke)}}f.resetStencilClippingMasks()},background:function(f,t,o,l){const d=o.paint.get("background-color"),g=o.paint.get("background-opacity");if(0===g)return;const v=f.context,E=v.gl,T=f.transform,S=T.tileSize,R=o.paint.get("background-pattern");if(f.isPatternMissing(R))return;const B=!R&&1===d.a&&1===g&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==B)return;const $=u.StencilMode.disabled,K=f.depthModeForSublayer(0,"opaque"===B?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),X=f.colorModeForRenderPass(),ne=f.useProgram(R?"backgroundPattern":"background");let J,W=l;W||(J=f.getBackgroundTiles(),W=Object.values(J).map(re=>re.tileID)),R&&(v.activeTexture.set(E.TEXTURE0),f.imageManager.bind(f.context));const se=o.getCrossfadeParameters();for(const re of W){const pe=re.toUnwrapped(),ge=l?re.projMatrix:f.transform.calculateProjMatrix(pe);f.prepareDrawTile();const ue=t?t.getTile(re):J?J[re.key]:new u.Tile(re,S,T.zoom,f),xe=R?Ol(ge,g,f,R,{tileID:re,tileSize:S},se):ti(ge,g,d);f.prepareDrawProgram(v,ne,pe);const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Oe}=f.getTileBoundsBuffers(ue);ne.draw(v,E.TRIANGLES,K,$,X,u.CullFaceMode.disabled,xe,o.id,Le,Ue,Oe)}},sky:function(f,t,o){const l=f.transform,d="mercator"===l.projection.name||"globe"===l.projection.name?1:u.smoothstep(7,8,l.zoom),g=o.paint.get("sky-opacity")*d;if(0===g)return;const v=f.context,E=o.paint.get("sky-type"),T=new u.DepthMode(v.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),S=f.frameCounter/1e3%1;"atmosphere"===E?"offscreen"===f.renderPass?o.needsSkyboxCapture(f)&&(function(R,B,$,K){const X=R.context,ne=X.gl;let J=B.skyboxFbo;if(!J){J=B.skyboxFbo=X.createFramebuffer(32,32,!1),B.skyboxGeometry=new L(X),B.skyboxTexture=X.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,B.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let pe=0;pe<6;++pe)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+pe,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(J.framebuffer),X.viewport.set([0,0,32,32]);const W=B.getCenter(R,!0),se=R.useProgram("skyboxCapture"),re=new Float64Array(16);u.identity(re),u.rotateY(re,re,.5*-Math.PI),Z(X,B,se,re,W,0),u.identity(re),u.rotateY(re,re,.5*Math.PI),Z(X,B,se,re,W,1),u.identity(re),u.rotateX(re,re,.5*-Math.PI),Z(X,B,se,re,W,2),u.identity(re),u.rotateX(re,re,.5*Math.PI),Z(X,B,se,re,W,3),u.identity(re),Z(X,B,se,re,W,4),u.identity(re),u.rotateY(re,re,Math.PI),Z(X,B,se,re,W,5),X.viewport.set([0,0,R.width,R.height])}(f,o),o.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,B,$,K,X){const ne=R.context,J=ne.gl,W=R.transform,se=R.useProgram("skybox");ne.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,B.skyboxTexture);const re={u_matrix:W.skyboxMatrix,u_sun_direction:B.getCenter(R,!1),u_cubemap:0,u_opacity:K,u_temporal_offset:X};R.prepareDrawProgram(ne,se),se.draw(ne,J.TRIANGLES,$,u.StencilMode.disabled,R.colorModeForRenderPass(),u.CullFaceMode.backCW,re,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,o,T,g,S):"gradient"===E&&"sky"===f.renderPass&&function(R,B,$,K,X){const ne=R.context,J=ne.gl,W=R.transform,se=R.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new L(ne)),ne.activeTexture.set(J.TEXTURE0);let re=B.colorRampTexture;re||(re=B.colorRampTexture=new u.Texture(ne,B.colorRamp,J.RGBA)),re.bind(J.LINEAR,J.CLAMP_TO_EDGE);const pe=(ge=W.skyboxMatrix,ue=B.getCenter(R,!1),xe=B.paint.get("sky-gradient-radius"),Le=K,Ue=X,{u_matrix:ge,u_color_ramp:0,u_center_direction:ue,u_radius:u.degToRad(xe),u_opacity:Le,u_temporal_offset:Ue});var ge,ue,xe,Le,Ue;R.prepareDrawProgram(ne,se),se.draw(ne,J.TRIANGLES,$,u.StencilMode.disabled,R.colorModeForRenderPass(),u.CullFaceMode.backCW,pe,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,o,T,g,S)},debug:function(f,t,o){for(let l=0;l<o.length;l++)Jo(f,t,o[l])},custom:function(f,t,o){const l=f.context,d=o.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))u.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const g=d.prerender;g&&(f.setCustomLayerDefaults(),l.setColorMode(f.colorModeForRenderPass()),g.call(d,l.gl,f.transform.customLayerMatrix()),l.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),l.setColorMode(f.colorModeForRenderPass()),l.setStencilMode(u.StencilMode.disabled);const g="3d"===d.renderingMode?new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,u.DepthMode.ReadOnly);l.setDepthMode(g),d.render(l.gl,f.transform.customLayerMatrix()),l.setDirty(),f.setBaseState(),l.bindFramebuffer.set(null)}}};class Kt{constructor(t,o){this.context=new U(t),this.transform=o,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new eo,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,o){const l=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(l||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Br(this,t));const d=this._terrain;this.transform.elevation=l?d:null,d.update(t,this.transform,o)}_updateFog(t){const o=t.fog;if(!o||"globe"===this.transform.projection.name||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[l,d]=o.getFovAdjustedRange(this.transform._fov);if(l>d)return void(this.transform.fogCullDistSq=null);const g=l+.78*(d-l);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,o){if(this.width=t*u.exported.devicePixelRatio,this.height=o*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const l of this.style.order)this.style._layers[l].resize()}setup(){const t=this.context,o=new u.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(u.EXTENT,0),o.emplaceBack(0,u.EXTENT),o.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(o,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const l=new u.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(u.EXTENT,0),l.emplaceBack(0,u.EXTENT),l.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(l,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const d=new u.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const g=new u.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(u.EXTENT,0,u.EXTENT,0),g.emplaceBack(0,u.EXTENT,0,u.EXTENT),g.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(g,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const v=new u.StructArrayLayout3ui6;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const E=new u.StructArrayLayout1ui2;for(const S of[0,1,3,2,0])E.emplaceBack(S);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new u.Texture(t,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=u.create();const T=this.context.gl;this.stencilClearMode=new u.StencilMode({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new Ge(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context,o=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,o.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Ns(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,l){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!l||0===l.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const T of l)if(void 0===this._tileClippingMaskIDs[T.key]){E=!0;break}if(!E)return}this.currentStencilSource=o.id;const d=this.context,g=d.gl;this.nextStencilID+l.length>256&&this.clearStencil(),d.setColorMode(u.ColorMode.disabled),d.setDepthMode(u.DepthMode.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of l){const T=o.getTile(E),S=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:$}=this.getTileBoundsBuffers(T);v.draw(d,g.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:g.ALWAYS,mask:0},S,255,g.KEEP,g.KEEP,g.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Ns(E.projMatrix),"$clipping",R,B,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new u.StencilMode({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new u.StencilMode({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,l=t.sort((v,E)=>E.overscaledZ-v.overscaledZ),d=l[l.length-1].overscaledZ,g=l[0].overscaledZ-d+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const v={};for(let E=0;E<g;E++)v[E+d]=new u.StencilMode({func:o.GEQUAL,mask:255},E+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=g,[v,l]}return[{[d]:u.StencilMode.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(t,o,l){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new u.DepthMode(l||this.context.gl.LEQUAL,o,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,o){this.style=t,this.options=o,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const l=this.style.order,d=this.style._sourceCaches;for(const T in d){const S=d[T];S.used&&S.prepare(this.context)}const g={},v={},E={};for(const T in d){const S=d[T];g[T]=S.getVisibleCoordinates(),v[T]=g[T].slice().reverse(),E[T]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),u.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const T of l){const S=this.style._layers[T],R=t._getLayerSourceCache(S);if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const B=R?v[R.id]:void 0;("custom"===S.type||S.isSky()||B&&B.length)&&this.renderLayer(this,R,S,B)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:o.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],S=t._getLayerSourceCache(T);if(T.isSky())continue;const R=S?v[S.id]:void 0;this._renderTileClippingMasks(T,S,R),this.renderLayer(this,S,T,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(T,S){const R=T.context,B=R.gl,$=T.transform,K=new u.DepthMode(B.LEQUAL,u.DepthMode.ReadOnly,[0,1]),X=T.useProgram("globeAtmosphere",null,"globe"===$.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ne=u.globeToMercatorTransition($.zoom),J=S.properties.get("color").toArray01(),W=S.properties.get("high-color").toArray01(),se=S.properties.get("space-color").toArray01PremultipliedAlpha(),re=u.identity$1([]);u.rotateY$1(re,re,-u.degToRad($._center.lng)),u.rotateX$1(re,re,u.degToRad($._center.lat)),u.rotateZ$1(re,re,$.angle),u.rotateX$1(re,re,-$._pitch);const pe=u.fromQuat(new Float32Array(16),re),ge=u.mapValue(S.properties.get("star-intensity"),0,1,0,.25),xe=u.mapValue(S.properties.get("horizon-blend"),0,1,5e-4,.25),Le=u.globeUseCustomAntiAliasing(T,R,$)&&5e-4===xe?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Ue=T.frameCounter/1e3%1,Oe=u.length($.globeCenterInViewSpace),ct=Math.sqrt(Math.pow(Oe,2)-Math.pow(Le,2)),Se=Math.acos(ct/Oe),Xe={u_frustum_tl:$.frustumCorners.TL,u_frustum_tr:$.frustumCorners.TR,u_frustum_br:$.frustumCorners.BR,u_frustum_bl:$.frustumCorners.BL,u_horizon:$.frustumCorners.horizon,u_transition:ne,u_fadeout_range:xe,u_color:J,u_high_color:W,u_space_color:se,u_star_intensity:ge,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ue,u_horizon_angle:Se,u_rotation_matrix:pe};T.prepareDrawProgram(R,X);const Ke=T.atmosphereBuffer;Ke&&X.draw(R,B.TRIANGLES,K,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Xe,"skybox",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],S=t._getLayerSourceCache(T);T.isSky()&&this.renderLayer(this,S,T,S?v[S.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;){const T=this.style._layers[l[this.currentLayer]],S=t._getLayerSourceCache(T);if(T.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(T)){if(T.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=S?("symbol"===T.type?E:v)[S.id]:void 0;this._renderTileClippingMasks(T,S,S?g[S.id]:void 0),this.renderLayer(this,S,T,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let T=null;u.values(this.style._layers).forEach(S=>{const R=t._getLayerSourceCache(S);R&&!S.isHidden(this.transform.zoom)&&(!T||T.getSource().maxzoom<R.getSource().maxzoom)&&(T=R)}),T&&this.options.showTileBoundaries&&tt.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const S=T.transform.padding;ps(T,T.transform.height-(S.top||0),3,Eo),ps(T,S.bottom||0,3,pc),Qs(T,S.left||0,3,mc),Qs(T,T.transform.width-(S.right||0),3,Hc);const R=T.transform.centerPoint;var B,$,K,X;Gi(B=T,($=R.x)-1,(K=T.transform.height-R.y)-10,2,20,X=wa),Gi(B,$-10,K-1,20,2,X)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,o,l,d){l.isHidden(this.transform.zoom)||("background"===l.type||"sky"===l.type||"custom"===l.type||d&&d.length)&&(this.id=l.id,this.gpuTimingStart(l),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(l.type)||tt[l.type](t,o,l,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;let l=this.gpuTimers[t.id];l||(l=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:o.createQueryEXT()}),l.calls++,o.beginQueryEXT(o.TIME_ELAPSED_EXT,l.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(o),t.beginQueryEXT(t.TIME_ELAPSED_EXT,o)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const l in t){const d=t[l],g=this.context.extTimerQuery,v=g.getQueryObjectEXT(d.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(d.query),o[l]=v}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.extTimerQuery;let l=0;for(const d of t)l+=o.getQueryObjectEXT(d,o.QUERY_RESULT_EXT)/1e6,o.deleteQueryEXT(d);return l}translatePosMatrix(t,o,l,d,g){if(!l[0]&&!l[1])return t;const v=g?"map"===d?this.transform.angle:0:"viewport"===d?-this.transform.angle:0;if(v){const S=Math.sin(v),R=Math.cos(v);l=[l[0]*R-l[1]*S,l[0]*S+l[1]*R]}const E=[g?l[0]:en(o,l[0],this.transform.zoom),g?l[1]:en(o,l[1],this.transform.zoom),0],T=new Float32Array(16);return u.translate(T,t,E),T}saveTileTexture(t){const o=this._tileTextures[t.size[0]];o?o.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const o=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!o||!l}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,o=this.style&&this.style.fog,l=[];return this.terrainRenderModeElevated()&&l.push("TERRAIN"),"globe"===this.transform.projection.name&&l.push("GLOBE"),o&&!t&&0!==o.getOpacity(this.transform.pitch)&&l.push("FOG"),t&&l.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&l.push("OVERDRAW_INSPECTOR"),l}useProgram(t,o,l){this.cache=this.cache||{};const d=l||[],g=this.currentGlobalDefines().concat(d),v=ro.cacheKey(cc[t],t,g,o);return this.cache[v]||(this.cache[v]=new ro(this.context,t,cc[t],o,Us[t],g)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,o,l){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const g=d.getOpacity(this.transform.pitch),v=((E,T,S,R,B,$,K,X,ne,J,W)=>{const se=E.transform,re=T.properties.get("color").toArray01();re[3]=R;const pe=E.frameCounter/1e3%1;return{u_fog_matrix:S?se.calculateFogTileMatrix(S):E.identityMat,u_fog_range:T.getFovAdjustedRange(se._fov),u_fog_color:re,u_fog_horizon_blend:T.properties.get("horizon-blend"),u_fog_temporal_offset:pe,u_frustum_tl:B,u_frustum_tr:$,u_frustum_br:K,u_frustum_bl:X,u_globe_pos:ne,u_globe_radius:J,u_viewport:W,u_globe_transition:u.globeToMercatorTransition(se.zoom),u_is_globe:+("globe"===se.projection.name)}})(this,d,l,g,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);o.setFogUniformValues(t,v)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},l=this.transform.coveringTiles({tileSize:512});for(const d of l)o[d.key]=t[d.key]||new u.Tile(d,512,this.transform.tileZoom,this);return o}clearBackgroundTiles(){this._backgroundTiles={}}}class tr{constructor(t=0,o=0,l=0,d=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(l)||l<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=l,this.right=d}interpolate(t,o,l){return null!=o.top&&null!=t.top&&(this.top=u.number(t.top,o.top,l)),null!=o.bottom&&null!=t.bottom&&(this.bottom=u.number(t.bottom,o.bottom,l)),null!=o.left&&null!=t.left&&(this.left=u.number(t.left,o.left,l)),null!=o.right&&null!=t.right&&(this.right=u.number(t.right,o.right,l)),this}getCenter(t,o){const l=u.clamp((this.left+t-this.right)/2,0,t),d=u.clamp((this.top+o-this.bottom)/2,0,o);return new u.pointGeometry(l,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new tr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Tn(f,t){const o=u.getColumn(f,3);u.fromQuat(f,t),u.setColumn(f,3,o)}function $n(f,t){const o=u.identity$1([]);return u.rotateZ$1(o,o,-t),u.rotateX$1(o,o,-f),o}function rn(f,t){const o=[f[0],f[1],0],l=[t[0],t[1],0];if(u.length(o)>=1e-15){const v=u.normalize([],o);u.scale$2(l,v,u.dot(l,v)),t[0]=l[0],t[1]=l[1]}const d=u.cross([],t,f);if(u.len(d)<1e-15)return null;const g=Math.atan2(-d[1],d[0]);return $n(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),g)}class Nr{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof u.MercatorCoordinate?t:new u.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=u.wrap(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const l=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(t)):0,d=this.position,g=u.MercatorCoordinate.fromLngLat(t,l),v=[g.x-d.x,g.y-d.y,g.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=rn(v,o)}setPitchBearing(t,o){this.orientation=$n(u.degToRad(t),u.degToRad(-o))}}class nr{constructor(t,o){this._transform=u.identity([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new u.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=u.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&u.setColumn(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||u.identity$1([]),t&&Tn(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=$n(t,o),Tn(this._transform,this._orientation)}forward(){const t=u.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=u.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=u.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const l=new Float64Array(16);return u.invert(l,this.getWorldToCamera(t,o)),l}getWorldToCameraPosition(t,o,l){const d=this.position;u.scale$2(d,d,-t);const g=new Float64Array(16);return u.fromScaling(g,[l,l,l]),u.translate(g,g,d),g[10]*=o,g}getWorldToCamera(t,o){const l=new Float64Array(16),d=new Float64Array(4),g=this.position;return u.conjugate(d,this._orientation),u.scale$2(g,g,-t),u.fromQuat(l,d),u.translate(l,l,g),l[1]*=-1,l[5]*=-1,l[9]*=-1,l[13]*=-1,l[8]*=o,l[9]*=o,l[10]*=o,l[11]*=o,l}getCameraToClipPerspective(t,o,l,d){const g=new Float64Array(16);return u.perspective(g,t,o,l,d),g}getDistanceToElevation(t){const o=0===t?0:u.mercatorZfromAltitude(t,this.position[1]),l=this.forward();return(o-this.position[2])/l[2]}clone(){return new nr([...this.position],[...this.orientation])}}function Yr(f,t){const o=Fi(f.projection,f.zoom,f.width,f.height),l=function(g,v,E,T,S){const R=new u.LngLat(E.lng-180*xi,E.lat),B=new u.LngLat(E.lng+180*xi,E.lat),$=g.project(R.lng,R.lat),K=g.project(B.lng,B.lat),X=-Math.atan2(K.y-$.y,K.x-$.x),ne=u.MercatorCoordinate.fromLngLat(E);ne.y=u.clamp(ne.y,-.999975,.999975);const J=ne.toLngLat(),W=g.project(J.lng,J.lat),se=u.MercatorCoordinate.fromLngLat(J);se.x+=xi;const re=se.toLngLat(),pe=g.project(re.lng,re.lat),ge=Tt(pe.x-W.x,pe.y-W.y,X),ue=u.MercatorCoordinate.fromLngLat(J);ue.y+=xi;const xe=ue.toLngLat(),Le=g.project(xe.lng,xe.lat),Ue=Tt(Le.x-W.x,Le.y-W.y,X),Oe=Math.abs(ge.x)/Math.abs(Ue.y),ct=u.identity([]);u.rotateZ(ct,ct,-X*(1-(S?0:T)));const Se=u.identity([]);return u.scale(Se,Se,[1,1-(1-Oe)*T,1]),Se[4]=-Ue.x/Ue.y*T,u.rotateZ(Se,Se,X),u.multiply(Se,ct,Se),Se}(f.projection,0,f.center,o,t),d=Do(f);return u.scale(l,l,[d,d,1]),l}function Do(f){const t=f.projection,o=Fi(f.projection,f.zoom,f.width,f.height),l=bi(t,f.center),d=bi(t,u.LngLat.convert(t.center));return Math.pow(2,l*o+(1-o)*d)}function Fi(f,t,o,l,d=1/0){const g=f.range;if(!g)return 0;const v=Math.min(d,Math.max(o,l)),E=Math.log(v/1024)/Math.LN2;return u.smoothstep(g[0]+E,g[1]+E,t)}const xi=1/4e4;function bi(f,t){const o=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),l=new u.LngLat(t.lng-180*xi,o),d=new u.LngLat(t.lng+180*xi,o),g=f.project(l.lng,o),v=f.project(d.lng,o),E=u.MercatorCoordinate.fromLngLat(l),T=u.MercatorCoordinate.fromLngLat(d),S=v.x-g.x,R=v.y-g.y,B=T.x-E.x,$=T.y-E.y,K=Math.sqrt((B*B+$*$)/(S*S+R*R));return Math.log(K)/Math.LN2}function Tt(f,t,o){const l=Math.cos(o),d=Math.sin(o);return{x:f*l-t*d,y:f*d+t*l}}class ni{constructor(t,o,l,d,g,v,E){this.tileSize=512,this._renderWorldCopies=void 0===g||g,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=l??0,this._maxPitch=d??60,this.setProjection(v),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new nr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const t=new ni(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const o=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||o)&&this._updateCameraOnTerrain(),(t||o)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const l=!Te(o,this.getProjection());return l&&this._calcMatrices(),this.mercatorFromTransition=!1,l}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;var l,d,g,v,E,T,S,R,B,$;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=(l=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l),d=this.rotationMatrix,v=this.angle,E=(g=this.rotationMatrix)[0],T=g[1],S=g[2],R=g[3],B=Math.sin(v),$=Math.cos(v),d[0]=E*$+S*B,d[1]=T*$+R*B,d[2]=E*-B+S*$,d[3]=T*-B+R*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=u.degToRad(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],l=this.horizonLineFromTop();let d=0,g=0;for(let v=0;v<o.length;v++){const E=new u.pointGeometry(o[v][0]*this.width,l+o[v][1]*(this.height-l)),T=t.pointCoordinate(E);if(!T)continue;const S=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);d+=T[3]*S,g+=S}return 0===g?NaN:d/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),l=this.pixelsPerMeter/this.worldSize*o,d=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),v=Math.max(d-l,g);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let l;l=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const d=u.length(u.sub([],this._camera.position,l));return u.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!u.exactEquals(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const l=[t.position.x,t.position.y,t.position.z];u.exactEquals$1(l,this._camera.position)||(this._setCameraPosition(l),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new Nr;return o.position=new u.MercatorCoordinate(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!u.length$1(t))return!1;u.normalize$1(t,t);const o=u.transformQuat([],[0,0,-1],t),l=u.transformQuat([],[0,-1,0],t);if(l[2]<0)return!1;const d=rn(o,l);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,l=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;t[2]=u.clamp(t[2],d/l,d/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,l){this._unmodified=!1,this._edgeInsets.interpolate(t,o,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new u.UnwrappedTileID(0,t)];if(this.renderWorldCopies){const l=this.pointCoordinate(new u.pointGeometry(0,0)),d=this.pointCoordinate(new u.pointGeometry(this.width,0)),g=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new u.pointGeometry(0,this.height)),E=Math.floor(Math.min(l.x,d.x,g.x,v.x)),T=Math.floor(Math.max(l.x,d.x,g.x,v.x)),S=1;for(let R=E-S;R<=T+S;R++)0!==R&&o.push(new u.UnwrappedTileID(R,t))}return o}coveringTiles(t){let o=this.coveringZoomLevel(t);const l=o,d=this.elevation&&!t.isTerrainDEM,g="mercator"===this.projection.name;if(void 0!==t.minzoom&&o<t.minzoom)return[];void 0!==t.maxzoom&&o>t.maxzoom&&(o=t.maxzoom);const v=this.locationCoordinate(this.center),E=this.center.lat,T=1<<o,S=[T*v.x,T*v.y,0],R="globe"===this.projection.name,B=!R,$=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,B),K=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=T*u.mercatorZfromAltitude(1,this.center.lat),ne=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),J=[T*K.x,T*K.y,ne*(B?1:X)],W=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),se=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?o:0,re=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,pe=t.isTerrainDEM?-re:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?Do(this):1,ue=Ce=>{const ft=new u.MercatorCoordinate(Ce.x+25e-6,Ce.y,Ce.z),xt=new u.MercatorCoordinate(Ce.x,Ce.y+25e-6,Ce.z),_t=Ce.toLngLat(),Vt=ft.toLngLat(),ln=xt.toLngLat(),Qt=this.locationCoordinate(_t),$t=this.locationCoordinate(Vt),yt=this.locationCoordinate(ln),vn=Math.hypot($t.x-Qt.x,$t.y-Qt.y),Mn=Math.hypot(yt.x-Qt.x,yt.y-Qt.y);return Math.sqrt(vn*Mn)*ge/25e-6},xe=Ce=>{const Ct=re,ft=pe;return{aabb:u.tileAABB(this,T,0,0,0,Ce,ft,Ct,this.projection),zoom:0,x:0,y:0,minZ:ft,maxZ:Ct,wrap:Ce,fullyVisible:!1}},Le=[];let Ue=[];const Oe=o,ct=t.reparseOverscaled?l:o,Se=Ce=>Ce*Ce,Xe=Se((ne-this._centerAltitude)*X),Ke=Ce=>{if(!this._elevation||!Ce.tileID||!g)return;const Ct=this._elevation.getMinMaxForTile(Ce.tileID),ft=Ce.aabb;Ct?(ft.min[2]=Ct.min,ft.max[2]=Ct.max,ft.center[2]=(ft.min[2]+ft.max[2])/2):(Ce.shouldSplit=ke(Ce),Ce.shouldSplit||(ft.min[2]=ft.max[2]=ft.center[2]=this._centerAltitude))},ke=Ce=>{if(Ce.zoom<se)return!0;if(Ce.zoom===Oe)return!1;if(null!=Ce.shouldSplit)return Ce.shouldSplit;const Ct=Ce.aabb.distanceX(J),ft=Ce.aabb.distanceY(J);let xt=Xe,_t=1;if(R){xt=Se(Ce.aabb.distanceZ(J));const Qt=Math.pow(2,Ce.zoom),$t=u.latFromMercatorY((Ce.y+1)/Qt),yt=u.latFromMercatorY(Ce.y/Qt),vn=Math.min(Math.max(E,$t),yt),Mn=u.circumferenceAtLatitude(vn)/u.circumferenceAtLatitude(E);if(_t=vn===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mn/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&Ce.zoom===Oe-1&&Mn>=.9)return!0}else if(d&&(xt=Se(Ce.aabb.distanceZ(J)*X)),this.projection.isReprojectedInTileSpace&&l<=5){const Qt=Math.pow(2,Ce.zoom),$t=ue(new u.MercatorCoordinate((Ce.x+.5)/Qt,(Ce.y+.5)/Qt));_t=$t>.85?1:$t}const Vt=Ct*Ct+ft*ft+xt;return Vt<Se((1<<Oe-Ce.zoom)*W*_t*((Qt,$t)=>{if($t*Se(.707)<Qt)return 1;const yt=Math.sqrt($t/Qt);return yt/(1.4144271570014144+(Math.pow(1.1,yt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(xt,Xe),Vt))};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)Le.push(xe(-Ce)),Le.push(xe(Ce));for(Le.push(xe(0));Le.length>0;){const Ce=Le.pop(),Ct=Ce.x,ft=Ce.y;let xt=Ce.fullyVisible;if(!xt){const _t=Ce.aabb.intersects($);if(0===_t)continue;xt=2===_t}if(Ce.zoom!==Oe&&ke(Ce))for(let _t=0;_t<4;_t++){const Vt=(Ct<<1)+_t%2,ln=(ft<<1)+(_t>>1),Qt={aabb:g?Ce.aabb.quadrant(_t):u.tileAABB(this,T,Ce.zoom+1,Vt,ln,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:Vt,y:ln,wrap:Ce.wrap,fullyVisible:xt,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};d&&!R&&(Qt.tileID=new u.OverscaledTileID(Ce.zoom+1===Oe?ct:Ce.zoom+1,Ce.wrap,Ce.zoom+1,Vt,ln),Ke(Qt)),Le.push(Qt)}else{const _t=Ce.zoom===Oe?ct:Ce.zoom;if(t.minzoom&&t.minzoom>_t)continue;const Vt=S[0]-(.5+Ct+(Ce.wrap<<Ce.zoom))*(1<<o-Ce.zoom),ln=S[1]-.5-ft,Qt=Ce.tileID?Ce.tileID:new u.OverscaledTileID(_t,Ce.wrap,Ce.zoom,Ct,ft);Ue.push({tileID:Qt,distanceSq:Vt*Vt+ln*ln})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,Ct=this.horizonLineFromTop();Ue=Ue.filter(ft=>{const xt=[0,0,0,1],_t=[u.EXTENT,u.EXTENT,0,1],Vt=this.calculateFogTileMatrix(ft.tileID.toUnwrapped());u.transformMat4$1(xt,xt,Vt),u.transformMat4$1(_t,_t,Vt);const ln=u.getAABBPointSquareDist(xt,_t);if(0===ln)return!0;let Qt=!1;const $t=this._elevation;if($t&&ln>Ce&&0!==Ct){const yt=this.calculateProjMatrix(ft.tileID.toUnwrapped());let vn;t.isTerrainDEM||(vn=$t.getMinMaxForTile(ft.tileID)),vn||(vn={min:pe,max:re});const Mn=u.furthestTileCorner(this.rotation),gr=[Mn[0]*u.EXTENT,Mn[1]*u.EXTENT,vn.max];u.transformMat4(gr,gr,yt),Qt=(1-gr[1])*this.height*.5<Ct}return ln<Ce||Qt})}return Ue.sort((Ce,Ct)=>Ce.distanceSq-Ct.distanceSq).map(Ce=>Ce.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=u.clamp(t.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),l=this.projection.project(t.lng,o);return new u.pointGeometry(l.x*this.worldSize,l.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,o){let l,d;const g=this.centerPoint;if("globe"===this.projection.name){const E=this.worldSize;l=(o.x-g.x)/E,d=(o.y-g.y)/E}else{const E=this.pointCoordinate(o),T=this.pointCoordinate(g);l=E.x-T.x,d=E.y-T.y}const v=this.locationCoordinate(t);this.setLocation(new u.MercatorCoordinate(v.x-l,v.y-d))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,o){const l=o?u.mercatorZfromAltitude(o,t.lat):void 0,d=this.projection.project(t.lng,t.lat);return new u.MercatorCoordinate(d.x,d.y,l)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const l=o??this._centerAltitude,d=[t.x,t.y,0,1],g=[t.x,t.y,1,1];u.transformMat4$1(d,d,this.pixelMatrixInverse),u.transformMat4$1(g,g,this.pixelMatrixInverse);const v=g[3];u.scale$1(d,d,1/d[3]),u.scale$1(g,g,1/v);const E=d[2],T=g[2];return{p0:d,p1:g,t:E===T?0:(l-E)/(T-E)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],l=[t.x,t.y,1,1];return u.transformMat4$1(o,o,this.pixelMatrixInverse),u.transformMat4$1(l,l,this.pixelMatrixInverse),u.scale$1(o,o,1/o[3]),u.scale$1(l,l,1/l[3]),o[2]=u.mercatorZfromAltitude(o[2],this._center.lat)*this.worldSize,l[2]=u.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,u.scale$1(o,o,1/this.worldSize),u.scale$1(l,l,1/this.worldSize),new u.Ray([o[0],o[1],o[2]],u.normalize([],u.sub([],l,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:l,t:d}=t,g=u.mercatorZfromAltitude(o[2],this._center.lat),v=u.mercatorZfromAltitude(l[2],this._center.lat);return new u.MercatorCoordinate(u.number(o[0],l[0],d)/this.worldSize,u.number(o[1],l[1],d)/this.worldSize,u.number(g,v,d))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let o=this.projection.pointCoordinate3D(this,t.x,t.y);if(o)return new u.MercatorCoordinate(o[0],o[1],o[2]);let l=0,d=this.horizonLineFromTop();if(t.y>d)return this.pointCoordinate(t);const g=.02*d,v=t.clone();for(let E=0;E<10&&d-l>g;E++){v.y=u.number(l,d,.66);const T=this.projection.pointCoordinate3D(this,v.x,v.y);T?(d=v.y,o=T):l=v.y}return o?new u.MercatorCoordinate(o[0],o[1],o[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,o){const l=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,d=[t.x*this.worldSize,t.y*this.worldSize,l+t.toAltitude(),1];return u.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new u.pointGeometry(d[0]/d[3],d[1]/d[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:t,left:o}=this._edgeInsets,l=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,g=this.pointCoordinate3D(new u.pointGeometry(o,t)),v=this.pointCoordinate3D(new u.pointGeometry(d,t)),E=this.pointCoordinate3D(new u.pointGeometry(d,l)),T=this.pointCoordinate3D(new u.pointGeometry(o,l));let S=Math.min(g.x,T.x),R=Math.max(v.x,E.x),B=Math.min(g.y,v.y),$=Math.max(T.y,E.y);const K=Math.pow(2,-this.zoom)/16,X=(W,se,re,pe)=>{const ge=(W+re)/2,ue=(se+pe)/2,xe=new u.pointGeometry(ge,ue),Le=this.pointCoordinate3D(xe),Ue=Math.max(0,S-Le.x,B-Le.y,Le.x-R,Le.y-$);S=Math.min(S,Le.x),R=Math.max(R,Le.x),B=Math.min(B,Le.y),$=Math.max($,Le.y),Ue>K&&(X(W,se,ge,ue),X(ge,ue,re,pe))};X(o,t,d,t),X(d,t,d,l),X(d,l,o,l),X(o,l,o,t);const ne=new u.LngLat(u.lngFromMercatorX(R),u.latFromMercatorY(B)),J=new u.LngLat(u.lngFromMercatorX(S),u.latFromMercatorY($));return new u.LngLatBounds(J,ne)}_getBounds(t,o){if("globe"===this.projection.name)return this._getGlobeBounds();const l=new u.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),d=new u.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),g=new u.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),v=new u.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let E=this.pointCoordinate(l,t),T=this.pointCoordinate(d,t);const S=this.pointCoordinate(g,o),R=this.pointCoordinate(v,o),B=($,K)=>(K.y-$.y)/(K.x-$.x);return E.y>1&&T.y>=0?E=new u.MercatorCoordinate((1-R.y)/B(R,E)+R.x,1):E.y<0&&T.y<=1&&(E=new u.MercatorCoordinate(-R.y/B(R,E)+R.x,0)),T.y>1&&E.y>=0?T=new u.MercatorCoordinate((1-S.y)/B(S,T)+S.x,1):T.y<0&&E.y<=1&&(T=new u.MercatorCoordinate(-S.y/B(S,T)+S.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(E)).extend(this.coordinateLocation(T)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(S))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBounds(0,0);const o=t.visibleDemTiles.reduce((l,d)=>{if(d.dem){const g=d.dem.tree;l.min=Math.min(l.min,g.minimums[0]),l.max=Math.max(l.max,g.maximums[0])}return l},{min:Number.MAX_VALUE,max:0});return this._getBounds(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,l=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,l):l}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,l=this._distanceTileDataCache;if(l[o])return l[o];const d=t.canonical,g=1/this.height,v=this.cameraWorldSize/this.zoomScale(d.z),E=(d.x+Math.pow(2,d.z)*t.wrap)*v,T=d.y*v,S=this.point,R=this.angle,B=Math.sin(-R),$=-Math.cos(-R);return l[o]={bearing:[B,$],center:[(S.x-E)*g,(S.y-T)*g],scale:v/u.EXTENT*g},l[o]}calculateFogTileMatrix(t){const o=t.key,l=this._fogTileMatrixCache;if(l[o])return l[o];const d=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return u.multiply(d,this.worldToFogMatrix,d),l[o]=new Float32Array(d),l[o]}calculateProjMatrix(t,o=!1){const l=t.key,d=o?this._alignedProjMatrixCache:this._projMatrixCache;if(d[l])return d[l];const g=this.calculatePosMatrix(t,this.worldSize);return u.multiply(g,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:o?this.alignedProjMatrix:this.projMatrix,g),d[l]=new Float32Array(g),d[l]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,l=this._pixelsToTileUnitsCache;if(l[o])return l[o];const d=function(g,v){const{scale:E}=g.tileTransform,T=E*u.EXTENT/(g.tileSize*Math.pow(2,v.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return S=new Float32Array(4),$=(R=v.inverseAdjustmentMatrix)[1],K=R[2],X=R[3],J=(B=[T,T])[1],S[0]=R[0]*(ne=B[0]),S[1]=$*ne,S[2]=K*J,S[3]=X*J,S;var S,R,B,$,K,X,ne,J}(t,this);return l[o]=d,l[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const o=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,l=this._computeCameraPosition(o),d=this._camera.forward(),g=u.mercatorZfromAltitude(1,this._center.lat);l[2]/=g,d[2]/=g,u.normalize(d,d);const v=t.raycast(l,d,t.exaggeration());if(v){const E=u.scaleAndAdd([],l,d,v),T=new u.MercatorCoordinate(E[0],E[1],u.mercatorZfromAltitude(E[2],u.latFromMercatorY(E[1]))),S=(T.z+u.length([T.x-l[0],T.y-l[1],T.z-l[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(S),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const o=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,l=this._computeCameraPosition(o),d=t.getAtPointOrZero(new u.MercatorCoordinate(...l)),g=this._minimumHeightOverTerrain()*Math.cos(u.degToRad(this._maxPitch)),v=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*d;if(v<g){const E=this.locationCoordinate(this._center,this._centerAltitude),T=[E.x-l[0],E.y-l[1],E.z-l[2]],S=u.length(T);T[2]-=(g-v)/this._pixelsPerMercatorPixel;const R=u.length(T);if(0===R)return;u.scale$2(T,T,S/R*this._pixelsPerMercatorPixel),this._camera.position=[E.x-T[0],E.y-T[1],E.z*this._pixelsPerMercatorPixel-T[2]],this._camera.orientation=rn(T,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const $=this.center;return $.lat=u.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&($.lng=u.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const o=this._unmodified,{x:l,y:d}=this.point;let g=0,v=l,E=d;const T=this.width/2,S=this.height/2,R=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(d-S<R&&(E=R+S),d+S>B&&(E=B-S),B-R<this.height&&(g=Math.max(g,this.height/(B-R)),E=(B+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,X=this.worldSize/2-($+K)/2;v=(l+X+this.worldSize)%this.worldSize-X,v-T<$&&(v=$+T),v+T>K&&(v=K-T),K-$<this.width&&(g=Math.max(g,this.width/(K-$)),v=(K+$)/2)}v===l&&E===d||(this.center=this.unproject(new u.pointGeometry(v,E))),g&&(this.zoom+=this.scaleZoom(g)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const l=Fi(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,l),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?o:1),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-t.x/this.width,g[9]=2*t.y/this.height;let v=u.mul([],g,d);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),ue=u.identity([]);u.translate(ue,ue,[ge.x*this.worldSize,ge.y*this.worldSize,0]),u.multiply(ue,ue,Yr(this)),u.translate(ue,ue,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),u.multiply(v,v,ue),this.inverseAdjustmentMatrix=function(xe){const Le=Yr(xe,!0);return qe([],[Le[0],Le[1],Le[4],Le[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],v,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=v,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const E=u.invert([],g);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const T=new Float32Array(16);u.identity(T),u.scale(T,T,[1,-1,1]),u.rotateX(T,T,this._pitch),u.rotateZ(T,T,this.angle);const S=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;S[8]=2*-t.x/this.width,S[9]=2*(t.y+R)/this.height,this.skyboxMatrix=u.multiply(T,S,T);const B=this.point,$=B.x,K=B.y,X=this.width%2/2,ne=this.height%2/2,J=Math.cos(this.angle),W=Math.sin(this.angle),se=$-Math.round($)+J*X+W*ne,re=K-Math.round(K)+J*ne+W*X,pe=new Float64Array(v);if(u.translate(pe,pe,[se>.5?se-1:se,re>.5?re-1:re,0]),this.alignedProjMatrix=pe,v=u.create(),u.scale(v,v,[this.width/2,-this.height/2,1]),u.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=u.create(),u.scale(v,v,[1,-1,1]),u.translate(v,v,[-1,-1,0]),u.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},v=u.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(ge,ge,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,o=this.cameraPixelsPerMeter,l=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,o];u.scale$2(g,g,d),u.scale$2(l,l,-1),u.multiply$2(l,l,g);const v=u.create();u.translate(v,v,l),u.scale(v,v,g),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,d)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,l=this._camera.forward(),d=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-l[0]*g,d.y/this.worldSize-l[1]*g,t/this.worldSize*this._centerAltitude-l[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),l=this._camera.position[2],d=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(g=Math.min((o-l)/d,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:l,bearing:d}=this._camera.getPitchBearing(),g=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),E=Math.max((t[2]-g)/Math.cos(l),v),T=this._zoomFromMercatorZ(E);u.scaleAndAdd(t,t,o,E),this._pitch=u.clamp(l,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(d,-Math.PI,Math.PI),this._setZoom(u.clamp(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){const o=v=>{const E=this.getCameraToCenterDistance(this.projection,v);return this.scaleZoom(E/(t*this.tileSize))};let l,d=o(this.zoom),g=Math.abs(d-o(d));for(;l!==g;)d=o(d),l=g,g=Math.abs(d-o(d));return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const l=Math.min(t.x,o.x),d=Math.max(t.x,o.x),g=Math.min(t.y,o.y),v=Math.max(t.y,o.y);if(g<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const E=[new u.pointGeometry(l,g),new u.pointGeometry(d,v),new u.pointGeometry(l,v),new u.pointGeometry(d,g)],T=this.renderWorldCopies?-3:0,S=this.renderWorldCopies?4:1;for(const R of E){const B=this.pointRayIntersection(R);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<T||$.y<0||$.x>S||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,o){const l=u.length(u.sub([],this._camera.position,t)),d=this._zoomFromMercatorZ(l)+o;return l-this._mercatorZfromZoom(d)}getCameraPoint(){if("globe"===this.projection.name){const t=function(o,l){const d=[o[0],o[1],o[2],1];u.transformMat4$1(d,d,l);const g=Math.max(d[3],1e-6);return[d[0]/g,d[1]/g,d[2]/g,g]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.pointGeometry(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,t))}}getCameraToCenterDistance(t,o=this.zoom){const l=Fi(t,o,this.width,this.height,1024),d=t.pixelSpaceConversion(this.center.lat,this.worldSize,l);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(t,t,this.globeMatrix),t}}function js(f,t){let o=!1,l=null;const d=()=>{l=null,o&&(f(),l=setTimeout(d,t),o=!1)};return()=>(o=!0,l||d(),l)}class Zc{constructor(t){this._hashName=t&&encodeURIComponent(t),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=js(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,u.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=qc(t);if(this._hashName){const l=this._hashName;let d=!1;const g=u.window.location.hash.slice(1).split("&").map(v=>{const E=v.split("=")[0];return E===l?(d=!0,`${E}=${o}`):v}).filter(v=>v);return d||g.push(`${l}=${o}`),`#${g.join("&")}`}return`#${o}`}_getCurrentHash(){const t=u.window.location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(l=>l.split("=")).forEach(l=>{l[0]===this._hashName&&(o=l)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(l=>isNaN(l))){const l=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:l,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,t)}}function qc(f,t){const o=f.getCenter(),l=Math.round(100*f.getZoom())/100,d=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,d),v=Math.round(o.lng*g)/g,E=Math.round(o.lat*g)/g,T=f.getBearing(),S=f.getPitch();let R=t?`/${v}/${E}/${l}`:`${l}/${E}/${v}`;return(T||S)&&(R+="/"+Math.round(10*T)/10),S&&(R+=`/${Math.round(S)}`),R}const zi={linearity:.3,easing:u.bezier(0,0,.3,1)},tl=u.extend({deceleration:2500,maxSpeed:1400},zi),gc=u.extend({deceleration:20,maxSpeed:1400},zi),Wc=u.extend({deceleration:1e3,maxSpeed:360},zi),Vs=u.extend({deceleration:1e3,maxSpeed:90},zi);class nl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=u.exported.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)o.zoom+=g.zoomDelta||0,o.bearing+=g.bearingDelta||0,o.pitch+=g.pitchDelta||0,g.panDelta&&o.pan._add(g.panDelta),g.around&&(o.around=g.around),g.pinchAround&&(o.pinchAround=g.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const g=ms(o.pan.mag(),l,u.extend({},tl,t||{}));d.offset=o.pan.mult(g.amount/o.pan.mag()),d.center=this._map.transform.center,rl(d,g)}if(o.zoom){const g=ms(o.zoom,l,gc);d.zoom=this._map.transform.zoom+g.amount,rl(d,g)}if(o.bearing){const g=ms(o.bearing,l,Wc);d.bearing=this._map.transform.bearing+u.clamp(g.amount,-179,179),rl(d,g)}if(o.pitch){const g=ms(o.pitch,l,Vs);d.pitch=this._map.transform.pitch+g.amount,rl(d,g)}if(d.zoom||d.bearing){const g=void 0===o.pinchAround?o.around:o.pinchAround;d.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function rl(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function ms(f,t,o){const{maxSpeed:l,linearity:d,deceleration:g}=o,v=u.clamp(f*d/(t/1e3),-l,l),E=Math.abs(v)/(g*d);return{easing:o.easing,duration:1e3*E,amount:v*(E/2)}}class No extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,l,d={}){const g=et(o.getCanvasContainer(),l),v=o.unproject(g);super(t,u.extend({point:g,lngLat:v,originalEvent:l},d)),this._defaultPrevented=!1,this.target=o}}class Xc extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,l){const d="touchend"===t?l.changedTouches:l.touches,g=Yn(o.getCanvasContainer(),d),v=g.map(T=>o.unproject(T)),E=g.reduce((T,S,R,B)=>T.add(S.div(B.length)),new u.pointGeometry(0,0));super(t,{points:g,point:E,lngLats:v,lngLat:o.unproject(E),originalEvent:l}),this._defaultPrevented=!1}}class _c extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class Fl{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _c(t.type,this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new No(t.type,this._map,t))}mouseup(t){this._map.fire(new No(t.type,this._map,t))}preclick(t){const o=u.extend({},t);o.type="preclick",this._map.fire(new No(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new No(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new No(t.type,this._map,t))}mouseover(t){this._map.fire(new No(t.type,this._map,t))}mouseout(t){this._map.fire(new No(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xc(t.type,this._map,t))}touchmove(t){this._map.fire(new Xc(t.type,this._map,t))}touchend(t){this._map.fire(new Xc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ea{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new No(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new No("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new No(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class il{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&0===t.button&&(wt(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const l=o,d=this._startPos,g=this._lastPos;if(!d||!g||g.equals(l)||!this._box&&l.dist(d)<this._clickTolerance)return;this._lastPos=l,this._box||(this._box=vt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(d.x,l.x),E=Math.max(d.x,l.x),T=Math.min(d.y,l.y),S=Math.max(d.y,l.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${T}px)`,this._box.style.width=E-v+"px",this._box.style.height=S-T+"px")})}mouseupWindow(t,o){if(!this._active)return;const l=this._startPos,d=o;if(l&&0===t.button){if(this.reset(),Lt(),l.x!==d.x||l.y!==d.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(l,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ht(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new u.Event(t,{originalEvent:o}))}}function ol(f,t){const o={};for(let l=0;l<f.length;l++)o[f[l].identifier]=t[l];return o}class gs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(d){const g=new u.pointGeometry(0,0);for(const v of d)g._add(v);return g.div(d.length)}(o),this.touches=ol(l,o)))}touchmove(t,o,l){if(this.aborted||!this.centroid)return;const d=ol(l,o);for(const g in this.touches){const v=this.touches[g],E=d[g];(!E||E.dist(v)>30)&&(this.aborted=!0)}}touchend(t,o,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===l.length){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Uo{constructor(t){this.singleTap=new gs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,l){this.singleTap.touchstart(t,o,l)}touchmove(t,o,l){this.singleTap.touchmove(t,o,l)}touchend(t,o,l){const d=this.singleTap.touchend(t,o,l);if(d){const g=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(d)<30;if(g&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Su{constructor(){this._zoomIn=new Uo({numTouches:1,numTaps:2}),this._zoomOut=new Uo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,l){this._zoomIn.touchstart(t,o,l),this._zoomOut.touchstart(t,o,l)}touchmove(t,o,l){this._zoomIn.touchmove(t,o,l),this._zoomOut.touchmove(t,o,l)}touchend(t,o,l){const d=this._zoomIn.touchend(t,o,l),g=this._zoomOut.touchend(t,o,l);return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(d)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ta={0:1,2:2};class sl{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const l=Ut(t);this._correctButton(t,l)&&(this._lastPoint=o,this._eventButton=l)}mousemoveWindow(t,o){const l=this._lastPoint;if(l)if(t.preventDefault(),null!=this._eventButton&&function(d,g){const v=ta[g];return void 0===d.buttons||(d.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(l)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(l,o)}mouseupWindow(t){this._lastPoint&&Ut(t)===this._eventButton&&(this._moved&&Lt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zl extends sl{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return 0===o&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Bl extends sl{_correctButton(t,o){return 0===o&&t.ctrlKey||2===o}_move(t,o){const l=.8*(o.x-t.x);if(l)return this._active=!0,{bearingDelta:l}}contextmenu(t){t.preventDefault()}}class na extends sl{_correctButton(t,o){return 0===o&&t.ctrlKey||2===o}_move(t,o){const l=-.5*(o.y-t.y);if(l)return this._active=!0,{pitchDelta:l}}contextmenu(t){t.preventDefault()}}class Yc{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(t,o,l){return this._calculateTransform(t,o,l)}touchmove(t,o,l){if(this._active&&!(l.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===l.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,l)}}touchend(t,o,l){this._calculateTransform(t,o,l),this._active&&l.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,l){l.length>0&&(this._active=!0);const d=ol(l,o),g=new u.pointGeometry(0,0),v=new u.pointGeometry(0,0);let E=0;for(const S in d){const R=d[S],B=this._touches[S];B&&(g._add(R),v._add(R.sub(B)),E++,d[S]=R)}if(this._touches=d,E<this._minTouches||!v.mag())return;const T=v.div(E);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(E),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=vt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class yc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,l){return{}}touchstart(t,o,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,l){const d=this._firstTwoTouches;if(!d)return;t.preventDefault();const[g,v]=d,E=so(l,o,g),T=so(l,o,v);if(!E||!T)return;const S=this._aroundCenter?null:E.add(T).div(2);return this._move([E,T],S,t)}touchend(t,o,l){if(!this._firstTwoTouches)return;const[d,g]=this._firstTwoTouches,v=so(l,o,d),E=so(l,o,g);v&&E||(this._active&&Lt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function so(f,t,o){for(let l=0;l<f.length;l++)if(f[l].identifier===o)return t[l]}function Kc(f,t){return Math.log(f/t)/Math.LN2}class al extends yc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,l),pinchAround:o}}}function ci(f,t){return 180*f.angleWith(t)/Math.PI}class wi extends yc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const l=this._vector;if(this._vector=t[0].sub(t[1]),l&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ci(this._vector,l),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,l=this._startVector;if(!l)return!1;const d=ci(t,l);return Math.abs(d)<o}}function Da(f){return Math.abs(f.y)>Math.abs(f.x)}class Ta extends yc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Da(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,l){const d=this._lastPoints;if(!d)return;const g=t[0].sub(d[0]),v=t[1].sub(d[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&l.touches.length<3||(this._valid=this.gestureBeginsVertically(g,v,l.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5})}gestureBeginsVertically(t,o,l){if(void 0!==this._valid)return this._valid;const d=t.mag()>=2,g=o.mag()>=2;if(!d&&!g)return;if(!d||!g)return null==this._firstMove&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==o.y>0;return Da(t)&&Da(o)&&v}}const Mu={panStep:100,bearingStep:15,pitchStep:10};class Au{constructor(){const t=Mu;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,l=0,d=0,g=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,d=0),{cameraAnimation:E=>{const T=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Qo,zoom:o?Math.round(T)+o*(t.shiftKey?2:1):T,bearing:E.getBearing()+l*this._bearingStep,pitch:E.getPitch()+d*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qo(f){return f*(2-f)}const Jc=4.000244140625;class ll{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=u.exported.now(),d=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,0!==o&&o%Jc==0?this._type="wheel":0!==o&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=et(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const T="wheel"===this._type&&Math.abs(this._delta)>Jc?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&0!==S&&(S=1/S);const R=o(),B=Math.pow(2,R),$="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom($*S))),"wheel"===this._type&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const l="number"==typeof this._targetZoom?this._targetZoom:o(),d=this._startZoom,g=this._easing;let v,E=!1;if("wheel"===this._type&&d&&g){const T=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),S=g(T);v=u.number(d,l,S),T<1?this._frameId||(this._frameId=!0):E=!0}else v=l,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-o(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=u.ease;if(this._prevEase){const l=this._prevEase,d=(u.exported.now()-l.start)/l.duration,g=l.easing(d+.01)-l.easing(d),v=.27/Math.sqrt(g*g+1e-4)*.01,E=Math.sqrt(.0729-v*v);o=u.bezier(v,E,.25,1)}return this._prevEase={start:u.exported.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=vt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class _s{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $s{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:l.getZoom()+(t.shiftKey?-1:1),around:l.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this._tap=new Uo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,l){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?l.length>0&&(this._swipePoint=o[0],this._swipeTouch=l[0].identifier):this._tap.touchstart(t,o,l))}touchmove(t,o,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const d=o[0],g=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,o,l)}touchend(t,o,l){this._tapTime?this._swipePoint&&0===l.length&&this.reset():this._tap.touchend(t,o,l)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ca{constructor(t,o,l){this._el=t,this._mousePan=o,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pu{constructor(t,o,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ia{constructor(t,o,l,d){this._el=t,this._touchZoom=o,this._touchRotate=l,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ei=f=>f.zoom||f.drag||f.pitch||f.rotate;class vc extends u.Event{}class Ru{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const l=u.sub([],o,t);this.radius=u.length(l[2]<0?u.div([],l,this.constants):[l[0],l[1],0])}projectRay(t){u.div(t,t,this.constants),u.normalize(t,t),u.mul$1(t,t,this.constants);const o=u.scale$2([],t,this.radius);if(o[2]>0){const l=u.scale$2([],[0,0,1],u.dot(o,[0,0,1])),d=u.scale$2([],u.normalize([],[o[0],o[1],0]),this.radius),g=u.add([],o,u.scale$2([],u.sub([],u.add([],d,l),o),2));o[0]=g[0],o[1]=g[1]}return o}}function cl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class sh{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nl(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ru,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),u.bindAll(["handleEvent","handleWindowEvent"],this);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[d,g,v]of this._listeners)d.addEventListener(g,d===u.window.document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,o,l]of this._listeners)t.removeEventListener(o,t===u.window.document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const o=this._map,l=o.getCanvasContainer();this._add("mapEvent",new Fl(o,t));const d=o.boxZoom=new il(o,t);this._add("boxZoom",d);const g=new Su,v=new $s;o.doubleClickZoom=new _s(v,g),this._add("tapZoom",g),this._add("clickZoom",v);const E=new St;this._add("tapDragZoom",E);const T=o.touchPitch=new Ta(o);this._add("touchPitch",T);const S=new Bl(t),R=new na(t);o.dragRotate=new Pu(t,S,R),this._add("mouseRotate",S,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const B=new zl(t),$=new Yc(o,t);o.dragPan=new Ca(l,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const K=new wi,X=new al;o.touchZoomRotate=new Ia(l,X,K,E),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ea(o));const ne=o.scrollZoom=new ll(o,this);this._add("scrollZoom",ne,["mousePan"]);const J=o.keyboard=new Au;this._add("keyboard",J);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[W]&&o[W].enable(t[W])}_add(t,o,l){this._handlers.push({handlerName:t,handler:o,allowed:l}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ei(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,o,l){for(const d in t)if(d!==l&&(!o||o.indexOf(d)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const l of t)this._el.contains(l.target)&&o.push(l);return o}handleEvent(t,o){this._updatingCamera=!0;const l="renderFrame"===t.type,d=l?void 0:t,g={needsRenderFrame:!1},v={},E={},T=t.touches?this._getMapTouches(t.touches):void 0,S=T?Yn(this._el,T):l?void 0:et(this._el,t);for(const{handlerName:$,handler:K,allowed:X}of this._handlers){if(!K.isEnabled())continue;let ne;this._blockedByActive(E,X,$)?K.reset():K[o||t.type]&&(ne=K[o||t.type](t,S,T),this.mergeHandlerResult(g,v,ne,$,d),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||K.isActive())&&(E[$]=K)}const R={};for(const $ in this._previousActiveHandlers)E[$]||(R[$]=d);this._previousActiveHandlers=E,(Object.keys(R).length||cl(g))&&(this._changes.push([g,v,R]),this._triggerRenderFrame()),(Object.keys(E).length||cl(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=g;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(t,o,l,d,g){if(!l)return;u.extend(t,l);const v={handlerName:d,originalEvent:l.originalEvent||g};void 0!==l.zoomDelta&&(o.zoom=v),void 0!==l.panDelta&&(o.drag=v),void 0!==l.pitchDelta&&(o.pitch=v),void 0!==l.bearingDelta&&(o.rotate=v)}_applyChanges(){const t={},o={},l={};for(const[d,g,v]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new u.pointGeometry(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),void 0!==d.around&&(t.around=d.around),void 0!==d.aroundCoord&&(t.aroundCoord=d.aroundCoord),void 0!==d.pinchAround&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),u.extend(o,g),u.extend(l,v);this._updateMapTransform(t,o,l),this._changes=[]}_updateMapTransform(t,o,l){const d=this._map,g=d.transform,v=se=>[se.x,se.y,se.z];if((se=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!cl(t)){const se=g.zoom;g.cameraElevationReference="sea",g.recenterOnTerrain(),g.cameraElevationReference="ground",se!==g.zoom&&this._map._update(!0)}if(!cl(t))return void this._fireEvents(o,l,!0);let{panDelta:E,zoomDelta:T,bearingDelta:S,pitchDelta:R,around:B,aroundCoord:$,pinchAround:K}=t;void 0!==K&&(B=K),(se=>o.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=v(g.pointCoordinate3D(B)),this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",d._stop(!0),B=B||d.transform.centerPoint,S&&(g.bearing+=S),R&&(g.pitch+=R),g._updateCameraState();const X=[0,0,0];if(E)if("mercator"===g.projection.name){const se=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(B).dir),re=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(B.sub(E)).dir);X[0]=re[0]-se[0],X[1]=re[1]-se[1]}else{const se=g.pointCoordinate(B);if("globe"===g.projection.name){E=E.rotate(-g.angle);const re=g._pixelsPerMercatorPixel/g.worldSize;X[0]=-E.x*u.mercatorScale(u.latFromMercatorY(se.y))*re,X[1]=-E.y*u.mercatorScale(g.center.lat)*re}else{const re=g.pointCoordinate(B.sub(E));se&&re&&(X[0]=re.x-se.x,X[1]=re.y-se.y)}}const ne=g.zoom,J=[0,0,0];if(T){const se=v($||g.pointCoordinate3D(B)),re={dir:u.normalize([],u.sub([],se,g._camera.position))};if(re.dir[2]<0){const pe=g.zoomDeltaToMovement(se,T);u.scale$2(J,re.dir,pe)}}const W=u.add(X,X,J);g._translateCameraConstrained(W),T&&Math.abs(g.zoom-ne)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,l,!0)}_fireEvents(t,o,l){const d=Ei(this._eventsInProgress),g=Ei(t),v={};for(const R in t){const{originalEvent:B}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=B),this._eventsInProgress[R]=t[R]}!d&&g&&this._fireEvent("movestart",g.originalEvent);for(const R in v)this._fireEvent(R,v[R]);g&&this._fireEvent("move",g.originalEvent);for(const R in t){const{originalEvent:B}=t[R];this._fireEvent(R,B)}const E={};let T;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],T=o[B]||$,E[`${R}end`]=T)}for(const R in E)this._fireEvent(R,E[R]);const S=Ei(this._eventsInProgress);if(l&&(d||g)&&!S){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;R?(B(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:T})):(this._map.fire(new u.Event("moveend",{originalEvent:T})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new u.Event(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new vc("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Nl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ul extends u.Evented{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,l){return t=u.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},o),l)}panTo(t,o,l){return this.easeTo(u.extend({center:t},o),l)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,l){return this.easeTo(u.extend({zoom:t},o),l)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,l){return this.easeTo(u.extend({bearing:t},o),l)}resetNorth(t,o){return this.rotateTo(0,u.extend({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=u.LngLatBounds.convert(t);const l=o&&o.bearing||0,d=t.getNorthWest(),g=t.getSouthEast();return this._cameraForBounds(this.transform,d,g,l,o)}_extendCameraOptions(t){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=u.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){const l=t.padding;t.padding={top:l,bottom:l,right:l,left:l}}return t.padding=u.extend(o,t.padding),t}_minimumAABBFrustumDistance(t,o){const l=o.max[0]-o.min[0],d=o.max[1]-o.min[1];return l/d>t.aspect?l/(2*Math.tan(.5*t.fovX)*t.aspect):d/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,l,d,g){const v=t.clone(),E=this._extendCameraOptions(g);v.bearing=d;const T=u.LngLat.convert(o),S=u.LngLat.convert(l),R=.5*(T.lat+S.lat),B=.5*(T.lng+S.lng),$=u.latLngToECEF(R,B),K=u.normalize([],$),X=u.normalize([],u.cross([],K,[0,1,0])),ne=u.cross([],X,K),J=[X[0],X[1],X[2],0,ne[0],ne[1],ne[2],0,K[0],K[1],K[2],0,0,0,0,1],W=[$,u.latLngToECEF(T.lat,T.lng),u.latLngToECEF(S.lat,T.lng),u.latLngToECEF(S.lat,S.lng),u.latLngToECEF(T.lat,S.lng),u.latLngToECEF(R,T.lng),u.latLngToECEF(R,S.lng),u.latLngToECEF(T.lat,B),u.latLngToECEF(S.lat,B)];let se=u.Aabb.fromPoints(W.map(ft=>[u.dot(X,ft),u.dot(ne,ft),u.dot(K,ft)]));const re=u.transformMat4([],se.center,J);0===u.squaredLength(re)&&u.set(re,0,0,1),u.normalize(re,re),u.scale$2(re,re,u.GLOBE_RADIUS),v.center=u.ecefToLatLng(re);const pe=v.getWorldToCameraMatrix(),ge=u.invert(new Float64Array(16),pe);se=u.Aabb.applyTransform(se,u.multiply([],pe,J)),u.transformMat4(re,re,pe);const ue=.5*(se.max[2]-se.min[2]),xe=this._minimumAABBFrustumDistance(v,se),Le=u.scale$2([],[0,0,1],ue),Ue=u.add(Le,re,Le),Oe=xe+(0===v.pitch?0:u.distance(re,Ue)),ct=v.globeCenterInViewSpace,Se=u.sub([],re,[ct[0],ct[1],ct[2]]);u.normalize(Se,Se),u.scale$2(Se,Se,Oe);const Xe=u.add([],re,Se);u.transformMat4(Xe,Xe,ge);const Ke=u.earthRadius/u.GLOBE_RADIUS,ke=u.length(Xe),Ce=u.mercatorZfromAltitude(ke*Ke-u.earthRadius,0),Ct=Math.min(v.zoomFromMercatorZAdjusted(Ce),E.maxZoom);return Ct>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"mercator"}),v.zoom=Ct,this._cameraForBounds(v,o,l,d,g)):{center:v.center,zoom:Ct,bearing:d}}queryTerrainElevation(t,o){const l=this.transform.elevation;return l?(o=u.extend({},{exaggerated:!0},o),l.getAtPoint(u.MercatorCoordinate.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,l,d,g){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,o,l,d,g);const v=t.clone(),E=this._extendCameraOptions(g),T=v.padding;v.bearing=d;const S=u.LngLat.convert(o),R=u.LngLat.convert(l),B=new u.LngLat(S.lng,R.lat),$=new u.LngLat(R.lng,S.lat),K=v.project(S),X=v.project(R),ne=this.queryTerrainElevation(S),J=this.queryTerrainElevation(R),W=this.queryTerrainElevation(B),se=this.queryTerrainElevation($),re=[[K.x,K.y,Math.min(ne||0,J||0,W||0,se||0)],[X.x,X.y,Math.max(ne||0,J||0,W||0,se||0)]];let pe=u.Aabb.fromPoints(re);const ge=v.getWorldToCameraMatrix(),ue=u.invert(new Float64Array(16),ge);pe=u.Aabb.applyTransform(pe,ge);const xe=u.sub([],pe.max,pe.min),Le=T.left||0,Ue=T.right||0,Oe=T.bottom||0,ct=T.top||0,{left:Se,right:Xe,top:Ke,bottom:ke}=E.padding,Ce=.5*(Le+Ue),Ct=.5*(ct+Oe),ft=Math.min(v.scaleZoom(v.scale*Math.min((v.width-(Le+Ue+Se+Xe))/xe[0],(v.height-(Oe+ct+ke+Ke))/xe[1])),E.maxZoom),xt=v.scale/v.zoomScale(ft);pe=new u.Aabb([pe.min[0]-(Se+Ce)*xt,pe.min[1]-(ke+Ct)*xt,pe.min[2]],[pe.max[0]+(Xe+Ce)*xt,pe.max[1]+(Ke+Ct)*xt,pe.max[2]]);const _t=.5*xe[2],Vt=this._minimumAABBFrustumDistance(v,pe),ln=[0,0,1,0];u.transformMat4$1(ln,ln,ge),u.normalize$2(ln,ln);const Qt=u.scale$2([],ln,Vt+_t),$t=u.add([],pe.center,Qt),yt=("number"==typeof E.offset.x&&"number"==typeof E.offset.y?new u.pointGeometry(E.offset.x,E.offset.y):u.pointGeometry.convert(E.offset)).rotate(-u.degToRad(d));pe.center[0]-=yt.x*xt,pe.center[1]+=yt.y*xt,u.transformMat4(pe.center,pe.center,ue),u.transformMat4($t,$t,ue);const vn=[pe.center[0],pe.center[1],$t[2]*v.pixelsPerMeter];u.scale$2(vn,vn,1/v.worldSize);const Mn=u.lngFromMercatorX(vn[0]),gr=u.latFromMercatorY(vn[1]),yr=Math.min(v._zoomFromMercatorZ(vn[2]),E.maxZoom),dr=new u.LngLat(Mn,gr);return v.mercatorFromTransition&&yr<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"globe"}),v.zoom=yr,this._cameraForBounds(v,o,l,d,g)):{center:dr,zoom:yr,bearing:d}}fitBounds(t,o,l){const d=this.cameraForBounds(t,o);return this._fitInternal(d,o,l)}fitScreenCoordinates(t,o,l,d,g){const v=u.pointGeometry.convert(t),E=u.pointGeometry.convert(o),T=new u.pointGeometry(Math.min(v.x,E.x),Math.min(v.y,E.y)),S=new u.pointGeometry(Math.max(v.x,E.x),Math.max(v.y,E.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(v,E))return this;const R=this.transform.pointLocation3D(T),B=this.transform.pointLocation3D(S),$=this.transform.pointLocation3D(new u.pointGeometry(T.x,S.y)),K=this.transform.pointLocation3D(new u.pointGeometry(S.x,T.y)),X=[Math.min(R.lng,B.lng,$.lng,K.lng),Math.min(R.lat,B.lat,$.lat,K.lat)],ne=[Math.max(R.lng,B.lng,$.lng,K.lng),Math.max(R.lat,B.lat,$.lat,K.lat)],J=this._cameraForBounds(this.transform,X,ne,l,d);return this._fitInternal(J,d,g)}_fitInternal(t,o,l){return t?(delete(o=u.extend(t,o)).padding,o.linear?this.easeTo(o,l):this.flyTo(o,l)):this}jumpTo(t,o){this.stop();const l=t.preloadOnly?this.transform.clone():this.transform;let d=!1,g=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(d=!0,l.zoom=+t.zoom),void 0!==t.center&&(l.center=u.LngLat.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(g=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),null==t.padding||l.isPaddingEqual(t.padding)||(l.padding=t.padding),t.preloadOnly?(this._preloadTiles(l),this):(this.fire(new u.Event("movestart",o)).fire(new u.Event("move",o)),d&&this.fire(new u.Event("zoomstart",o)).fire(new u.Event("zoom",o)).fire(new u.Event("zoomend",o)),g&&this.fire(new u.Event("rotatestart",o)).fire(new u.Event("rotate",o)).fire(new u.Event("rotateend",o)),v&&this.fire(new u.Event("pitchstart",o)).fire(new u.Event("pitch",o)).fire(new u.Event("pitchend",o)),this.fire(new u.Event("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(Nl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const l=this.transform;if(!l.projection.supportsFreeCamera)return u.warnOnce(Nl),this;this.stop();const d=l.zoom,g=l.pitch,v=l.bearing;l.setFreeCameraOptions(t);const E=d!==l.zoom,T=g!==l.pitch,S=v!==l.bearing;return this.fire(new u.Event("movestart",o)).fire(new u.Event("move",o)),E&&this.fire(new u.Event("zoomstart",o)).fire(new u.Event("zoom",o)).fire(new u.Event("zoomend",o)),S&&this.fire(new u.Event("rotatestart",o)).fire(new u.Event("rotate",o)).fire(new u.Event("rotateend",o)),T&&this.fire(new u.Event("pitchstart",o)).fire(new u.Event("pitch",o)).fire(new u.Event("pitchend",o)),this.fire(new u.Event("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),(!1===(t=u.extend({offset:[0,0],duration:500,easing:u.ease},t)).animate||!t.essential&&u.exported.prefersReducedMotion)&&(t.duration=0);const l=this.transform,d=this.getZoom(),g=this.getBearing(),v=this.getPitch(),E=this.getPadding(),T="zoom"in t?+t.zoom:d,S="bearing"in t?this._normalizeBearing(t.bearing,g):g,R="pitch"in t?+t.pitch:v,B="padding"in t?t.padding:l.padding,$=u.pointGeometry.convert(t.offset);let K,X,ne;if("globe"===l.projection.name){const Ue=u.MercatorCoordinate.fromLngLat(l.center),Oe=$.rotate(-l.angle);Ue.x+=Oe.x/l.worldSize,Ue.y+=Oe.y/l.worldSize;const ct=Ue.toLngLat(),Se=u.LngLat.convert(t.center||ct);this._normalizeCenter(Se),K=l.centerPoint.add(Oe),X=new u.pointGeometry(Ue.x,Ue.y).mult(l.worldSize),ne=new u.pointGeometry(u.mercatorXfromLng(Se.lng),u.mercatorYfromLat(Se.lat)).mult(l.worldSize).sub(X)}else{K=l.centerPoint.add($);const Ue=l.pointLocation(K),Oe=u.LngLat.convert(t.center||Ue);this._normalizeCenter(Oe),X=l.project(Ue),ne=l.project(Oe).sub(X)}const J=l.zoomScale(T-d);let W,se;t.around&&(W=u.LngLat.convert(t.around),se=l.locationPoint(W));const re=this._zooming||T!==d,pe=this._rotating||g!==S,ge=this._pitching||R!==v,ue=!l.isPaddingEqual(B),xe=Ue=>Oe=>{if(re&&(Ue.zoom=u.number(d,T,Oe)),pe&&(Ue.bearing=u.number(g,S,Oe)),ge&&(Ue.pitch=u.number(v,R,Oe)),ue&&(Ue.interpolatePadding(E,B,Oe),K=Ue.centerPoint.add($)),W)Ue.setLocationAtPoint(W,se);else{const ct=Ue.zoomScale(Ue.zoom-d),Se=T>d?Math.min(2,J):Math.max(.5,J),Xe=Math.pow(Se,1-Oe),Ke=Ue.unproject(X.add(ne.mult(Oe*Xe)).mult(ct));Ue.setLocationAtPoint(Ue.renderWorldCopies?Ke.wrap():Ke,K)}return t.preloadOnly||this._fireMoveEvents(o),Ue};if(t.preloadOnly){const Ue=this._emulate(xe,t.duration,l);return this._preloadTiles(Ue),this}const Le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=pe,this._pitching=ge,this._padding=ue,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,Le),this._ease(xe(l),Ue=>{l.recenterOnTerrain(),this._afterEase(o,Ue)},t),this}_prepareEase(t,o,l={}){this._moving=!0,this.transform.cameraElevationReference="sea",o||l.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!l.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new u.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const l=this._zooming,d=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new u.Event("zoomend",t)),d&&this.fire(new u.Event("rotateend",t)),g&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,o){if(!t.essential&&u.exported.prefersReducedMotion){const xt=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xt,o)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);const l=this.transform,d=this.getZoom(),g=this.getBearing(),v=this.getPitch(),E=this.getPadding(),T="zoom"in t?u.clamp(+t.zoom,l.minZoom,l.maxZoom):d,S="bearing"in t?this._normalizeBearing(t.bearing,g):g,R="pitch"in t?+t.pitch:v,B="padding"in t?t.padding:l.padding,$=l.zoomScale(T-d),K=u.pointGeometry.convert(t.offset);let X=l.centerPoint.add(K);const ne=l.pointLocation(X),J=u.LngLat.convert(t.center||ne);this._normalizeCenter(J);const W=l.project(ne),se=l.project(J).sub(W);let re=t.curve;const pe=Math.max(l.width,l.height),ge=pe/$,ue=se.mag();if("minZoom"in t){const xt=u.clamp(Math.min(t.minZoom,d,T),l.minZoom,l.maxZoom),_t=pe/l.zoomScale(xt-d);re=Math.sqrt(_t/ue*2)}const xe=re*re;function Le(xt){const _t=(ge*ge-pe*pe+(xt?-1:1)*xe*xe*ue*ue)/(2*(xt?ge:pe)*xe*ue);return Math.log(Math.sqrt(_t*_t+1)-_t)}function Ue(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function Oe(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const ct=Le(0);let Se=function(xt){return Oe(ct)/Oe(ct+re*xt)},Xe=function(xt){return pe*((Oe(ct)*(Ue(_t=ct+re*xt)/Oe(_t))-Ue(ct))/xe)/ue;var _t},Ke=(Le(1)-ct)/re;if(Math.abs(ue)<1e-6||!isFinite(Ke)){if(Math.abs(pe-ge)<1e-6)return this.easeTo(t,o);const xt=ge<pe?-1:1;Ke=Math.abs(Math.log(ge/pe))/re,Xe=function(){return 0},Se=function(_t){return Math.exp(xt*re*_t)}}t.duration="duration"in t?+t.duration:1e3*Ke/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ke=g!==S,Ce=R!==v,Ct=!l.isPaddingEqual(B),ft=xt=>_t=>{const Vt=_t*Ke,ln=1/Se(Vt);xt.zoom=1===_t?T:d+xt.scaleZoom(ln),ke&&(xt.bearing=u.number(g,S,_t)),Ce&&(xt.pitch=u.number(v,R,_t)),Ct&&(xt.interpolatePadding(E,B,_t),X=xt.centerPoint.add(K));const Qt=1===_t?J:xt.unproject(W.add(se.mult(Xe(Vt))).mult(ln));return xt.setLocationAtPoint(xt.renderWorldCopies?Qt.wrap():Qt,X),xt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),xt};if(t.preloadOnly){const xt=this._emulate(ft,t.duration,l);return this._preloadTiles(xt),this}return this._zooming=!0,this._rotating=ke,this._pitching=Ce,this._padding=Ct,this._prepareEase(o,!1),this._ease(ft(l),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const l=this._onEaseEnd;this._onEaseEnd=void 0,l.call(this,o)}if(!t){const l=this.handlers;l&&l.stop(!1)}return this}_ease(t,o,l){!1===l.animate||0===l.duration?(t(1),o()):(this._easeStart=u.exported.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=u.wrap(t,-180,180);const l=Math.abs(t-o);return Math.abs(t-360-o)<l&&(t-=360),Math.abs(t+360-o)<l&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(!o.renderWorldCopies||o.maxBounds)return;const l=t.lng-o.center.lng;t.lng+=l>180?-360:l<-180?360:0}_emulate(t,o,l){const d=Math.ceil(15*o/1e3),g=[],v=t(l.clone());for(let E=0;E<=d;E++){const T=v(E/d);g.push(T.clone())}return g}}class ys{constructor(t={}){this.options=t,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact;return this._map=t,this._container=vt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=vt("button","mapboxgl-ctrl-attrib-button",this._container),vt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=vt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===o&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,o){const l=this._map._getUIString(`AttributionControl.${o}`);t.setAttribute("aria-label",l),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",l)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(t){const l=o.reduce((d,g,v)=>(g.value&&(d+=`${g.key}=${g.value}${v<o.length-1?"&":""}`),d),"?");t.href=`${u.config.FEEDBACK_URL}/${l}#${qc(this._map,!0)}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style._sourceCaches;for(const d in o){const g=o[d];if(g.used){const v=g.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((d,g)=>d.length-g.length),t=t.filter((d,g)=>{for(let v=g+1;v<t.length;v++)if(t[v].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class vs{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=vt("div","mapboxgl-ctrl");const o=vt("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const o in t){const l=t[o].getSource();if(l.hasOwnProperty("mapbox_logo")&&!l.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Gs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,l=o?this._queue.concat(o):this._queue;for(const d of l)if(d.id===t)return void(d.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const l of o)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ul(f,t,o){if(f=new u.LngLat(f.lng,f.lat),t){const l=new u.LngLat(f.lng-360,f.lat),d=new u.LngLat(f.lng+360,f.lat),g=360*Math.ceil(Math.abs(f.lng-o.center.lng)/360),v=o.locationPoint(f).distSqr(t),E=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint(l).distSqr(t)<v&&(E||Math.abs(l.lng-o.center.lng)<g)?f=l:o.locationPoint(d).distSqr(t)<v&&(E||Math.abs(d.lng-o.center.lng)<g)&&(f=d)}for(;Math.abs(f.lng-o.center.lng)>180;){const l=o.locationPoint(f);if(l.x>=0&&l.y>=0&&l.x<=o.width&&l.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}const Sa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Hs extends u.Evented{constructor(t,o){if(super(),(t instanceof u.window.HTMLElement||o)&&(t=u.extend({element:t},o)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=u.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=vt("div");const d=41,g=27,v=mt("svg",{display:"block",height:d*this._scale+"px",width:g*this._scale+"px",viewBox:`0 0 ${g} ${d}`},this._element),E=mt("radialGradient",{id:"shadowGradient"},mt("defs",{},v));mt("stop",{offset:"10%","stop-opacity":.4},E),mt("stop",{offset:"100%","stop-opacity":.05},E),mt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},v),mt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},v),mt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},v),mt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},v),this._offset=u.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const l=this._element.classList;for(const d in Sa)l.remove(`mapboxgl-marker-anchor-${d}`);l.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,l=t.charCode||t.keyCode;"Space"!==o&&"Enter"!==o&&32!==l&&13!==l||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,l=this._element;this._popup&&(o===l||l.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const l=t.unproject(o),d=t.getFreeCameraOptions();if(!d.position)return!1;const g=d.position.toLngLat();return g.distanceTo(l)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const l=t.unproject(o);let d;t._showingGlobe()&&u.isLngLatBehindGlobe(t.transform,this._lngLat)?d=0:(d=1-t._queryFogOpacity(l),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${t.x}px,${t.y}px)\n            ${Sa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${o.x}px,${o.y}px)\n        `}_calculateXYTransform(){const t=this._pos,o=this._map,l=this.getPitchAlignment();if(!o||!t||"map"!==l)return"";if(!o._showingGlobe()){const T=o.getPitch();return T?`rotateX(${T}deg)`:""}const d=u.radToDeg(u.globeTiltAtLngLat(o.transform,this._lngLat)),g=t.sub(u.globeCenterToScreenPoint(o.transform)),v=Math.abs(g.x)+Math.abs(g.y);if(0===v)return"";const E=d/v;return`rotateX(${-g.y*E}deg) rotateY(${g.x*E}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let l=0;const d=this.getRotationAlignment();if("map"===d)if(o._showingGlobe()){const g=o.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),v=o.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(g);l=u.radToDeg(Math.atan2(v.y,v.x))-90}else l=-o.getBearing();else if("horizon"===d){const g=u.smoothstep(4,6,o.getZoom()),v=u.globeCenterToScreenPoint(o.transform);v.y+=g*o.transform.height;const E=t.sub(v),T=u.radToDeg(Math.atan2(E.y,E.x));l=(T>90?T-270:T+90)*(1-g)}return l+=this._rotation,l?`rotateZ(${l}deg)`:""}_update(t){u.window.cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=ul(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat),!0===t?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=u.pointGeometry.convert(t),this._update(),this}_onMove(t){const o=this._map;if(!o)return;const l=this._pointerdownPos,d=this._positionDelta;if(l&&d){if(!this._isDragging){const g=this._clickTolerance||o._clickTolerance;if(t.point.dist(l)<g)return;this._isDragging=!0}this._pos=t.point.sub(d),this._lngLat=o.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,l=this._pos;o&&l&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(l),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const dd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _r(f=new u.pointGeometry(0,0),t="bottom"){if("number"==typeof f){const o=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new u.pointGeometry(0,f);case"top-left":return new u.pointGeometry(o,o);case"top-right":return new u.pointGeometry(-o,o);case"bottom":return new u.pointGeometry(0,-f);case"bottom-left":return new u.pointGeometry(o,-o);case"bottom-right":return new u.pointGeometry(-o,-o);case"left":return new u.pointGeometry(f,0);case"right":return new u.pointGeometry(-f,0)}return new u.pointGeometry(0,0)}return f instanceof u.pointGeometry||Array.isArray(f)?u.pointGeometry.convert(f):u.pointGeometry.convert(f[t]||[0,0])}class ku{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=u.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,l){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+l}}const ah={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Lu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Qc(f){f.parentNode&&f.parentNode.removeChild(f)}const lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class ch{constructor(t,o,l=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Bl({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,l&&(this.mousePitch=new na({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),wt()}move(t,o){const l=this.map,d=this.mouseRotate.mousemoveWindow(t,o),g=d&&d.bearingDelta;if(g&&l.setBearing(l.getBearing()+g),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,o),E=v&&v.pitchDelta;E&&l.setPitch(l.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ht(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(u.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),et(this.element,t)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,et(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=Yn(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=Yn(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const uh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ma={maxWidth:100,unit:"metric"};function hh(f,t,o){const l=xc(t),d=l/t,g={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[o];this._map._requestDomTask(()=>{this._container.style.width=f*d+"px",this._container.innerHTML=`${l}&nbsp;${g}`})}function xc(f){const t=Math.pow(10,`${Math.floor(f)}`.length-1);let o=f/t;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(l){const d=Math.pow(10,Math.ceil(-Math.log(l)/Math.LN10));return Math.round(l*d)/d}(o),t*o}const Wr={version:u.version,supported:Gt,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Ul{constructor(f){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(f=u.extend({},Lu,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(f.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ni(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new Gs,this._domRenderTaskQueue=new Gs,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},ah,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ku(0),this._interactionRange=[1/0,-1/0],this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=u.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new sh(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Zc("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,u.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new ys({customAttribution:f.customAttribution})),this._logoControl=new vs,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new u.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new u.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(f,t){if(void 0===t&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[t];return-1!==t.indexOf("bottom")?l.insertBefore(o,l.firstChild):l.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new u.Event("movestart",f)).fire(new u.Event("move",f)),this.fire(new u.Event("resize",f)),t&&this.fire(new u.Event("moveend",f)),this}getBounds(){return"globe"===this.transform.projection.name&&u.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(u.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?u.window.navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(t=>"auto"===t?u.window.navigator.language:t):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style._reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,t=f.projection.name;let o;"globe"===t&&f.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),o=!0):"mercator"===t&&f.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;if(t="globe"===f.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),t){this.painter.clearBackgroundTiles();for(const o in this.style._sourceCaches)this.style._sourceCaches[o].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(u.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(u.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(f,t,o){if("mouseenter"===f||"mouseover"===f){let l=!1;const d=v=>{const E=t.filter(S=>this.getLayer(S)),T=E.length?this.queryRenderedFeatures(v.point,{layers:E}):[];T.length?l||(l=!0,o.call(this,new No(f,this,v.originalEvent,{features:T}))):l=!1},g=()=>{l=!1};return{layers:new Set(t),listener:o,delegates:{mousemove:d,mouseout:g}}}if("mouseleave"===f||"mouseout"===f){let l=!1;const d=v=>{const E=t.filter(T=>this.getLayer(T));(E.length?this.queryRenderedFeatures(v.point,{layers:E}):[]).length?l=!0:l&&(l=!1,o.call(this,new No(f,this,v.originalEvent)))},g=v=>{l&&(l=!1,o.call(this,new No(f,this,v.originalEvent)))};return{layers:new Set(t),listener:o,delegates:{mousemove:d,mouseout:g}}}{const l=d=>{const g=t.filter(E=>this.getLayer(E)),v=g.length?this.queryRenderedFeatures(d.point,{layers:g}):[];v.length&&(d.features=v,o.call(this,d),delete d.features)};return{layers:new Set(t),listener:o,delegates:{[f]:l}}}}on(f,t,o){if(void 0===o)return super.on(f,t);Array.isArray(t)||(t=[t]);const l=this._createDelegatedListener(f,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(l);for(const d in l.delegates)this.on(d,l.delegates[d]);return this}once(f,t,o){if(void 0===o)return super.once(f,t);Array.isArray(t)||(t=[t]);const l=this._createDelegatedListener(f,t,o);for(const d in l.delegates)this.once(d,l.delegates[d]);return this}off(f,t,o){if(void 0===o)return super.off(f,t);t=new Set(Array.isArray(t)?t:[t]);const l=(g,v)=>{if(g.size!==v.size)return!1;for(const E of g)if(!v.has(E))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[f]:void 0;return d&&(g=>{for(let v=0;v<g.length;v++){const E=g[v];if(E.listener===o&&l(E.layers,t)){for(const T in E.delegates)this.off(T,E.delegates[T]);return g.splice(v,1),this}}})(d),this}queryRenderedFeatures(f,t){return this.style?(void 0!==t||void 0===f||f instanceof u.pointGeometry||Array.isArray(f)||(t=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return!1!==(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(null==t)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new Wo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Wo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if("string"==typeof f){const o=this._requestManager.normalizeStyleURL(f),l=this._requestManager.transformRequest(o,u.ResourceType.Style);u.getJSON(l,(d,g)=>{d?this.fire(new u.ErrorEvent(d)):g&&this._updateDiff(g,t)})}else"object"==typeof f&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f)&&this._update(!0)}catch(o){u.warnOnce(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const t in f){const o=f[t]._tiles;for(const l in o){const d=o[l];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0}addSourceType(f,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,o)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,{pixelRatio:o=1,sdf:l=!1,stretchX:d,stretchY:g,content:v}={}){if(this._lazyInitEmptyStyle(),t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap){const{width:E,height:T,data:S}=u.exported.getImageData(t);this.style.addImage(f,{data:new u.RGBAImage({width:E,height:T},S),pixelRatio:o,stretchX:d,stretchY:g,content:v,sdf:l,version:0})}else if(void 0===t.width||void 0===t.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:T}=t,S=t;this.style.addImage(f,{data:new u.RGBAImage({width:E,height:T},new Uint8Array(S.data)),pixelRatio:o,stretchX:d,stretchY:g,content:v,sdf:l,version:0,userImage:S}),S.onAdd&&S.onAdd(this,f)}}updateImage(f,t){const o=this.style.getImage(f);if(!o)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap?u.exported.getImageData(t):t,{width:d,height:g}=l;void 0!==d&&void 0!==g?d===o.data.width&&g===o.data.height?(o.data.replace(l.data,!(t instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&t instanceof u.window.ImageBitmap)),this.style.updateImage(f,o)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${d}, ${g})\n                must be that same as the previous version of the image\n                (${o.data.width}, ${o.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){u.getImage(this._requestManager.transformRequest(f,u.ResourceType.Image),(o,l)=>{t(o,l instanceof u.window.HTMLImageElement?u.exported.getImageData(l):l)})}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,t,o){return this.style.setLayerZoomRange(f,t,o),this._update(!0)}setFilter(f,t,o={}){return this.style.setFilter(f,t,o),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,o,l={}){return this.style.setPaintProperty(f,t,o,l),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,o,l={}){return this.style.setLayoutProperty(f,t,o,l),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(f),this.transform):0}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,l,d,g=this._container;for(;g&&(!l||!d);){const v=u.window.getComputedStyle(g).transform;v&&"none"!==v&&(o=v.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&"0"!==o[0]&&"1"!==o[0]&&(l=o[0]),o[3]&&"0"!==o[3]&&"1"!==o[3]&&(d=o[3])),g=g.parentElement}this._containerWidth=l?Math.abs(f/l):f,this._containerHeight=d?Math.abs(t/d):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=vt("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=vt("div","mapboxgl-canvas-container",f);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=vt("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=vt("div","mapboxgl-control-container",f),l=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{l[d]=vt("div",`mapboxgl-ctrl-${d}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const o=u.exported.devicePixelRatio||1;this._canvas.width=o*Math.ceil(f),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);-1!==t&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const f=u.extend({},Gt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);t?(u.storeAuthState(t,!0),this.painter=new Kt(t,this.transform),this.on("data",o=>{"source"===o.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(t)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;const o=this.painter.context.extTimerQuery,l=u.exported.now();if(this.listens("gpu-timing-frame")&&(t=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let d=!1;const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,S=this.transform.pitch,R=u.exported.now();this.style.zoomHistory.update(T,R);const B=new u.EvaluationParameters(T,{now:R,fadeDuration:g,pitch:S,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=B.crossFadingFactor();1===$&&$===this._crossFadingFactor||(d=!0,this._crossFadingFactor=$),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(l),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(l),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const T=u.exported.now()-l;o.endQueryEXT(o.TIME_ELAPSED_EXT,t),setTimeout(()=>{const S=o.getQueryObjectEXT(t,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(t),this.fire(new u.Event("gpu-timing-frame",{cpuTime:T,gpuTime:S})),u.window.performance.mark("frame-gpu",{startTime:l,detail:{gpuTime:S}})},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(T);this.fire(new u.Event("gpu-timing-layer",{layerTimes:S}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const S=this.painter.queryGpuTimeDeferredRender(T);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:S}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const T=!this.isMoving()&&this.loaded();if(T&&(v=this._updateAverageElevation(l,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const S=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:S})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const o=l=>(this.transform.averageElevation=l,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&o(0);if((t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const l=this.transform.averageElevation;let d=this.transform.sampleAverageElevation(),g=!1;this.transform.elevation&&(g=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(d)?d=0:this._averageElevationLastSampledAt=f;const v=Math.abs(l-d);if(v>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(d),o(d);this._averageElevation.easeTo(d,f,300)}else if(v>1e-4)return this._averageElevation.jumpTo(d),o(d)}return!!this._averageElevation.isEasing(f)&&o(this._averageElevation.getValue(f))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===u.AUTH_ERR_MSG||401===f.status)){const t=this.painter.context.gl;u.storeAuthState(t,!1),this._logoControl instanceof vs&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,l=o.createFramebuffer();function d(g){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,g,0);const v=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,v),v}return o.bindFramebuffer(o.FRAMEBUFFER,l),this._canvasPixelComparison(d(f),t.canvasCopies.map(d),t.timeStamps)}_canvasPixelComparison(f,t,o){let l=o[1]-o[0];const d=f.length/4;for(let g=0;g<t.length;g++){const v=t[g];let E=0;for(let T=0;T<v.length;T+=4)v[T]===f[T]&&v[T+1]===f[T+1]&&v[T+2]===f[T+2]&&v[T+3]===f[T+3]&&(E+=1);l+=(o[g+2]-o[g+1])*(1-E/d)}return l}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Qc(this._canvasContainer),Qc(this._controlContainer),Qc(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=u.exported.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(f){const t=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(t,(o,l)=>o._preloadTiles(f,l),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,t){u.setCacheLimits(f,t)}get version(){return u.version}},NavigationControl:class{constructor(f){this.options=u.extend({},lh,f),this._container=vt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),vt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),vt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=vt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),o=t===f.getMaxZoom(),l=t===f.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ch(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const o=vt("button",f,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(f,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",o),f.firstElementChild&&f.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends u.Evented{constructor(f){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},uh,f),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=js(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=vt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,f(o)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(o=>t("denied"!==o.state)).catch(()=>t()):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),o=f.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",f)),this._finish()}}_updateCamera(f){const t=new u.LngLat(f.coords.longitude,f.coords.latitude),o=f.coords.accuracy,l=this._map.getBearing(),d=u.extend({bearing:l},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),d,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new u.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=u.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=vt("button","mapboxgl-ctrl-geolocate",this._container),vt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=vt("div","mapboxgl-user-location"),this._dotElement.appendChild(vt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(vt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hs({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=vt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ys,ScaleControl:class{constructor(f){this.options=u.extend({},Ma,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=hh.bind(this)),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,l=t._containerWidth/2-f/2,d=t.unproject([l,o]),g=t.unproject([l+f,o]),v=d.distanceTo(g);if("imperial"===this.options.unit){const E=3.2808*v;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else"nautical"===this.options.unit?this._setScale(f,v/1852,"nautical-mile"):v>=1e3?this._setScale(f,v/1e3,"kilometer"):this._setScale(f,v,"meter")}_setScale(f,t,o){const l=xc(t),d=l/t;this._map._requestDomTask(()=>{this._container.style.width=f*d+"px",this._container.innerHTML="nautical-mile"!==o?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:o}).format(l):`${l}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=vt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof u.window.HTMLElement?this._container=f.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=vt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=vt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);vt("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(f){super(),this.options=u.extend(Object.create(dd),f),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=u.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(u.window.document.createTextNode(f))}setHTML(f){const t=u.window.document.createDocumentFragment(),o=u.window.document.createElement("body");let l;for(o.innerHTML=f;l=o.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=vt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const o=this._closeButton=vt("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.setAttribute("aria-hidden","true"),o.innerHTML="&#215;",o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,l=this._pos;if(!t||!o||!l)return"bottom";const d=o.offsetWidth,g=o.offsetHeight,v=l.x<d/2,E=l.x>t.transform.width-d/2;if(l.y+f<g)return v?"top-left":E?"top-right":"top";if(l.y>t.transform.height-g){if(v)return"bottom-left";if(E)return"bottom-right"}return v?"left":E?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let l=this._container;if(l||(l=this._container=vt("div","mapboxgl-popup",t.getContainer()),this._tip=vt("div","mapboxgl-popup-tip",l),l.appendChild(o)),this.options.maxWidth&&l.style.maxWidth!==this.options.maxWidth&&(l.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ul(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const d=this._pos=this._trackPointer&&f?f:t.project(this._lngLat),g=_r(this.options.offset),v=this._anchor=this._getAnchor(g.y),E=_r(this.options.offset,v),T=d.add(E).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Sa[v]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&t._showingGlobe()){const d=u.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(hl);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Hs,Style:Wo,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:Nr,Evented:u.Evented,config:u.config,prewarm:function(){Ot().acquire(Re)},clearPrewarmedResources:function(){const f=We;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Re),We=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(f){u.config.ACCESS_TOKEN=f},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(f){u.config.API_URL=f},get workerCount(){return rt.workerCount},set workerCount(f){rt.workerCount=f},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){u.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){u.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return Wr}),G}()},751:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{y:()=>At});var G=Ae(961),Ee=Ae(727),Rt=Ae(822),u=Ae(635),Te=Ae(416),Gt=Ae(576),Nt=Ae(806);let At=(()=>{class It{constructor(wt){wt&&(this._subscribe=wt)}lift(wt){const Ht=new It;return Ht.source=this,Ht.operator=wt,Ht}subscribe(wt,Ht,Xt){const Lt=function Qe(It){return It&&It instanceof G.Lv||function mt(It){return It&&(0,Gt.m)(It.next)&&(0,Gt.m)(It.error)&&(0,Gt.m)(It.complete)}(It)&&(0,Ee.Nn)(It)}(wt)?wt:new G.Hp(wt,Ht,Xt);return(0,Nt.x)(()=>{const{operator:et,source:Yn}=this;Lt.add(et?et.call(Lt,Yn):Yn?this._subscribe(Lt):this._trySubscribe(Lt))}),Lt}_trySubscribe(wt){try{return this._subscribe(wt)}catch(Ht){wt.error(Ht)}}forEach(wt,Ht){return new(Ht=vt(Ht))((Xt,Lt)=>{const et=new G.Hp({next:Yn=>{try{wt(Yn)}catch(Ut){Lt(Ut),et.unsubscribe()}},error:Lt,complete:Xt});this.subscribe(et)})}_subscribe(wt){var Ht;return null===(Ht=this.source)||void 0===Ht?void 0:Ht.subscribe(wt)}[Rt.L](){return this}pipe(...wt){return(0,u.U)(wt)(this)}toPromise(wt){return new(wt=vt(wt))((Ht,Xt)=>{let Lt;this.subscribe(et=>Lt=et,et=>Xt(et),()=>Ht(Lt))})}}return It.create=xn=>new It(xn),It})();function vt(It){var xn;return null!==(xn=It??Te.v.Promise)&&void 0!==xn?xn:Promise}},579:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{x:()=>Nt});var G=Ae(751),Ee=Ae(727);const u=(0,Ae(888).d)(vt=>function(){vt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Te=Ae(737),Gt=Ae(806);let Nt=(()=>{class vt extends G.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(Qe){const It=new At(this,this);return It.operator=Qe,It}_throwIfClosed(){if(this.closed)throw new u}next(Qe){(0,Gt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const It of this.currentObservers)It.next(Qe)}})}error(Qe){(0,Gt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=Qe;const{observers:It}=this;for(;It.length;)It.shift().error(Qe)}})}complete(){(0,Gt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:Qe}=this;for(;Qe.length;)Qe.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var Qe;return(null===(Qe=this.observers)||void 0===Qe?void 0:Qe.length)>0}_trySubscribe(Qe){return this._throwIfClosed(),super._trySubscribe(Qe)}_subscribe(Qe){return this._throwIfClosed(),this._checkFinalizedStatuses(Qe),this._innerSubscribe(Qe)}_innerSubscribe(Qe){const{hasError:It,isStopped:xn,observers:wt}=this;return It||xn?Ee.Lc:(this.currentObservers=null,wt.push(Qe),new Ee.w0(()=>{this.currentObservers=null,(0,Te.P)(wt,Qe)}))}_checkFinalizedStatuses(Qe){const{hasError:It,thrownError:xn,isStopped:wt}=this;It?Qe.error(xn):wt&&Qe.complete()}asObservable(){const Qe=new G.y;return Qe.source=this,Qe}}return vt.create=(mt,Qe)=>new At(mt,Qe),vt})();class At extends Nt{constructor(mt,Qe){super(),this.destination=mt,this.source=Qe}next(mt){var Qe,It;null===(It=null===(Qe=this.destination)||void 0===Qe?void 0:Qe.next)||void 0===It||It.call(Qe,mt)}error(mt){var Qe,It;null===(It=null===(Qe=this.destination)||void 0===Qe?void 0:Qe.error)||void 0===It||It.call(Qe,mt)}complete(){var mt,Qe;null===(Qe=null===(mt=this.destination)||void 0===mt?void 0:mt.complete)||void 0===Qe||Qe.call(mt)}_subscribe(mt){var Qe,It;return null!==(It=null===(Qe=this.source)||void 0===Qe?void 0:Qe.subscribe(mt))&&void 0!==It?It:Ee.Lc}}},961:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{Hp:()=>Xt,Lv:()=>It});var G=Ae(576),Ee=Ae(727),Rt=Ae(416),u=Ae(849);function Te(){}const Gt=vt("C",void 0,void 0);function vt(Zt,qe,Yt){return{kind:Zt,value:qe,error:Yt}}var mt=Ae(410),Qe=Ae(806);class It extends Ee.w0{constructor(qe){super(),this.isStopped=!1,qe?(this.destination=qe,(0,Ee.Nn)(qe)&&qe.add(this)):this.destination=Ut}static create(qe,Yt,Pt){return new Xt(qe,Yt,Pt)}next(qe){this.isStopped?Yn(function At(Zt){return vt("N",Zt,void 0)}(qe),this):this._next(qe)}error(qe){this.isStopped?Yn(function Nt(Zt){return vt("E",void 0,Zt)}(qe),this):(this.isStopped=!0,this._error(qe))}complete(){this.isStopped?Yn(Gt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(qe){this.destination.next(qe)}_error(qe){try{this.destination.error(qe)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const xn=Function.prototype.bind;function wt(Zt,qe){return xn.call(Zt,qe)}class Ht{constructor(qe){this.partialObserver=qe}next(qe){const{partialObserver:Yt}=this;if(Yt.next)try{Yt.next(qe)}catch(Pt){Lt(Pt)}}error(qe){const{partialObserver:Yt}=this;if(Yt.error)try{Yt.error(qe)}catch(Pt){Lt(Pt)}else Lt(qe)}complete(){const{partialObserver:qe}=this;if(qe.complete)try{qe.complete()}catch(Yt){Lt(Yt)}}}class Xt extends It{constructor(qe,Yt,Pt){let tn;if(super(),(0,G.m)(qe)||!qe)tn={next:qe??void 0,error:Yt??void 0,complete:Pt??void 0};else{let st;this&&Rt.v.useDeprecatedNextContext?(st=Object.create(qe),st.unsubscribe=()=>this.unsubscribe(),tn={next:qe.next&&wt(qe.next,st),error:qe.error&&wt(qe.error,st),complete:qe.complete&&wt(qe.complete,st)}):tn=qe}this.destination=new Ht(tn)}}function Lt(Zt){Rt.v.useDeprecatedSynchronousErrorHandling?(0,Qe.O)(Zt):(0,u.h)(Zt)}function Yn(Zt,qe){const{onStoppedNotification:Yt}=Rt.v;Yt&&mt.z.setTimeout(()=>Yt(Zt,qe))}const Ut={closed:!0,next:Te,error:function et(Zt){throw Zt},complete:Te}},727:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{Lc:()=>Gt,w0:()=>Te,Nn:()=>Nt});var G=Ae(576);const Rt=(0,Ae(888).d)(vt=>function(Qe){vt(this),this.message=Qe?`${Qe.length} errors occurred during unsubscription:\n${Qe.map((It,xn)=>`${xn+1}) ${It.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=Qe});var u=Ae(737);class Te{constructor(mt){this.initialTeardown=mt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let mt;if(!this.closed){this.closed=!0;const{_parentage:Qe}=this;if(Qe)if(this._parentage=null,Array.isArray(Qe))for(const wt of Qe)wt.remove(this);else Qe.remove(this);const{initialTeardown:It}=this;if((0,G.m)(It))try{It()}catch(wt){mt=wt instanceof Rt?wt.errors:[wt]}const{_finalizers:xn}=this;if(xn){this._finalizers=null;for(const wt of xn)try{At(wt)}catch(Ht){mt=mt??[],Ht instanceof Rt?mt=[...mt,...Ht.errors]:mt.push(Ht)}}if(mt)throw new Rt(mt)}}add(mt){var Qe;if(mt&&mt!==this)if(this.closed)At(mt);else{if(mt instanceof Te){if(mt.closed||mt._hasParent(this))return;mt._addParent(this)}(this._finalizers=null!==(Qe=this._finalizers)&&void 0!==Qe?Qe:[]).push(mt)}}_hasParent(mt){const{_parentage:Qe}=this;return Qe===mt||Array.isArray(Qe)&&Qe.includes(mt)}_addParent(mt){const{_parentage:Qe}=this;this._parentage=Array.isArray(Qe)?(Qe.push(mt),Qe):Qe?[Qe,mt]:mt}_removeParent(mt){const{_parentage:Qe}=this;Qe===mt?this._parentage=null:Array.isArray(Qe)&&(0,u.P)(Qe,mt)}remove(mt){const{_finalizers:Qe}=this;Qe&&(0,u.P)(Qe,mt),mt instanceof Te&&mt._removeParent(this)}}Te.EMPTY=(()=>{const vt=new Te;return vt.closed=!0,vt})();const Gt=Te.EMPTY;function Nt(vt){return vt instanceof Te||vt&&"closed"in vt&&(0,G.m)(vt.remove)&&(0,G.m)(vt.add)&&(0,G.m)(vt.unsubscribe)}function At(vt){(0,G.m)(vt)?vt():vt.unsubscribe()}},416:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{v:()=>G});const G={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{E:()=>Ee});const Ee=new(Ae(751).y)(Te=>Te.complete())},76:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{D:()=>Pt});var G=Ae(421),Ee=Ae(672),Rt=Ae(482),u=Ae(403);function Te(tn,st=0){return(0,Rt.e)((kt,Ie)=>{kt.subscribe((0,u.x)(Ie,Ne=>(0,Ee.f)(Ie,tn,()=>Ie.next(Ne),st),()=>(0,Ee.f)(Ie,tn,()=>Ie.complete(),st),Ne=>(0,Ee.f)(Ie,tn,()=>Ie.error(Ne),st)))})}function Gt(tn,st=0){return(0,Rt.e)((kt,Ie)=>{Ie.add(tn.schedule(()=>kt.subscribe(Ie),st))})}var vt=Ae(751),Qe=Ae(202),It=Ae(576);function wt(tn,st){if(!tn)throw new Error("Iterable cannot be null");return new vt.y(kt=>{(0,Ee.f)(kt,st,()=>{const Ie=tn[Symbol.asyncIterator]();(0,Ee.f)(kt,st,()=>{Ie.next().then(Ne=>{Ne.done?kt.complete():kt.next(Ne.value)})},0,!0)})})}var Ht=Ae(670),Xt=Ae(239),Lt=Ae(144),et=Ae(495),Yn=Ae(206),Ut=Ae(532),Zt=Ae(260);function Pt(tn,st){return st?function Yt(tn,st){if(null!=tn){if((0,Ht.c)(tn))return function Nt(tn,st){return(0,G.Xf)(tn).pipe(Gt(st),Te(st))}(tn,st);if((0,Lt.z)(tn))return function mt(tn,st){return new vt.y(kt=>{let Ie=0;return st.schedule(function(){Ie===tn.length?kt.complete():(kt.next(tn[Ie++]),kt.closed||this.schedule())})})}(tn,st);if((0,Xt.t)(tn))return function At(tn,st){return(0,G.Xf)(tn).pipe(Gt(st),Te(st))}(tn,st);if((0,Yn.D)(tn))return wt(tn,st);if((0,et.T)(tn))return function xn(tn,st){return new vt.y(kt=>{let Ie;return(0,Ee.f)(kt,st,()=>{Ie=tn[Qe.h](),(0,Ee.f)(kt,st,()=>{let Ne,Ye;try{({value:Ne,done:Ye}=Ie.next())}catch(Ve){return void kt.error(Ve)}Ye?kt.complete():kt.next(Ne)},0,!0)}),()=>(0,It.m)(Ie?.return)&&Ie.return()})}(tn,st);if((0,Zt.L)(tn))return function qe(tn,st){return wt((0,Zt.Q)(tn),st)}(tn,st)}throw(0,Ut.z)(tn)}(tn,st):(0,G.Xf)(tn)}},421:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{Xf:()=>xn});var G=Ae(655),Ee=Ae(144),Rt=Ae(239),u=Ae(751),Te=Ae(670),Gt=Ae(206),Nt=Ae(532),At=Ae(495),vt=Ae(260),mt=Ae(576),Qe=Ae(849),It=Ae(822);function xn(Zt){if(Zt instanceof u.y)return Zt;if(null!=Zt){if((0,Te.c)(Zt))return function wt(Zt){return new u.y(qe=>{const Yt=Zt[It.L]();if((0,mt.m)(Yt.subscribe))return Yt.subscribe(qe);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Zt);if((0,Ee.z)(Zt))return function Ht(Zt){return new u.y(qe=>{for(let Yt=0;Yt<Zt.length&&!qe.closed;Yt++)qe.next(Zt[Yt]);qe.complete()})}(Zt);if((0,Rt.t)(Zt))return function Xt(Zt){return new u.y(qe=>{Zt.then(Yt=>{qe.closed||(qe.next(Yt),qe.complete())},Yt=>qe.error(Yt)).then(null,Qe.h)})}(Zt);if((0,Gt.D)(Zt))return et(Zt);if((0,At.T)(Zt))return function Lt(Zt){return new u.y(qe=>{for(const Yt of Zt)if(qe.next(Yt),qe.closed)return;qe.complete()})}(Zt);if((0,vt.L)(Zt))return function Yn(Zt){return et((0,vt.Q)(Zt))}(Zt)}throw(0,Nt.z)(Zt)}function et(Zt){return new u.y(qe=>{(function Ut(Zt,qe){var Yt,Pt,tn,st;return(0,G.mG)(this,void 0,void 0,function*(){try{for(Yt=(0,G.KL)(Zt);!(Pt=yield Yt.next()).done;)if(qe.next(Pt.value),qe.closed)return}catch(kt){tn={error:kt}}finally{try{Pt&&!Pt.done&&(st=Yt.return)&&(yield st.call(Yt))}finally{if(tn)throw tn.error}}qe.complete()})})(Zt,qe).catch(Yt=>qe.error(Yt))})}},403:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{x:()=>Ee});var G=Ae(961);function Ee(u,Te,Gt,Nt,At){return new Rt(u,Te,Gt,Nt,At)}class Rt extends G.Lv{constructor(Te,Gt,Nt,At,vt,mt){super(Te),this.onFinalize=vt,this.shouldUnsubscribe=mt,this._next=Gt?function(Qe){try{Gt(Qe)}catch(It){Te.error(It)}}:super._next,this._error=At?function(Qe){try{At(Qe)}catch(It){Te.error(It)}finally{this.unsubscribe()}}:super._error,this._complete=Nt?function(){try{Nt()}catch(Qe){Te.error(Qe)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Te;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Gt}=this;super.unsubscribe(),!Gt&&(null===(Te=this.onFinalize)||void 0===Te||Te.call(this))}}}},4:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{U:()=>Rt});var G=Ae(482),Ee=Ae(403);function Rt(u,Te){return(0,G.e)((Gt,Nt)=>{let At=0;Gt.subscribe((0,Ee.x)(Nt,vt=>{Nt.next(u.call(Te,vt,At++))}))})}},189:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{J:()=>Rt});var G=Ae(577),Ee=Ae(671);function Rt(u=1/0){return(0,G.z)(Ee.y,u)}},577:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{z:()=>At});var G=Ae(4),Ee=Ae(421),Rt=Ae(482),u=Ae(672),Te=Ae(403),Nt=Ae(576);function At(vt,mt,Qe=1/0){return(0,Nt.m)(mt)?At((It,xn)=>(0,G.U)((wt,Ht)=>mt(It,wt,xn,Ht))((0,Ee.Xf)(vt(It,xn))),Qe):("number"==typeof mt&&(Qe=mt),(0,Rt.e)((It,xn)=>function Gt(vt,mt,Qe,It,xn,wt,Ht,Xt){const Lt=[];let et=0,Yn=0,Ut=!1;const Zt=()=>{Ut&&!Lt.length&&!et&&mt.complete()},qe=Pt=>et<It?Yt(Pt):Lt.push(Pt),Yt=Pt=>{wt&&mt.next(Pt),et++;let tn=!1;(0,Ee.Xf)(Qe(Pt,Yn++)).subscribe((0,Te.x)(mt,st=>{xn?.(st),wt?qe(st):mt.next(st)},()=>{tn=!0},void 0,()=>{if(tn)try{for(et--;Lt.length&&et<It;){const st=Lt.shift();Ht?(0,u.f)(mt,Ht,()=>Yt(st)):Yt(st)}Zt()}catch(st){mt.error(st)}}))};return vt.subscribe((0,Te.x)(mt,qe,()=>{Ut=!0,Zt()})),()=>{Xt?.()}}(It,xn,vt,Qe)))}},410:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{z:()=>G});const G={setTimeout(Ee,Rt,...u){const{delegate:Te}=G;return Te?.setTimeout?Te.setTimeout(Ee,Rt,...u):setTimeout(Ee,Rt,...u)},clearTimeout(Ee){const{delegate:Rt}=G;return(Rt?.clearTimeout||clearTimeout)(Ee)},delegate:void 0}},202:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{h:()=>Ee});const Ee=function G(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},822:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{L:()=>G});const G="function"==typeof Symbol&&Symbol.observable||"@@observable"},669:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{_6:()=>Gt,jO:()=>u,yG:()=>Te});var G=Ae(576);function Rt(Nt){return Nt[Nt.length-1]}function u(Nt){return(0,G.m)(Rt(Nt))?Nt.pop():void 0}function Te(Nt){return function Ee(Nt){return Nt&&(0,G.m)(Nt.schedule)}(Rt(Nt))?Nt.pop():void 0}function Gt(Nt,At){return"number"==typeof Rt(Nt)?Nt.pop():At}},737:(Xn,Bt,Ae)=>{"use strict";function G(Ee,Rt){if(Ee){const u=Ee.indexOf(Rt);0<=u&&Ee.splice(u,1)}}Ae.d(Bt,{P:()=>G})},888:(Xn,Bt,Ae)=>{"use strict";function G(Ee){const u=Ee(Te=>{Error.call(Te),Te.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}Ae.d(Bt,{d:()=>G})},806:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{O:()=>u,x:()=>Rt});var G=Ae(416);let Ee=null;function Rt(Te){if(G.v.useDeprecatedSynchronousErrorHandling){const Gt=!Ee;if(Gt&&(Ee={errorThrown:!1,error:null}),Te(),Gt){const{errorThrown:Nt,error:At}=Ee;if(Ee=null,Nt)throw At}}else Te()}function u(Te){G.v.useDeprecatedSynchronousErrorHandling&&Ee&&(Ee.errorThrown=!0,Ee.error=Te)}},672:(Xn,Bt,Ae)=>{"use strict";function G(Ee,Rt,u,Te=0,Gt=!1){const Nt=Rt.schedule(function(){u(),Gt?Ee.add(this.schedule(null,Te)):this.unsubscribe()},Te);if(Ee.add(Nt),!Gt)return Nt}Ae.d(Bt,{f:()=>G})},671:(Xn,Bt,Ae)=>{"use strict";function G(Ee){return Ee}Ae.d(Bt,{y:()=>G})},144:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{z:()=>G});const G=Ee=>Ee&&"number"==typeof Ee.length&&"function"!=typeof Ee},206:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{D:()=>Ee});var G=Ae(576);function Ee(Rt){return Symbol.asyncIterator&&(0,G.m)(Rt?.[Symbol.asyncIterator])}},576:(Xn,Bt,Ae)=>{"use strict";function G(Ee){return"function"==typeof Ee}Ae.d(Bt,{m:()=>G})},670:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{c:()=>Rt});var G=Ae(822),Ee=Ae(576);function Rt(u){return(0,Ee.m)(u[G.L])}},495:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{T:()=>Rt});var G=Ae(202),Ee=Ae(576);function Rt(u){return(0,Ee.m)(u?.[G.h])}},239:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{t:()=>Ee});var G=Ae(576);function Ee(Rt){return(0,G.m)(Rt?.then)}},260:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{L:()=>u,Q:()=>Rt});var G=Ae(655),Ee=Ae(576);function Rt(Te){return(0,G.FC)(this,arguments,function*(){const Nt=Te.getReader();try{for(;;){const{value:At,done:vt}=yield(0,G.qq)(Nt.read());if(vt)return yield(0,G.qq)(void 0);yield yield(0,G.qq)(At)}}finally{Nt.releaseLock()}})}function u(Te){return(0,Ee.m)(Te?.getReader)}},482:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{A:()=>Ee,e:()=>Rt});var G=Ae(576);function Ee(u){return(0,G.m)(u?.lift)}function Rt(u){return Te=>{if(Ee(Te))return Te.lift(function(Gt){try{return u(Gt,this)}catch(Nt){this.error(Nt)}});throw new TypeError("Unable to lift unknown Observable type")}}},635:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{U:()=>Rt,z:()=>Ee});var G=Ae(671);function Ee(...u){return Rt(u)}function Rt(u){return 0===u.length?G.y:1===u.length?u[0]:function(Gt){return u.reduce((Nt,At)=>At(Nt),Gt)}}},849:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{h:()=>Rt});var G=Ae(416),Ee=Ae(410);function Rt(u){Ee.z.setTimeout(()=>{const{onUnhandledError:Te}=G.v;if(!Te)throw u;Te(u)})}},532:(Xn,Bt,Ae)=>{"use strict";function G(Ee){return new TypeError(`You provided ${null!==Ee&&"object"==typeof Ee?"an invalid object":`'${Ee}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Ae.d(Bt,{z:()=>G})},655:(Xn,Bt,Ae)=>{"use strict";function At(Ie,Ne,Ye,Ve){return new(Ye||(Ye=Promise))(function(gt,fn){function Gn(Mr){try{en(Ve.next(Mr))}catch(gi){fn(gi)}}function lr(Mr){try{en(Ve.throw(Mr))}catch(gi){fn(gi)}}function en(Mr){Mr.done?gt(Mr.value):function Dt(gt){return gt instanceof Ye?gt:new Ye(function(fn){fn(gt)})}(Mr.value).then(Gn,lr)}en((Ve=Ve.apply(Ie,Ne||[])).next())})}function Lt(Ie){return this instanceof Lt?(this.v=Ie,this):new Lt(Ie)}function et(Ie,Ne,Ye){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Dt,Ve=Ye.apply(Ie,Ne||[]),gt=[];return Dt={},fn("next"),fn("throw"),fn("return"),Dt[Symbol.asyncIterator]=function(){return this},Dt;function fn(kn){Ve[kn]&&(Dt[kn]=function(hr){return new Promise(function(ui,cr){gt.push([kn,hr,ui,cr])>1||Gn(kn,hr)})})}function Gn(kn,hr){try{!function lr(kn){kn.value instanceof Lt?Promise.resolve(kn.value.v).then(en,Mr):gi(gt[0][2],kn)}(Ve[kn](hr))}catch(ui){gi(gt[0][3],ui)}}function en(kn){Gn("next",kn)}function Mr(kn){Gn("throw",kn)}function gi(kn,hr){kn(hr),gt.shift(),gt.length&&Gn(gt[0][0],gt[0][1])}}function Ut(Ie){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ye,Ne=Ie[Symbol.asyncIterator];return Ne?Ne.call(Ie):(Ie=function It(Ie){var Ne="function"==typeof Symbol&&Symbol.iterator,Ye=Ne&&Ie[Ne],Ve=0;if(Ye)return Ye.call(Ie);if(Ie&&"number"==typeof Ie.length)return{next:function(){return Ie&&Ve>=Ie.length&&(Ie=void 0),{value:Ie&&Ie[Ve++],done:!Ie}}};throw new TypeError(Ne?"Object is not iterable.":"Symbol.iterator is not defined.")}(Ie),Ye={},Ve("next"),Ve("throw"),Ve("return"),Ye[Symbol.asyncIterator]=function(){return this},Ye);function Ve(gt){Ye[gt]=Ie[gt]&&function(fn){return new Promise(function(Gn,lr){!function Dt(gt,fn,Gn,lr){Promise.resolve(lr).then(function(en){gt({value:en,done:Gn})},fn)}(Gn,lr,(fn=Ie[gt](fn)).done,fn.value)})}}}Ae.d(Bt,{FC:()=>et,KL:()=>Ut,mG:()=>At,qq:()=>Lt})},895:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{Do:()=>Ut,EM:()=>Va,HT:()=>Te,JF:()=>hs,JJ:()=>_a,K0:()=>Nt,Mx:()=>Li,PC:()=>En,S$:()=>Lt,V_:()=>mt,Ye:()=>Zt,b0:()=>Yn,bD:()=>us,ez:()=>Ua,q:()=>Rt,sg:()=>_n,w_:()=>Gt});var G=Ae(256);let Ee=null;function Rt(){return Ee}function Te(k){Ee||(Ee=k)}class Gt{}const Nt=new G.OlP("DocumentToken");let At=(()=>{class k{historyGo(L){throw new Error("Not implemented")}}return k.\u0275fac=function(L){return new(L||k)},k.\u0275prov=G.Yz7({token:k,factory:function(){return function vt(){return(0,G.LFG)(Qe)}()},providedIn:"platform"}),k})();const mt=new G.OlP("Location Initialized");let Qe=(()=>{class k extends At{constructor(L){super(),this._doc=L,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Rt().getBaseHref(this._doc)}onPopState(L){const Z=Rt().getGlobalEventTarget(this._doc,"window");return Z.addEventListener("popstate",L,!1),()=>Z.removeEventListener("popstate",L)}onHashChange(L){const Z=Rt().getGlobalEventTarget(this._doc,"window");return Z.addEventListener("hashchange",L,!1),()=>Z.removeEventListener("hashchange",L)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(L){this.location.pathname=L}pushState(L,Z,ve){It()?this._history.pushState(L,Z,ve):this.location.hash=ve}replaceState(L,Z,ve){It()?this._history.replaceState(L,Z,ve):this.location.hash=ve}forward(){this._history.forward()}back(){this._history.back()}historyGo(L=0){this._history.go(L)}getState(){return this._history.state}}return k.\u0275fac=function(L){return new(L||k)(G.LFG(Nt))},k.\u0275prov=G.Yz7({token:k,factory:function(){return function xn(){return new Qe((0,G.LFG)(Nt))}()},providedIn:"platform"}),k})();function It(){return!!window.history.pushState}function wt(k,j){if(0==k.length)return j;if(0==j.length)return k;let L=0;return k.endsWith("/")&&L++,j.startsWith("/")&&L++,2==L?k+j.substring(1):1==L?k+j:k+"/"+j}function Ht(k){const j=k.match(/#|\?|$/),L=j&&j.index||k.length;return k.slice(0,L-("/"===k[L-1]?1:0))+k.slice(L)}function Xt(k){return k&&"?"!==k[0]?"?"+k:k}let Lt=(()=>{class k{historyGo(L){throw new Error("Not implemented")}}return k.\u0275fac=function(L){return new(L||k)},k.\u0275prov=G.Yz7({token:k,factory:function(){return(0,G.f3M)(Yn)},providedIn:"root"}),k})();const et=new G.OlP("appBaseHref");let Yn=(()=>{class k extends Lt{constructor(L,Z){super(),this._platformLocation=L,this._removeListenerFns=[],this._baseHref=Z??this._platformLocation.getBaseHrefFromDOM()??(0,G.f3M)(Nt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(L){this._removeListenerFns.push(this._platformLocation.onPopState(L),this._platformLocation.onHashChange(L))}getBaseHref(){return this._baseHref}prepareExternalUrl(L){return wt(this._baseHref,L)}path(L=!1){const Z=this._platformLocation.pathname+Xt(this._platformLocation.search),ve=this._platformLocation.hash;return ve&&L?`${Z}${ve}`:Z}pushState(L,Z,ve,Ge){const tt=this.prepareExternalUrl(ve+Xt(Ge));this._platformLocation.pushState(L,Z,tt)}replaceState(L,Z,ve,Ge){const tt=this.prepareExternalUrl(ve+Xt(Ge));this._platformLocation.replaceState(L,Z,tt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(L=0){this._platformLocation.historyGo?.(L)}}return k.\u0275fac=function(L){return new(L||k)(G.LFG(At),G.LFG(et,8))},k.\u0275prov=G.Yz7({token:k,factory:k.\u0275fac,providedIn:"root"}),k})(),Ut=(()=>{class k extends Lt{constructor(L,Z){super(),this._platformLocation=L,this._baseHref="",this._removeListenerFns=[],null!=Z&&(this._baseHref=Z)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(L){this._removeListenerFns.push(this._platformLocation.onPopState(L),this._platformLocation.onHashChange(L))}getBaseHref(){return this._baseHref}path(L=!1){let Z=this._platformLocation.hash;return null==Z&&(Z="#"),Z.length>0?Z.substring(1):Z}prepareExternalUrl(L){const Z=wt(this._baseHref,L);return Z.length>0?"#"+Z:Z}pushState(L,Z,ve,Ge){let tt=this.prepareExternalUrl(ve+Xt(Ge));0==tt.length&&(tt=this._platformLocation.pathname),this._platformLocation.pushState(L,Z,tt)}replaceState(L,Z,ve,Ge){let tt=this.prepareExternalUrl(ve+Xt(Ge));0==tt.length&&(tt=this._platformLocation.pathname),this._platformLocation.replaceState(L,Z,tt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(L=0){this._platformLocation.historyGo?.(L)}}return k.\u0275fac=function(L){return new(L||k)(G.LFG(At),G.LFG(et,8))},k.\u0275prov=G.Yz7({token:k,factory:k.\u0275fac}),k})(),Zt=(()=>{class k{constructor(L){this._subject=new G.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=L;const Z=this._locationStrategy.getBaseHref();this._baseHref=Ht(Pt(Z)),this._locationStrategy.onPopState(ve=>{this._subject.emit({url:this.path(!0),pop:!0,state:ve.state,type:ve.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(L=!1){return this.normalize(this._locationStrategy.path(L))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(L,Z=""){return this.path()==this.normalize(L+Xt(Z))}normalize(L){return k.stripTrailingSlash(function Yt(k,j){return k&&j.startsWith(k)?j.substring(k.length):j}(this._baseHref,Pt(L)))}prepareExternalUrl(L){return L&&"/"!==L[0]&&(L="/"+L),this._locationStrategy.prepareExternalUrl(L)}go(L,Z="",ve=null){this._locationStrategy.pushState(ve,"",L,Z),this._notifyUrlChangeListeners(this.prepareExternalUrl(L+Xt(Z)),ve)}replaceState(L,Z="",ve=null){this._locationStrategy.replaceState(ve,"",L,Z),this._notifyUrlChangeListeners(this.prepareExternalUrl(L+Xt(Z)),ve)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(L=0){this._locationStrategy.historyGo?.(L)}onUrlChange(L){return this._urlChangeListeners.push(L),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(Z=>{this._notifyUrlChangeListeners(Z.url,Z.state)})),()=>{const Z=this._urlChangeListeners.indexOf(L);this._urlChangeListeners.splice(Z,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(L="",Z){this._urlChangeListeners.forEach(ve=>ve(L,Z))}subscribe(L,Z,ve){return this._subject.subscribe({next:L,error:Z,complete:ve})}}return k.normalizeQueryParams=Xt,k.joinWithSlash=wt,k.stripTrailingSlash=Ht,k.\u0275fac=function(L){return new(L||k)(G.LFG(Lt))},k.\u0275prov=G.Yz7({token:k,factory:function(){return function qe(){return new Zt((0,G.LFG)(Lt))}()},providedIn:"root"}),k})();function Pt(k){return k.replace(/\/index.html$/,"")}var st=(()=>((st=st||{})[st.Decimal=0]="Decimal",st[st.Percent=1]="Percent",st[st.Currency=2]="Currency",st[st.Scientific=3]="Scientific",st))(),Ve=(()=>((Ve=Ve||{})[Ve.Decimal=0]="Decimal",Ve[Ve.Group=1]="Group",Ve[Ve.List=2]="List",Ve[Ve.PercentSign=3]="PercentSign",Ve[Ve.PlusSign=4]="PlusSign",Ve[Ve.MinusSign=5]="MinusSign",Ve[Ve.Exponential=6]="Exponential",Ve[Ve.SuperscriptingExponent=7]="SuperscriptingExponent",Ve[Ve.PerMille=8]="PerMille",Ve[Ve.Infinity=9]="Infinity",Ve[Ve.NaN=10]="NaN",Ve[Ve.TimeSeparator=11]="TimeSeparator",Ve[Ve.CurrencyDecimal=12]="CurrencyDecimal",Ve[Ve.CurrencyGroup=13]="CurrencyGroup",Ve))();function cr(k,j){const L=(0,G.cg1)(k),Z=L[G.wAp.NumberSymbols][j];if(typeof Z>"u"){if(j===Ve.CurrencyDecimal)return L[G.wAp.NumberSymbols][Ve.Decimal];if(j===Ve.CurrencyGroup)return L[G.wAp.NumberSymbols][Ve.Group]}return Z}const Me=/^(\d+)?\.((\d+)(-(\d+))?)?$/,Q=".";function $e(k){const j=parseInt(k);if(isNaN(j))throw new Error("Invalid integer literal when parsing "+k);return j}function Li(k,j){j=encodeURIComponent(j);for(const L of k.split(";")){const Z=L.indexOf("="),[ve,Ge]=-1==Z?[L,""]:[L.slice(0,Z),L.slice(Z+1)];if(ve.trim()===j)return decodeURIComponent(Ge)}return null}class on{constructor(j,L,Z,ve){this.$implicit=j,this.ngForOf=L,this.index=Z,this.count=ve}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let _n=(()=>{class k{constructor(L,Z,ve){this._viewContainer=L,this._template=Z,this._differs=ve,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(L){this._ngForOf=L,this._ngForOfDirty=!0}set ngForTrackBy(L){this._trackByFn=L}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(L){L&&(this._template=L)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const L=this._ngForOf;!this._differ&&L&&(this._differ=this._differs.find(L).create(this.ngForTrackBy))}if(this._differ){const L=this._differ.diff(this._ngForOf);L&&this._applyChanges(L)}}_applyChanges(L){const Z=this._viewContainer;L.forEachOperation((ve,Ge,tt)=>{if(null==ve.previousIndex)Z.createEmbeddedView(this._template,new on(ve.item,this._ngForOf,-1,-1),null===tt?void 0:tt);else if(null==tt)Z.remove(null===Ge?void 0:Ge);else if(null!==Ge){const Kt=Z.get(Ge);Z.move(Kt,tt),kr(Kt,ve)}});for(let ve=0,Ge=Z.length;ve<Ge;ve++){const Kt=Z.get(ve).context;Kt.index=ve,Kt.count=Ge,Kt.ngForOf=this._ngForOf}L.forEachIdentityChange(ve=>{kr(Z.get(ve.currentIndex),ve)})}static ngTemplateContextGuard(L,Z){return!0}}return k.\u0275fac=function(L){return new(L||k)(G.Y36(G.s_b),G.Y36(G.Rgc),G.Y36(G.ZZ4))},k.\u0275dir=G.lG2({type:k,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),k})();function kr(k,j){k.context.$implicit=j.item}let En=(()=>{class k{constructor(L,Z,ve){this._ngEl=L,this._differs=Z,this._renderer=ve,this._ngStyle=null,this._differ=null}set ngStyle(L){this._ngStyle=L,!this._differ&&L&&(this._differ=this._differs.find(L).create())}ngDoCheck(){if(this._differ){const L=this._differ.diff(this._ngStyle);L&&this._applyChanges(L)}}_setStyle(L,Z){const[ve,Ge]=L.split("."),tt=-1===ve.indexOf("-")?void 0:G.JOm.DashCase;null!=Z?this._renderer.setStyle(this._ngEl.nativeElement,ve,Ge?`${Z}${Ge}`:Z,tt):this._renderer.removeStyle(this._ngEl.nativeElement,ve,tt)}_applyChanges(L){L.forEachRemovedItem(Z=>this._setStyle(Z.key,null)),L.forEachAddedItem(Z=>this._setStyle(Z.key,Z.currentValue)),L.forEachChangedItem(Z=>this._setStyle(Z.key,Z.currentValue))}}return k.\u0275fac=function(L){return new(L||k)(G.Y36(G.SBq),G.Y36(G.aQg),G.Y36(G.Qsj))},k.\u0275dir=G.lG2({type:k,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),k})();let _a=(()=>{class k{constructor(L){this._locale=L}transform(L,Z,ve){if(!function ya(k){return!(null==k||""===k||k!=k)}(L))return null;ve=ve||this._locale;try{return function Jt(k,j,L){return function Ot(k,j,L,Z,ve,Ge,tt=!1){let Kt="",tr=!1;if(isFinite(k)){let Tn=function po(k){let Z,ve,Ge,tt,Kt,j=Math.abs(k)+"",L=0;for((ve=j.indexOf(Q))>-1&&(j=j.replace(Q,"")),(Ge=j.search(/e/i))>0?(ve<0&&(ve=Ge),ve+=+j.slice(Ge+1),j=j.substring(0,Ge)):ve<0&&(ve=j.length),Ge=0;"0"===j.charAt(Ge);Ge++);if(Ge===(Kt=j.length))Z=[0],ve=1;else{for(Kt--;"0"===j.charAt(Kt);)Kt--;for(ve-=Ge,Z=[],tt=0;Ge<=Kt;Ge++,tt++)Z[tt]=Number(j.charAt(Ge))}return ve>22&&(Z=Z.splice(0,21),L=ve-1,ve=1),{digits:Z,exponent:L,integerLen:ve}}(k);tt&&(Tn=function qn(k){if(0===k.digits[0])return k;const j=k.digits.length-k.integerLen;return k.exponent?k.exponent+=2:(0===j?k.digits.push(0,0):1===j&&k.digits.push(0),k.integerLen+=2),k}(Tn));let $n=j.minInt,rn=j.minFrac,Nr=j.maxFrac;if(Ge){const bi=Ge.match(Me);if(null===bi)throw new Error(`${Ge} is not a valid digit info`);const Tt=bi[1],ni=bi[3],js=bi[5];null!=Tt&&($n=$e(Tt)),null!=ni&&(rn=$e(ni)),null!=js?Nr=$e(js):null!=ni&&rn>Nr&&(Nr=rn)}!function mo(k,j,L){if(j>L)throw new Error(`The minimum number of digits after fraction (${j}) is higher than the maximum (${L}).`);let Z=k.digits,ve=Z.length-k.integerLen;const Ge=Math.min(Math.max(j,ve),L);let tt=Ge+k.integerLen,Kt=Z[tt];if(tt>0){Z.splice(Math.max(k.integerLen,tt));for(let rn=tt;rn<Z.length;rn++)Z[rn]=0}else{ve=Math.max(0,ve),k.integerLen=1,Z.length=Math.max(1,tt=Ge+1),Z[0]=0;for(let rn=1;rn<tt;rn++)Z[rn]=0}if(Kt>=5)if(tt-1<0){for(let rn=0;rn>tt;rn--)Z.unshift(0),k.integerLen++;Z.unshift(1),k.integerLen++}else Z[tt-1]++;for(;ve<Math.max(0,Ge);ve++)Z.push(0);let tr=0!==Ge;const Tn=j+k.integerLen,$n=Z.reduceRight(function(rn,Nr,nr,Yr){return Yr[nr]=(Nr+=rn)<10?Nr:Nr-10,tr&&(0===Yr[nr]&&nr>=Tn?Yr.pop():tr=!1),Nr>=10?1:0},0);$n&&(Z.unshift($n),k.integerLen++)}(Tn,rn,Nr);let nr=Tn.digits,Yr=Tn.integerLen;const Do=Tn.exponent;let Fi=[];for(tr=nr.every(bi=>!bi);Yr<$n;Yr++)nr.unshift(0);for(;Yr<0;Yr++)nr.unshift(0);Yr>0?Fi=nr.splice(Yr,nr.length):(Fi=nr,nr=[0]);const xi=[];for(nr.length>=j.lgSize&&xi.unshift(nr.splice(-j.lgSize,nr.length).join(""));nr.length>j.gSize;)xi.unshift(nr.splice(-j.gSize,nr.length).join(""));nr.length&&xi.unshift(nr.join("")),Kt=xi.join(cr(L,Z)),Fi.length&&(Kt+=cr(L,ve)+Fi.join("")),Do&&(Kt+=cr(L,Ve.Exponential)+"+"+Do)}else Kt=cr(L,Ve.Infinity);return Kt=k<0&&!tr?j.negPre+Kt+j.negSuf:j.posPre+Kt+j.posSuf,Kt}(k,function On(k,j="-"){const L={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},Z=k.split(";"),ve=Z[0],Ge=Z[1],tt=-1!==ve.indexOf(Q)?ve.split(Q):[ve.substring(0,ve.lastIndexOf("0")+1),ve.substring(ve.lastIndexOf("0")+1)],Kt=tt[0],tr=tt[1]||"";L.posPre=Kt.substring(0,Kt.indexOf("#"));for(let $n=0;$n<tr.length;$n++){const rn=tr.charAt($n);"0"===rn?L.minFrac=L.maxFrac=$n+1:"#"===rn?L.maxFrac=$n+1:L.posSuf+=rn}const Tn=Kt.split(",");if(L.gSize=Tn[1]?Tn[1].length:0,L.lgSize=Tn[2]||Tn[1]?(Tn[2]||Tn[1]).length:0,Ge){const $n=ve.length-L.posPre.length-L.posSuf.length,rn=Ge.indexOf("#");L.negPre=Ge.substring(0,rn).replace(/'/g,""),L.negSuf=Ge.slice(rn+$n).replace(/'/g,"")}else L.negPre=j+L.posPre,L.negSuf=L.posSuf;return L}(function ji(k,j){return(0,G.cg1)(k)[G.wAp.NumberFormats][j]}(j,st.Decimal),cr(j,Ve.MinusSign)),j,Ve.Group,Ve.Decimal,L)}(function yo(k){if("string"==typeof k&&!isNaN(Number(k)-parseFloat(k)))return Number(k);if("number"!=typeof k)throw new Error(`${k} is not a number`);return k}(L),ve,Z)}catch(Ge){throw function Qr(k,j){return new G.vHH(2100,!1)}()}}}return k.\u0275fac=function(L){return new(L||k)(G.Y36(G.soG,16))},k.\u0275pipe=G.Yjl({name:"number",type:k,pure:!0,standalone:!0}),k})();let Ua=(()=>{class k{}return k.\u0275fac=function(L){return new(L||k)},k.\u0275mod=G.oAB({type:k}),k.\u0275inj=G.cJS({}),k})();const us="browser";let Va=(()=>{class k{}return k.\u0275prov=(0,G.Yz7)({token:k,providedIn:"root",factory:()=>new ac((0,G.LFG)(Nt),window)}),k})();class ac{constructor(j,L){this.document=j,this.window=L,this.offset=()=>[0,0]}setOffset(j){this.offset=Array.isArray(j)?()=>j:j}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(j){this.supportsScrolling()&&this.window.scrollTo(j[0],j[1])}scrollToAnchor(j){if(!this.supportsScrolling())return;const L=function lc(k,j){const L=k.getElementById(j)||k.getElementsByName(j)[0];if(L)return L;if("function"==typeof k.createTreeWalker&&k.body&&(k.body.createShadowRoot||k.body.attachShadow)){const Z=k.createTreeWalker(k.body,NodeFilter.SHOW_ELEMENT);let ve=Z.currentNode;for(;ve;){const Ge=ve.shadowRoot;if(Ge){const tt=Ge.getElementById(j)||Ge.querySelector(`[name="${j}"]`);if(tt)return tt}ve=Z.nextNode()}}return null}(this.document,j);L&&(this.scrollToElement(L),L.focus())}setHistoryScrollRestoration(j){if(this.supportScrollRestoration()){const L=this.window.history;L&&L.scrollRestoration&&(L.scrollRestoration=j)}}scrollToElement(j){const L=j.getBoundingClientRect(),Z=L.left+this.window.pageXOffset,ve=L.top+this.window.pageYOffset,Ge=this.offset();this.window.scrollTo(Z-Ge[0],ve-Ge[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const j=xo(this.window.history)||xo(Object.getPrototypeOf(this.window.history));return!(!j||!j.writable&&!j.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function xo(k){return Object.getOwnPropertyDescriptor(k,"scrollRestoration")}class hs{}},256:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{tb:()=>ix,AFp:()=>tx,ip1:()=>ex,CZH:()=>Cg,hGG:()=>Gw,z2F:()=>Sg,sBO:()=>Sw,Sil:()=>cw,_Vd:()=>Ph,EJc:()=>aw,Xts:()=>$u,SBq:()=>Rh,lqb:()=>Pc,qLn:()=>Rc,vpe:()=>Gc,XFs:()=>ut,OlP:()=>_r,zs3:()=>ua,ZZ4:()=>ky,aQg:()=>Ly,soG:()=>Ig,YKP:()=>a0,h0i:()=>df,PXZ:()=>ww,R0b:()=>Dl,FiY:()=>Xe,Lbi:()=>iw,g9A:()=>rx,Qsj:()=>n_,FYo:()=>xm,JOm:()=>Pa,tp0:()=>ke,Rgc:()=>Hp,dDg:()=>yw,eoX:()=>hx,GfV:()=>Qf,s_b:()=>Eg,ifc:()=>Re,MMx:()=>ly,Lck:()=>J1,eFA:()=>px,G48:()=>Iw,f3M:()=>V,_c5:()=>$w,c2e:()=>ow,zSh:()=>kd,wAp:()=>Pn,vHH:()=>Pt,lri:()=>cx,rWj:()=>ux,D6c:()=>Hw,cg1:()=>ey,kL8:()=>Rv,dqk:()=>Hn,Z0I:()=>Jr,sIi:()=>wl,CqO:()=>je,QGY:()=>He,QP$:()=>_n,F4k:()=>ht,RDi:()=>xs,AaK:()=>Xt,TTD:()=>Oo,jDz:()=>c0,xp6:()=>op,uIk:()=>Qu,Suo:()=>P0,Xpm:()=>mo,lG2:()=>As,Yz7:()=>Jn,cJS:()=>hi,oAB:()=>ko,Yjl:()=>qo,Y36:()=>kc,_UZ:()=>ae,qZA:()=>me,TgZ:()=>le,EpF:()=>Fe,LFG:()=>ie,$8M:()=>Ul,$Z:()=>up,NdJ:()=>Je,CRH:()=>R0,oxw:()=>cn,ALo:()=>w0,xi3:()=>E0,Q6J:()=>z,s9C:()=>an,WLB:()=>g0,iGM:()=>M0,MAs:()=>F,KtG:()=>Ll,CHM:()=>wo,P3R:()=>pm,YNc:()=>A,_uU:()=>dv,hij:()=>_g,lnq:()=>Q_,Gf:()=>A0});var G=Ae(579),Ee=Ae(727),Rt=Ae(751),u=Ae(189),Te=Ae(421),Gt=Ae(515),Nt=Ae(669),At=Ae(76),mt=Ae(961),Qe=Ae(482);function xn(i,s,...c){if(!0===s)return void i();if(!1===s)return;const p=new mt.Hp({next:()=>{p.unsubscribe(),i()}});return s(...c).subscribe(p)}function wt(i){for(let s in i)if(i[s]===wt)return s;throw Error("Could not find renamed property on target object.")}function Xt(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(Xt).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const s=i.toString();if(null==s)return""+s;const c=s.indexOf("\n");return-1===c?s:s.substring(0,c)}function Lt(i,s){return null==i||""===i?null===s?"":s:null==s||""===s?i:i+" "+s}const et=wt({__forward_ref__:wt});function Yn(i){return i.__forward_ref__=Yn,i.toString=function(){return Xt(this())},i}function Ut(i){return function Zt(i){return"function"==typeof i&&i.hasOwnProperty(et)&&i.__forward_ref__===Yn}(i)?i():i}function qe(i){return i&&!!i.\u0275providers}class Pt extends Error{constructor(s,c){super(function tn(i,s){return`NG0${Math.abs(i)}${s?": "+s.trim():""}`}(s,c)),this.code=s}}function st(i){return"string"==typeof i?i:null==i?"":String(i)}function Ve(i,s){throw new Pt(-201,!1)}function mn(i,s){null==i&&function Sn(i,s,c,p){throw new Error(`ASSERTION ERROR: ${i}`+(null==p?"":` [Expected=> ${c} ${p} ${s} <=Actual]`))}(s,i,null,"!=")}function Jn(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function hi(i){return{providers:i.providers||[],imports:i.imports||[]}}function $i(i){return Pr(i,Ji)||Pr(i,bn)}function Jr(i){return null!==$i(i)}function Pr(i,s){return i.hasOwnProperty(s)?i[s]:null}function ss(i){return i&&(i.hasOwnProperty(_i)||i.hasOwnProperty(ur))?i[_i]:null}const Ji=wt({\u0275prov:wt}),_i=wt({\u0275inj:wt}),bn=wt({ngInjectableDef:wt}),ur=wt({ngInjectorDef:wt});var ut=(()=>((ut=ut||{})[ut.Default=0]="Default",ut[ut.Host=1]="Host",ut[ut.Self=2]="Self",ut[ut.SkipSelf=4]="SkipSelf",ut[ut.Optional=8]="Optional",ut))();let un;function xr(i){const s=un;return un=i,s}function Zn(i,s,c){const p=$i(i);return p&&"root"==p.providedIn?void 0===p.value?p.value=p.factory():p.value:c&ut.Optional?null:void 0!==s?s:void Ve(Xt(i))}const Hn=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Rn={},di="__NG_DI_FLAG__",Ri="ngTempTokenPath",ho=/\n/gm,ii="__source";let ki;function yi(i){const s=ki;return ki=i,s}function fo(i,s=ut.Default){if(void 0===ki)throw new Pt(-203,!1);return null===ki?Zn(i,void 0,s):ki.get(i,s&ut.Optional?null:void 0,s)}function ie(i,s=ut.Default){return(function Ss(){return un}()||fo)(Ut(i),s)}function V(i,s=ut.Default){return ie(i,oe(s))}function oe(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function he(i){const s=[];for(let c=0;c<i.length;c++){const p=Ut(i[c]);if(Array.isArray(p)){if(0===p.length)throw new Pt(900,!1);let y,b=ut.Default;for(let C=0;C<p.length;C++){const M=p[C],O=Pe(M);"number"==typeof O?-1===O?y=M.token:b|=O:y=M}s.push(ie(y,b))}else s.push(ie(p))}return s}function ye(i,s){return i[di]=s,i.prototype[di]=s,i}function Pe(i){return i[di]}function Q(i){return{toString:i}.toString()}var ee=(()=>((ee=ee||{})[ee.OnPush=0]="OnPush",ee[ee.Default=1]="Default",ee))(),Re=(()=>{return(i=Re||(Re={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",Re;var i})();const rt={},We=[],Ot=wt({\u0275cmp:wt}),nn=wt({\u0275dir:wt}),Ln=wt({\u0275pipe:wt}),Jt=wt({\u0275mod:wt}),On=wt({\u0275fac:wt}),qn=wt({__NG_ELEMENT_ID__:wt});let po=0;function mo(i){return Q(()=>{const c=!0===i.standalone,p={},y={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:p,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===ee.OnPush,directiveDefs:null,pipeDefs:null,standalone:c,dependencies:c&&i.dependencies||null,getStandaloneInjector:null,selectors:i.selectors||We,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||Re.Emulated,id:"c"+po++,styles:i.styles||We,_:null,setInput:null,schemas:i.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},b=i.dependencies,C=i.features;return y.inputs=Li(i.inputs,p),y.outputs=Li(i.outputs),C&&C.forEach(M=>M(y)),y.directiveDefs=b?()=>("function"==typeof b?b():b).map(Qi).filter(Rr):null,y.pipeDefs=b?()=>("function"==typeof b?b():b).map(on).filter(Rr):null,y})}function Qi(i){return Un(i)||dt(i)}function Rr(i){return null!==i}function ko(i){return Q(()=>({type:i.type,bootstrap:i.bootstrap||We,declarations:i.declarations||We,imports:i.imports||We,exports:i.exports||We,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Li(i,s){if(null==i)return rt;const c={};for(const p in i)if(i.hasOwnProperty(p)){let y=i[p],b=y;Array.isArray(y)&&(b=y[1],y=y[0]),c[y]=p,s&&(s[y]=b)}return c}const As=mo;function qo(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function Un(i){return i[Ot]||null}function dt(i){return i[nn]||null}function on(i){return i[Ln]||null}function _n(i){const s=Un(i)||dt(i)||on(i);return null!==s&&s.standalone}function kr(i,s){const c=i[Jt]||null;if(!c&&!0===s)throw new Error(`Type ${Xt(i)} does not have '\u0275mod' property.`);return c}function zr(i){return Array.isArray(i)&&"object"==typeof i[1]}function ai(i){return Array.isArray(i)&&!0===i[1]}function cs(i){return 0!=(4&i.flags)}function _a(i){return i.componentOffset>-1}function Os(i){return 1==(1&i.flags)}function li(i){return null!==i.template}function ya(i){return 0!=(256&i[2])}function no(i,s){return i.hasOwnProperty(On)?i[On]:null}class $a{constructor(s,c,p){this.previousValue=s,this.currentValue=c,this.firstChange=p}isFirstChange(){return this.firstChange}}function Oo(){return Xo}function Xo(i){return i.type.prototype.ngOnChanges&&(i.setInput=zs),Ga}function Ga(){const i=Bs(this),s=i?.current;if(s){const c=i.previous;if(c===rt)i.previous=s;else for(let p in s)c[p]=s[p];i.current=null,this.ngOnChanges(s)}}function zs(i,s,c,p){const y=this.declaredInputs[c],b=Bs(i)||function va(i,s){return i[Ha]=s}(i,{previous:rt,current:null}),C=b.current||(b.current={}),M=b.previous,O=M[y];C[y]=new $a(O&&O.currentValue,s,M===rt),i[p]=s}Oo.ngInherit=!0;const Ha="__ngSimpleChanges__";function Bs(i){return i[Ha]||null}function Br(i){for(;Array.isArray(i);)i=i[0];return i}function vi(i,s){return Br(s[i.index])}function Ks(i,s){return i.data[s]}function bo(i,s){return i[s]}function er(i,s){const c=s[i];return zr(c)?c:c[0]}function io(i){return 64==(64&i[2])}function fs(i,s){return null==s?null:i[s]}function Wa(i){i[18]=0}function Ko(i,s){i[5]+=s;let c=i,p=i[3];for(;null!==p&&(1===s&&1===c[5]||-1===s&&0===c[5]);)p[5]+=s,c=p,p=p[3]}const sn={lFrame:Z(null),bindingsEnabled:!0};function kl(){return sn.bindingsEnabled}function lt(){return sn.lFrame.lView}function Vn(){return sn.lFrame.tView}function wo(i){return sn.lFrame.contextLView=i,i[8]}function Ll(i){return sn.lFrame.contextLView=null,i}function ti(){let i=Ol();for(;null!==i&&64===i.type;)i=i.parent;return i}function Ol(){return sn.lFrame.currentTNode}function oo(i,s){const c=sn.lFrame;c.currentTNode=i,c.isParent=s}function Ja(){return sn.lFrame.isParent}function fi(){const i=sn.lFrame;let s=i.bindingRootIndex;return-1===s&&(s=i.bindingRootIndex=i.tView.bindingStartIndex),s}function Bo(){return sn.lFrame.bindingIndex++}function Hc(i,s){const c=sn.lFrame;c.bindingIndex=c.bindingRootIndex=i,Jo(s)}function Jo(i){sn.lFrame.currentDirectiveIndex=i}function Qs(){return sn.lFrame.currentQueryIndex}function Gi(i){sn.lFrame.currentQueryIndex=i}function ea(i){const s=i[1];return 2===s.type?s.declTNode:1===s.type?i[6]:null}function k(i,s,c){if(c&ut.SkipSelf){let y=s,b=i;for(;!(y=y.parent,null!==y||c&ut.Host||(y=ea(b),null===y||(b=b[15],10&y.type))););if(null===y)return!1;s=y,i=b}const p=sn.lFrame=L();return p.currentTNode=s,p.lView=i,!0}function j(i){const s=L(),c=i[1];sn.lFrame=s,s.currentTNode=c.firstChild,s.lView=i,s.tView=c,s.contextLView=i,s.bindingIndex=c.bindingStartIndex,s.inI18n=!1}function L(){const i=sn.lFrame,s=null===i?null:i.child;return null===s?Z(i):s}function Z(i){const s={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=s),s}function ve(){const i=sn.lFrame;return sn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const Ge=ve;function tt(){const i=ve();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Tn(){return sn.lFrame.selectedIndex}function $n(i){sn.lFrame.selectedIndex=i}function rn(){const i=sn.lFrame;return Ks(i.tView,i.selectedIndex)}function bi(i,s){for(let c=s.directiveStart,p=s.directiveEnd;c<p;c++){const b=i.data[c].type.prototype,{ngAfterContentInit:C,ngAfterContentChecked:M,ngAfterViewInit:O,ngAfterViewChecked:N,ngOnDestroy:q}=b;C&&(i.contentHooks||(i.contentHooks=[])).push(-c,C),M&&((i.contentHooks||(i.contentHooks=[])).push(c,M),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(c,M)),O&&(i.viewHooks||(i.viewHooks=[])).push(-c,O),N&&((i.viewHooks||(i.viewHooks=[])).push(c,N),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(c,N)),null!=q&&(i.destroyHooks||(i.destroyHooks=[])).push(c,q)}}function Tt(i,s,c){Zc(i,s,3,c)}function ni(i,s,c,p){(3&i[2])===c&&Zc(i,s,c,p)}function js(i,s){let c=i[2];(3&c)===s&&(c&=2047,c+=1,i[2]=c)}function Zc(i,s,c,p){const b=p??-1,C=s.length-1;let M=0;for(let O=void 0!==p?65535&i[18]:0;O<C;O++)if("number"==typeof s[O+1]){if(M=s[O],null!=p&&M>=p)break}else s[O]<0&&(i[18]+=65536),(M<b||-1==b)&&(qc(i,c,s,O),i[18]=(4294901760&i[18])+O+2),O++}function qc(i,s,c,p){const y=c[p]<0,b=c[p+1],M=i[y?-c[p]:c[p]];if(y){if(i[2]>>11<i[18]>>16&&(3&i[2])===s){i[2]+=2048;try{b.call(M)}finally{}}}else try{b.call(M)}finally{}}class tl{constructor(s,c,p){this.factory=s,this.resolving=!1,this.canSeeViewProviders=c,this.injectImpl=p}}function _c(i,s,c){let p=0;for(;p<c.length;){const y=c[p];if("number"==typeof y){if(0!==y)break;p++;const b=c[p++],C=c[p++],M=c[p++];i.setAttribute(s,C,M,b)}else{const b=y,C=c[++p];Ea(b)?i.setProperty(s,b,C):i.setAttribute(s,b,C),p++}}return p}function Fl(i){return 3===i||4===i||6===i}function Ea(i){return 64===i.charCodeAt(0)}function il(i,s){if(null!==s&&0!==s.length)if(null===i||0===i.length)i=s.slice();else{let c=-1;for(let p=0;p<s.length;p++){const y=s[p];"number"==typeof y?c=y:0===c||ol(i,c,y,null,-1===c||2===c?s[++p]:null)}}return i}function ol(i,s,c,p,y){let b=0,C=i.length;if(-1===s)C=-1;else for(;b<i.length;){const M=i[b++];if("number"==typeof M){if(M===s){C=-1;break}if(M>s){C=b-1;break}}}for(;b<i.length;){const M=i[b];if("number"==typeof M)break;if(M===c){if(null===p)return void(null!==y&&(i[b+1]=y));if(p===i[b+1])return void(i[b+2]=y)}b++,null!==p&&b++,null!==y&&b++}-1!==C&&(i.splice(C,0,s),b=C+1),i.splice(b++,0,c),null!==p&&i.splice(b++,0,p),null!==y&&i.splice(b++,0,y)}function gs(i){return-1!==i}function Uo(i){return 32767&i}function ta(i,s){let c=function Su(i){return i>>16}(i),p=s;for(;c>0;)p=p[15],c--;return p}let sl=!0;function zl(i){const s=sl;return sl=i,s}let yc=0;const so={};function al(i,s){const c=wi(i,s);if(-1!==c)return c;const p=s[1];p.firstCreatePass&&(i.injectorIndex=s.length,ci(p.data,i),ci(s,null),ci(p.blueprint,null));const y=Da(i,s),b=i.injectorIndex;if(gs(y)){const C=Uo(y),M=ta(y,s),O=M[1].data;for(let N=0;N<8;N++)s[b+N]=M[C+N]|O[C+N]}return s[b+8]=y,b}function ci(i,s){i.push(0,0,0,0,0,0,0,0,s)}function wi(i,s){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===s[i.injectorIndex+8]?-1:i.injectorIndex}function Da(i,s){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let c=0,p=null,y=s;for(;null!==y;){if(p=Nl(y),null===p)return-1;if(c++,y=y[15],-1!==p.injectorIndex)return p.injectorIndex|c<<16}return-1}function Ta(i,s,c){!function Kc(i,s,c){let p;"string"==typeof c?p=c.charCodeAt(0)||0:c.hasOwnProperty(qn)&&(p=c[qn]),null==p&&(p=c[qn]=yc++);const y=255&p;s.data[i+(y>>5)]|=1<<y}(i,s,c)}function Au(i,s,c){if(c&ut.Optional||void 0!==i)return i;Ve()}function Qo(i,s,c,p){if(c&ut.Optional&&void 0===p&&(p=null),0==(c&(ut.Self|ut.Host))){const y=i[9],b=xr(void 0);try{return y?y.get(s,p,c&ut.Optional):Zn(s,p,c&ut.Optional)}finally{xr(b)}}return Au(p,0,c)}function Jc(i,s,c,p=ut.Default,y){if(null!==i){if(1024&s[2]){const C=function sh(i,s,c,p,y){let b=i,C=s;for(;null!==b&&null!==C&&1024&C[2]&&!(256&C[2]);){const M=ll(b,C,c,p|ut.Self,so);if(M!==so)return M;let O=b.parent;if(!O){const N=C[21];if(N){const q=N.get(c,so,p);if(q!==so)return q}O=Nl(C),C=C[15]}b=O}return y}(i,s,c,p,so);if(C!==so)return C}const b=ll(i,s,c,p,so);if(b!==so)return b}return Qo(s,c,p,y)}function ll(i,s,c,p,y){const b=function Ca(i){if("string"==typeof i)return i.charCodeAt(0)||0;const s=i.hasOwnProperty(qn)?i[qn]:void 0;return"number"==typeof s?s>=0?255&s:vc:s}(c);if("function"==typeof b){if(!k(s,i,p))return p&ut.Host?Au(y,0,p):Qo(s,c,p,y);try{const C=b(p);if(null!=C||p&ut.Optional)return C;Ve()}finally{Ge()}}else if("number"==typeof b){let C=null,M=wi(i,s),O=-1,N=p&ut.Host?s[16][6]:null;for((-1===M||p&ut.SkipSelf)&&(O=-1===M?Da(i,s):s[M+8],-1!==O&&Ia(p,!1)?(C=s[1],M=Uo(O),s=ta(O,s)):M=-1);-1!==M;){const q=s[1];if(Pu(b,M,q.data)){const ce=_s(M,s,c,C,p,N);if(ce!==so)return ce}O=s[M+8],-1!==O&&Ia(p,s[1].data[M+8]===N)&&Pu(b,M,s)?(C=q,M=Uo(O),s=ta(O,s)):M=-1}}return y}function _s(i,s,c,p,y,b){const C=s[1],M=C.data[i+8],q=$s(M,C,c,null==p?_a(M)&&sl:p!=C&&0!=(3&M.type),y&ut.Host&&b===M);return null!==q?St(s,C,q,M):so}function $s(i,s,c,p,y){const b=i.providerIndexes,C=s.data,M=1048575&b,O=i.directiveStart,q=b>>20,De=y?M+q:i.directiveEnd;for(let ze=p?M:M+q;ze<De;ze++){const it=C[ze];if(ze<O&&c===it||ze>=O&&it.type===c)return ze}if(y){const ze=C[O];if(ze&&li(ze)&&ze.type===c)return O}return null}function St(i,s,c,p){let y=i[c];const b=s.data;if(function gc(i){return i instanceof tl}(y)){const C=y;C.resolving&&function Ie(i,s){const c=s?`. Dependency path: ${s.join(" > ")} > ${i}`:"";throw new Pt(-200,`Circular dependency in DI detected for ${i}${c}`)}(function kt(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():st(i)}(b[c]));const M=zl(C.canSeeViewProviders);C.resolving=!0;const O=C.injectImpl?xr(C.injectImpl):null;k(i,p,ut.Default);try{y=i[c]=C.factory(void 0,b,i,p),s.firstCreatePass&&c>=p.directiveStart&&function xi(i,s,c){const{ngOnChanges:p,ngOnInit:y,ngDoCheck:b}=s.type.prototype;if(p){const C=Xo(s);(c.preOrderHooks||(c.preOrderHooks=[])).push(i,C),(c.preOrderCheckHooks||(c.preOrderCheckHooks=[])).push(i,C)}y&&(c.preOrderHooks||(c.preOrderHooks=[])).push(0-i,y),b&&((c.preOrderHooks||(c.preOrderHooks=[])).push(i,b),(c.preOrderCheckHooks||(c.preOrderCheckHooks=[])).push(i,b))}(c,b[c],s)}finally{null!==O&&xr(O),zl(M),C.resolving=!1,Ge()}}return y}function Pu(i,s,c){return!!(c[s+(i>>5)]&1<<i)}function Ia(i,s){return!(i&ut.Self||i&ut.Host&&s)}class Ei{constructor(s,c){this._tNode=s,this._lView=c}get(s,c,p){return Jc(this._tNode,this._lView,s,oe(p),c)}}function vc(){return new Ei(ti(),lt())}function Nl(i){const s=i[1],c=s.type;return 2===c?s.declTNode:1===c?i[6]:null}function Ul(i){return function Mu(i,s){if("class"===s)return i.classes;if("style"===s)return i.styles;const c=i.attrs;if(c){const p=c.length;let y=0;for(;y<p;){const b=c[y];if(Fl(b))break;if(0===b)y+=2;else if("number"==typeof b)for(y++;y<p&&"string"==typeof c[y];)y++;else{if(b===s)return c[y+1];y+=2}}}return null}(ti(),i)}const vs="__parameters__";function Hs(i,s,c){return Q(()=>{const p=function Sa(i){return function(...c){if(i){const p=i(...c);for(const y in p)this[y]=p[y]}}}(s);function y(...b){if(this instanceof y)return p.apply(this,b),this;const C=new y(...b);return M.annotation=C,M;function M(O,N,q){const ce=O.hasOwnProperty(vs)?O[vs]:Object.defineProperty(O,vs,{value:[]})[vs];for(;ce.length<=q;)ce.push(null);return(ce[q]=ce[q]||[]).push(C),O}}return c&&(y.prototype=Object.create(c.prototype)),y.prototype.ngMetadataName=i,y.annotationCls=y,y})}class _r{constructor(s,c){this._desc=s,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof c?this.__NG_ELEMENT_ID__=c:void 0!==c&&(this.\u0275prov=Jn({token:this,providedIn:c.providedIn||"root",factory:c.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function d(i,s){void 0===s&&(s=i);for(let c=0;c<i.length;c++){let p=i[c];Array.isArray(p)?(s===i&&(s=i.slice(0,c)),d(p,s)):s!==i&&s.push(p)}return s}function g(i,s){i.forEach(c=>Array.isArray(c)?g(c,s):s(c))}function v(i,s,c){s>=i.length?i.push(c):i.splice(s,0,c)}function E(i,s){return s>=i.length-1?i.pop():i.splice(s,1)[0]}const Xe=ye(Hs("Optional"),8),ke=ye(Hs("SkipSelf"),4);var Pa=(()=>((Pa=Pa||{})[Pa.Important=1]="Important",Pa[Pa.DashCase=2]="DashCase",Pa))();const _d=new Map;let Yp=0;const yd="__ngContext__";function Co(i,s){zr(s)?(i[yd]=s[20],function Jp(i){_d.set(i[20],i)}(s)):i[yd]=s}function gh(i,s){return undefined(i,s)}function rs(i){const s=i[3];return ai(s)?s[3]:s}function Hl(i){return tm(i[13])}function Tf(i){return tm(i[4])}function tm(i){for(;null!==i&&!ai(i);)i=i[4];return i}function Ou(i,s,c,p,y){if(null!=p){let b,C=!1;ai(p)?b=p:zr(p)&&(C=!0,p=p[0]);const M=Br(p);0===i&&null!==c?null==y?Mf(s,c,M):$o(s,c,M,y||null,!0):1===i&&null!==c?$o(s,c,M,y||null,!0):2===i?function Rf(i,s,c){const p=Fu(i,s);p&&function Af(i,s,c,p){i.removeChild(s,c,p)}(i,p,s,c)}(s,M,C):3===i&&s.destroyNode(M),null!=b&&function Lf(i,s,c,p,y){const b=c[7];b!==Br(c)&&Ou(s,i,p,b,y);for(let M=10;M<c.length;M++){const O=c[M];xh(O[1],O,i,s,p,b)}}(s,i,b,c,y)}}function Cf(i,s,c){return i.createElement(s,c)}function If(i,s){const c=i[9],p=c.indexOf(s),y=s[3];512&s[2]&&(s[2]&=-513,Ko(y,-1)),c.splice(p,1)}function vh(i,s){if(i.length<=10)return;const c=10+s,p=i[c];if(p){const y=p[17];null!==y&&y!==i&&If(y,p),s>0&&(i[c-1][4]=p[4]);const b=E(i,10+s);!function Og(i,s){xh(i,s,s[11],2,null,null),s[0]=null,s[6]=null}(p[1],p);const C=b[19];null!==C&&C.detachView(b[1]),p[3]=null,p[4]=null,p[2]&=-65}return p}function ka(i,s){if(!(128&s[2])){const c=s[11];c.destroyNode&&xh(i,s,c,3,null,null),function Dc(i){let s=i[13];if(!s)return oa(i[1],i);for(;s;){let c=null;if(zr(s))c=s[13];else{const p=s[10];p&&(c=p)}if(!c){for(;s&&!s[4]&&s!==i;)zr(s)&&oa(s[1],s),s=s[3];null===s&&(s=i),zr(s)&&oa(s[1],s),c=s&&s[4]}s=c}}(s)}}function oa(i,s){if(!(128&s[2])){s[2]&=-65,s[2]|=128,function Zs(i,s){let c;if(null!=i&&null!=(c=i.destroyHooks))for(let p=0;p<c.length;p+=2){const y=s[c[p]];if(!(y instanceof tl)){const b=c[p+1];if(Array.isArray(b))for(let C=0;C<b.length;C+=2){const M=y[b[C]],O=b[C+1];try{O.call(M)}finally{}}else try{b.call(y)}finally{}}}}(i,s),function sa(i,s){const c=i.cleanup,p=s[7];let y=-1;if(null!==c)for(let b=0;b<c.length-1;b+=2)if("string"==typeof c[b]){const C=c[b+1],M="function"==typeof C?C(s):Br(s[C]),O=p[y=c[b+2]],N=c[b+3];"boolean"==typeof N?M.removeEventListener(c[b],O,N):N>=0?p[y=N]():p[y=-N].unsubscribe(),b+=2}else{const C=p[y=c[b+1]];c[b].call(C)}if(null!==p){for(let b=y+1;b<p.length;b++)(0,p[b])();s[7]=null}}(i,s),1===s[1].type&&s[11].destroy();const c=s[17];if(null!==c&&ai(s[3])){c!==s[3]&&If(c,s);const p=s[19];null!==p&&p.detachView(i)}!function Qp(i){_d.delete(i[20])}(s)}}function Zi(i,s,c){return function Sf(i,s,c){let p=s;for(;null!==p&&40&p.type;)p=(s=p).parent;if(null===p)return c[0];{const{componentOffset:y}=p;if(y>-1){const{encapsulation:b}=i.data[p.directiveStart+y];if(b===Re.None||b===Re.Emulated)return null}return vi(p,c)}}(i,s.parent,c)}function $o(i,s,c,p,y){i.insertBefore(s,c,p,y)}function Mf(i,s,c){i.appendChild(s,c)}function nu(i,s,c,p,y){null!==p?$o(i,s,c,p,y):Mf(i,s,c)}function Fu(i,s){return i.parentNode(s)}let zu,bh,nm=function Pf(i,s,c){return 40&i.type?vi(i,c):null};function ru(i,s,c,p){const y=Zi(i,p,s),b=s[11],M=function bd(i,s,c){return nm(i,s,c)}(p.parent||s[6],p,s);if(null!=y)if(Array.isArray(c))for(let O=0;O<c.length;O++)nu(b,y,c[O],M,!1);else nu(b,y,c,M,!1)}function iu(i,s){if(null!==s){const c=s.type;if(3&c)return vi(s,i);if(4&c)return Ed(-1,i[s.index]);if(8&c){const p=s.child;if(null!==p)return iu(i,p);{const y=i[s.index];return ai(y)?Ed(-1,y):Br(y)}}if(32&c)return gh(s,i)()||Br(i[s.index]);{const p=wd(i,s);return null!==p?Array.isArray(p)?p[0]:iu(rs(i[16]),p):iu(i,s.next)}}return null}function wd(i,s){return null!==s?i[16][6].projection[s.projection]:null}function Ed(i,s){const c=10+i+1;if(c<s.length){const p=s[c],y=p[1].firstChild;if(null!==y)return iu(p,y)}return s[7]}function Dd(i,s,c,p,y,b,C){for(;null!=c;){const M=p[c.index],O=c.type;if(C&&0===s&&(M&&Co(Br(M),p),c.flags|=2),32!=(32&c.flags))if(8&O)Dd(i,s,c.child,p,y,b,!1),Ou(s,i,y,M,b);else if(32&O){const N=gh(c,p);let q;for(;q=N();)Ou(s,i,y,q,b);Ou(s,i,y,M,b)}else 16&O?rm(i,s,p,c,y,b):Ou(s,i,y,M,b);c=C?c.projectionNext:c.next}}function xh(i,s,c,p,y,b){Dd(c,p,i.firstChild,s,y,b,!1)}function rm(i,s,c,p,y,b){const C=c[16],O=C[6].projection[p.projection];if(Array.isArray(O))for(let N=0;N<O.length;N++)Ou(s,i,y,O[N],b);else Dd(i,s,O,C[3],y,b,!0)}function Cc(i,s,c){""===c?i.removeAttribute(s,"class"):i.setAttribute(s,"class",c)}function Of(i,s,c){const{mergedAttrs:p,classes:y,styles:b}=c;null!==p&&_c(i,s,p),null!==y&&Cc(i,s,y),null!==b&&function om(i,s,c){i.setAttribute(s,"style",c)}(i,s,b)}function xs(i){zu=i}function Bu(i){return function aa(){if(void 0===bh&&(bh=null,Hn.trustedTypes))try{bh=Hn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return bh}()?.createScriptURL(i)||i}class Sc{constructor(s){this.changingThisBreaksApplicationSecurity=s}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function fl(i){return i instanceof Sc?i.changingThisBreaksApplicationSecurity:i}function Nu(i,s){const c=function wh(i){return i instanceof Sc&&i.getTypeName()||null}(i);if(null!=c&&c!==s){if("ResourceURL"===c&&"URL"===s)return!0;throw new Error(`Required a safe ${s}, got a ${c} (see https://g.co/ng/security#xss)`)}return c===s}const la=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Bi=(()=>((Bi=Bi||{})[Bi.NONE=0]="NONE",Bi[Bi.HTML=1]="HTML",Bi[Bi.STYLE=2]="STYLE",Bi[Bi.SCRIPT=3]="SCRIPT",Bi[Bi.URL=4]="URL",Bi[Bi.RESOURCE_URL=5]="RESOURCE_URL",Bi))();function Vf(i){const s=Wl();return s?s.sanitize(Bi.URL,i)||"":Nu(i,"URL")?fl(i):function Th(i){return(i=String(i)).match(la)?i:"unsafe:"+i}(st(i))}function Pd(i){const s=Wl();if(s)return Bu(s.sanitize(Bi.RESOURCE_URL,i)||"");if(Nu(i,"ResourceURL"))return Bu(fl(i));throw new Pt(904,!1)}function pm(i,s,c){return function $f(i,s){return"src"===s&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===s&&("base"===i||"link"===i)?Pd:Vf}(s,c)(i)}function Wl(){const i=lt();return i&&i[12]}const $u=new _r("ENVIRONMENT_INITIALIZER"),Gf=new _r("INJECTOR",-1),Ac=new _r("INJECTOR_DEF_TYPES");class Gu{get(s,c=Rn){if(c===Rn){const p=new Error(`NullInjectorError: No provider for ${Xt(s)}!`);throw p.name="NullInjectorError",p}return c}}function Xg(...i){return{\u0275providers:mm(0,i),\u0275fromNgModule:!0}}function mm(i,...s){const c=[],p=new Set;let y;return g(s,b=>{const C=b;Hf(C,c,[],p)&&(y||(y=[]),y.push(C))}),void 0!==y&&gm(y,c),c}function gm(i,s){for(let c=0;c<i.length;c++){const{providers:y}=i[c];Zf(y,b=>{s.push(b)})}}function Hf(i,s,c,p){if(!(i=Ut(i)))return!1;let y=null,b=ss(i);const C=!b&&Un(i);if(b||C){if(C&&!C.standalone)return!1;y=i}else{const O=i.ngModule;if(b=ss(O),!b)return!1;y=O}const M=p.has(y);if(C){if(M)return!1;if(p.add(y),C.dependencies){const O="function"==typeof C.dependencies?C.dependencies():C.dependencies;for(const N of O)Hf(N,s,c,p)}}else{if(!b)return!1;{if(null!=b.imports&&!M){let N;p.add(y);try{g(b.imports,q=>{Hf(q,s,c,p)&&(N||(N=[]),N.push(q))})}finally{}void 0!==N&&gm(N,s)}if(!M){const N=no(y)||(()=>new y);s.push({provide:y,useFactory:N,deps:We},{provide:Ac,useValue:y,multi:!0},{provide:$u,useValue:()=>ie(y),multi:!0})}const O=b.providers;null==O||M||Zf(O,q=>{s.push(q)})}}return y!==i&&void 0!==i.providers}function Zf(i,s){for(let c of i)qe(c)&&(c=c.\u0275providers),Array.isArray(c)?Zf(c,s):s(c)}const qf=wt({provide:String,useValue:wt});function Wf(i){return null!==i&&"object"==typeof i&&qf in i}function Ur(i){return"function"==typeof i}const kd=new _r("Set Injector scope."),au={},Ld={};let lu;function Ih(){return void 0===lu&&(lu=new Gu),lu}class Pc{}class Hu extends Pc{constructor(s,c,p,y){super(),this.parent=c,this.source=p,this.scopes=y,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Mh(s,C=>this.processProvider(C)),this.records.set(Gf,pl(void 0,this)),y.has("environment")&&this.records.set(Pc,pl(void 0,this));const b=this.records.get(kd);null!=b&&"string"==typeof b.value&&this.scopes.add(b.value),this.injectorDefTypes=new Set(this.get(Ac.multi,We,ut.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const s of this._ngOnDestroyHooks)s.ngOnDestroy();for(const s of this._onDestroyHooks)s()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(s){this._onDestroyHooks.push(s)}runInContext(s){this.assertNotDestroyed();const c=yi(this),p=xr(void 0);try{return s()}finally{yi(c),xr(p)}}get(s,c=Rn,p=ut.Default){this.assertNotDestroyed(),p=oe(p);const y=yi(this),b=xr(void 0);try{if(!(p&ut.SkipSelf)){let M=this.records.get(s);if(void 0===M){const O=function Jg(i){return"function"==typeof i||"object"==typeof i&&i instanceof _r}(s)&&$i(s);M=O&&this.injectableDefInScope(O)?pl(Sh(s),au):null,this.records.set(s,M)}if(null!=M)return this.hydrate(s,M)}return(p&ut.Self?Ih():this.parent).get(s,c=p&ut.Optional&&c===Rn?null:c)}catch(C){if("NullInjectorError"===C.name){if((C[Ri]=C[Ri]||[]).unshift(Xt(s)),y)throw C;return function Me(i,s,c,p){const y=i[Ri];throw s[ii]&&y.unshift(s[ii]),i.message=function we(i,s,c,p=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.slice(2):i;let y=Xt(s);if(Array.isArray(s))y=s.map(Xt).join(" -> ");else if("object"==typeof s){let b=[];for(let C in s)if(s.hasOwnProperty(C)){let M=s[C];b.push(C+":"+("string"==typeof M?JSON.stringify(M):Xt(M)))}y=`{${b.join(", ")}}`}return`${c}${p?"("+p+")":""}[${y}]: ${i.replace(ho,"\n  ")}`}("\n"+i.message,y,c,p),i.ngTokenPath=y,i[Ri]=null,i}(C,s,"R3InjectorError",this.source)}throw C}finally{xr(b),yi(y)}}resolveInjectorInitializers(){const s=yi(this),c=xr(void 0);try{const p=this.get($u.multi,We,ut.Self);for(const y of p)y()}finally{yi(s),xr(c)}}toString(){const s=[],c=this.records;for(const p of c.keys())s.push(Xt(p));return`R3Injector[${s.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Pt(205,!1)}processProvider(s){let c=Ur(s=Ut(s))?s:Ut(s&&s.provide);const p=function Yg(i){return Wf(i)?pl(void 0,i.useValue):pl(function Yf(i,s,c){let p;if(Ur(i)){const y=Ut(i);return no(y)||Sh(y)}if(Wf(i))p=()=>Ut(i.useValue);else if(function _m(i){return!(!i||!i.useFactory)}(i))p=()=>i.useFactory(...he(i.deps||[]));else if(function su(i){return!(!i||!i.useExisting)}(i))p=()=>ie(Ut(i.useExisting));else{const y=Ut(i&&(i.useClass||i.provide));if(!function Kg(i){return!!i.deps}(i))return no(y)||Sh(y);p=()=>new y(...he(i.deps))}return p}(i),au)}(s);if(Ur(s)||!0!==s.multi)this.records.get(c);else{let y=this.records.get(c);y||(y=pl(void 0,au,!0),y.factory=()=>he(y.multi),this.records.set(c,y)),c=s,y.multi.push(s)}this.records.set(c,p)}hydrate(s,c){return c.value===au&&(c.value=Ld,c.value=c.factory()),"object"==typeof c.value&&c.value&&function Kf(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(c.value)&&this._ngOnDestroyHooks.add(c.value),c.value}injectableDefInScope(s){if(!s.providedIn)return!1;const c=Ut(s.providedIn);return"string"==typeof c?"any"===c||this.scopes.has(c):this.injectorDefTypes.has(c)}}function Sh(i){const s=$i(i),c=null!==s?s.factory:no(i);if(null!==c)return c;if(i instanceof _r)throw new Pt(204,!1);if(i instanceof Function)return function Xf(i){const s=i.length;if(s>0)throw function T(i,s){const c=[];for(let p=0;p<i;p++)c.push(s);return c}(s,"?"),new Pt(204,!1);const c=function uo(i){const s=i&&(i[Ji]||i[bn]);if(s){const c=function Is(i){if(i.hasOwnProperty("name"))return i.name;const s=(""+i).match(/^function\s*([^\s(]+)/);return null===s?"":s[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${c}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${c}" class.`),s}return null}(i);return null!==c?()=>c.factory(i):()=>new i}(i);throw new Pt(204,!1)}function pl(i,s,c=!1){return{factory:i,value:s,multi:c?[]:void 0}}function Mh(i,s){for(const c of i)Array.isArray(c)?Mh(c,s):c&&qe(c)?Mh(c.\u0275providers,s):s(c)}class Jf{}class Ah{}class e_{resolveComponentFactory(s){throw function Qg(i){const s=Error(`No component factory found for ${Xt(i)}. Did you add it to @NgModule.entryComponents?`);return s.ngComponent=i,s}(s)}}let Ph=(()=>{class i{}return i.NULL=new e_,i})();function t_(){return Xl(ti(),lt())}function Xl(i,s){return new Rh(vi(i,s))}let Rh=(()=>{class i{constructor(c){this.nativeElement=c}}return i.__NG_ELEMENT_ID__=t_,i})();function vm(i){return i instanceof Rh?i.nativeElement:i}class xm{}let n_=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function r_(){const i=lt(),c=er(ti().index,i);return(zr(c)?c:i)[11]}(),i})(),bm=(()=>{class i{}return i.\u0275prov=Jn({token:i,providedIn:"root",factory:()=>null}),i})();class Qf{constructor(s){this.full=s,this.major=s.split(".")[0],this.minor=s.split(".")[1],this.patch=s.split(".").slice(2).join(".")}}const i_=new Qf("15.0.0"),ep={};function Zu(i){return i.ngOriginalError}class Rc{constructor(){this._console=console}handleError(s){const c=this._findOriginalError(s);this._console.error("ERROR",s),c&&this._console.error("ORIGINAL ERROR",c)}_findOriginalError(s){let c=s&&Zu(s);for(;c&&Zu(c);)c=Zu(c);return c||null}}function ml(i){return i instanceof Function?i():i}function Cm(i,s,c){let p=i.length;for(;;){const y=i.indexOf(s,c);if(-1===y)return y;if(0===y||i.charCodeAt(y-1)<=32){const b=s.length;if(y+b===p||i.charCodeAt(y+b)<=32)return y}c=y+1}}const zh="ng-template";function Im(i,s,c){let p=0;for(;p<i.length;){let y=i[p++];if(c&&"class"===y){if(y=i[p],-1!==Cm(y.toLowerCase(),s,0))return!0}else if(1===y){for(;p<i.length&&"string"==typeof(y=i[p++]);)if(y.toLowerCase()===s)return!0;return!1}}return!1}function So(i){return 4===i.type&&i.value!==zh}function Bh(i,s,c){return s===(4!==i.type||c?i.value:zh)}function Wu(i,s,c){let p=4;const y=i.attrs||[],b=function h_(i){for(let s=0;s<i.length;s++)if(Fl(i[s]))return s;return i.length}(y);let C=!1;for(let M=0;M<s.length;M++){const O=s[M];if("number"!=typeof O){if(!C)if(4&p){if(p=2|1&p,""!==O&&!Bh(i,O,c)||""===O&&1===s.length){if(is(p))return!1;C=!0}}else{const N=8&p?O:s[++M];if(8&p&&null!==i.attrs){if(!Im(i.attrs,N,c)){if(is(p))return!1;C=!0}continue}const ce=Sm(8&p?"class":O,y,So(i),c);if(-1===ce){if(is(p))return!1;C=!0;continue}if(""!==N){let De;De=ce>b?"":y[ce+1].toLowerCase();const ze=8&p?De:null;if(ze&&-1!==Cm(ze,N,0)||2&p&&N!==De){if(is(p))return!1;C=!0}}}}else{if(!C&&!is(p)&&!is(O))return!1;if(C&&is(O))continue;C=!1,p=O|1&p}}return is(p)||C}function is(i){return 0==(1&i)}function Sm(i,s,c,p){if(null===s)return-1;let y=0;if(p||!c){let b=!1;for(;y<s.length;){const C=s[y];if(C===i)return y;if(3===C||6===C)b=!0;else{if(1===C||2===C){let M=s[++y];for(;"string"==typeof M;)M=s[++y];continue}if(4===C)break;if(0===C){y+=4;continue}}y+=b?1:2}return-1}return function d_(i,s){let c=i.indexOf(4);if(c>-1)for(c++;c<i.length;){const p=i[c];if("number"==typeof p)return-1;if(p===s)return c;c++}return-1}(s,i)}function ip(i,s,c=!1){for(let p=0;p<s.length;p++)if(Wu(i,s[p],c))return!0;return!1}function Mm(i,s){return i?":not("+s.trim()+")":s}function p_(i){let s=i[0],c=1,p=2,y="",b=!1;for(;c<i.length;){let C=i[c];if("string"==typeof C)if(2&p){const M=i[++c];y+="["+C+(M.length>0?'="'+M+'"':"")+"]"}else 8&p?y+="."+C:4&p&&(y+=" "+C);else""!==y&&!is(C)&&(s+=Mm(b,y),y=""),p=C,b=b||!is(p);c++}return""!==y&&(s+=Mm(b,y)),s}const Bn={};function op(i){sp(Vn(),lt(),Tn()+i,!1)}function sp(i,s,c,p){if(!p)if(3==(3&s[2])){const b=i.preOrderCheckHooks;null!==b&&Tt(s,b,c)}else{const b=i.preOrderHooks;null!==b&&ni(s,b,0,c)}$n(c)}function Fd(i,s=null,c=null,p){const y=Nh(i,s,c,p);return y.resolveInjectorInitializers(),y}function Nh(i,s=null,c=null,p,y=new Set){const b=[c||We,Xg(i)];return p=p||("object"==typeof i?void 0:Xt(i)),new Hu(b,s||Ih(),p||null,y)}let ua=(()=>{class i{static create(c,p){if(Array.isArray(c))return Fd({name:""},p,c,"");{const y=c.name??"";return Fd({name:y},c.parent,c.providers,y)}}}return i.THROW_IF_NOT_FOUND=Rn,i.NULL=new Gu,i.\u0275prov=Jn({token:i,providedIn:"any",factory:()=>ie(Gf)}),i.__NG_ELEMENT_ID__=-1,i})();function kc(i,s=ut.Default){const c=lt();return null===c?ie(i,s):Jc(ti(),c,Ut(i),s)}function up(){throw new Error("invalid")}function Zm(i,s){const c=i.contentQueries;if(null!==c)for(let p=0;p<c.length;p+=2){const y=c[p],b=c[p+1];if(-1!==b){const C=i.data[b];Gi(y),C.contentQueries(2,s[b],b)}}}function Oc(i,s,c,p,y,b,C,M,O,N,q){const ce=s.blueprint.slice();return ce[0]=y,ce[2]=76|p,(null!==q||i&&1024&i[2])&&(ce[2]|=1024),Wa(ce),ce[3]=ce[15]=i,ce[8]=c,ce[10]=C||i&&i[10],ce[11]=M||i&&i[11],ce[12]=O||i&&i[12]||null,ce[9]=N||i&&i[9]||null,ce[6]=b,ce[20]=function Kp(){return Yp++}(),ce[21]=q,ce[16]=2==s.type?i[16]:ce,ce}function Es(i,s,c,p,y){let b=i.data[s];if(null===b)b=function qh(i,s,c,p,y){const b=Ol(),C=Ja(),O=i.data[s]=function N_(i,s,c,p,y,b){return{type:c,index:p,insertBeforeIndex:null,injectorIndex:s?s.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:y,attrs:b,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:s,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,C?b:b&&b.parent,c,s,p,y);return null===i.firstChild&&(i.firstChild=O),null!==b&&(C?null==b.child&&null!==O.parent&&(b.child=O):null===b.next&&(b.next=O)),O}(i,s,c,p,y),function pc(){return sn.lFrame.inI18n}()&&(b.flags|=32);else if(64&b.type){b.type=c,b.value=p,b.attrs=y;const C=function Us(){const i=sn.lFrame,s=i.currentTNode;return i.isParent?s:s.parent}();b.injectorIndex=null===C?-1:C.injectorIndex}return oo(b,!0),b}function vl(i,s,c,p){if(0===c)return-1;const y=s.length;for(let b=0;b<c;b++)s.push(p),i.blueprint.push(p),i.data.push(null);return y}function Fc(i,s,c){j(s);try{const p=i.viewQuery;null!==p&&Ep(1,p,c);const y=i.template;null!==y&&ha(i,s,y,1,c),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Zm(i,s),i.staticViewQueries&&Ep(2,i.viewQuery,c);const b=i.components;null!==b&&function Wm(i,s){for(let c=0;c<s.length;c++)H_(i,s[c])}(s,b)}catch(p){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),p}finally{s[2]&=-5,tt()}}function Ds(i,s,c,p){const y=s[2];if(128!=(128&y)){j(s);try{Wa(s),function Js(i){return sn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==c&&ha(i,s,c,2,p);const C=3==(3&y);if(C){const N=i.preOrderCheckHooks;null!==N&&Tt(s,N,null)}else{const N=i.preOrderHooks;null!==N&&ni(s,N,0,null),js(s,0)}if(function G_(i){for(let s=Hl(i);null!==s;s=Tf(s)){if(!s[2])continue;const c=s[9];for(let p=0;p<c.length;p++){const y=c[p],b=y[3];0==(512&y[2])&&Ko(b,1),y[2]|=512}}}(s),function ef(i){for(let s=Hl(i);null!==s;s=Tf(s))for(let c=10;c<s.length;c++){const p=s[c],y=p[1];io(p)&&Ds(y,p,y.template,p[8])}}(s),null!==i.contentQueries&&Zm(i,s),C){const N=i.contentCheckHooks;null!==N&&Tt(s,N)}else{const N=i.contentHooks;null!==N&&ni(s,N,1),js(s,1)}!function B_(i,s){const c=i.hostBindingOpCodes;if(null!==c)try{for(let p=0;p<c.length;p++){const y=c[p];if(y<0)$n(~y);else{const b=y,C=c[++p],M=c[++p];Hc(C,b),M(2,s[b])}}}finally{$n(-1)}}(i,s);const M=i.components;null!==M&&function qm(i,s){for(let c=0;c<s.length;c++)tg(i,s[c])}(s,M);const O=i.viewQuery;if(null!==O&&Ep(2,O,p),C){const N=i.viewCheckHooks;null!==N&&Tt(s,N)}else{const N=i.viewHooks;null!==N&&ni(s,N,2),js(s,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),s[2]&=-41,512&s[2]&&(s[2]&=-513,Ko(s[3],-1))}finally{tt()}}}function ha(i,s,c,p,y){const b=Tn(),C=2&p;try{$n(-1),C&&s.length>22&&sp(i,s,22,!1),c(p,y)}finally{$n(b)}}function vp(i,s,c){if(cs(s)){const y=s.directiveEnd;for(let b=s.directiveStart;b<y;b++){const C=i.data[b];C.contentQueries&&C.contentQueries(1,c[b],b)}}}function Xd(i,s,c){!kl()||(function Jm(i,s,c,p){const y=c.directiveStart,b=c.directiveEnd;i.firstCreatePass||al(c,s),Co(p,s);const C=c.initialInputs;for(let M=y;M<b;M++){const O=i.data[M],N=li(O);N&&Qh(s,c,O);const q=St(s,i,M,c);Co(q,s),null!==C&&Qd(0,M-y,q,O,0,C),N&&(er(c.index,s)[8]=q)}}(i,s,c,vi(c,s)),64==(64&c.flags)&&Qm(i,s,c))}function xp(i,s,c=vi){const p=s.localNames;if(null!==p){let y=s.index+1;for(let b=0;b<p.length;b+=2){const C=p[b+1],M=-1===C?c(s,i):i[C];i[y++]=M}}}function Yd(i){const s=i.tView;return null===s||s.incompleteFirstPass?i.tView=da(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):s}function da(i,s,c,p,y,b,C,M,O,N){const q=22+p,ce=q+y,De=function fu(i,s){const c=[];for(let p=0;p<s;p++)c.push(p<i?null:Bn);return c}(q,ce),ze="function"==typeof N?N():N;return De[1]={type:i,blueprint:De,template:c,queries:null,viewQuery:M,declTNode:s,data:De.slice().fill(null,q),bindingStartIndex:q,expandoStartIndex:ce,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof b?b():b,pipeRegistry:"function"==typeof C?C():C,firstChild:null,schemas:O,consts:ze,incompleteFirstPass:!1}}function bp(i,s,c,p){const y=ed(s);null===c?y.push(p):(y.push(c),i.firstCreatePass&&td(i).push(p,y.length-1))}function Wh(i,s,c,p){for(let y in i)if(i.hasOwnProperty(y)){c=null===c?{}:c;const b=i[y];null===p?Kd(c,s,y,b):p.hasOwnProperty(y)&&Kd(c,s,p[y],b)}return c}function Kd(i,s,c,p){i.hasOwnProperty(c)?i[c].push(s,p):i[c]=[s,p]}function Mo(i,s,c,p,y,b,C,M){const O=vi(s,c);let q,N=s.inputs;!M&&null!=N&&(q=N[p])?(rd(i,c,q,p,y),_a(s)&&Yh(c,s.index)):3&s.type&&(p=function Xh(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(p),y=null!=C?C(y,s.value||"",p):y,b.setProperty(O,p,y))}function Yh(i,s){const c=er(s,i);16&c[2]||(c[2]|=32)}function Kh(i,s,c,p){let y=!1;if(kl()){const b=null===p?null:{"":-1},C=function eg(i,s){const c=i.directiveRegistry;let p=null,y=null;if(c)for(let b=0;b<c.length;b++){const C=c[b];if(ip(s,C.selectors,!1))if(p||(p=[]),li(C))if(null!==C.findHostDirectiveDefs){const M=[];y=y||new Map,C.findHostDirectiveDefs(C,M,y),p.unshift(...M,C),Ql(i,s,M.length)}else p.unshift(C),Ql(i,s,0);else y=y||new Map,C.findHostDirectiveDefs?.(C,p,y),p.push(C)}return null===p?null:[p,y]}(i,c);let M,O;null===C?M=O=null:[M,O]=C,null!==M&&(y=!0,wp(i,s,c,M,b,O)),b&&function j_(i,s,c){if(s){const p=i.localNames=[];for(let y=0;y<s.length;y+=2){const b=c[s[y+1]];if(null==b)throw new Pt(-301,!1);p.push(s[y],b)}}}(c,p,b)}return c.mergedAttrs=il(c.mergedAttrs,c.attrs),y}function wp(i,s,c,p,y,b){for(let N=0;N<p.length;N++)Ta(al(c,s),i,p[N].type);!function V_(i,s,c){i.flags|=1,i.directiveStart=s,i.directiveEnd=s+c,i.providerIndexes=s}(c,i.data.length,p.length);for(let N=0;N<p.length;N++){const q=p[N];q.providersResolver&&q.providersResolver(q)}let C=!1,M=!1,O=vl(i,s,p.length,null);for(let N=0;N<p.length;N++){const q=p[N];c.mergedAttrs=il(c.mergedAttrs,q.hostAttrs),Jh(i,c,s,O,q),zc(O,q,y),null!==q.contentQueries&&(c.flags|=4),(null!==q.hostBindings||null!==q.hostAttrs||0!==q.hostVars)&&(c.flags|=64);const ce=q.type.prototype;!C&&(ce.ngOnChanges||ce.ngOnInit||ce.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(c.index),C=!0),!M&&(ce.ngOnChanges||ce.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(c.index),M=!0),O++}!function Yu(i,s,c){const y=s.directiveEnd,b=i.data,C=s.attrs,M=[];let O=null,N=null;for(let q=s.directiveStart;q<y;q++){const ce=b[q],De=c?c.get(ce):null,it=De?De.outputs:null;O=Wh(ce.inputs,q,O,De?De.inputs:null),N=Wh(ce.outputs,q,N,it);const Et=null===O||null===C||So(s)?null:$_(O,q,C);M.push(Et)}null!==O&&(O.hasOwnProperty("class")&&(s.flags|=8),O.hasOwnProperty("style")&&(s.flags|=16)),s.initialInputs=M,s.inputs=O,s.outputs=N}(i,c,b)}function Qm(i,s,c){const p=c.directiveStart,y=c.directiveEnd,b=c.index,C=function wa(){return sn.lFrame.currentDirectiveIndex}();try{$n(b);for(let M=p;M<y;M++){const O=i.data[M],N=s[M];Jo(M),(null!==O.hostBindings||0!==O.hostVars||null!==O.hostAttrs)&&U_(O,N)}}finally{$n(-1),Jo(C)}}function U_(i,s){null!==i.hostBindings&&i.hostBindings(1,s)}function Ql(i,s,c){s.componentOffset=c,(i.components||(i.components=[])).push(s.index)}function zc(i,s,c){if(c){if(s.exportAs)for(let p=0;p<s.exportAs.length;p++)c[s.exportAs[p]]=i;li(s)&&(c[""]=i)}}function Jh(i,s,c,p,y){i.data[p]=y;const b=y.factory||(y.factory=no(y.type)),C=new tl(b,li(y),kc);i.blueprint[p]=C,c[p]=C,function Ku(i,s,c,p,y){const b=y.hostBindings;if(b){let C=i.hostBindingOpCodes;null===C&&(C=i.hostBindingOpCodes=[]);const M=~s.index;(function Km(i){let s=i.length;for(;s>0;){const c=i[--s];if("number"==typeof c&&c<0)return c}return 0})(C)!=M&&C.push(M),C.push(c,p,b)}}(i,s,p,vl(i,c,y.hostVars,Bn),y)}function Qh(i,s,c){const p=vi(s,i),y=Yd(c),b=i[10],C=nf(i,Oc(i,y,null,c.onPush?32:16,p,s,b,b.createRenderer(p,c),null,null,null));i[s.index]=C}function Ts(i,s,c,p,y,b){const C=vi(i,s);!function pu(i,s,c,p,y,b,C){if(null==b)i.removeAttribute(s,y,c);else{const M=null==C?st(b):C(b,p||"",y);i.setAttribute(s,y,M,c)}}(s[11],C,b,i.value,c,p,y)}function Qd(i,s,c,p,y,b){const C=b[s];if(null!==C){const M=p.setInput;for(let O=0;O<C.length;){const N=C[O++],q=C[O++],ce=C[O++];null!==M?p.setInput(c,ce,N,q):c[q]=ce}}}function $_(i,s,c){let p=null,y=0;for(;y<c.length;){const b=c[y];if(0!==b)if(5!==b){if("number"==typeof b)break;if(i.hasOwnProperty(b)){null===p&&(p=[]);const C=i[b];for(let M=0;M<C.length;M+=2)if(C[M]===s){p.push(b,C[M+1],c[y+1]);break}}y+=2}else y+=2;else y+=4}return p}function mu(i,s,c,p){return new Array(i,!0,!1,s,null,0,p,c,null,null)}function tg(i,s){const c=er(s,i);if(io(c)){const p=c[1];48&c[2]?Ds(p,c,p.template,c[8]):c[5]>0&&tf(c)}}function tf(i){for(let p=Hl(i);null!==p;p=Tf(p))for(let y=10;y<p.length;y++){const b=p[y];if(io(b))if(512&b[2]){const C=b[1];Ds(C,b,C.template,b[8])}else b[5]>0&&tf(b)}const c=i[1].components;if(null!==c)for(let p=0;p<c.length;p++){const y=er(c[p],i);io(y)&&y[5]>0&&tf(y)}}function H_(i,s){const c=er(s,i),p=c[1];(function ng(i,s){for(let c=s.length;c<i.blueprint.length;c++)s.push(i.blueprint[c])})(p,c),Fc(p,c,c[8])}function nf(i,s){return i[13]?i[14][4]=s:i[13]=s,i[14]=s,s}function rf(i){for(;i;){i[2]|=32;const s=rs(i);if(ya(i)&&!s)return i;i=s}return null}function sf(i,s,c,p=!0){const y=s[10];y.begin&&y.begin();try{Ds(i,s,i.template,c)}catch(C){throw p&&rg(s,C),C}finally{y.end&&y.end()}}function Ep(i,s,c){Gi(0),s(i,c)}function ed(i){return i[7]||(i[7]=[])}function td(i){return i.cleanup||(i.cleanup=[])}function rg(i,s){const c=i[9],p=c?c.get(Rc,null):null;p&&p.handleError(s)}function rd(i,s,c,p,y){for(let b=0;b<c.length;){const C=c[b++],M=c[b++],O=s[C],N=i.data[C];null!==N.setInput?N.setInput(O,y,p,M):O[M]=y}}function Fa(i,s,c){const p=function Fo(i,s){return Br(s[i])}(s,i);!function yh(i,s,c){i.setValue(s,c)}(i[11],p,c)}function za(i,s,c){let p=c?i.styles:null,y=c?i.classes:null,b=0;if(null!==s)for(let C=0;C<s.length;C++){const M=s[C];"number"==typeof M?b=M:1==b?y=Lt(y,M):2==b&&(p=Lt(p,M+": "+s[++C]+";"))}c?i.styles=p:i.stylesWithoutHost=p,c?i.classes=y:i.classesWithoutHost=y}function af(i,s,c,p,y=!1){for(;null!==c;){const b=s[c.index];if(null!==b&&p.push(Br(b)),ai(b))for(let M=10;M<b.length;M++){const O=b[M],N=O[1].firstChild;null!==N&&af(O[1],O,N,p)}const C=c.type;if(8&C)af(i,s,c.child,p);else if(32&C){const M=gh(c,s);let O;for(;O=M();)p.push(O)}else if(16&C){const M=wd(s,c);if(Array.isArray(M))p.push(...M);else{const O=rs(s[16]);af(O[1],O,M,p,!0)}}c=y?c.projectionNext:c.next}return p}class gu{constructor(s,c){this._lView=s,this._cdRefInjectingView=c,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const s=this._lView,c=s[1];return af(c,s,c.firstChild,[])}get context(){return this._lView[8]}set context(s){this._lView[8]=s}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const s=this._lView[3];if(ai(s)){const c=s[8],p=c?c.indexOf(this):-1;p>-1&&(vh(s,p),E(c,p))}this._attachedToViewContainer=!1}ka(this._lView[1],this._lView)}onDestroy(s){bp(this._lView[1],this._lView,null,s)}markForCheck(){rf(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){sf(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Pt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function hn(i,s){xh(i,s,s[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(s){if(this._attachedToViewContainer)throw new Pt(902,!1);this._appRef=s}}class ig extends gu{constructor(s){super(s),this._view=s}detectChanges(){const s=this._view;sf(s[1],s,s[8],!1)}checkNoChanges(){}get context(){return null}}class Ju extends Ph{constructor(s){super(),this.ngModule=s}resolveComponentFactory(s){const c=Un(s);return new id(c,this.ngModule)}}function og(i){const s=[];for(let c in i)i.hasOwnProperty(c)&&s.push({propName:i[c],templateName:c});return s}class W_{constructor(s,c){this.injector=s,this.parentInjector=c}get(s,c,p){p=oe(p);const y=this.injector.get(s,ep,p);return y!==ep||c===ep?y:this.parentInjector.get(s,c,p)}}class id extends Ah{constructor(s,c){super(),this.componentDef=s,this.ngModule=c,this.componentType=s.type,this.selector=function Od(i){return i.map(p_).join(",")}(s.selectors),this.ngContentSelectors=s.ngContentSelectors?s.ngContentSelectors:[],this.isBoundToModule=!!c}get inputs(){return og(this.componentDef.inputs)}get outputs(){return og(this.componentDef.outputs)}create(s,c,p,y){let b=(y=y||this.ngModule)instanceof Pc?y:y?.injector;b&&null!==this.componentDef.getStandaloneInjector&&(b=this.componentDef.getStandaloneInjector(b)||b);const C=b?new W_(s,b):s,M=C.get(xm,null);if(null===M)throw new Pt(407,!1);const O=C.get(bm,null),N=M.createRenderer(null,this.componentDef),q=this.componentDef.selectors[0][0]||"div",ce=p?function Xm(i,s,c){return i.selectRootElement(s,c===Re.ShadowDom)}(N,p,this.componentDef.encapsulation):Cf(N,q,function q_(i){const s=i.toLowerCase();return"svg"===s?"svg":"math"===s?"math":null}(q)),De=this.componentDef.onPush?288:272,ze=da(0,null,null,1,0,null,null,null,null,null),it=Oc(null,ze,null,De,null,null,M,N,O,C,null);let Et,zt;j(it);try{const Wt=this.componentDef;let dn,bt=null;Wt.findHostDirectiveDefs?(dn=[],bt=new Map,Wt.findHostDirectiveDefs(Wt,dn,bt),dn.push(Wt)):dn=[Wt];const Fn=function X_(i,s){const c=i[1];return i[22]=s,Es(c,22,2,"#host",null)}(it,ce),Er=function sg(i,s,c,p,y,b,C,M){const O=y[1];!function Y_(i,s,c,p){for(const y of i)s.mergedAttrs=il(s.mergedAttrs,y.hostAttrs);null!==s.mergedAttrs&&(za(s,s.mergedAttrs,!0),null!==c&&Of(p,c,s))}(p,i,s,C);const N=b.createRenderer(s,c),q=Oc(y,Yd(c),null,c.onPush?32:16,y[i.index],i,b,N,M||null,null,null);return O.firstCreatePass&&Ql(O,i,p.length-1),nf(y,q),y[i.index]=q}(Fn,ce,Wt,dn,it,M,N);zt=Ks(ze,22),ce&&function fa(i,s,c,p){if(p)_c(i,c,["ng-version",i_.full]);else{const{attrs:y,classes:b}=function m_(i){const s=[],c=[];let p=1,y=2;for(;p<i.length;){let b=i[p];if("string"==typeof b)2===y?""!==b&&s.push(b,i[++p]):8===y&&c.push(b);else{if(!is(y))break;y=b}p++}return{attrs:s,classes:c}}(s.selectors[0]);y&&_c(i,c,y),b&&b.length>0&&Cc(i,c,b.join(" "))}}(N,Wt,ce,p),void 0!==c&&function xl(i,s,c){const p=i.projection=[];for(let y=0;y<s.length;y++){const b=c[y];p.push(null!=b?Array.from(b):null)}}(zt,this.ngContentSelectors,c),Et=function ag(i,s,c,p,y,b){const C=ti(),M=y[1],O=vi(C,y);wp(M,y,C,c,null,p);for(let q=0;q<c.length;q++)Co(St(y,M,C.directiveStart+q,C),y);Qm(M,y,C),O&&Co(O,y);const N=St(y,M,C.directiveStart+C.componentOffset,C);if(i[8]=y[8]=N,null!==b)for(const q of b)q(N,s);return vp(M,C,i),N}(Er,Wt,dn,bt,it,[Bc]),Fc(ze,it,null)}finally{tt()}return new od(this.componentType,Et,Xl(zt,it),it,zt)}}class od extends Jf{constructor(s,c,p,y,b){super(),this.location=p,this._rootLView=y,this._tNode=b,this.instance=c,this.hostView=this.changeDetectorRef=new ig(y),this.componentType=s}setInput(s,c){const p=this._tNode.inputs;let y;if(null!==p&&(y=p[s])){const b=this._rootLView;rd(b[1],b,y,s,c),Yh(b,this._tNode.index)}}get injector(){return new Ei(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(s){this.hostView.onDestroy(s)}}function Bc(){const i=ti();bi(lt()[1],i)}let sd=null;function bl(){if(!sd){const i=Hn.Symbol;if(i&&i.iterator)sd=i.iterator;else{const s=Object.getOwnPropertyNames(Map.prototype);for(let c=0;c<s.length;++c){const p=s[c];"entries"!==p&&"size"!==p&&Map.prototype[p]===Map.prototype.entries&&(sd=p)}}}return sd}function wl(i){return!!pa(i)&&(Array.isArray(i)||!(i instanceof Map)&&bl()in i)}function pa(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function Ci(i,s,c){return!Object.is(i[s],c)&&(i[s]=c,!0)}function Nc(i,s,c,p){const y=Ci(i,s,c);return Ci(i,s+1,p)||y}function Qu(i,s,c,p){const y=lt();return Ci(y,Bo(),s)&&(Vn(),Ts(rn(),y,i,s,c,p)),Qu}function yu(i,s,c,p){return Ci(i,Bo(),c)?s+st(c)+p:Bn}function vu(i,s,c,p,y,b,C,M){const N=function ad(i,s,c,p,y){const b=Nc(i,s,c,p);return Ci(i,s+2,y)||b}(i,function zo(){return sn.lFrame.bindingIndex}(),c,y,C);return function Eo(i){const s=sn.lFrame,c=s.bindingIndex;return s.bindingIndex=s.bindingIndex+i,c}(3),N?s+st(c)+p+st(y)+b+st(C)+M:Bn}function A(i,s,c,p,y,b,C,M){const O=lt(),N=Vn(),q=i+22,ce=N.firstCreatePass?function I(i,s,c,p,y,b,C,M,O){const N=s.consts,q=Es(s,i,4,C||null,fs(N,M));Kh(s,c,q,fs(N,O)),bi(s,q);const ce=q.tViews=da(2,q,p,y,b,s.directiveRegistry,s.pipeRegistry,null,s.schemas,N);return null!==s.queries&&(s.queries.template(s,q),ce.queries=s.queries.embeddedTView(q)),q}(q,N,O,s,c,p,y,b,C):N.data[q];oo(ce,!1);const De=O[11].createComment("");ru(N,O,De,ce),Co(De,O),nf(O,O[q]=mu(De,O,De,ce)),Os(ce)&&Xd(N,O,ce),null!=C&&xp(O,ce,M)}function F(i){return bo(function Cu(){return sn.lFrame.contextLView}(),22+i)}function z(i,s,c){const p=lt();return Ci(p,Bo(),s)&&Mo(Vn(),rn(),p,i,s,p[11],c,!1),z}function H(i,s,c,p,y){const C=y?"class":"style";rd(i,c,s.inputs[C],C,p)}function le(i,s,c,p){const y=lt(),b=Vn(),C=22+i,M=y[11],O=y[C]=Cf(M,s,function Fi(){return sn.lFrame.currentNamespace}()),N=b.firstCreatePass?function Y(i,s,c,p,y,b,C){const M=s.consts,N=Es(s,i,2,y,fs(M,b));return Kh(s,c,N,fs(M,C)),null!==N.attrs&&za(N,N.attrs,!1),null!==N.mergedAttrs&&za(N,N.mergedAttrs,!0),null!==s.queries&&s.queries.elementStart(s,N),N}(C,b,y,0,s,c,p):b.data[C];return oo(N,!0),Of(M,O,N),32!=(32&N.flags)&&ru(b,y,O,N),0===function dc(){return sn.lFrame.elementDepthCount}()&&Co(O,y),function Xa(){sn.lFrame.elementDepthCount++}(),Os(N)&&(Xd(b,y,N),vp(b,N,y)),null!==p&&xp(y,N),le}function me(){let i=ti();Ja()?function Qa(){sn.lFrame.isParent=!1}():(i=i.parent,oo(i,!1));const s=i;!function Ya(){sn.lFrame.elementDepthCount--}();const c=Vn();return c.firstCreatePass&&(bi(c,i),cs(i)&&c.queries.elementEnd(i)),null!=s.classesWithoutHost&&function rl(i){return 0!=(8&i.flags)}(s)&&H(c,s,lt(),s.classesWithoutHost,!0),null!=s.stylesWithoutHost&&function ms(i){return 0!=(16&i.flags)}(s)&&H(c,s,lt(),s.stylesWithoutHost,!1),me}function ae(i,s,c,p){return le(i,s,c,p),me(),ae}function Fe(){return lt()}function He(i){return!!i&&"function"==typeof i.then}function ht(i){return!!i&&"function"==typeof i.subscribe}const je=ht;function Je(i,s,c,p){const y=lt(),b=Vn(),C=ti();return function pt(i,s,c,p,y,b,C,M){const O=Os(p),q=i.firstCreatePass&&td(i),ce=s[8],De=ed(s);let ze=!0;if(3&p.type||M){const zt=vi(p,s),Wt=M?M(zt):zt,dn=De.length,bt=M?Er=>M(Br(Er[p.index])):p.index;let Fn=null;if(!M&&O&&(Fn=function at(i,s,c,p){const y=i.cleanup;if(null!=y)for(let b=0;b<y.length-1;b+=2){const C=y[b];if(C===c&&y[b+1]===p){const M=s[7],O=y[b+2];return M.length>O?M[O]:null}"string"==typeof C&&(b+=2)}return null}(i,s,y,p.index)),null!==Fn)(Fn.__ngLastListenerFn__||Fn).__ngNextListenerFn__=b,Fn.__ngLastListenerFn__=b,ze=!1;else{b=Ft(p,s,ce,b,!1);const Er=c.listen(Wt,y,b);De.push(b,Er),q&&q.push(y,bt,dn,dn+1)}}else b=Ft(p,s,ce,b,!1);const it=p.outputs;let Et;if(ze&&null!==it&&(Et=it[y])){const zt=Et.length;if(zt)for(let Wt=0;Wt<zt;Wt+=2){const Si=s[Et[Wt]][Et[Wt+1]].subscribe(b),hd=De.length;De.push(b,Si),q&&q.push(y,p.index,hd,-(hd+1))}}}(b,y,y[11],C,i,s,0,p),Je}function Ze(i,s,c,p){try{return!1!==c(p)}catch(y){return rg(i,y),!1}}function Ft(i,s,c,p,y){return function b(C){if(C===Function)return p;rf(i.componentOffset>-1?er(i.index,s):s);let O=Ze(s,0,p,C),N=b.__ngNextListenerFn__;for(;N;)O=Ze(s,0,N,C)&&O,N=N.__ngNextListenerFn__;return y&&!1===O&&(C.preventDefault(),C.returnValue=!1),O}}function cn(i=1){return function Kt(i){return(sn.lFrame.contextLView=function tr(i,s){for(;i>0;)s=s[15],i--;return s}(i,sn.lFrame.contextLView))[8]}(i)}function an(i,s,c){return wn(i,"",s,"",c),an}function wn(i,s,c,p,y){const b=lt(),C=yu(b,s,c,p);return C!==Bn&&Mo(Vn(),rn(),b,i,C,b[11],y,!1),wn}function dv(i,s=""){const c=lt(),p=Vn(),y=i+22,b=p.firstCreatePass?Es(p,y,1,s,null):p.data[y],C=c[y]=function vd(i,s){return i.createText(s)}(c[11],s);ru(p,c,C,b),oo(b,!1)}function _g(i,s,c){const p=lt(),y=yu(p,i,s,c);return y!==Bn&&Fa(p,Tn(),y),_g}function Q_(i,s,c,p,y,b,C){const M=lt(),O=vu(M,i,s,c,p,y,b,C);return O!==Bn&&Fa(M,Tn(),O),Q_}const cd=void 0;var Jx=["en",[["a","p"],["AM","PM"],cd],[["AM","PM"],cd,cd],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],cd,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],cd,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",cd,"{1} 'at' {0}",cd],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Kx(i){const c=Math.floor(Math.abs(i)),p=i.toString().replace(/^[^.]*\.?/,"").length;return 1===c&&0===p?1:5}];let uf={};function ey(i){const s=function Qx(i){return i.toLowerCase().replace(/_/g,"-")}(i);let c=kv(s);if(c)return c;const p=s.split("-")[0];if(c=kv(p),c)return c;if("en"===p)return Jx;throw new Pt(701,!1)}function Rv(i){return ey(i)[Pn.PluralCase]}function kv(i){return i in uf||(uf[i]=Hn.ng&&Hn.ng.common&&Hn.ng.common.locales&&Hn.ng.common.locales[i]),uf[i]}var Pn=(()=>((Pn=Pn||{})[Pn.LocaleId=0]="LocaleId",Pn[Pn.DayPeriodsFormat=1]="DayPeriodsFormat",Pn[Pn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Pn[Pn.DaysFormat=3]="DaysFormat",Pn[Pn.DaysStandalone=4]="DaysStandalone",Pn[Pn.MonthsFormat=5]="MonthsFormat",Pn[Pn.MonthsStandalone=6]="MonthsStandalone",Pn[Pn.Eras=7]="Eras",Pn[Pn.FirstDayOfWeek=8]="FirstDayOfWeek",Pn[Pn.WeekendRange=9]="WeekendRange",Pn[Pn.DateFormat=10]="DateFormat",Pn[Pn.TimeFormat=11]="TimeFormat",Pn[Pn.DateTimeFormat=12]="DateTimeFormat",Pn[Pn.NumberSymbols=13]="NumberSymbols",Pn[Pn.NumberFormats=14]="NumberFormats",Pn[Pn.CurrencyCode=15]="CurrencyCode",Pn[Pn.CurrencySymbol=16]="CurrencySymbol",Pn[Pn.CurrencyName=17]="CurrencyName",Pn[Pn.Currencies=18]="Currencies",Pn[Pn.Directionality=19]="Directionality",Pn[Pn.PluralCase=20]="PluralCase",Pn[Pn.ExtraData=21]="ExtraData",Pn))();const hf="en-US";let Lv=hf;class df{}class a0{}function J1(i,s){return new l0(i,s??null)}class l0 extends df{constructor(s,c){super(),this._parent=c,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Ju(this);const p=kr(s);this._bootstrapComponents=ml(p.bootstrap),this._r3Injector=Nh(s,c,[{provide:df,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver}],Xt(s),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(s)}get injector(){return this._r3Injector}destroy(){const s=this._r3Injector;!s.destroyed&&s.destroy(),this.destroyCbs.forEach(c=>c()),this.destroyCbs=null}onDestroy(s){this.destroyCbs.push(s)}}class ay extends a0{constructor(s){super(),this.moduleType=s}create(s){return new l0(this.moduleType,s)}}class Q1 extends df{constructor(s,c,p){super(),this.componentFactoryResolver=new Ju(this),this.instance=null;const y=new Hu([...s,{provide:df,useValue:this},{provide:Ph,useValue:this.componentFactoryResolver}],c||Ih(),p,new Set(["environment"]));this.injector=y,y.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(s){this.injector.onDestroy(s)}}function ly(i,s,c=null){return new Q1(i,s,c).injector}let eb=(()=>{class i{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c.id)){const p=mm(0,c.type),y=p.length>0?ly([p],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c.id,y)}return this.cachedInjectors.get(c.id)}ngOnDestroy(){try{for(const c of this.cachedInjectors.values())null!==c&&c.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Jn({token:i,providedIn:"environment",factory:()=>new i(ie(Pc))}),i})();function c0(i){i.getStandaloneInjector=s=>s.get(eb).getOrCreateStandaloneInjector(i)}function g0(i,s,c,p,y){return y0(lt(),fi(),i,s,c,p,y)}function y0(i,s,c,p,y,b,C){const M=s+c;return Nc(i,M,y,b)?function ma(i,s,c){return i[s]=c}(i,M+2,C?p.call(C,y,b):p(y,b)):function $p(i,s){const c=i[s];return c===Bn?void 0:c}(i,M+2)}function w0(i,s){const c=Vn();let p;const y=i+22;c.firstCreatePass?(p=function yb(i,s){if(s)for(let c=s.length-1;c>=0;c--){const p=s[c];if(i===p.name)return p}}(s,c.pipeRegistry),c.data[y]=p,p.onDestroy&&(c.destroyHooks||(c.destroyHooks=[])).push(y,p.onDestroy)):p=c.data[y];const b=p.factory||(p.factory=no(p.type)),C=xr(kc);try{const M=zl(!1),O=b();return zl(M),function P(i,s,c,p){c>=i.data.length&&(i.data[c]=null,i.blueprint[c]=null),s[c]=p}(c,lt(),y,O),O}finally{xr(C)}}function E0(i,s,c,p){const y=i+22,b=lt(),C=bo(b,y);return function Gp(i,s){return i[1].data[s].pure}(b,y)?y0(b,fi(),s,C.transform,c,p,C):C.transform(c,p)}function uy(i){return s=>{setTimeout(i,void 0,s)}}const Gc=class Eb extends G.x{constructor(s=!1){super(),this.__isAsync=s}emit(s){super.next(s)}subscribe(s,c,p){let y=s,b=c||(()=>null),C=p;if(s&&"object"==typeof s){const O=s;y=O.next?.bind(O),b=O.error?.bind(O),C=O.complete?.bind(O)}this.__isAsync&&(b=uy(b),y&&(y=uy(y)),C&&(C=uy(C)));const M=super.subscribe({next:y,error:b,complete:C});return s instanceof Ee.w0&&s.add(M),M}};function Db(){return this._results[bl()]()}class hy{constructor(s=!1){this._emitDistinctChangesOnly=s,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const c=bl(),p=hy.prototype;p[c]||(p[c]=Db)}get changes(){return this._changes||(this._changes=new Gc)}get(s){return this._results[s]}map(s){return this._results.map(s)}filter(s){return this._results.filter(s)}find(s){return this._results.find(s)}reduce(s,c){return this._results.reduce(s,c)}forEach(s){this._results.forEach(s)}some(s){return this._results.some(s)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(s,c){const p=this;p.dirty=!1;const y=d(s);(this._changesDetected=!function l(i,s,c){if(i.length!==s.length)return!1;for(let p=0;p<i.length;p++){let y=i[p],b=s[p];if(c&&(y=c(y),b=c(b)),b!==y)return!1}return!0}(p._results,y,c))&&(p._results=y,p.length=y.length,p.last=y[this.length-1],p.first=y[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Hp=(()=>{class i{}return i.__NG_ELEMENT_ID__=Ib,i})();const Tb=Hp,Cb=class extends Tb{constructor(s,c,p){super(),this._declarationLView=s,this._declarationTContainer=c,this.elementRef=p}createEmbeddedView(s,c){const p=this._declarationTContainer.tViews,y=Oc(this._declarationLView,p,s,16,null,p.declTNode,null,null,null,null,c||null);y[17]=this._declarationLView[this._declarationTContainer.index];const C=this._declarationLView[19];return null!==C&&(y[19]=C.createEmbeddedView(p)),Fc(p,y,s),new gu(y)}};function Ib(){return wg(ti(),lt())}function wg(i,s){return 4&i.type?new Cb(s,i,Xl(i,s)):null}let Eg=(()=>{class i{}return i.__NG_ELEMENT_ID__=Sb,i})();function Sb(){return C0(ti(),lt())}const Mb=Eg,D0=class extends Mb{constructor(s,c,p){super(),this._lContainer=s,this._hostTNode=c,this._hostLView=p}get element(){return Xl(this._hostTNode,this._hostLView)}get injector(){return new Ei(this._hostTNode,this._hostLView)}get parentInjector(){const s=Da(this._hostTNode,this._hostLView);if(gs(s)){const c=ta(s,this._hostLView),p=Uo(s);return new Ei(c[1].data[p+8],c)}return new Ei(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(s){const c=T0(this._lContainer);return null!==c&&c[s]||null}get length(){return this._lContainer.length-10}createEmbeddedView(s,c,p){let y,b;"number"==typeof p?y=p:null!=p&&(y=p.index,b=p.injector);const C=s.createEmbeddedView(c||{},b);return this.insert(C,y),C}createComponent(s,c,p,y,b){const C=s&&!function t(i){return"function"==typeof i}(s);let M;if(C)M=c;else{const ce=c||{};M=ce.index,p=ce.injector,y=ce.projectableNodes,b=ce.environmentInjector||ce.ngModuleRef}const O=C?s:new id(Un(s)),N=p||this.parentInjector;if(!b&&null==O.ngModule){const De=(C?N:this.parentInjector).get(Pc,null);De&&(b=De)}const q=O.create(N,y,void 0,b);return this.insert(q.hostView,M),q}insert(s,c){const p=s._lView,y=p[1];if(function ds(i){return ai(i[3])}(p)){const q=this.indexOf(s);if(-1!==q)this.detach(q);else{const ce=p[3],De=new D0(ce,ce[6],ce[3]);De.detach(De.indexOf(s))}}const b=this._adjustIndex(c),C=this._lContainer;!function xd(i,s,c,p){const y=10+p,b=c.length;p>0&&(c[y-1][4]=s),p<b-10?(s[4]=c[y],v(c,10+p,s)):(c.push(s),s[4]=null),s[3]=c;const C=s[17];null!==C&&c!==C&&function ar(i,s){const c=i[9];s[16]!==s[3][3][16]&&(i[2]=!0),null===c?i[9]=[s]:c.push(s)}(C,s);const M=s[19];null!==M&&M.insertView(i),s[2]|=64}(y,p,C,b);const M=Ed(b,C),O=p[11],N=Fu(O,C[7]);return null!==N&&function Ti(i,s,c,p,y,b){p[0]=y,p[6]=s,xh(i,p,c,1,y,b)}(y,C[6],O,p,N,M),s.attachToViewContainerRef(),v(dy(C),b,s),s}move(s,c){return this.insert(s,c)}indexOf(s){const c=T0(this._lContainer);return null!==c?c.indexOf(s):-1}remove(s){const c=this._adjustIndex(s,-1),p=vh(this._lContainer,c);p&&(E(dy(this._lContainer),c),ka(p[1],p))}detach(s){const c=this._adjustIndex(s,-1),p=vh(this._lContainer,c);return p&&null!=E(dy(this._lContainer),c)?new gu(p):null}_adjustIndex(s,c=0){return s??this.length+c}};function T0(i){return i[8]}function dy(i){return i[8]||(i[8]=[])}function C0(i,s){let c;const p=s[i.index];if(ai(p))c=p;else{let y;if(8&i.type)y=Br(p);else{const b=s[11];y=b.createComment("");const C=vi(i,s);$o(b,Fu(b,C),y,function zg(i,s){return i.nextSibling(s)}(b,C),!1)}s[i.index]=c=mu(p,s,y,i),nf(s,c)}return new D0(c,i,s)}class fy{constructor(s){this.queryList=s,this.matches=null}clone(){return new fy(this.queryList)}setDirty(){this.queryList.setDirty()}}class py{constructor(s=[]){this.queries=s}createEmbeddedView(s){const c=s.queries;if(null!==c){const p=null!==s.contentQueries?s.contentQueries[0]:c.length,y=[];for(let b=0;b<p;b++){const C=c.getByIndex(b);y.push(this.queries[C.indexInDeclarationView].clone())}return new py(y)}return null}insertView(s){this.dirtyQueriesWithMatches(s)}detachView(s){this.dirtyQueriesWithMatches(s)}dirtyQueriesWithMatches(s){for(let c=0;c<this.queries.length;c++)null!==O0(s,c).matches&&this.queries[c].setDirty()}}class I0{constructor(s,c,p=null){this.predicate=s,this.flags=c,this.read=p}}class my{constructor(s=[]){this.queries=s}elementStart(s,c){for(let p=0;p<this.queries.length;p++)this.queries[p].elementStart(s,c)}elementEnd(s){for(let c=0;c<this.queries.length;c++)this.queries[c].elementEnd(s)}embeddedTView(s){let c=null;for(let p=0;p<this.length;p++){const y=null!==c?c.length:0,b=this.getByIndex(p).embeddedTView(s,y);b&&(b.indexInDeclarationView=p,null!==c?c.push(b):c=[b])}return null!==c?new my(c):null}template(s,c){for(let p=0;p<this.queries.length;p++)this.queries[p].template(s,c)}getByIndex(s){return this.queries[s]}get length(){return this.queries.length}track(s){this.queries.push(s)}}class gy{constructor(s,c=-1){this.metadata=s,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=c}elementStart(s,c){this.isApplyingToNode(c)&&this.matchTNode(s,c)}elementEnd(s){this._declarationNodeIndex===s.index&&(this._appliesToNextNode=!1)}template(s,c){this.elementStart(s,c)}embeddedTView(s,c){return this.isApplyingToNode(s)?(this.crossesNgTemplate=!0,this.addMatch(-s.index,c),new gy(this.metadata)):null}isApplyingToNode(s){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const c=this._declarationNodeIndex;let p=s.parent;for(;null!==p&&8&p.type&&p.index!==c;)p=p.parent;return c===(null!==p?p.index:-1)}return this._appliesToNextNode}matchTNode(s,c){const p=this.metadata.predicate;if(Array.isArray(p))for(let y=0;y<p.length;y++){const b=p[y];this.matchTNodeWithReadOption(s,c,Rb(c,b)),this.matchTNodeWithReadOption(s,c,$s(c,s,b,!1,!1))}else p===Hp?4&c.type&&this.matchTNodeWithReadOption(s,c,-1):this.matchTNodeWithReadOption(s,c,$s(c,s,p,!1,!1))}matchTNodeWithReadOption(s,c,p){if(null!==p){const y=this.metadata.read;if(null!==y)if(y===Rh||y===Eg||y===Hp&&4&c.type)this.addMatch(c.index,-2);else{const b=$s(c,s,y,!1,!1);null!==b&&this.addMatch(c.index,b)}else this.addMatch(c.index,p)}}addMatch(s,c){null===this.matches?this.matches=[s,c]:this.matches.push(s,c)}}function Rb(i,s){const c=i.localNames;if(null!==c)for(let p=0;p<c.length;p+=2)if(c[p]===s)return c[p+1];return null}function Lb(i,s,c,p){return-1===c?function kb(i,s){return 11&i.type?Xl(i,s):4&i.type?wg(i,s):null}(s,i):-2===c?function Ob(i,s,c){return c===Rh?Xl(s,i):c===Hp?wg(s,i):c===Eg?C0(s,i):void 0}(i,s,p):St(i,i[1],c,s)}function S0(i,s,c,p){const y=s[19].queries[p];if(null===y.matches){const b=i.data,C=c.matches,M=[];for(let O=0;O<C.length;O+=2){const N=C[O];M.push(N<0?null:Lb(s,b[N],C[O+1],c.metadata.read))}y.matches=M}return y.matches}function _y(i,s,c,p){const y=i.queries.getByIndex(c),b=y.matches;if(null!==b){const C=S0(i,s,y,c);for(let M=0;M<b.length;M+=2){const O=b[M];if(O>0)p.push(C[M/2]);else{const N=b[M+1],q=s[-O];for(let ce=10;ce<q.length;ce++){const De=q[ce];De[17]===De[3]&&_y(De[1],De,N,p)}if(null!==q[9]){const ce=q[9];for(let De=0;De<ce.length;De++){const ze=ce[De];_y(ze[1],ze,N,p)}}}}}return p}function M0(i){const s=lt(),c=Vn(),p=Qs();Gi(p+1);const y=O0(c,p);if(i.dirty&&function Du(i){return 4==(4&i[2])}(s)===(2==(2&y.metadata.flags))){if(null===y.matches)i.reset([]);else{const b=y.crossesNgTemplate?_y(c,s,p,[]):S0(c,s,y,p);i.reset(b,vm),i.notifyOnChanges()}return!0}return!1}function A0(i,s,c){const p=Vn();p.firstCreatePass&&(L0(p,new I0(i,s,c),-1),2==(2&s)&&(p.staticViewQueries=!0)),k0(p,lt(),s)}function P0(i,s,c,p){const y=Vn();if(y.firstCreatePass){const b=ti();L0(y,new I0(s,c,p),b.index),function zb(i,s){const c=i.contentQueries||(i.contentQueries=[]);s!==(c.length?c[c.length-1]:-1)&&c.push(i.queries.length-1,s)}(y,i),2==(2&c)&&(y.staticContentQueries=!0)}k0(y,lt(),c)}function R0(){return function Fb(i,s){return i[19].queries[s].queryList}(lt(),Qs())}function k0(i,s,c){const p=new hy(4==(4&c));bp(i,s,p,p.destroy),null===s[19]&&(s[19]=new py),s[19].queries.push(new fy(p))}function L0(i,s,c){null===i.queries&&(i.queries=new my),i.queries.track(new gy(s,c))}function O0(i,s){return i.queries.getByIndex(s)}function Tg(...i){}const ex=new _r("Application Initializer");let Cg=(()=>{class i{constructor(c){this.appInits=c,this.resolve=Tg,this.reject=Tg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((p,y)=>{this.resolve=p,this.reject=y})}runInitializers(){if(this.initialized)return;const c=[],p=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let y=0;y<this.appInits.length;y++){const b=this.appInits[y]();if(He(b))c.push(b);else if(je(b)){const C=new Promise((M,O)=>{b.subscribe({complete:M,error:O})});c.push(C)}}Promise.all(c).then(()=>{p()}).catch(y=>{this.reject(y)}),0===c.length&&p(),this.initialized=!0}}return i.\u0275fac=function(c){return new(c||i)(ie(ex,8))},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const tx=new _r("AppId",{providedIn:"root",factory:function nx(){return`${wy()}${wy()}${wy()}`}});function wy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const rx=new _r("Platform Initializer"),iw=new _r("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),ix=new _r("appBootstrapListener");let ow=(()=>{class i{log(c){console.log(c)}warn(c){console.warn(c)}}return i.\u0275fac=function(c){return new(c||i)},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Ig=new _r("LocaleId",{providedIn:"root",factory:()=>V(Ig,ut.Optional|ut.SkipSelf)||function sw(){return typeof $localize<"u"&&$localize.locale||hf}()}),aw=new _r("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class lw{constructor(s,c){this.ngModuleFactory=s,this.componentFactories=c}}let cw=(()=>{class i{compileModuleSync(c){return new ay(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){const p=this.compileModuleSync(c),b=ml(kr(c).declarations).reduce((C,M)=>{const O=Un(M);return O&&C.push(new id(O)),C},[]);return new lw(p,b)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}}return i.\u0275fac=function(c){return new(c||i)},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const dw=(()=>Promise.resolve(0))();function Ey(i){typeof Zone>"u"?dw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Dl{constructor({enableLongStackTrace:s=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:p=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Gc(!1),this.onMicrotaskEmpty=new Gc(!1),this.onStable=new Gc(!1),this.onError=new Gc(!1),typeof Zone>"u")throw new Pt(908,!1);Zone.assertZonePatched();const y=this;y._nesting=0,y._outer=y._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(y._inner=y._inner.fork(new Zone.TaskTrackingZoneSpec)),s&&Zone.longStackTraceZoneSpec&&(y._inner=y._inner.fork(Zone.longStackTraceZoneSpec)),y.shouldCoalesceEventChangeDetection=!p&&c,y.shouldCoalesceRunChangeDetection=p,y.lastRequestAnimationFrameId=-1,y.nativeRequestAnimationFrame=function fw(){let i=Hn.requestAnimationFrame,s=Hn.cancelAnimationFrame;if(typeof Zone<"u"&&i&&s){const c=i[Zone.__symbol__("OriginalDelegate")];c&&(i=c);const p=s[Zone.__symbol__("OriginalDelegate")];p&&(s=p)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:s}}().nativeRequestAnimationFrame,function gw(i){const s=()=>{!function mw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(Hn,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Ty(i),i.isCheckStableRunning=!0,Dy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Ty(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(c,p,y,b,C,M)=>{try{return ax(i),c.invokeTask(y,b,C,M)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===b.type||i.shouldCoalesceRunChangeDetection)&&s(),lx(i)}},onInvoke:(c,p,y,b,C,M,O)=>{try{return ax(i),c.invoke(y,b,C,M,O)}finally{i.shouldCoalesceRunChangeDetection&&s(),lx(i)}},onHasTask:(c,p,y,b)=>{c.hasTask(y,b),p===y&&("microTask"==b.change?(i._hasPendingMicrotasks=b.microTask,Ty(i),Dy(i)):"macroTask"==b.change&&(i.hasPendingMacrotasks=b.macroTask))},onHandleError:(c,p,y,b)=>(c.handleError(y,b),i.runOutsideAngular(()=>i.onError.emit(b)),!1)})}(y)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Dl.isInAngularZone())throw new Pt(909,!1)}static assertNotInAngularZone(){if(Dl.isInAngularZone())throw new Pt(909,!1)}run(s,c,p){return this._inner.run(s,c,p)}runTask(s,c,p,y){const b=this._inner,C=b.scheduleEventTask("NgZoneEvent: "+y,s,pw,Tg,Tg);try{return b.runTask(C,c,p)}finally{b.cancelTask(C)}}runGuarded(s,c,p){return this._inner.runGuarded(s,c,p)}runOutsideAngular(s){return this._outer.run(s)}}const pw={};function Dy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Ty(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function ax(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function lx(i){i._nesting--,Dy(i)}class _w{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Gc,this.onMicrotaskEmpty=new Gc,this.onStable=new Gc,this.onError=new Gc}run(s,c,p){return s.apply(c,p)}runGuarded(s,c,p){return s.apply(c,p)}runOutsideAngular(s){return s()}runTask(s,c,p,y){return s.apply(c,p)}}const cx=new _r(""),ux=new _r("");let Cy,yw=(()=>{class i{constructor(c,p,y){this._ngZone=c,this.registry=p,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Cy||(function vw(i){Cy=i}(y),y.addToWindow(p)),this._watchAngularEvents(),c.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Dl.assertNotInAngularZone(),Ey(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ey(()=>{for(;0!==this._callbacks.length;){let c=this._callbacks.pop();clearTimeout(c.timeoutId),c.doneCb(this._didWork)}this._didWork=!1});else{let c=this.getPendingTasks();this._callbacks=this._callbacks.filter(p=>!p.updateCb||!p.updateCb(c)||(clearTimeout(p.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(c=>({source:c.source,creationLocation:c.creationLocation,data:c.data})):[]}addCallback(c,p,y){let b=-1;p&&p>0&&(b=setTimeout(()=>{this._callbacks=this._callbacks.filter(C=>C.timeoutId!==b),c(this._didWork,this.getPendingTasks())},p)),this._callbacks.push({doneCb:c,timeoutId:b,updateCb:y})}whenStable(c,p,y){if(y&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(c,p,y),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(c){this.registry.registerApplication(c,this)}unregisterApplication(c){this.registry.unregisterApplication(c)}findProviders(c,p,y){return[]}}return i.\u0275fac=function(c){return new(c||i)(ie(Dl),ie(hx),ie(ux))},i.\u0275prov=Jn({token:i,factory:i.\u0275fac}),i})(),hx=(()=>{class i{constructor(){this._applications=new Map}registerApplication(c,p){this._applications.set(c,p)}unregisterApplication(c){this._applications.delete(c)}unregisterAllApplications(){this._applications.clear()}getTestability(c){return this._applications.get(c)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(c,p=!0){return Cy?.findTestabilityInTree(this,c,p)??null}}return i.\u0275fac=function(c){return new(c||i)},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})(),oh=null;const dx=new _r("AllowMultipleToken"),Iy=new _r("PlatformDestroyListeners");class ww{constructor(s,c){this.name=s,this.token=c}}function px(i,s,c=[]){const p=`Platform: ${s}`,y=new _r(p);return(b=[])=>{let C=Sy();if(!C||C.injector.get(dx,!1)){const M=[...c,...b,{provide:y,useValue:!0}];i?i(M):function Ew(i){if(oh&&!oh.get(dx,!1))throw new Pt(400,!1);oh=i;const s=i.get(gx);(function fx(i){const s=i.get(rx,null);s&&s.forEach(c=>c())})(i)}(function mx(i=[],s){return ua.create({name:s,providers:[{provide:kd,useValue:"platform"},{provide:Iy,useValue:new Set([()=>oh=null])},...i]})}(M,p))}return function Tw(i){const s=Sy();if(!s)throw new Pt(401,!1);return s}()}}function Sy(){return oh?.get(gx)??null}let gx=(()=>{class i{constructor(c){this._injector=c,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(c,p){const y=function yx(i,s){let c;return c="noop"===i?new _w:("zone.js"===i?void 0:i)||new Dl(s),c}(p?.ngZone,function _x(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(p)),b=[{provide:Dl,useValue:y}];return y.run(()=>{const C=ua.create({providers:b,parent:this.injector,name:c.moduleType.name}),M=c.create(C),O=M.injector.get(Rc,null);if(!O)throw new Pt(402,!1);return y.runOutsideAngular(()=>{const N=y.onError.subscribe({next:q=>{O.handleError(q)}});M.onDestroy(()=>{Mg(this._modules,M),N.unsubscribe()})}),function vx(i,s,c){try{const p=c();return He(p)?p.catch(y=>{throw s.runOutsideAngular(()=>i.handleError(y)),y}):p}catch(p){throw s.runOutsideAngular(()=>i.handleError(p)),p}}(O,y,()=>{const N=M.injector.get(Cg);return N.runInitializers(),N.donePromise.then(()=>(function Ov(i){mn(i,"Expected localeId to be defined"),"string"==typeof i&&(Lv=i.toLowerCase().replace(/_/g,"-"))}(M.injector.get(Ig,hf)||hf),this._moduleDoBootstrap(M),M))})})}bootstrapModule(c,p=[]){const y=xx({},p);return function xw(i,s,c){const p=new ay(c);return Promise.resolve(p)}(0,0,c).then(b=>this.bootstrapModuleFactory(b,y))}_moduleDoBootstrap(c){const p=c.injector.get(Sg);if(c._bootstrapComponents.length>0)c._bootstrapComponents.forEach(y=>p.bootstrap(y));else{if(!c.instance.ngDoBootstrap)throw new Pt(403,!1);c.instance.ngDoBootstrap(p)}this._modules.push(c)}onDestroy(c){this._destroyListeners.push(c)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Pt(404,!1);this._modules.slice().forEach(p=>p.destroy()),this._destroyListeners.forEach(p=>p());const c=this._injector.get(Iy,null);c&&(c.forEach(p=>p()),c.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(c){return new(c||i)(ie(ua))},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function xx(i,s){return Array.isArray(s)?s.reduce(xx,i):{...i,...s}}let Sg=(()=>{class i{constructor(c,p,y){this._zone=c,this._injector=p,this._exceptionHandler=y,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const b=new Rt.y(M=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{M.next(this._stable),M.complete()})}),C=new Rt.y(M=>{let O;this._zone.runOutsideAngular(()=>{O=this._zone.onStable.subscribe(()=>{Dl.assertNotInAngularZone(),Ey(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,M.next(!0))})})});const N=this._zone.onUnstable.subscribe(()=>{Dl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{M.next(!1)}))});return()=>{O.unsubscribe(),N.unsubscribe()}});this.isStable=function vt(...i){const s=(0,Nt.yG)(i),c=(0,Nt._6)(i,1/0),p=i;return p.length?1===p.length?(0,Te.Xf)(p[0]):(0,u.J)(c)((0,At.D)(p,s)):Gt.E}(b,C.pipe(function It(i={}){const{connector:s=(()=>new G.x),resetOnError:c=!0,resetOnComplete:p=!0,resetOnRefCountZero:y=!0}=i;return b=>{let C,M,O,N=0,q=!1,ce=!1;const De=()=>{M?.unsubscribe(),M=void 0},ze=()=>{De(),C=O=void 0,q=ce=!1},it=()=>{const Et=C;ze(),Et?.unsubscribe()};return(0,Qe.e)((Et,zt)=>{N++,!ce&&!q&&De();const Wt=O=O??s();zt.add(()=>{N--,0===N&&!ce&&!q&&(M=xn(it,y))}),Wt.subscribe(zt),!C&&N>0&&(C=new mt.Hp({next:dn=>Wt.next(dn),error:dn=>{ce=!0,De(),M=xn(ze,c,dn),Wt.error(dn)},complete:()=>{q=!0,De(),M=xn(ze,p),Wt.complete()}}),(0,Te.Xf)(Et).subscribe(C))})(b)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,p){const y=c instanceof Ah;if(!this._injector.get(Cg).done)throw!y&&_n(c),new Pt(405,false);let C;C=y?c:this._injector.get(Ph).resolveComponentFactory(c),this.componentTypes.push(C.componentType);const M=function bw(i){return i.isBoundToModule}(C)?void 0:this._injector.get(df),N=C.create(ua.NULL,[],p||C.selector,M),q=N.location.nativeElement,ce=N.injector.get(cx,null);return ce?.registerApplication(q),N.onDestroy(()=>{this.detachView(N.hostView),Mg(this.components,N),ce?.unregisterApplication(q)}),this._loadComponent(N),N}tick(){if(this._runningTick)throw new Pt(101,!1);try{this._runningTick=!0;for(let c of this._views)c.detectChanges()}catch(c){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(c))}finally{this._runningTick=!1}}attachView(c){const p=c;this._views.push(p),p.attachToAppRef(this)}detachView(c){const p=c;Mg(this._views,p),p.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c),this._injector.get(ix,[]).concat(this._bootstrapListeners).forEach(y=>y(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>Mg(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new Pt(406,!1);const c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(c){return new(c||i)(ie(Dl),ie(Pc),ie(Rc))},i.\u0275prov=Jn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Mg(i,s){const c=i.indexOf(s);c>-1&&i.splice(c,1)}function Iw(){}let Sw=(()=>{class i{}return i.__NG_ELEMENT_ID__=Mw,i})();function Mw(i){return function Aw(i,s,c){if(_a(i)&&!c){const p=er(i.index,s);return new gu(p,p)}return 47&i.type?new gu(s[16],s):null}(ti(),lt(),16==(16&i))}class Tx{constructor(){}supports(s){return wl(s)}create(s){return new Fw(s)}}const Ow=(i,s)=>s;class Fw{constructor(s){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=s||Ow}forEachItem(s){let c;for(c=this._itHead;null!==c;c=c._next)s(c)}forEachOperation(s){let c=this._itHead,p=this._removalsHead,y=0,b=null;for(;c||p;){const C=!p||c&&c.currentIndex<Ix(p,y,b)?c:p,M=Ix(C,y,b),O=C.currentIndex;if(C===p)y--,p=p._nextRemoved;else if(c=c._next,null==C.previousIndex)y++;else{b||(b=[]);const N=M-y,q=O-y;if(N!=q){for(let De=0;De<N;De++){const ze=De<b.length?b[De]:b[De]=0,it=ze+De;q<=it&&it<N&&(b[De]=ze+1)}b[C.previousIndex]=q-N}}M!==O&&s(C,M,O)}}forEachPreviousItem(s){let c;for(c=this._previousItHead;null!==c;c=c._nextPrevious)s(c)}forEachAddedItem(s){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)s(c)}forEachMovedItem(s){let c;for(c=this._movesHead;null!==c;c=c._nextMoved)s(c)}forEachRemovedItem(s){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)s(c)}forEachIdentityChange(s){let c;for(c=this._identityChangesHead;null!==c;c=c._nextIdentityChange)s(c)}diff(s){if(null==s&&(s=[]),!wl(s))throw new Pt(900,!1);return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let y,b,C,c=this._itHead,p=!1;if(Array.isArray(s)){this.length=s.length;for(let M=0;M<this.length;M++)b=s[M],C=this._trackByFn(M,b),null!==c&&Object.is(c.trackById,C)?(p&&(c=this._verifyReinsertion(c,b,C,M)),Object.is(c.item,b)||this._addIdentityChange(c,b)):(c=this._mismatch(c,b,C,M),p=!0),c=c._next}else y=0,function Mp(i,s){if(Array.isArray(i))for(let c=0;c<i.length;c++)s(i[c]);else{const c=i[bl()]();let p;for(;!(p=c.next()).done;)s(p.value)}}(s,M=>{C=this._trackByFn(y,M),null!==c&&Object.is(c.trackById,C)?(p&&(c=this._verifyReinsertion(c,M,C,y)),Object.is(c.item,M)||this._addIdentityChange(c,M)):(c=this._mismatch(c,M,C,y),p=!0),c=c._next,y++}),this.length=y;return this._truncate(c),this.collection=s,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let s;for(s=this._previousItHead=this._itHead;null!==s;s=s._next)s._nextPrevious=s._next;for(s=this._additionsHead;null!==s;s=s._nextAdded)s.previousIndex=s.currentIndex;for(this._additionsHead=this._additionsTail=null,s=this._movesHead;null!==s;s=s._nextMoved)s.previousIndex=s.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(s,c,p,y){let b;return null===s?b=this._itTail:(b=s._prev,this._remove(s)),null!==(s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(p,null))?(Object.is(s.item,c)||this._addIdentityChange(s,c),this._reinsertAfter(s,b,y)):null!==(s=null===this._linkedRecords?null:this._linkedRecords.get(p,y))?(Object.is(s.item,c)||this._addIdentityChange(s,c),this._moveAfter(s,b,y)):s=this._addAfter(new zw(c,p),b,y),s}_verifyReinsertion(s,c,p,y){let b=null===this._unlinkedRecords?null:this._unlinkedRecords.get(p,null);return null!==b?s=this._reinsertAfter(b,s._prev,y):s.currentIndex!=y&&(s.currentIndex=y,this._addToMoves(s,y)),s}_truncate(s){for(;null!==s;){const c=s._next;this._addToRemovals(this._unlink(s)),s=c}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(s,c,p){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(s);const y=s._prevRemoved,b=s._nextRemoved;return null===y?this._removalsHead=b:y._nextRemoved=b,null===b?this._removalsTail=y:b._prevRemoved=y,this._insertAfter(s,c,p),this._addToMoves(s,p),s}_moveAfter(s,c,p){return this._unlink(s),this._insertAfter(s,c,p),this._addToMoves(s,p),s}_addAfter(s,c,p){return this._insertAfter(s,c,p),this._additionsTail=null===this._additionsTail?this._additionsHead=s:this._additionsTail._nextAdded=s,s}_insertAfter(s,c,p){const y=null===c?this._itHead:c._next;return s._next=y,s._prev=c,null===y?this._itTail=s:y._prev=s,null===c?this._itHead=s:c._next=s,null===this._linkedRecords&&(this._linkedRecords=new Cx),this._linkedRecords.put(s),s.currentIndex=p,s}_remove(s){return this._addToRemovals(this._unlink(s))}_unlink(s){null!==this._linkedRecords&&this._linkedRecords.remove(s);const c=s._prev,p=s._next;return null===c?this._itHead=p:c._next=p,null===p?this._itTail=c:p._prev=c,s}_addToMoves(s,c){return s.previousIndex===c||(this._movesTail=null===this._movesTail?this._movesHead=s:this._movesTail._nextMoved=s),s}_addToRemovals(s){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Cx),this._unlinkedRecords.put(s),s.currentIndex=null,s._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=s,s._prevRemoved=null):(s._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=s),s}_addIdentityChange(s,c){return s.item=c,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=s:this._identityChangesTail._nextIdentityChange=s,s}}class zw{constructor(s,c){this.item=s,this.trackById=c,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Bw{constructor(){this._head=null,this._tail=null}add(s){null===this._head?(this._head=this._tail=s,s._nextDup=null,s._prevDup=null):(this._tail._nextDup=s,s._prevDup=this._tail,s._nextDup=null,this._tail=s)}get(s,c){let p;for(p=this._head;null!==p;p=p._nextDup)if((null===c||c<=p.currentIndex)&&Object.is(p.trackById,s))return p;return null}remove(s){const c=s._prevDup,p=s._nextDup;return null===c?this._head=p:c._nextDup=p,null===p?this._tail=c:p._prevDup=c,null===this._head}}class Cx{constructor(){this.map=new Map}put(s){const c=s.trackById;let p=this.map.get(c);p||(p=new Bw,this.map.set(c,p)),p.add(s)}get(s,c){const y=this.map.get(s);return y?y.get(s,c):null}remove(s){const c=s.trackById;return this.map.get(c).remove(s)&&this.map.delete(c),s}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ix(i,s,c){const p=i.previousIndex;if(null===p)return p;let y=0;return c&&p<c.length&&(y=c[p]),p+s+y}class Sx{constructor(){}supports(s){return s instanceof Map||pa(s)}create(){return new Nw}}class Nw{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(s){let c;for(c=this._mapHead;null!==c;c=c._next)s(c)}forEachPreviousItem(s){let c;for(c=this._previousMapHead;null!==c;c=c._nextPrevious)s(c)}forEachChangedItem(s){let c;for(c=this._changesHead;null!==c;c=c._nextChanged)s(c)}forEachAddedItem(s){let c;for(c=this._additionsHead;null!==c;c=c._nextAdded)s(c)}forEachRemovedItem(s){let c;for(c=this._removalsHead;null!==c;c=c._nextRemoved)s(c)}diff(s){if(s){if(!(s instanceof Map||pa(s)))throw new Pt(900,!1)}else s=new Map;return this.check(s)?this:null}onDestroy(){}check(s){this._reset();let c=this._mapHead;if(this._appendAfter=null,this._forEach(s,(p,y)=>{if(c&&c.key===y)this._maybeAddToChanges(c,p),this._appendAfter=c,c=c._next;else{const b=this._getOrCreateRecordForKey(y,p);c=this._insertBeforeOrAppend(c,b)}}),c){c._prev&&(c._prev._next=null),this._removalsHead=c;for(let p=c;null!==p;p=p._nextRemoved)p===this._mapHead&&(this._mapHead=null),this._records.delete(p.key),p._nextRemoved=p._next,p.previousValue=p.currentValue,p.currentValue=null,p._prev=null,p._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(s,c){if(s){const p=s._prev;return c._next=s,c._prev=p,s._prev=c,p&&(p._next=c),s===this._mapHead&&(this._mapHead=c),this._appendAfter=s,s}return this._appendAfter?(this._appendAfter._next=c,c._prev=this._appendAfter):this._mapHead=c,this._appendAfter=c,null}_getOrCreateRecordForKey(s,c){if(this._records.has(s)){const y=this._records.get(s);this._maybeAddToChanges(y,c);const b=y._prev,C=y._next;return b&&(b._next=C),C&&(C._prev=b),y._next=null,y._prev=null,y}const p=new Uw(s);return this._records.set(s,p),p.currentValue=c,this._addToAdditions(p),p}_reset(){if(this.isDirty){let s;for(this._previousMapHead=this._mapHead,s=this._previousMapHead;null!==s;s=s._next)s._nextPrevious=s._next;for(s=this._changesHead;null!==s;s=s._nextChanged)s.previousValue=s.currentValue;for(s=this._additionsHead;null!=s;s=s._nextAdded)s.previousValue=s.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(s,c){Object.is(c,s.currentValue)||(s.previousValue=s.currentValue,s.currentValue=c,this._addToChanges(s))}_addToAdditions(s){null===this._additionsHead?this._additionsHead=this._additionsTail=s:(this._additionsTail._nextAdded=s,this._additionsTail=s)}_addToChanges(s){null===this._changesHead?this._changesHead=this._changesTail=s:(this._changesTail._nextChanged=s,this._changesTail=s)}_forEach(s,c){s instanceof Map?s.forEach(c):Object.keys(s).forEach(p=>c(s[p],p))}}class Uw{constructor(s){this.key=s,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Mx(){return new ky([new Tx])}let ky=(()=>{class i{constructor(c){this.factories=c}static create(c,p){if(null!=p){const y=p.factories.slice();c=c.concat(y)}return new i(c)}static extend(c){return{provide:i,useFactory:p=>i.create(c,p||Mx()),deps:[[i,new ke,new Xe]]}}find(c){const p=this.factories.find(y=>y.supports(c));if(null!=p)return p;throw new Pt(901,!1)}}return i.\u0275prov=Jn({token:i,providedIn:"root",factory:Mx}),i})();function Ax(){return new Ly([new Sx])}let Ly=(()=>{class i{constructor(c){this.factories=c}static create(c,p){if(p){const y=p.factories.slice();c=c.concat(y)}return new i(c)}static extend(c){return{provide:i,useFactory:p=>i.create(c,p||Ax()),deps:[[i,new ke,new Xe]]}}find(c){const p=this.factories.find(y=>y.supports(c));if(p)return p;throw new Pt(901,!1)}}return i.\u0275prov=Jn({token:i,providedIn:"root",factory:Ax}),i})();const $w=px(null,"core",[]);let Gw=(()=>{class i{constructor(c){}}return i.\u0275fac=function(c){return new(c||i)(ie(Sg))},i.\u0275mod=ko({type:i}),i.\u0275inj=hi({}),i})();function Hw(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},481:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{Dx:()=>bn,b2:()=>uo,q6:()=>hi});var G=Ae(895),Ee=Ae(256);class Rt extends G.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends Rt{static makeCurrent(){(0,G.HT)(new u)}onAndCancel(ee,te,de){return ee.addEventListener(te,de,!1),()=>{ee.removeEventListener(te,de,!1)}}dispatchEvent(ee,te){ee.dispatchEvent(te)}remove(ee){ee.parentNode&&ee.parentNode.removeChild(ee)}createElement(ee,te){return(te=te||this.getDefaultDocument()).createElement(ee)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ee){return ee.nodeType===Node.ELEMENT_NODE}isShadowRoot(ee){return ee instanceof DocumentFragment}getGlobalEventTarget(ee,te){return"window"===te?window:"document"===te?ee:"body"===te?ee.body:null}getBaseHref(ee){const te=function Gt(){return Te=Te||document.querySelector("base"),Te?Te.getAttribute("href"):null}();return null==te?null:function At(Q){Nt=Nt||document.createElement("a"),Nt.setAttribute("href",Q);const ee=Nt.pathname;return"/"===ee.charAt(0)?ee:`/${ee}`}(te)}resetBaseElement(){Te=null}getUserAgent(){return window.navigator.userAgent}getCookie(ee){return(0,G.Mx)(document.cookie,ee)}}let Nt,Te=null;const vt=new Ee.OlP("TRANSITION_ID"),Qe=[{provide:Ee.ip1,useFactory:function mt(Q,ee,te){return()=>{te.get(Ee.CZH).donePromise.then(()=>{const de=(0,G.q)(),Re=ee.querySelectorAll(`style[ng-transition="${Q}"]`);for(let rt=0;rt<Re.length;rt++)de.remove(Re[rt])})}},deps:[vt,G.K0,Ee.zs3],multi:!0}];let xn=(()=>{class Q{build(){return new XMLHttpRequest}}return Q.\u0275fac=function(te){return new(te||Q)},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();const wt=new Ee.OlP("EventManagerPlugins");let Ht=(()=>{class Q{constructor(te,de){this._zone=de,this._eventNameToPlugin=new Map,te.forEach(Re=>Re.manager=this),this._plugins=te.slice().reverse()}addEventListener(te,de,Re){return this._findPluginFor(de).addEventListener(te,de,Re)}addGlobalEventListener(te,de,Re){return this._findPluginFor(de).addGlobalEventListener(te,de,Re)}getZone(){return this._zone}_findPluginFor(te){const de=this._eventNameToPlugin.get(te);if(de)return de;const Re=this._plugins;for(let rt=0;rt<Re.length;rt++){const We=Re[rt];if(We.supports(te))return this._eventNameToPlugin.set(te,We),We}throw new Error(`No event manager plugin found for event ${te}`)}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(wt),Ee.LFG(Ee.R0b))},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class Xt{constructor(ee){this._doc=ee}addGlobalEventListener(ee,te,de){const Re=(0,G.q)().getGlobalEventTarget(this._doc,ee);if(!Re)throw new Error(`Unsupported event target ${Re} for event ${te}`);return this.addEventListener(Re,te,de)}}let Lt=(()=>{class Q{constructor(){this._stylesSet=new Set}addStyles(te){const de=new Set;te.forEach(Re=>{this._stylesSet.has(Re)||(this._stylesSet.add(Re),de.add(Re))}),this.onStylesAdded(de)}onStylesAdded(te){}getAllStyles(){return Array.from(this._stylesSet)}}return Q.\u0275fac=function(te){return new(te||Q)},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),et=(()=>{class Q extends Lt{constructor(te){super(),this._doc=te,this._hostNodes=new Map,this._hostNodes.set(te.head,[])}_addStylesToHost(te,de,Re){te.forEach(rt=>{const We=this._doc.createElement("style");We.textContent=rt,Re.push(de.appendChild(We))})}addHost(te){const de=[];this._addStylesToHost(this._stylesSet,te,de),this._hostNodes.set(te,de)}removeHost(te){const de=this._hostNodes.get(te);de&&de.forEach(Yn),this._hostNodes.delete(te)}onStylesAdded(te){this._hostNodes.forEach((de,Re)=>{this._addStylesToHost(te,Re,de)})}ngOnDestroy(){this._hostNodes.forEach(te=>te.forEach(Yn))}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(G.K0))},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();function Yn(Q){(0,G.q)().remove(Q)}const Ut={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Zt=/%COMP%/g;function Ie(Q,ee,te){for(let de=0;de<ee.length;de++){let Re=ee[de];Array.isArray(Re)?Ie(Q,Re,te):(Re=Re.replace(Zt,Q),te.push(Re))}return te}function Ne(Q){return ee=>{if("__ngUnwrap__"===ee)return Q;!1===Q(ee)&&(ee.preventDefault(),ee.returnValue=!1)}}let Ve=(()=>{class Q{constructor(te,de,Re){this.eventManager=te,this.sharedStylesHost=de,this.appId=Re,this.rendererByCompId=new Map,this.defaultRenderer=new Dt(te)}createRenderer(te,de){if(!te||!de)return this.defaultRenderer;switch(de.encapsulation){case Ee.ifc.Emulated:{let Re=this.rendererByCompId.get(de.id);return Re||(Re=new lr(this.eventManager,this.sharedStylesHost,de,this.appId),this.rendererByCompId.set(de.id,Re)),Re.applyToHost(te),Re}case 1:case Ee.ifc.ShadowDom:return new en(this.eventManager,this.sharedStylesHost,te,de);default:if(!this.rendererByCompId.has(de.id)){const Re=Ie(de.id,de.styles,[]);this.sharedStylesHost.addStyles(Re),this.rendererByCompId.set(de.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(Ht),Ee.LFG(et),Ee.LFG(Ee.AFp))},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class Dt{constructor(ee){this.eventManager=ee,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ee,te){return te?document.createElementNS(Ut[te]||te,ee):document.createElement(ee)}createComment(ee){return document.createComment(ee)}createText(ee){return document.createTextNode(ee)}appendChild(ee,te){(Gn(ee)?ee.content:ee).appendChild(te)}insertBefore(ee,te,de){ee&&(Gn(ee)?ee.content:ee).insertBefore(te,de)}removeChild(ee,te){ee&&ee.removeChild(te)}selectRootElement(ee,te){let de="string"==typeof ee?document.querySelector(ee):ee;if(!de)throw new Error(`The selector "${ee}" did not match any elements`);return te||(de.textContent=""),de}parentNode(ee){return ee.parentNode}nextSibling(ee){return ee.nextSibling}setAttribute(ee,te,de,Re){if(Re){te=Re+":"+te;const rt=Ut[Re];rt?ee.setAttributeNS(rt,te,de):ee.setAttribute(te,de)}else ee.setAttribute(te,de)}removeAttribute(ee,te,de){if(de){const Re=Ut[de];Re?ee.removeAttributeNS(Re,te):ee.removeAttribute(`${de}:${te}`)}else ee.removeAttribute(te)}addClass(ee,te){ee.classList.add(te)}removeClass(ee,te){ee.classList.remove(te)}setStyle(ee,te,de,Re){Re&(Ee.JOm.DashCase|Ee.JOm.Important)?ee.style.setProperty(te,de,Re&Ee.JOm.Important?"important":""):ee.style[te]=de}removeStyle(ee,te,de){de&Ee.JOm.DashCase?ee.style.removeProperty(te):ee.style[te]=""}setProperty(ee,te,de){ee[te]=de}setValue(ee,te){ee.nodeValue=te}listen(ee,te,de){return"string"==typeof ee?this.eventManager.addGlobalEventListener(ee,te,Ne(de)):this.eventManager.addEventListener(ee,te,Ne(de))}}function Gn(Q){return"TEMPLATE"===Q.tagName&&void 0!==Q.content}class lr extends Dt{constructor(ee,te,de,Re){super(ee),this.component=de;const rt=Ie(Re+"-"+de.id,de.styles,[]);te.addStyles(rt),this.contentAttr=function st(Q){return"_ngcontent-%COMP%".replace(Zt,Q)}(Re+"-"+de.id),this.hostAttr=function kt(Q){return"_nghost-%COMP%".replace(Zt,Q)}(Re+"-"+de.id)}applyToHost(ee){super.setAttribute(ee,this.hostAttr,"")}createElement(ee,te){const de=super.createElement(ee,te);return super.setAttribute(de,this.contentAttr,""),de}}class en extends Dt{constructor(ee,te,de,Re){super(ee),this.sharedStylesHost=te,this.hostEl=de,this.shadowRoot=de.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const rt=Ie(Re.id,Re.styles,[]);for(let We=0;We<rt.length;We++){const Ot=document.createElement("style");Ot.textContent=rt[We],this.shadowRoot.appendChild(Ot)}}nodeOrShadowRoot(ee){return ee===this.hostEl?this.shadowRoot:ee}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(ee,te){return super.appendChild(this.nodeOrShadowRoot(ee),te)}insertBefore(ee,te,de){return super.insertBefore(this.nodeOrShadowRoot(ee),te,de)}removeChild(ee,te){return super.removeChild(this.nodeOrShadowRoot(ee),te)}parentNode(ee){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ee)))}}let Mr=(()=>{class Q extends Xt{constructor(te){super(te)}supports(te){return!0}addEventListener(te,de,Re){return te.addEventListener(de,Re,!1),()=>this.removeEventListener(te,de,Re)}removeEventListener(te,de,Re){return te.removeEventListener(de,Re)}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(G.K0))},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();const gi=["alt","control","meta","shift"],kn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},hr={alt:Q=>Q.altKey,control:Q=>Q.ctrlKey,meta:Q=>Q.metaKey,shift:Q=>Q.shiftKey};let ui=(()=>{class Q extends Xt{constructor(te){super(te)}supports(te){return null!=Q.parseEventName(te)}addEventListener(te,de,Re){const rt=Q.parseEventName(de),We=Q.eventCallback(rt.fullKey,Re,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,G.q)().onAndCancel(te,rt.domEventName,We))}static parseEventName(te){const de=te.toLowerCase().split("."),Re=de.shift();if(0===de.length||"keydown"!==Re&&"keyup"!==Re)return null;const rt=Q._normalizeKey(de.pop());let We="",Ot=de.indexOf("code");if(Ot>-1&&(de.splice(Ot,1),We="code."),gi.forEach(Ln=>{const Jt=de.indexOf(Ln);Jt>-1&&(de.splice(Jt,1),We+=Ln+".")}),We+=rt,0!=de.length||0===rt.length)return null;const nn={};return nn.domEventName=Re,nn.fullKey=We,nn}static matchEventFullKeyCode(te,de){let Re=kn[te.key]||te.key,rt="";return de.indexOf("code.")>-1&&(Re=te.code,rt="code."),!(null==Re||!Re)&&(Re=Re.toLowerCase()," "===Re?Re="space":"."===Re&&(Re="dot"),gi.forEach(We=>{We!==Re&&(0,hr[We])(te)&&(rt+=We+".")}),rt+=Re,rt===de)}static eventCallback(te,de,Re){return rt=>{Q.matchEventFullKeyCode(rt,te)&&Re.runGuarded(()=>de(rt))}}static _normalizeKey(te){return"esc"===te?"escape":te}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(G.K0))},Q.\u0275prov=Ee.Yz7({token:Q,factory:Q.\u0275fac}),Q})();const hi=(0,Ee.eFA)(Ee._c5,"browser",[{provide:Ee.Lbi,useValue:G.bD},{provide:Ee.g9A,useValue:function Ki(){u.makeCurrent()},multi:!0},{provide:G.K0,useFactory:function Jn(){return(0,Ee.RDi)(document),document},deps:[]}]),$i=new Ee.OlP(""),Jr=[{provide:Ee.rWj,useClass:class It{addToWindow(ee){Ee.dqk.getAngularTestability=(de,Re=!0)=>{const rt=ee.findTestabilityInTree(de,Re);if(null==rt)throw new Error("Could not find testability for element.");return rt},Ee.dqk.getAllAngularTestabilities=()=>ee.getAllTestabilities(),Ee.dqk.getAllAngularRootElements=()=>ee.getAllRootElements(),Ee.dqk.frameworkStabilizers||(Ee.dqk.frameworkStabilizers=[]),Ee.dqk.frameworkStabilizers.push(de=>{const Re=Ee.dqk.getAllAngularTestabilities();let rt=Re.length,We=!1;const Ot=function(nn){We=We||nn,rt--,0==rt&&de(We)};Re.forEach(function(nn){nn.whenStable(Ot)})})}findTestabilityInTree(ee,te,de){return null==te?null:ee.getTestability(te)??(de?(0,G.q)().isShadowRoot(te)?this.findTestabilityInTree(ee,te.host,!0):this.findTestabilityInTree(ee,te.parentElement,!0):null)}},deps:[]},{provide:Ee.lri,useClass:Ee.dDg,deps:[Ee.R0b,Ee.eoX,Ee.rWj]},{provide:Ee.dDg,useClass:Ee.dDg,deps:[Ee.R0b,Ee.eoX,Ee.rWj]}],Pr=[{provide:Ee.zSh,useValue:"root"},{provide:Ee.qLn,useFactory:function Vi(){return new Ee.qLn},deps:[]},{provide:wt,useClass:Mr,multi:!0,deps:[G.K0,Ee.R0b,Ee.Lbi]},{provide:wt,useClass:ui,multi:!0,deps:[G.K0]},{provide:Ve,useClass:Ve,deps:[Ht,et,Ee.AFp]},{provide:Ee.FYo,useExisting:Ve},{provide:Lt,useExisting:et},{provide:et,useClass:et,deps:[G.K0]},{provide:Ht,useClass:Ht,deps:[wt,Ee.R0b]},{provide:G.JF,useClass:xn,deps:[]},[]];let uo=(()=>{class Q{constructor(te){}static withServerTransition(te){return{ngModule:Q,providers:[{provide:Ee.AFp,useValue:te.appId},{provide:vt,useExisting:Ee.AFp},Qe]}}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG($i,12))},Q.\u0275mod=Ee.oAB({type:Q}),Q.\u0275inj=Ee.cJS({providers:[...Pr,...Jr],imports:[G.ez,Ee.hGG]}),Q})(),bn=(()=>{class Q{constructor(te){this._doc=te}getTitle(){return this._doc.title}setTitle(te){this._doc.title=te||""}}return Q.\u0275fac=function(te){return new(te||Q)(Ee.LFG(G.K0))},Q.\u0275prov=Ee.Yz7({token:Q,factory:function(te){let de=null;return de=te?new te:function _i(){return new bn((0,Ee.LFG)(G.K0))}(),de},providedIn:"root"}),Q})();typeof window<"u"&&window},322:(Xn,Bt,Ae)=>{"use strict";Ae.d(Bt,{rH:()=>Ta,Od:()=>Mu,Bz:()=>Qc,lC:()=>Ga});var G=Ae(256),Ee=Ae(76),Rt=Ae(669);function u(...t){const o=(0,Rt.yG)(t);return(0,Ee.D)(t,o)}var Te=Ae(579);class Gt extends Te.x{constructor(o){super(),this._value=o}get value(){return this.getValue()}_subscribe(o){const l=super._subscribe(o);return!l.closed&&o.next(this._value),l}getValue(){const{hasError:o,thrownError:l,_value:d}=this;if(o)throw l;return this._throwIfClosed(),d}next(o){super.next(this._value=o)}}const At=(0,Ae(888).d)(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});var vt=Ae(751);const{isArray:mt}=Array,{getPrototypeOf:Qe,prototype:It,keys:xn}=Object;var Xt=Ae(671),Lt=Ae(4);const{isArray:et}=Array;var qe=Ae(403),Yt=Ae(672);function Pt(...t){const o=(0,Rt.yG)(t),l=(0,Rt.jO)(t),{args:d,keys:g}=function wt(t){if(1===t.length){const o=t[0];if(mt(o))return{args:o,keys:null};if(function Ht(t){return t&&"object"==typeof t&&Qe(t)===It}(o)){const l=xn(o);return{args:l.map(d=>o[d]),keys:l}}}return{args:t,keys:null}}(t);if(0===d.length)return(0,Ee.D)([],o);const v=new vt.y(function tn(t,o,l=Xt.y){return d=>{st(o,()=>{const{length:g}=t,v=new Array(g);let E=g,T=g;for(let S=0;S<g;S++)st(o,()=>{const R=(0,Ee.D)(t[S],o);let B=!1;R.subscribe((0,qe.x)(d,$=>{v[S]=$,B||(B=!0,T--),T||d.next(l(v.slice()))},()=>{--E||d.complete()}))},d)},d)}}(d,o,g?E=>function Zt(t,o){return t.reduce((l,d,g)=>(l[d]=o[g],l),{})}(g,E):Xt.y));return l?v.pipe(function Ut(t){return(0,Lt.U)(o=>function Yn(t,o){return et(o)?t(...o):t(o)}(t,o))}(l)):v}function st(t,o,l){t?(0,Yt.f)(l,t,o):o()}var kt=Ae(189);function Ne(...t){return function Ie(){return(0,kt.J)(1)}()((0,Ee.D)(t,(0,Rt.yG)(t)))}var Ye=Ae(421);function Ve(t){return new vt.y(o=>{(0,Ye.Xf)(t()).subscribe(o)})}var Dt=Ae(635),gt=Ae(576);function fn(t,o){const l=(0,gt.m)(t)?t:()=>t,d=g=>g.error(l());return new vt.y(o?g=>o.schedule(d,0,g):d)}var Gn=Ae(515),lr=Ae(727),en=Ae(482);function Mr(){return(0,en.e)((t,o)=>{let l=null;t._refCount++;const d=(0,qe.x)(o,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(l=null);const g=t._connection,v=l;l=null,g&&(!v||g===v)&&g.unsubscribe(),o.unsubscribe()});t.subscribe(d),d.closed||(l=t.connect())})}class gi extends vt.y{constructor(o,l){super(),this.source=o,this.subjectFactory=l,this._subject=null,this._refCount=0,this._connection=null,(0,en.A)(o)&&(this.lift=o.lift)}_subscribe(o){return this.getSubject().subscribe(o)}getSubject(){const o=this._subject;return(!o||o.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:o}=this;this._subject=this._connection=null,o?.unsubscribe()}connect(){let o=this._connection;if(!o){o=this._connection=new lr.w0;const l=this.getSubject();o.add(this.source.subscribe((0,qe.x)(l,void 0,()=>{this._teardown(),l.complete()},d=>{this._teardown(),l.error(d)},()=>this._teardown()))),o.closed&&(this._connection=null,o=lr.w0.EMPTY)}return o}refCount(){return Mr()(this)}}var kn=Ae(895);function hr(t,o){return(0,en.e)((l,d)=>{let g=null,v=0,E=!1;const T=()=>E&&!g&&d.complete();l.subscribe((0,qe.x)(d,S=>{g?.unsubscribe();let R=0;const B=v++;(0,Ye.Xf)(t(S,B)).subscribe(g=(0,qe.x)(d,$=>d.next(o?o(S,$,B,R++):$),()=>{g=null,T()}))},()=>{E=!0,T()}))})}function ui(t){return t<=0?()=>Gn.E:(0,en.e)((o,l)=>{let d=0;o.subscribe((0,qe.x)(l,g=>{++d<=t&&(l.next(g),t<=d&&l.complete())}))})}function ji(t,o){return(0,en.e)((l,d)=>{let g=0;l.subscribe((0,qe.x)(d,v=>t.call(o,v,g++)&&d.next(v)))})}var mn=Ae(577);function Sn(t){return(0,en.e)((o,l)=>{let d=!1;o.subscribe((0,qe.x)(l,g=>{d=!0,l.next(g)},()=>{d||l.next(t),l.complete()}))})}function jn(t=Ki){return(0,en.e)((o,l)=>{let d=!1;o.subscribe((0,qe.x)(l,g=>{d=!0,l.next(g)},()=>d?l.complete():l.error(t())))})}function Ki(){return new At}function Vi(t,o){const l=arguments.length>=2;return d=>d.pipe(t?ji((g,v)=>t(g,v,d)):Xt.y,ui(1),l?Sn(o):jn(()=>new At))}function Jn(t,o){return(0,gt.m)(o)?(0,mn.z)(t,o,1):(0,mn.z)(t,1)}function Ar(t,o,l){const d=(0,gt.m)(t)||o||l?{next:t,error:o,complete:l}:t;return d?(0,en.e)((g,v)=>{var E;null===(E=d.subscribe)||void 0===E||E.call(d);let T=!0;g.subscribe((0,qe.x)(v,S=>{var R;null===(R=d.next)||void 0===R||R.call(d,S),v.next(S)},()=>{var S;T=!1,null===(S=d.complete)||void 0===S||S.call(d),v.complete()},S=>{var R;T=!1,null===(R=d.error)||void 0===R||R.call(d,S),v.error(S)},()=>{var S,R;T&&(null===(S=d.unsubscribe)||void 0===S||S.call(d)),null===(R=d.finalize)||void 0===R||R.call(d)}))}):Xt.y}function hi(t){return(0,en.e)((o,l)=>{let v,d=null,g=!1;d=o.subscribe((0,qe.x)(l,void 0,void 0,E=>{v=(0,Ye.Xf)(t(E,hi(t)(o))),d?(d.unsubscribe(),d=null,v.subscribe(l)):g=!0})),g&&(d.unsubscribe(),d=null,v.subscribe(l))})}function $i(t,o,l,d,g){return(v,E)=>{let T=l,S=o,R=0;v.subscribe((0,qe.x)(E,B=>{const $=R++;S=T?t(S,B,$):(T=!0,B),d&&E.next(S)},g&&(()=>{T&&E.next(S),E.complete()})))}}function Jr(t,o){return(0,en.e)($i(t,o,arguments.length>=2,!0))}function Pr(t){return t<=0?()=>Gn.E:(0,en.e)((o,l)=>{let d=[];o.subscribe((0,qe.x)(l,g=>{d.push(g),t<d.length&&d.shift()},()=>{for(const g of d)l.next(g);l.complete()},void 0,()=>{d=null}))})}function uo(t,o){const l=arguments.length>=2;return d=>d.pipe(t?ji((g,v)=>t(g,v,d)):Xt.y,Pr(1),l?Sn(o):jn(()=>new At))}function Ji(t){return(0,en.e)((o,l)=>{try{o.subscribe(l)}finally{l.add(t)}})}var _i=Ae(481);const bn="primary",ur=Symbol("RouteTitle");class ut{constructor(o){this.params=o||{}}has(o){return Object.prototype.hasOwnProperty.call(this.params,o)}get(o){if(this.has(o)){const l=this.params[o];return Array.isArray(l)?l[0]:l}return null}getAll(o){if(this.has(o)){const l=this.params[o];return Array.isArray(l)?l:[l]}return[]}get keys(){return Object.keys(this.params)}}function un(t){return new ut(t)}function Ss(t,o,l){const d=l.path.split("/");if(d.length>t.length||"full"===l.pathMatch&&(o.hasChildren()||d.length<t.length))return null;const g={};for(let v=0;v<d.length;v++){const E=d[v],T=t[v];if(E.startsWith(":"))g[E.substring(1)]=T;else if(E!==T.path)return null}return{consumed:t.slice(0,d.length),posParams:g}}function Zn(t,o){const l=t?Object.keys(t):void 0,d=o?Object.keys(o):void 0;if(!l||!d||l.length!=d.length)return!1;let g;for(let v=0;v<l.length;v++)if(g=l[v],!Po(t[g],o[g]))return!1;return!0}function Po(t,o){if(Array.isArray(t)&&Array.isArray(o)){if(t.length!==o.length)return!1;const l=[...t].sort(),d=[...o].sort();return l.every((g,v)=>d[v]===g)}return t===o}function Hn(t){return Array.prototype.concat.apply([],t)}function Ro(t){return t.length>0?t[t.length-1]:null}function Vr(t,o){for(const l in t)t.hasOwnProperty(l)&&o(t[l],l)}function Rn(t){return(0,G.CqO)(t)?t:(0,G.QGY)(t)?(0,Ee.D)(Promise.resolve(t)):u(t)}const di=!1,Ri={exact:function ii(t,o,l){if(!ye(t.segments,o.segments)||!ie(t.segments,o.segments,l)||t.numberOfChildren!==o.numberOfChildren)return!1;for(const d in o.children)if(!t.children[d]||!ii(t.children[d],o.children[d],l))return!1;return!0},subset:yi},Ys={exact:function Ms(t,o){return Zn(t,o)},subset:function ki(t,o){return Object.keys(o).length<=Object.keys(t).length&&Object.keys(o).every(l=>Po(t[l],o[l]))},ignored:()=>!0};function ho(t,o,l){return Ri[l.paths](t.root,o.root,l.matrixParams)&&Ys[l.queryParams](t.queryParams,o.queryParams)&&!("exact"===l.fragment&&t.fragment!==o.fragment)}function yi(t,o,l){return fo(t,o,o.segments,l)}function fo(t,o,l,d){if(t.segments.length>l.length){const g=t.segments.slice(0,l.length);return!(!ye(g,l)||o.hasChildren()||!ie(g,l,d))}if(t.segments.length===l.length){if(!ye(t.segments,l)||!ie(t.segments,l,d))return!1;for(const g in o.children)if(!t.children[g]||!yi(t.children[g],o.children[g],d))return!1;return!0}{const g=l.slice(0,t.segments.length),v=l.slice(t.segments.length);return!!(ye(t.segments,g)&&ie(t.segments,g,d)&&t.children[bn])&&fo(t.children[bn],o,v,d)}}function ie(t,o,l){return o.every((d,g)=>Ys[l](t[g].parameters,d.parameters))}class U{constructor(o=new V([],{}),l={},d=null){this.root=o,this.queryParams=l,this.fragment=d}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=un(this.queryParams)),this._queryParamMap}toString(){return Q.serialize(this)}}class V{constructor(o,l){this.segments=o,this.children=l,this.parent=null,Vr(l,(d,g)=>d.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ee(this)}}class oe{constructor(o,l){this.path=o,this.parameters=l}get parameterMap(){return this._parameterMap||(this._parameterMap=un(this.parameters)),this._parameterMap}toString(){return Ln(this)}}function ye(t,o){return t.length===o.length&&t.every((l,d)=>l.path===o[d].path)}let Me=(()=>{class t{}return t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=G.Yz7({token:t,factory:function(){return new we},providedIn:"root"}),t})();class we{parse(o){const l=new ko(o);return new U(l.parseRootSegment(),l.parseQueryParams(),l.parseFragment())}serialize(o){const l=`/${te(o.root,!0)}`,d=function On(t){const o=Object.keys(t).map(l=>{const d=t[l];return Array.isArray(d)?d.map(g=>`${Re(l)}=${Re(g)}`).join("&"):`${Re(l)}=${Re(d)}`}).filter(l=>!!l);return o.length?`?${o.join("&")}`:""}(o.queryParams);return`${l}${d}${"string"==typeof o.fragment?`#${function rt(t){return encodeURI(t)}(o.fragment)}`:""}`}}const Q=new we;function ee(t){return t.segments.map(o=>Ln(o)).join("/")}function te(t,o){if(!t.hasChildren())return ee(t);if(o){const l=t.children[bn]?te(t.children[bn],!1):"",d=[];return Vr(t.children,(g,v)=>{v!==bn&&d.push(`${v}:${te(g,!1)}`)}),d.length>0?`${l}(${d.join("//")})`:l}{const l=function Pe(t,o){let l=[];return Vr(t.children,(d,g)=>{g===bn&&(l=l.concat(o(d,g)))}),Vr(t.children,(d,g)=>{g!==bn&&(l=l.concat(o(d,g)))}),l}(t,(d,g)=>g===bn?[te(t.children[bn],!1)]:[`${g}:${te(d,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[bn]?`${ee(t)}/${l[0]}`:`${ee(t)}/(${l.join("//")})`}}function de(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Re(t){return de(t).replace(/%3B/gi,";")}function We(t){return de(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ot(t){return decodeURIComponent(t)}function nn(t){return Ot(t.replace(/\+/g,"%20"))}function Ln(t){return`${We(t.path)}${function Jt(t){return Object.keys(t).map(o=>`;${We(o)}=${We(t[o])}`).join("")}(t.parameters)}`}const qn=/^[^\/()?;=#]+/;function po(t){const o=t.match(qn);return o?o[0]:""}const mo=/^[^=?&#]+/,Qi=/^[^&#]+/;class ko{constructor(o){this.url=o,this.remaining=o}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new V([],{}):new V([],this.parseChildren())}parseQueryParams(){const o={};if(this.consumeOptional("?"))do{this.parseQueryParam(o)}while(this.consumeOptional("&"));return o}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const o=[];for(this.peekStartsWith("(")||o.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),o.push(this.parseSegment());let l={};this.peekStartsWith("/(")&&(this.capture("/"),l=this.parseParens(!0));let d={};return this.peekStartsWith("(")&&(d=this.parseParens(!1)),(o.length>0||Object.keys(l).length>0)&&(d[bn]=new V(o,l)),d}parseSegment(){const o=po(this.remaining);if(""===o&&this.peekStartsWith(";"))throw new G.vHH(4009,di);return this.capture(o),new oe(Ot(o),this.parseMatrixParams())}parseMatrixParams(){const o={};for(;this.consumeOptional(";");)this.parseParam(o);return o}parseParam(o){const l=po(this.remaining);if(!l)return;this.capture(l);let d="";if(this.consumeOptional("=")){const g=po(this.remaining);g&&(d=g,this.capture(d))}o[Ot(l)]=Ot(d)}parseQueryParam(o){const l=function $e(t){const o=t.match(mo);return o?o[0]:""}(this.remaining);if(!l)return;this.capture(l);let d="";if(this.consumeOptional("=")){const E=function Rr(t){const o=t.match(Qi);return o?o[0]:""}(this.remaining);E&&(d=E,this.capture(d))}const g=nn(l),v=nn(d);if(o.hasOwnProperty(g)){let E=o[g];Array.isArray(E)||(E=[E],o[g]=E),E.push(v)}else o[g]=v}parseParens(o){const l={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const d=po(this.remaining),g=this.remaining[d.length];if("/"!==g&&")"!==g&&";"!==g)throw new G.vHH(4010,di);let v;d.indexOf(":")>-1?(v=d.slice(0,d.indexOf(":")),this.capture(v),this.capture(":")):o&&(v=bn);const E=this.parseChildren();l[v]=1===Object.keys(E).length?E[bn]:new V([],E),this.consumeOptional("//")}return l}peekStartsWith(o){return this.remaining.startsWith(o)}consumeOptional(o){return!!this.peekStartsWith(o)&&(this.remaining=this.remaining.substring(o.length),!0)}capture(o){if(!this.consumeOptional(o))throw new G.vHH(4011,di)}}function Tl(t){return t.segments.length>0?new V([],{[bn]:t}):t}function Li(t){const o={};for(const d of Object.keys(t.children)){const v=Li(t.children[d]);(v.segments.length>0||v.hasChildren())&&(o[d]=v)}return function As(t){if(1===t.numberOfChildren&&t.children[bn]){const o=t.children[bn];return new V(t.segments.concat(o.segments),o.children)}return t}(new V(t.segments,o))}function qo(t){return t instanceof U}function kr(t,o,l,d,g){if(0===l.length)return pn(o.root,o.root,o.root,d,g);const v=function $r(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new Zr(!0,0,t);let o=0,l=!1;const d=t.reduce((g,v,E)=>{if("object"==typeof v&&null!=v){if(v.outlets){const T={};return Vr(v.outlets,(S,R)=>{T[R]="string"==typeof S?S.split("/"):S}),[...g,{outlets:T}]}if(v.segmentPath)return[...g,v.segmentPath]}return"string"!=typeof v?[...g,v]:0===E?(v.split("/").forEach((T,S)=>{0==S&&"."===T||(0==S&&""===T?l=!0:".."===T?o++:""!=T&&g.push(T))}),g):[...g,v]},[]);return new Zr(l,o,d)}(l);return v.toRoot()?pn(o.root,o.root,new V([],{}),d,g):function E(S){const R=function or(t,o,l,d){if(t.isAbsolute)return new yn(o.root,!0,0);if(-1===d)return new yn(l,l===o.root,0);return function Lo(t,o,l){let d=t,g=o,v=l;for(;v>g;){if(v-=g,d=d.parent,!d)throw new G.vHH(4005,!1);g=d.segments.length}return new yn(d,!1,g-v)}(l,d+(Hr(t.commands[0])?0:1),t.numberOfDoubleDots)}(v,o,t.snapshot?._urlSegment,S),B=R.processChildren?go(R.segmentGroup,R.index,v.commands):En(R.segmentGroup,R.index,v.commands);return pn(o.root,R.segmentGroup,B,d,g)}(t.snapshot?._lastPathIndex)}function Hr(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function ot(t){return"object"==typeof t&&null!=t&&t.outlets}function pn(t,o,l,d,g){let E,v={};d&&Vr(d,(S,R)=>{v[R]=Array.isArray(S)?S.map(B=>`${B}`):`${S}`}),E=t===o?l:ir(t,o,l);const T=Tl(Li(E));return new U(T,v,g)}function ir(t,o,l){const d={};return Vr(t.children,(g,v)=>{d[v]=g===o?l:ir(g,o,l)}),new V(t.segments,d)}class Zr{constructor(o,l,d){if(this.isAbsolute=o,this.numberOfDoubleDots=l,this.commands=d,o&&d.length>0&&Hr(d[0]))throw new G.vHH(4003,!1);const g=d.find(ot);if(g&&g!==Ro(d))throw new G.vHH(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class yn{constructor(o,l,d){this.segmentGroup=o,this.processChildren=l,this.index=d}}function En(t,o,l){if(t||(t=new V([],{})),0===t.segments.length&&t.hasChildren())return go(t,o,l);const d=function as(t,o,l){let d=0,g=o;const v={match:!1,pathIndex:0,commandIndex:0};for(;g<t.segments.length;){if(d>=l.length)return v;const E=t.segments[g],T=l[d];if(ot(T))break;const S=`${T}`,R=d<l.length-1?l[d+1]:null;if(g>0&&void 0===S)break;if(S&&R&&"object"==typeof R&&void 0===R.outlets){if(!qr(S,R,E))return v;d+=2}else{if(!qr(S,{},E))return v;d++}g++}return{match:!0,pathIndex:g,commandIndex:d}}(t,o,l),g=l.slice(d.commandIndex);if(d.match&&d.pathIndex<t.segments.length){const v=new V(t.segments.slice(0,d.pathIndex),{});return v.children[bn]=new V(t.segments.slice(d.pathIndex),t.children),go(v,0,g)}return d.match&&0===g.length?new V(t.segments,{}):d.match&&!t.hasChildren()?Qr(t,o,l):d.match?go(t,0,g):Qr(t,o,l)}function go(t,o,l){if(0===l.length)return new V(t.segments,{});{const d=function oi(t){return ot(t[0])?t[0].outlets:{[bn]:t}}(l),g={};return Vr(d,(v,E)=>{"string"==typeof v&&(v=[v]),null!==v&&(g[E]=En(t.children[E],o,v))}),Vr(t.children,(v,E)=>{void 0===d[E]&&(g[E]=v)}),new V(t.segments,g)}}function Qr(t,o,l){const d=t.segments.slice(0,o);let g=0;for(;g<l.length;){const v=l[g];if(ot(v)){const S=_o(v.outlets);return new V(d,S)}if(0===g&&Hr(l[0])){d.push(new oe(t.segments[o].path,Lr(l[0]))),g++;continue}const E=ot(v)?v.outlets[bn]:`${v}`,T=g<l.length-1?l[g+1]:null;E&&T&&Hr(T)?(d.push(new oe(E,Lr(T))),g+=2):(d.push(new oe(E,{})),g++)}return new V(d,{})}function _o(t){const o={};return Vr(t,(l,d)=>{"string"==typeof l&&(l=[l]),null!==l&&(o[d]=Qr(new V([],{}),0,l))}),o}function Lr(t){const o={};return Vr(t,(l,d)=>o[d]=`${l}`),o}function qr(t,o,l){return t==l.path&&Zn(o,l.parameters)}class Wn{constructor(o,l){this.id=o,this.url=l}}class Mi extends Wn{constructor(o,l,d="imperative",g=null){super(o,l),this.type=0,this.navigationTrigger=d,this.restoredState=g}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Oi extends Wn{constructor(o,l,d){super(o,l),this.urlAfterRedirects=d,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class ei extends Wn{constructor(o,l,d,g){super(o,l),this.reason=d,this.code=g,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class zn extends Wn{constructor(o,l,d,g){super(o,l),this.error=d,this.target=g,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class rc extends Wn{constructor(o,l,d,g){super(o,l),this.urlAfterRedirects=d,this.state=g,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Rs extends Wn{constructor(o,l,d,g){super(o,l),this.urlAfterRedirects=d,this.state=g,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Or extends Wn{constructor(o,l,d,g,v){super(o,l),this.urlAfterRedirects=d,this.state=g,this.shouldActivate=v,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ks extends Wn{constructor(o,l,d,g){super(o,l),this.urlAfterRedirects=d,this.state=g,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ls extends Wn{constructor(o,l,d,g){super(o,l),this.urlAfterRedirects=d,this.state=g,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ls{constructor(o){this.route=o,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Fr{constructor(o){this.route=o,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class si{constructor(o){this.snapshot=o,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Cl{constructor(o){this.snapshot=o,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class zr{constructor(o){this.snapshot=o,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ai{constructor(o){this.snapshot=o,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cs{constructor(o,l,d){this.routerEvent=o,this.position=l,this.anchor=d,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Os{constructor(o){this._root=o}get root(){return this._root.value}parent(o){const l=this.pathFromRoot(o);return l.length>1?l[l.length-2]:null}children(o){const l=li(o,this._root);return l?l.children.map(d=>d.value):[]}firstChild(o){const l=li(o,this._root);return l&&l.children.length>0?l.children[0].value:null}siblings(o){const l=ya(o,this._root);return l.length<2?[]:l[l.length-2].children.map(g=>g.value).filter(g=>g!==o)}pathFromRoot(o){return ya(o,this._root).map(l=>l.value)}}function li(t,o){if(t===o.value)return o;for(const l of o.children){const d=li(t,l);if(d)return d}return null}function ya(t,o){if(t===o.value)return[o];for(const l of o.children){const d=ya(t,l);if(d.length)return d.unshift(o),d}return[]}class yo{constructor(o,l){this.value=o,this.children=l}toString(){return`TreeNode(${this.value})`}}function eo(t){const o={};return t&&t.children.forEach(l=>o[l.value.outlet]=l),o}class vo extends Os{constructor(o,l){super(o),this.snapshot=l,ic(this,o)}toString(){return this.snapshot.toString()}}function Ua(t,o){const l=function us(t,o){const E=new Il([],{},{},"",{},bn,o,null,t.root,-1,{});return new Sl("",new yo(E,[]))}(t,o),d=new Gt([new oe("",{})]),g=new Gt({}),v=new Gt({}),E=new Gt({}),T=new Gt(""),S=new Fs(d,g,E,T,v,bn,o,l.root);return S.snapshot=l.root,new vo(new yo(S,[]),l)}class Fs{constructor(o,l,d,g,v,E,T,S){this.url=o,this.params=l,this.queryParams=d,this.fragment=g,this.data=v,this.outlet=E,this.component=T,this.title=this.data?.pipe((0,Lt.U)(R=>R[ur]))??u(void 0),this._futureSnapshot=S}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Lt.U)(o=>un(o)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Lt.U)(o=>un(o)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ja(t,o="emptyOnly"){const l=t.pathFromRoot;let d=0;if("always"!==o)for(d=l.length-1;d>=1;){const g=l[d],v=l[d-1];if(g.routeConfig&&""===g.routeConfig.path)d--;else{if(v.component)break;d--}}return function Wo(t){return t.reduce((o,l)=>({params:{...o.params,...l.params},data:{...o.data,...l.data},resolve:{...l.data,...o.resolve,...l.routeConfig?.data,...l._resolvedData}}),{params:{},data:{},resolve:{}})}(l.slice(d))}class Il{constructor(o,l,d,g,v,E,T,S,R,B,$){this.url=o,this.params=l,this.queryParams=d,this.fragment=g,this.data=v,this.outlet=E,this.component=T,this.routeConfig=S,this._urlSegment=R,this._lastPathIndex=B,this._resolve=$}get title(){return this.data?.[ur]}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=un(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=un(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(d=>d.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Sl extends Os{constructor(o,l){super(l),this.url=o,ic(this,l)}toString(){return oc(this._root)}}function ic(t,o){o.value._routerState=t,o.children.forEach(l=>ic(t,l))}function oc(t){const o=t.children.length>0?` { ${t.children.map(oc).join(", ")} } `:"";return`${t.value}${o}`}function sc(t){if(t.snapshot){const o=t.snapshot,l=t._futureSnapshot;t.snapshot=l,Zn(o.queryParams,l.queryParams)||t.queryParams.next(l.queryParams),o.fragment!==l.fragment&&t.fragment.next(l.fragment),Zn(o.params,l.params)||t.params.next(l.params),function xr(t,o){if(t.length!==o.length)return!1;for(let l=0;l<t.length;++l)if(!Zn(t[l],o[l]))return!1;return!0}(o.url,l.url)||t.url.next(l.url),Zn(o.data,l.data)||t.data.next(l.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Va(t,o){const l=Zn(t.params,o.params)&&function he(t,o){return ye(t,o)&&t.every((l,d)=>Zn(l.parameters,o[d].parameters))}(t.url,o.url);return l&&!(!t.parent!=!o.parent)&&(!t.parent||Va(t.parent,o.parent))}function xo(t,o,l){if(l&&t.shouldReuseRoute(o.value,l.value.snapshot)){const d=l.value;d._futureSnapshot=o.value;const g=function lc(t,o,l){return o.children.map(d=>{for(const g of l.children)if(t.shouldReuseRoute(d.value,g.value.snapshot))return xo(t,d,g);return xo(t,d)})}(t,o,l);return new yo(d,g)}{if(t.shouldAttach(o.value)){const v=t.retrieve(o.value);if(null!==v){const E=v.route;return E.value._futureSnapshot=o.value,E.children=o.children.map(T=>xo(t,T)),E}}const d=function Ml(t){return new Fs(new Gt(t.url),new Gt(t.params),new Gt(t.queryParams),new Gt(t.fragment),new Gt(t.data),t.outlet,t.component,t)}(o.value),g=o.children.map(v=>xo(t,v));return new yo(d,g)}}const hs="ngNavigationCancelingError";function cc(t,o){const{redirectTo:l,navigationBehaviorOptions:d}=qo(o)?{redirectTo:o,navigationBehaviorOptions:void 0}:o,g=to(!1,0,o);return g.url=l,g.navigationBehaviorOptions=d,g}function to(t,o,l){const d=new Error("NavigationCancelingError: "+(t||""));return d[hs]=!0,d.cancellationCode=o,l&&(d.url=l),d}function Kn(t){return no(t)&&qo(t.url)}function no(t){return t&&t[hs]}class $a{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Oo,this.attachRef=null}}let Oo=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(l,d){const g=this.getOrCreateContext(l);g.outlet=d,this.contexts.set(l,g)}onChildOutletDestroyed(l){const d=this.getContext(l);d&&(d.outlet=null,d.attachRef=null)}onOutletDeactivated(){const l=this.contexts;return this.contexts=new Map,l}onOutletReAttached(l){this.contexts=l}getOrCreateContext(l){let d=this.getContext(l);return d||(d=new $a,this.contexts.set(l,d)),d}getContext(l){return this.contexts.get(l)||null}}return t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=G.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Xo=!1;let Ga=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=bn,this.activateEvents=new G.vpe,this.deactivateEvents=new G.vpe,this.attachEvents=new G.vpe,this.detachEvents=new G.vpe,this.parentContexts=(0,G.f3M)(Oo),this.location=(0,G.f3M)(G.s_b),this.changeDetector=(0,G.f3M)(G.sBO),this.environmentInjector=(0,G.f3M)(G.lqb)}ngOnChanges(l){if(l.name){const{firstChange:d,previousValue:g}=l.name;if(d)return;this.isTrackedInParentContexts(g)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(g)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(l){return this.parentContexts.getContext(l)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const l=this.parentContexts.getContext(this.name);l?.route&&(l.attachRef?this.attach(l.attachRef,l.route):this.activateWith(l.route,l.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new G.vHH(4012,Xo);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new G.vHH(4012,Xo);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new G.vHH(4012,Xo);this.location.detach();const l=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(l.instance),l}attach(l,d){this.activated=l,this._activatedRoute=d,this.location.insert(l.hostView),this.attachEvents.emit(l.instance)}deactivate(){if(this.activated){const l=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(l)}}activateWith(l,d){if(this.isActivated)throw new G.vHH(4013,Xo);this._activatedRoute=l;const g=this.location,E=l._futureSnapshot.component,T=this.parentContexts.getOrCreateContext(this.name).children,S=new zs(l,T,g.injector);if(d&&function Ha(t){return!!t.resolveComponentFactory}(d)){const R=d.resolveComponentFactory(E);this.activated=g.createComponent(R,g.length,S)}else this.activated=g.createComponent(E,{index:g.length,injector:S,environmentInjector:d??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(l){return new(l||t)},t.\u0275dir=G.lG2({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[G.TTD]}),t})();class zs{constructor(o,l,d){this.route=o,this.childContexts=l,this.parent=d}get(o,l){return o===Fs?this.route:o===Oo?this.childContexts:this.parent.get(o,l)}}let Bs=(()=>{class t{}return t.\u0275fac=function(l){return new(l||t)},t.\u0275cmp=G.Xpm({type:t,selectors:[["ng-component"]],standalone:!0,features:[G.jDz],decls:1,vars:0,template:function(l,d){1&l&&G._UZ(0,"router-outlet")},dependencies:[Ga],encapsulation:2}),t})();function va(t,o){return t.providers&&!t._injector&&(t._injector=(0,G.MMx)(t.providers,o,`Route: ${t.path}`)),t._injector??o}function Br(t){const o=t.children&&t.children.map(Br),l=o?{...t,children:o}:{...t};return!l.component&&!l.loadComponent&&(o||l.loadChildren)&&l.outlet&&l.outlet!==bn&&(l.component=Bs),l}function ro(t){return t.outlet||bn}function hc(t,o){const l=t.filter(d=>ro(d)===o);return l.push(...t.filter(d=>ro(d)!==o)),l}function Fo(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let o=t.parent;o;o=o.parent){const l=o.routeConfig;if(l?._loadedInjector)return l._loadedInjector;if(l?._injector)return l._injector}return null}class Pl{constructor(o,l,d,g){this.routeReuseStrategy=o,this.futureState=l,this.currState=d,this.forwardEvent=g}activate(o){const l=this.futureState._root,d=this.currState?this.currState._root:null;this.deactivateChildRoutes(l,d,o),sc(this.futureState.root),this.activateChildRoutes(l,d,o)}deactivateChildRoutes(o,l,d){const g=eo(l);o.children.forEach(v=>{const E=v.value.outlet;this.deactivateRoutes(v,g[E],d),delete g[E]}),Vr(g,(v,E)=>{this.deactivateRouteAndItsChildren(v,d)})}deactivateRoutes(o,l,d){const g=o.value,v=l?l.value:null;if(g===v)if(g.component){const E=d.getContext(g.outlet);E&&this.deactivateChildRoutes(o,l,E.children)}else this.deactivateChildRoutes(o,l,d);else v&&this.deactivateRouteAndItsChildren(l,d)}deactivateRouteAndItsChildren(o,l){o.value.component&&this.routeReuseStrategy.shouldDetach(o.value.snapshot)?this.detachAndStoreRouteSubtree(o,l):this.deactivateRouteAndOutlet(o,l)}detachAndStoreRouteSubtree(o,l){const d=l.getContext(o.value.outlet),g=d&&o.value.component?d.children:l,v=eo(o);for(const E of Object.keys(v))this.deactivateRouteAndItsChildren(v[E],g);if(d&&d.outlet){const E=d.outlet.detach(),T=d.children.onOutletDeactivated();this.routeReuseStrategy.store(o.value.snapshot,{componentRef:E,route:o,contexts:T})}}deactivateRouteAndOutlet(o,l){const d=l.getContext(o.value.outlet),g=d&&o.value.component?d.children:l,v=eo(o);for(const E of Object.keys(v))this.deactivateRouteAndItsChildren(v[E],g);d&&d.outlet&&(d.outlet.deactivate(),d.children.onOutletDeactivated(),d.attachRef=null,d.resolver=null,d.route=null)}activateChildRoutes(o,l,d){const g=eo(l);o.children.forEach(v=>{this.activateRoutes(v,g[v.value.outlet],d),this.forwardEvent(new ai(v.value.snapshot))}),o.children.length&&this.forwardEvent(new Cl(o.value.snapshot))}activateRoutes(o,l,d){const g=o.value,v=l?l.value:null;if(sc(g),g===v)if(g.component){const E=d.getOrCreateContext(g.outlet);this.activateChildRoutes(o,l,E.children)}else this.activateChildRoutes(o,l,d);else if(g.component){const E=d.getOrCreateContext(g.outlet);if(this.routeReuseStrategy.shouldAttach(g.snapshot)){const T=this.routeReuseStrategy.retrieve(g.snapshot);this.routeReuseStrategy.store(g.snapshot,null),E.children.onOutletReAttached(T.contexts),E.attachRef=T.componentRef,E.route=T.route.value,E.outlet&&E.outlet.attach(T.componentRef,T.route.value),sc(T.route.value),this.activateChildRoutes(o,null,E.children)}else{const T=Fo(g.snapshot),S=T?.get(G._Vd)??null;E.attachRef=null,E.route=g,E.resolver=S,E.injector=T,E.outlet&&E.outlet.activateWith(g,E.injector),this.activateChildRoutes(o,null,E.children)}}else this.activateChildRoutes(o,null,d)}}class Ks{constructor(o){this.path=o,this.route=this.path[this.path.length-1]}}class bo{constructor(o,l){this.component=o,this.route=l}}function er(t,o,l){const d=t._root;return ds(d,o?o._root:null,l,[d.value])}function io(t,o){const l=Symbol(),d=o.get(t,l);return d===l?"function"!=typeof t||(0,G.Z0I)(t)?o.get(t):t:d}function ds(t,o,l,d,g={canDeactivateChecks:[],canActivateChecks:[]}){const v=eo(o);return t.children.forEach(E=>{(function fs(t,o,l,d,g={canDeactivateChecks:[],canActivateChecks:[]}){const v=t.value,E=o?o.value:null,T=l?l.getContext(t.value.outlet):null;if(E&&v.routeConfig===E.routeConfig){const S=function Wa(t,o,l){if("function"==typeof l)return l(t,o);switch(l){case"pathParamsChange":return!ye(t.url,o.url);case"pathParamsOrQueryParamsChange":return!ye(t.url,o.url)||!Zn(t.queryParams,o.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Va(t,o)||!Zn(t.queryParams,o.queryParams);default:return!Va(t,o)}}(E,v,v.routeConfig.runGuardsAndResolvers);S?g.canActivateChecks.push(new Ks(d)):(v.data=E.data,v._resolvedData=E._resolvedData),ds(t,o,v.component?T?T.children:null:l,d,g),S&&T&&T.outlet&&T.outlet.isActivated&&g.canDeactivateChecks.push(new bo(T.outlet.component,E))}else E&&Ko(o,T,g),g.canActivateChecks.push(new Ks(d)),ds(t,null,v.component?T?T.children:null:l,d,g)})(E,v[E.value.outlet],l,d.concat([E.value]),g),delete v[E.value.outlet]}),Vr(v,(E,T)=>Ko(E,l.getContext(T),g)),g}function Ko(t,o,l){const d=eo(t),g=t.value;Vr(d,(v,E)=>{Ko(v,g.component?o?o.children.getContext(E):null:o,l)}),l.canDeactivateChecks.push(new bo(g.component&&o&&o.outlet&&o.outlet.isActivated?o.outlet.component:null,g))}function sn(t){return"function"==typeof t}function lt(t){return t instanceof At||"EmptyError"===t?.name}const Vn=Symbol("INITIAL_VALUE");function wo(){return hr(t=>Pt(t.map(o=>o.pipe(ui(1),function cr(...t){const o=(0,Rt.yG)(t);return(0,en.e)((l,d)=>{(o?Ne(t,l,o):Ne(t,l)).subscribe(d)})}(Vn)))).pipe((0,Lt.U)(o=>{for(const l of o)if(!0!==l){if(l===Vn)return Vn;if(!1===l||l instanceof U)return l}return!0}),ji(o=>o!==Vn),ui(1)))}function Iu(t){return(0,Dt.z)(Ar(o=>{if(qo(o))throw cc(0,o)}),(0,Lt.U)(o=>!0===o))}const fi={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function zo(t,o,l,d,g){const v=Js(t,o,l);return v.matched?function fc(t,o,l,d){const g=o.canMatch;return g&&0!==g.length?u(g.map(E=>{const T=io(E,t);return Rn(function kl(t){return t&&sn(t.canMatch)}(T)?T.canMatch(o,l):t.runInContext(()=>T(o,l)))})).pipe(wo(),Iu()):u(!0)}(d=va(o,d),o,l).pipe((0,Lt.U)(E=>!0===E?v:{...fi})):u(v)}function Js(t,o,l){if(""===o.path)return"full"===o.pathMatch&&(t.hasChildren()||l.length>0)?{...fi}:{matched:!0,consumedSegments:[],remainingSegments:l,parameters:{},positionalParamSegments:{}};const g=(o.matcher||Ss)(l,t,o);if(!g)return{...fi};const v={};Vr(g.posParams,(T,S)=>{v[S]=T.path});const E=g.consumed.length>0?{...v,...g.consumed[g.consumed.length-1].parameters}:v;return{matched:!0,consumedSegments:g.consumed,remainingSegments:l.slice(g.consumed.length),parameters:E,positionalParamSegments:g.posParams??{}}}function Bo(t,o,l,d){if(l.length>0&&function mc(t,o,l){return l.some(d=>wa(t,o,d)&&ro(d)!==bn)}(t,l,d)){const v=new V(o,function pc(t,o,l,d){const g={};g[bn]=d,d._sourceSegment=t,d._segmentIndexShift=o.length;for(const v of l)if(""===v.path&&ro(v)!==bn){const E=new V([],{});E._sourceSegment=t,E._segmentIndexShift=o.length,g[ro(v)]=E}return g}(t,o,d,new V(l,t.children)));return v._sourceSegment=t,v._segmentIndexShift=o.length,{segmentGroup:v,slicedSegments:[]}}if(0===l.length&&function Hc(t,o,l){return l.some(d=>wa(t,o,d))}(t,l,d)){const v=new V(t.segments,function Eo(t,o,l,d,g){const v={};for(const E of d)if(wa(t,l,E)&&!g[ro(E)]){const T=new V([],{});T._sourceSegment=t,T._segmentIndexShift=o.length,v[ro(E)]=T}return{...g,...v}}(t,o,l,d,t.children));return v._sourceSegment=t,v._segmentIndexShift=o.length,{segmentGroup:v,slicedSegments:l}}const g=new V(t.segments,t.children);return g._sourceSegment=t,g._segmentIndexShift=o.length,{segmentGroup:g,slicedSegments:l}}function wa(t,o,l){return(!(t.hasChildren()||o.length>0)||"full"!==l.pathMatch)&&""===l.path}function Jo(t,o,l,d){return!!(ro(t)===d||d!==bn&&wa(o,l,t))&&("**"===t.path||Js(o,t,l).matched)}function ps(t,o,l){return 0===o.length&&!t.children[l]}const Qs=!1;class Gi{constructor(o){this.segmentGroup=o||null}}class ea{constructor(o){this.urlTree=o}}function k(t){return fn(new Gi(t))}function j(t){return fn(new ea(t))}class Ge{constructor(o,l,d,g,v){this.injector=o,this.configLoader=l,this.urlSerializer=d,this.urlTree=g,this.config=v,this.allowRedirects=!0}apply(){const o=Bo(this.urlTree.root,[],[],this.config).segmentGroup,l=new V(o.segments,o.children);return this.expandSegmentGroup(this.injector,this.config,l,bn).pipe((0,Lt.U)(v=>this.createUrlTree(Li(v),this.urlTree.queryParams,this.urlTree.fragment))).pipe(hi(v=>{if(v instanceof ea)return this.allowRedirects=!1,this.match(v.urlTree);throw v instanceof Gi?this.noMatchError(v):v}))}match(o){return this.expandSegmentGroup(this.injector,this.config,o.root,bn).pipe((0,Lt.U)(g=>this.createUrlTree(Li(g),o.queryParams,o.fragment))).pipe(hi(g=>{throw g instanceof Gi?this.noMatchError(g):g}))}noMatchError(o){return new G.vHH(4002,Qs)}createUrlTree(o,l,d){const g=Tl(o);return new U(g,l,d)}expandSegmentGroup(o,l,d,g){return 0===d.segments.length&&d.hasChildren()?this.expandChildren(o,l,d).pipe((0,Lt.U)(v=>new V([],v))):this.expandSegment(o,d,l,d.segments,g,!0)}expandChildren(o,l,d){const g=[];for(const v of Object.keys(d.children))"primary"===v?g.unshift(v):g.push(v);return(0,Ee.D)(g).pipe(Jn(v=>{const E=d.children[v],T=hc(l,v);return this.expandSegmentGroup(o,T,E,v).pipe((0,Lt.U)(S=>({segment:S,outlet:v})))}),Jr((v,E)=>(v[E.outlet]=E.segment,v),{}),uo())}expandSegment(o,l,d,g,v,E){return(0,Ee.D)(d).pipe(Jn(T=>this.expandSegmentAgainstRoute(o,l,d,T,g,v,E).pipe(hi(R=>{if(R instanceof Gi)return u(null);throw R}))),Vi(T=>!!T),hi((T,S)=>{if(lt(T))return ps(l,g,v)?u(new V([],{})):k(l);throw T}))}expandSegmentAgainstRoute(o,l,d,g,v,E,T){return Jo(g,l,v,E)?void 0===g.redirectTo?this.matchSegmentAgainstRoute(o,l,g,v,E):T&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(o,l,d,g,v,E):k(l):k(l)}expandSegmentAgainstRouteUsingRedirect(o,l,d,g,v,E){return"**"===g.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(o,d,g,E):this.expandRegularSegmentAgainstRouteUsingRedirect(o,l,d,g,v,E)}expandWildCardWithParamsAgainstRouteUsingRedirect(o,l,d,g){const v=this.applyRedirectCommands([],d.redirectTo,{});return d.redirectTo.startsWith("/")?j(v):this.lineralizeSegments(d,v).pipe((0,mn.z)(E=>{const T=new V(E,{});return this.expandSegment(o,T,l,E,g,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(o,l,d,g,v,E){const{matched:T,consumedSegments:S,remainingSegments:R,positionalParamSegments:B}=Js(l,g,v);if(!T)return k(l);const $=this.applyRedirectCommands(S,g.redirectTo,B);return g.redirectTo.startsWith("/")?j($):this.lineralizeSegments(g,$).pipe((0,mn.z)(K=>this.expandSegment(o,l,d,K.concat(R),E,!1)))}matchSegmentAgainstRoute(o,l,d,g,v){return"**"===d.path?(o=va(d,o),d.loadChildren?(d._loadedRoutes?u({routes:d._loadedRoutes,injector:d._loadedInjector}):this.configLoader.loadChildren(o,d)).pipe((0,Lt.U)(T=>(d._loadedRoutes=T.routes,d._loadedInjector=T.injector,new V(g,{})))):u(new V(g,{}))):zo(l,d,g,o).pipe(hr(({matched:E,consumedSegments:T,remainingSegments:S})=>E?this.getChildConfig(o=d._injector??o,d,g).pipe((0,mn.z)(B=>{const $=B.injector??o,K=B.routes,{segmentGroup:X,slicedSegments:ne}=Bo(l,T,S,K),J=new V(X.segments,X.children);if(0===ne.length&&J.hasChildren())return this.expandChildren($,K,J).pipe((0,Lt.U)(pe=>new V(T,pe)));if(0===K.length&&0===ne.length)return u(new V(T,{}));const W=ro(d)===v;return this.expandSegment($,J,K,ne,W?bn:v,!0).pipe((0,Lt.U)(re=>new V(T.concat(re.segments),re.children)))})):k(l)))}getChildConfig(o,l,d){return l.children?u({routes:l.children,injector:o}):l.loadChildren?void 0!==l._loadedRoutes?u({routes:l._loadedRoutes,injector:l._loadedInjector}):function Cu(t,o,l,d){const g=o.canLoad;return void 0===g||0===g.length?u(!0):u(g.map(E=>{const T=io(E,t);return Rn(function Tu(t){return t&&sn(t.canLoad)}(T)?T.canLoad(o,l):t.runInContext(()=>T(o,l)))})).pipe(wo(),Iu())}(o,l,d).pipe((0,mn.z)(g=>g?this.configLoader.loadChildren(o,l).pipe(Ar(v=>{l._loadedRoutes=v.routes,l._loadedInjector=v.injector})):function Z(t){return fn(to(Qs,3))}())):u({routes:[],injector:o})}lineralizeSegments(o,l){let d=[],g=l.root;for(;;){if(d=d.concat(g.segments),0===g.numberOfChildren)return u(d);if(g.numberOfChildren>1||!g.children[bn])return fn(new G.vHH(4e3,Qs));g=g.children[bn]}}applyRedirectCommands(o,l,d){return this.applyRedirectCreateUrlTree(l,this.urlSerializer.parse(l),o,d)}applyRedirectCreateUrlTree(o,l,d,g){const v=this.createSegmentGroup(o,l.root,d,g);return new U(v,this.createQueryParams(l.queryParams,this.urlTree.queryParams),l.fragment)}createQueryParams(o,l){const d={};return Vr(o,(g,v)=>{if("string"==typeof g&&g.startsWith(":")){const T=g.substring(1);d[v]=l[T]}else d[v]=g}),d}createSegmentGroup(o,l,d,g){const v=this.createSegments(o,l.segments,d,g);let E={};return Vr(l.children,(T,S)=>{E[S]=this.createSegmentGroup(o,T,d,g)}),new V(v,E)}createSegments(o,l,d,g){return l.map(v=>v.path.startsWith(":")?this.findPosParam(o,v,g):this.findOrReturn(v,d))}findPosParam(o,l,d){const g=d[l.path.substring(1)];if(!g)throw new G.vHH(4001,Qs);return g}findOrReturn(o,l){let d=0;for(const g of l){if(g.path===o.path)return l.splice(d),g;d++}return o}}class tr{}class rn{constructor(o,l,d,g,v,E,T){this.injector=o,this.rootComponentType=l,this.config=d,this.urlTree=g,this.url=v,this.paramsInheritanceStrategy=E,this.urlSerializer=T}recognize(){const o=Bo(this.urlTree.root,[],[],this.config.filter(l=>void 0===l.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,o,bn).pipe((0,Lt.U)(l=>{if(null===l)return null;const d=new Il([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},bn,this.rootComponentType,null,this.urlTree.root,-1,{}),g=new yo(d,l),v=new Sl(this.url,g);return this.inheritParamsAndData(v._root),v}))}inheritParamsAndData(o){const l=o.value,d=ja(l,this.paramsInheritanceStrategy);l.params=Object.freeze(d.params),l.data=Object.freeze(d.data),o.children.forEach(g=>this.inheritParamsAndData(g))}processSegmentGroup(o,l,d,g){return 0===d.segments.length&&d.hasChildren()?this.processChildren(o,l,d):this.processSegment(o,l,d,d.segments,g)}processChildren(o,l,d){return(0,Ee.D)(Object.keys(d.children)).pipe(Jn(g=>{const v=d.children[g],E=hc(l,g);return this.processSegmentGroup(o,E,v,g)}),Jr((g,v)=>g&&v?(g.push(...v),g):null),function Is(t,o=!1){return(0,en.e)((l,d)=>{let g=0;l.subscribe((0,qe.x)(d,v=>{const E=t(v,g++);(E||o)&&d.next(v),!E&&d.complete()}))})}(g=>null!==g),Sn(null),uo(),(0,Lt.U)(g=>{if(null===g)return null;const v=Do(g);return function Nr(t){t.sort((o,l)=>o.value.outlet===bn?-1:l.value.outlet===bn?1:o.value.outlet.localeCompare(l.value.outlet))}(v),v}))}processSegment(o,l,d,g,v){return(0,Ee.D)(l).pipe(Jn(E=>this.processSegmentAgainstRoute(E._injector??o,E,d,g,v)),Vi(E=>!!E),hi(E=>{if(lt(E))return ps(d,g,v)?u([]):u(null);throw E}))}processSegmentAgainstRoute(o,l,d,g,v){if(l.redirectTo||!Jo(l,d,g,v))return u(null);let E;if("**"===l.path){const T=g.length>0?Ro(g).parameters:{},S=bi(d)+g.length;E=u({snapshot:new Il(g,T,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,ni(l),ro(l),l.component??l._loadedComponent??null,l,xi(d),S,js(l)),consumedSegments:[],remainingSegments:[]})}else E=zo(d,l,g,o).pipe((0,Lt.U)(({matched:T,consumedSegments:S,remainingSegments:R,parameters:B})=>{if(!T)return null;const $=bi(d)+S.length;return{snapshot:new Il(S,B,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,ni(l),ro(l),l.component??l._loadedComponent??null,l,xi(d),$,js(l)),consumedSegments:S,remainingSegments:R}}));return E.pipe(hr(T=>{if(null===T)return u(null);const{snapshot:S,consumedSegments:R,remainingSegments:B}=T;o=l._injector??o;const $=l._loadedInjector??o,K=function nr(t){return t.children?t.children:t.loadChildren?t._loadedRoutes:[]}(l),{segmentGroup:X,slicedSegments:ne}=Bo(d,R,B,K.filter(W=>void 0===W.redirectTo));if(0===ne.length&&X.hasChildren())return this.processChildren($,K,X).pipe((0,Lt.U)(W=>null===W?null:[new yo(S,W)]));if(0===K.length&&0===ne.length)return u([new yo(S,[])]);const J=ro(l)===v;return this.processSegment($,K,X,ne,J?bn:v).pipe((0,Lt.U)(W=>null===W?null:[new yo(S,W)]))}))}}function Yr(t){const o=t.value.routeConfig;return o&&""===o.path&&void 0===o.redirectTo}function Do(t){const o=[],l=new Set;for(const d of t){if(!Yr(d)){o.push(d);continue}const g=o.find(v=>d.value.routeConfig===v.value.routeConfig);void 0!==g?(g.children.push(...d.children),l.add(g)):o.push(d)}for(const d of l){const g=Do(d.children);o.push(new yo(d.value,g))}return o.filter(d=>!l.has(d))}function xi(t){let o=t;for(;o._sourceSegment;)o=o._sourceSegment;return o}function bi(t){let o=t,l=o._segmentIndexShift??0;for(;o._sourceSegment;)o=o._sourceSegment,l+=o._segmentIndexShift??0;return l-1}function ni(t){return t.data||{}}function js(t){return t.resolve||{}}function Vs(t){return"string"==typeof t.title||null===t.title}function nl(t){return hr(o=>{const l=t(o);return l?(0,Ee.D)(l).pipe((0,Lt.U)(()=>o)):u(o)})}let rl=(()=>{class t{buildTitle(l){let d,g=l.root;for(;void 0!==g;)d=this.getResolvedTitleForRoute(g)??d,g=g.children.find(v=>v.outlet===bn);return d}getResolvedTitleForRoute(l){return l.data[ur]}}return t.\u0275fac=function(l){return new(l||t)},t.\u0275prov=G.Yz7({token:t,factory:function(){return(0,G.f3M)(ms)},providedIn:"root"}),t})(),ms=(()=>{class t extends rl{constructor(l){super(),this.title=l}updateTitle(l){const d=this.buildTitle(l);void 0!==d&&this.title.setTitle(d)}}return t.\u0275fac=function(l){return new(l||t)(G.LFG(_i.Dx))},t.\u0275prov=G.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class No{}class Xc{shouldDetach(o){return!1}store(o,l){}shouldAttach(o){return!1}retrieve(o){return null}shouldReuseRoute(o,l){return o.routeConfig===l.routeConfig}}class _c extends Xc{}const Ea=new G.OlP("",{providedIn:"root",factory:()=>({})}),gs=new G.OlP("ROUTES");let Uo=(()=>{class t{constructor(l,d){this.injector=l,this.compiler=d,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(l){if(this.componentLoaders.get(l))return this.componentLoaders.get(l);if(l._loadedComponent)return u(l._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(l);const d=Rn(l.loadComponent()).pipe((0,Lt.U)(ta),Ar(v=>{this.onLoadEndListener&&this.onLoadEndListener(l),l._loadedComponent=v}),Ji(()=>{this.componentLoaders.delete(l)})),g=new gi(d,()=>new Te.x).pipe(Mr());return this.componentLoaders.set(l,g),g}loadChildren(l,d){if(this.childrenLoaders.get(d))return this.childrenLoaders.get(d);if(d._loadedRoutes)return u({routes:d._loadedRoutes,injector:d._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(d);const v=this.loadModuleFactoryOrRoutes(d.loadChildren).pipe((0,Lt.U)(T=>{this.onLoadEndListener&&this.onLoadEndListener(d);let S,R,B=!1;Array.isArray(T)?R=T:(S=T.create(l).injector,R=Hn(S.get(gs,[],G.XFs.Self|G.XFs.Optional)));return{routes:R.map(Br),injector:S}}),Ji(()=>{this.childrenLoaders.delete(d)})),E=new gi(v,()=>new Te.x).pipe(Mr());return this.childrenLoaders.set(d,E),E}loadModuleFactoryOrRoutes(l){return Rn(l()).pipe((0,Lt.U)(ta),(0,mn.z)(g=>g instanceof G.YKP||Array.isArray(g)?u(g):(0,Ee.D)(this.compiler.compileModuleAsync(g))))}}return t.\u0275fac=function(l){return new(l||t)(G.LFG(G.zs3),G.LFG(G.Sil))},t.\u0275prov=G.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function ta(t){return function Su(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}class sl{}class zl{shouldProcessUrl(o){return!0}extract(o){return o}merge(o,l){return o}}function na(t){throw t}function Yc(t,o,l){return o.parse("/")}const yc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},so={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function al(){const t=(0,G.f3M)(Me),o=(0,G.f3M)(Oo),l=(0,G.f3M)(kn.Ye),d=(0,G.f3M)(G.zs3),g=(0,G.f3M)(G.Sil),v=(0,G.f3M)(gs,{optional:!0})??[],E=(0,G.f3M)(Ea,{optional:!0})??{},T=(0,G.f3M)(ms),S=(0,G.f3M)(rl,{optional:!0}),R=(0,G.f3M)(sl,{optional:!0}),B=(0,G.f3M)(No,{optional:!0}),$=new ci(null,t,o,l,d,g,Hn(v));return R&&($.urlHandlingStrategy=R),B&&($.routeReuseStrategy=B),$.titleStrategy=S??T,function Kc(t,o){t.errorHandler&&(o.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(o.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(o.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(o.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.urlUpdateStrategy&&(o.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(o.canceledNavigationResolution=t.canceledNavigationResolution)}(E,$),$}let ci=(()=>{class t{constructor(l,d,g,v,E,T,S){this.rootComponentType=l,this.urlSerializer=d,this.rootContexts=g,this.location=v,this.config=S,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Te.x,this.errorHandler=na,this.malformedUriErrorHandler=Yc,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>u(void 0),this.urlHandlingStrategy=new zl,this.routeReuseStrategy=new _c,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.canceledNavigationResolution="replace",this.configLoader=E.get(Uo),this.configLoader.onLoadEndListener=K=>this.triggerEvent(new Fr(K)),this.configLoader.onLoadStartListener=K=>this.triggerEvent(new ls(K)),this.ngModule=E.get(G.h0i),this.console=E.get(G.c2e);const $=E.get(G.R0b);this.isNgZoneEnabled=$ instanceof G.R0b&&G.R0b.isInAngularZone(),this.resetConfig(S),this.currentUrlTree=new U,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Ua(this.currentUrlTree,this.rootComponentType),this.transitions=new Gt({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(l){const d=this.events;return l.pipe(ji(g=>0!==g.id),(0,Lt.U)(g=>({...g,extractedUrl:this.urlHandlingStrategy.extract(g.rawUrl)})),hr(g=>{let v=!1,E=!1;return u(g).pipe(Ar(T=>{this.currentNavigation={id:T.id,initialUrl:T.rawUrl,extractedUrl:T.extractedUrl,trigger:T.source,extras:T.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),hr(T=>{const S=this.browserUrlTree.toString(),R=!this.navigated||T.extractedUrl.toString()!==S||S!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||R)&&this.urlHandlingStrategy.shouldProcessUrl(T.rawUrl))return Da(T.source)&&(this.browserUrlTree=T.extractedUrl),u(T).pipe(hr($=>{const K=this.transitions.getValue();return d.next(new Mi($.id,this.serializeUrl($.extractedUrl),$.source,$.restoredState)),K!==this.transitions.getValue()?Gn.E:Promise.resolve($)}),function tt(t,o,l,d){return hr(g=>function ve(t,o,l,d,g){return new Ge(t,o,l,d,g).apply()}(t,o,l,g.extractedUrl,d).pipe((0,Lt.U)(v=>({...g,urlAfterRedirects:v}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Ar($=>{this.currentNavigation={...this.currentNavigation,finalUrl:$.urlAfterRedirects},g.urlAfterRedirects=$.urlAfterRedirects}),function Zc(t,o,l,d,g){return(0,mn.z)(v=>function $n(t,o,l,d,g,v,E="emptyOnly"){return new rn(t,o,l,d,g,E,v).recognize().pipe(hr(T=>null===T?function Tn(t){return new vt.y(o=>o.error(t))}(new tr):u(T)))}(t,o,l,v.urlAfterRedirects,d.serialize(v.urlAfterRedirects),d,g).pipe((0,Lt.U)(E=>({...v,targetSnapshot:E}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy),Ar($=>{if(g.targetSnapshot=$.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!$.extras.skipLocationChange){const X=this.urlHandlingStrategy.merge($.urlAfterRedirects,$.rawUrl);this.setBrowserUrl(X,$)}this.browserUrlTree=$.urlAfterRedirects}const K=new rc($.id,this.serializeUrl($.extractedUrl),this.serializeUrl($.urlAfterRedirects),$.targetSnapshot);d.next(K)}));if(R&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:K,extractedUrl:X,source:ne,restoredState:J,extras:W}=T,se=new Mi(K,this.serializeUrl(X),ne,J);d.next(se);const re=Ua(X,this.rootComponentType).snapshot;return u(g={...T,targetSnapshot:re,urlAfterRedirects:X,extras:{...W,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=T.rawUrl,T.resolve(null),Gn.E}),Ar(T=>{const S=new Rs(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot);this.triggerEvent(S)}),(0,Lt.U)(T=>g={...T,guards:er(T.targetSnapshot,T.currentSnapshot,this.rootContexts)}),function Ll(t,o){return(0,mn.z)(l=>{const{targetSnapshot:d,currentSnapshot:g,guards:{canActivateChecks:v,canDeactivateChecks:E}}=l;return 0===E.length&&0===v.length?u({...l,guardsResult:!0}):function ti(t,o,l,d){return(0,Ee.D)(t).pipe((0,mn.z)(g=>function el(t,o,l,d,g){const v=o&&o.routeConfig?o.routeConfig.canDeactivate:null;return v&&0!==v.length?u(v.map(T=>{const S=Fo(o)??g,R=io(T,S);return Rn(function Ya(t){return t&&sn(t.canDeactivate)}(R)?R.canDeactivate(t,o,l,d):S.runInContext(()=>R(t,o,l,d))).pipe(Vi())})).pipe(wo()):u(!0)}(g.component,g.route,l,o,d)),Vi(g=>!0!==g,!0))}(E,d,g,t).pipe((0,mn.z)(T=>T&&function Rl(t){return"boolean"==typeof t}(T)?function Ol(t,o,l,d){return(0,Ee.D)(o).pipe(Jn(g=>Ne(function oo(t,o){return null!==t&&o&&o(new si(t)),u(!0)}(g.route.parent,d),function Us(t,o){return null!==t&&o&&o(new zr(t)),u(!0)}(g.route,d),function Qa(t,o,l){const d=o[o.length-1],v=o.slice(0,o.length-1).reverse().map(E=>function Du(t){const o=t.routeConfig?t.routeConfig.canActivateChild:null;return o&&0!==o.length?{node:t,guards:o}:null}(E)).filter(E=>null!==E).map(E=>Ve(()=>u(E.guards.map(S=>{const R=Fo(E.node)??l,B=io(S,R);return Rn(function Xa(t){return t&&sn(t.canActivateChild)}(B)?B.canActivateChild(d,t):R.runInContext(()=>B(d,t))).pipe(Vi())})).pipe(wo())));return u(v).pipe(wo())}(t,g.path,l),function Ja(t,o,l){const d=o.routeConfig?o.routeConfig.canActivate:null;if(!d||0===d.length)return u(!0);const g=d.map(v=>Ve(()=>{const E=Fo(o)??l,T=io(v,E);return Rn(function dc(t){return t&&sn(t.canActivate)}(T)?T.canActivate(o,t):E.runInContext(()=>T(o,t))).pipe(Vi())}));return u(g).pipe(wo())}(t,g.route,l))),Vi(g=>!0!==g,!0))}(d,v,t,o):u(T)),(0,Lt.U)(T=>({...l,guardsResult:T})))})}(this.ngModule.injector,T=>this.triggerEvent(T)),Ar(T=>{if(g.guardsResult=T.guardsResult,qo(T.guardsResult))throw cc(0,T.guardsResult);const S=new Or(T.id,this.serializeUrl(T.extractedUrl),this.serializeUrl(T.urlAfterRedirects),T.targetSnapshot,!!T.guardsResult);this.triggerEvent(S)}),ji(T=>!!T.guardsResult||(this.restoreHistory(T),this.cancelNavigationTransition(T,"",3),!1)),nl(T=>{if(T.guards.canActivateChecks.length)return u(T).pipe(Ar(S=>{const R=new ks(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}),hr(S=>{let R=!1;return u(S).pipe(function qc(t,o){return(0,mn.z)(l=>{const{targetSnapshot:d,guards:{canActivateChecks:g}}=l;if(!g.length)return u(l);let v=0;return(0,Ee.D)(g).pipe(Jn(E=>function zi(t,o,l,d){const g=t.routeConfig,v=t._resolve;return void 0!==g?.title&&!Vs(g)&&(v[ur]=g.title),function tl(t,o,l,d){const g=function gc(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===g.length)return u({});const v={};return(0,Ee.D)(g).pipe((0,mn.z)(E=>function Wc(t,o,l,d){const g=Fo(o)??d,v=io(t,g);return Rn(v.resolve?v.resolve(o,l):g.runInContext(()=>v(o,l)))}(t[E],o,l,d).pipe(Vi(),Ar(T=>{v[E]=T}))),Pr(1),function ss(t){return(0,Lt.U)(()=>t)}(v),hi(E=>lt(E)?Gn.E:fn(E)))}(v,t,o,d).pipe((0,Lt.U)(E=>(t._resolvedData=E,t.data=ja(t,l).resolve,g&&Vs(g)&&(t.data[ur]=g.title),null)))}(E.route,d,t,o)),Ar(()=>v++),Pr(1),(0,mn.z)(E=>v===g.length?u(l):Gn.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Ar({next:()=>R=!0,complete:()=>{R||(this.restoreHistory(S),this.cancelNavigationTransition(S,"",2))}}))}),Ar(S=>{const R=new Ls(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}))}),nl(T=>{const S=R=>{const B=[];R.routeConfig?.loadComponent&&!R.routeConfig._loadedComponent&&B.push(this.configLoader.loadComponent(R.routeConfig).pipe(Ar($=>{R.component=$}),(0,Lt.U)(()=>{})));for(const $ of R.children)B.push(...S($));return B};return Pt(S(T.targetSnapshot.root)).pipe(Sn(),ui(1))}),nl(()=>this.afterPreactivation()),(0,Lt.U)(T=>{const S=function ac(t,o,l){const d=xo(t,o._root,l?l._root:void 0);return new vo(d,o)}(this.routeReuseStrategy,T.targetSnapshot,T.currentRouterState);return g={...T,targetRouterState:S}}),Ar(T=>{this.currentUrlTree=T.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(T.urlAfterRedirects,T.rawUrl),this.routerState=T.targetRouterState,"deferred"===this.urlUpdateStrategy&&(T.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,T),this.browserUrlTree=T.urlAfterRedirects)}),((t,o,l)=>(0,Lt.U)(d=>(new Pl(o,d.targetRouterState,d.currentRouterState,l).activate(t),d)))(this.rootContexts,this.routeReuseStrategy,T=>this.triggerEvent(T)),Ar({next(){v=!0},complete(){v=!0}}),Ji(()=>{v||E||this.cancelNavigationTransition(g,"",1),this.currentNavigation?.id===g.id&&(this.currentNavigation=null)}),hi(T=>{if(E=!0,no(T)){Kn(T)||(this.navigated=!0,this.restoreHistory(g,!0));const S=new ei(g.id,this.serializeUrl(g.extractedUrl),T.message,T.cancellationCode);if(d.next(S),Kn(T)){const R=this.urlHandlingStrategy.merge(T.url,this.rawUrlTree),B={skipLocationChange:g.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Da(g.source)};this.scheduleNavigation(R,"imperative",null,B,{resolve:g.resolve,reject:g.reject,promise:g.promise})}else g.resolve(!1)}else{this.restoreHistory(g,!0);const S=new zn(g.id,this.serializeUrl(g.extractedUrl),T,g.targetSnapshot??void 0);d.next(S);try{g.resolve(this.errorHandler(T))}catch(R){g.reject(R)}}return Gn.E}))}))}resetRootComponentType(l){this.rootComponentType=l,this.routerState.root.component=this.rootComponentType}setTransition(l){this.transitions.next({...this.transitions.value,...l})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(l=>{const d="popstate"===l.type?"popstate":"hashchange";"popstate"===d&&setTimeout(()=>{const g={replaceUrl:!0},v=l.state?.navigationId?l.state:null;if(v){const T={...v};delete T.navigationId,delete T.\u0275routerPageId,0!==Object.keys(T).length&&(g.state=T)}const E=this.parseUrl(l.url);this.scheduleNavigation(E,d,v,g)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(l){this.events.next(l)}resetConfig(l){this.config=l.map(Br),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(l,d={}){const{relativeTo:g,queryParams:v,fragment:E,queryParamsHandling:T,preserveFragment:S}=d,R=g||this.routerState.root,B=S?this.currentUrlTree.fragment:E;let $=null;switch(T){case"merge":$={...this.currentUrlTree.queryParams,...v};break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=v||null}return null!==$&&($=this.removeEmptyProps($)),kr(R,this.currentUrlTree,l,$,B??null)}navigateByUrl(l,d={skipLocationChange:!1}){const g=qo(l)?l:this.parseUrl(l),v=this.urlHandlingStrategy.merge(g,this.rawUrlTree);return this.scheduleNavigation(v,"imperative",null,d)}navigate(l,d={skipLocationChange:!1}){return function wi(t){for(let o=0;o<t.length;o++){if(null==t[o])throw new G.vHH(4008,false)}}(l),this.navigateByUrl(this.createUrlTree(l,d),d)}serializeUrl(l){return this.urlSerializer.serialize(l)}parseUrl(l){let d;try{d=this.urlSerializer.parse(l)}catch(g){d=this.malformedUriErrorHandler(g,this.urlSerializer,l)}return d}isActive(l,d){let g;if(g=!0===d?{...yc}:!1===d?{...so}:d,qo(l))return ho(this.currentUrlTree,l,g);const v=this.parseUrl(l);return ho(this.currentUrlTree,v,g)}removeEmptyProps(l){return Object.keys(l).reduce((d,g)=>{const v=l[g];return null!=v&&(d[g]=v),d},{})}processNavigations(){this.navigations.subscribe(l=>{this.navigated=!0,this.lastSuccessfulId=l.id,this.currentPageId=l.targetPageId,this.events.next(new Oi(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),l.resolve(!0)},l=>{this.console.warn(`Unhandled Navigation Error: ${l}`)})}scheduleNavigation(l,d,g,v,E){if(this.disposed)return Promise.resolve(!1);let T,S,R;E?(T=E.resolve,S=E.reject,R=E.promise):R=new Promise((K,X)=>{T=K,S=X});const B=++this.navigationId;let $;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(g=this.location.getState()),$=g&&g.\u0275routerPageId?g.\u0275routerPageId:v.replaceUrl||v.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):$=0,this.setTransition({id:B,targetPageId:$,source:d,restoredState:g,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:l,extras:v,resolve:T,reject:S,promise:R,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),R.catch(K=>Promise.reject(K))}setBrowserUrl(l,d){const g=this.urlSerializer.serialize(l),v={...d.extras.state,...this.generateNgRouterState(d.id,d.targetPageId)};this.location.isCurrentPathEqualTo(g)||d.extras.replaceUrl?this.location.replaceState(g,"",v):this.location.go(g,"",v)}restoreHistory(l,d=!1){if("computed"===this.canceledNavigationResolution){const g=this.currentPageId-l.targetPageId;"popstate"!==l.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===g?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===g&&(this.resetState(l),this.browserUrlTree=l.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(g)}else"replace"===this.canceledNavigationResolution&&(d&&this.resetState(l),this.resetUrlToCurrentUrlTree())}resetState(l){this.routerState=l.currentRouterState,this.currentUrlTree=l.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,l.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(l,d,g){const v=new ei(l.id,this.serializeUrl(l.extractedUrl),d,g);this.triggerEvent(v),l.resolve(!1)}generateNgRouterState(l,d){return"computed"===this.canceledNavigationResolution?{navigationId:l,\u0275routerPageId:d}:{navigationId:l}}}return t.\u0275fac=function(l){G.$Z()},t.\u0275prov=G.Yz7({token:t,factory:function(){return al()},providedIn:"root"}),t})();function Da(t){return"imperative"!==t}let Ta=(()=>{class t{constructor(l,d,g,v,E,T){this.router=l,this.route=d,this.tabIndexAttribute=g,this.renderer=v,this.el=E,this.locationStrategy=T,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Te.x;const S=E.nativeElement.tagName;this.isAnchorElement="A"===S||"AREA"===S,this.isAnchorElement?this.subscription=l.events.subscribe(R=>{R instanceof Oi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(l){this._preserveFragment=(0,G.D6c)(l)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(l){this._skipLocationChange=(0,G.D6c)(l)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(l){this._replaceUrl=(0,G.D6c)(l)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(l){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",l)}ngOnChanges(l){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(l){null!=l?(this.commands=Array.isArray(l)?l:[l],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(l,d,g,v,E){return!!(null===this.urlTree||this.isAnchorElement&&(0!==l||d||g||v||E||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const l=null===this.href?null:(0,G.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",l)}applyAttributeValue(l,d){const g=this.renderer,v=this.el.nativeElement;null!==d?g.setAttribute(v,l,d):g.removeAttribute(v,l)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return t.\u0275fac=function(l){return new(l||t)(G.Y36(ci),G.Y36(Fs),G.$8M("tabindex"),G.Y36(G.Qsj),G.Y36(G.SBq),G.Y36(kn.S$))},t.\u0275dir=G.lG2({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(l,d){1&l&&G.NdJ("click",function(v){return d.onClick(v.button,v.ctrlKey,v.shiftKey,v.altKey,v.metaKey)}),2&l&&G.uIk("target",d.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[G.TTD]}),t})(),Mu=(()=>{class t{constructor(l,d,g,v,E){this.router=l,this.element=d,this.renderer=g,this.cdr=v,this.link=E,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new G.vpe,this.routerEventsSubscription=l.events.subscribe(T=>{T instanceof Oi&&this.update()})}ngAfterContentInit(){u(this.links.changes,u(null)).pipe((0,kt.J)()).subscribe(l=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();const l=[...this.links.toArray(),this.link].filter(d=>!!d).map(d=>d.onChanges);this.linkInputChangesSubscription=(0,Ee.D)(l).pipe((0,kt.J)()).subscribe(d=>{this.isActive!==this.isLinkActive(this.router)(d)&&this.update()})}set routerLinkActive(l){const d=Array.isArray(l)?l:l.split(" ");this.classes=d.filter(g=>!!g)}ngOnChanges(l){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||Promise.resolve().then(()=>{const l=this.hasActiveLinks();this.isActive!==l&&(this.isActive=l,this.cdr.markForCheck(),this.classes.forEach(d=>{l?this.renderer.addClass(this.element.nativeElement,d):this.renderer.removeClass(this.element.nativeElement,d)}),l&&void 0!==this.ariaCurrentWhenActive?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(l))})}isLinkActive(l){const d=function Au(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return g=>!!g.urlTree&&l.isActive(g.urlTree,d)}hasActiveLinks(){const l=this.isLinkActive(this.router);return this.link&&l(this.link)||this.links.some(l)}}return t.\u0275fac=function(l){return new(l||t)(G.Y36(ci),G.Y36(G.SBq),G.Y36(G.Qsj),G.Y36(G.sBO),G.Y36(Ta,8))},t.\u0275dir=G.lG2({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(l,d,g){if(1&l&&G.Suo(g,Ta,5),2&l){let v;G.iGM(v=G.CRH())&&(d.links=v)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[G.TTD]}),t})();class Qo{}let _s=(()=>{class t{constructor(l,d,g,v,E){this.router=l,this.injector=g,this.preloadingStrategy=v,this.loader=E}setUpPreloading(){this.subscription=this.router.events.pipe(ji(l=>l instanceof Oi),Jn(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(l,d){const g=[];for(const v of d){v.providers&&!v._injector&&(v._injector=(0,G.MMx)(v.providers,l,`Route: ${v.path}`));const E=v._injector??l,T=v._loadedInjector??E;v.loadChildren&&!v._loadedRoutes&&void 0===v.canLoad||v.loadComponent&&!v._loadedComponent?g.push(this.preloadConfig(E,v)):(v.children||v._loadedRoutes)&&g.push(this.processRoutes(T,v.children??v._loadedRoutes))}return(0,Ee.D)(g).pipe((0,kt.J)())}preloadConfig(l,d){return this.preloadingStrategy.preload(d,()=>{let g;g=d.loadChildren&&void 0===d.canLoad?this.loader.loadChildren(l,d):u(null);const v=g.pipe((0,mn.z)(E=>null===E?u(void 0):(d._loadedRoutes=E.routes,d._loadedInjector=E.injector,this.processRoutes(E.injector??l,E.routes))));if(d.loadComponent&&!d._loadedComponent){const E=this.loader.loadComponent(d);return(0,Ee.D)([v,E]).pipe((0,kt.J)())}return v})}}return t.\u0275fac=function(l){return new(l||t)(G.LFG(ci),G.LFG(G.Sil),G.LFG(G.lqb),G.LFG(Qo),G.LFG(Uo))},t.\u0275prov=G.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const $s=new G.OlP("");let St=(()=>{class t{constructor(l,d,g,v={}){this.router=l,this.viewportScroller=d,this.zone=g,this.options=v,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},v.scrollPositionRestoration=v.scrollPositionRestoration||"disabled",v.anchorScrolling=v.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(l=>{l instanceof Mi?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=l.navigationTrigger,this.restoredId=l.restoredState?l.restoredState.navigationId:0):l instanceof Oi&&(this.lastId=l.id,this.scheduleScrollEvent(l,this.router.parseUrl(l.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(l=>{l instanceof cs&&(l.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(l.position):l.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(l.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(l,d){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.router.triggerEvent(new cs(l,"popstate"===this.lastSource?this.store[this.restoredId]:null,d))})},0)})}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(l){G.$Z()},t.\u0275prov=G.Yz7({token:t,factory:t.\u0275fac}),t})();function Ei(t,o){return{\u0275kind:t,\u0275providers:o}}function Nl(){const t=(0,G.f3M)(G.zs3);return o=>{const l=t.get(G.z2F);if(o!==l.components[0])return;const d=t.get(ci),g=t.get(Ul);1===t.get(ys)&&d.initialNavigation(),t.get(Sa,null,G.XFs.Optional)?.setUpPreloading(),t.get($s,null,G.XFs.Optional)?.init(),d.resetRootComponentType(l.componentTypes[0]),g.next(),g.complete()}}const Ul=new G.OlP("",{factory:()=>new Te.x}),ys=new G.OlP("",{providedIn:"root",factory:()=>1});const Sa=new G.OlP("");function Hs(t){return Ei(0,[{provide:Sa,useExisting:_s},{provide:Qo,useExisting:t}])}const ku=new G.OlP("ROUTER_FORROOT_GUARD"),ah=[kn.Ye,{provide:Me,useClass:we},{provide:ci,useFactory:al},Oo,{provide:Fs,useFactory:function Ia(t){return t.routerState.root},deps:[ci]},Uo,[]];function Lu(){return new G.PXZ("Router",ci)}let Qc=(()=>{class t{constructor(l){}static forRoot(l,d){return{ngModule:t,providers:[ah,[],{provide:gs,multi:!0,useValue:l},{provide:ku,useFactory:Ma,deps:[[ci,new G.FiY,new G.tp0]]},{provide:Ea,useValue:d||{}},d?.useHash?{provide:kn.S$,useClass:kn.Do}:{provide:kn.S$,useClass:kn.b0},{provide:$s,useFactory:()=>{const t=(0,G.f3M)(ci),o=(0,G.f3M)(kn.EM),l=(0,G.f3M)(G.R0b),d=(0,G.f3M)(Ea);return d.scrollOffset&&o.setOffset(d.scrollOffset),new St(t,o,l,d)}},d?.preloadingStrategy?Hs(d.preloadingStrategy).\u0275providers:[],{provide:G.PXZ,multi:!0,useFactory:Lu},d?.initialNavigation?hh(d):[],[{provide:xc,useFactory:Nl},{provide:G.tb,multi:!0,useExisting:xc}]]}}static forChild(l){return{ngModule:t,providers:[{provide:gs,multi:!0,useValue:l}]}}}return t.\u0275fac=function(l){return new(l||t)(G.LFG(ku,8))},t.\u0275mod=G.oAB({type:t}),t.\u0275inj=G.cJS({imports:[Bs]}),t})();function Ma(t){return"guarded"}function hh(t){return["disabled"===t.initialNavigation?Ei(3,[{provide:G.ip1,multi:!0,useFactory:()=>{const o=(0,G.f3M)(ci);return()=>{o.setUpLocationChangeListener()}}},{provide:ys,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Ei(2,[{provide:ys,useValue:0},{provide:G.ip1,multi:!0,deps:[G.zs3],useFactory:o=>{const l=o.get(kn.V_,Promise.resolve());let d=!1;return()=>l.then(()=>new Promise(v=>{const E=o.get(ci),T=o.get(Ul);(function g(v){o.get(ci).events.pipe(ji(T=>T instanceof Oi||T instanceof ei||T instanceof zn),(0,Lt.U)(T=>T instanceof Oi||T instanceof ei&&(0===T.code||1===T.code)&&null),ji(T=>null!==T),ui(1)).subscribe(()=>{v()})})(()=>{v(!0),d=!0}),E.afterPreactivation=()=>(v(!0),d||T.closed?u(void 0):T),E.initialNavigation()}))}}]).\u0275providers:[]]}const xc=new G.OlP("")}},Xn=>{Xn(Xn.s=339)}]);